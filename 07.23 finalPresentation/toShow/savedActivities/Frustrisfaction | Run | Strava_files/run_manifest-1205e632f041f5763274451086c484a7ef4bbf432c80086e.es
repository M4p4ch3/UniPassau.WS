(function(){Strava.module("Strava.Ui.Global"),Strava.Ui.Global=function(){function t(){}return t.prepareAutoresizingTextbox=function(){return jQuery(document).on("focus","textarea.autoresize",function(){var t;return t=jQuery(this),t.siblings("div.textarea-clone").length?void 0:t.addClass("noresize").after("<div class='textarea-clone'></div>").bind("keydown paste",function(){return setTimeout(function(){return function(){var e,i,r;return e=t.next(),r=t.val()+"W",e.text(r),i=e.outerHeight(),t.css("height",i)}}(this),10)})})},t}()}).call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/changing_activity_type"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<header>\n  <span class='left loading status'></span>\n  <h3 class='left'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.edit.changing_type")))),i.push("  </h3>\n</header>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ChangingActivityTypeView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="edit-activity",i.prototype.template="activities/changing_activity_type",i.prototype.initialize=function(){return this.renderTemplate()},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ChangingActivityTypeLightboxView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.options=t,this.lightbox=new Strava.Ui.LightboxView("edit_activity"),this.editView=new Strava.Labs.Activities.ChangingActivityTypeView,this.model.on("updated",this.handleUpdated,this).on("typeChange:start",this.handleTypeChangeStart,this).on("typeChange:end",this.handleTypeChangeEnd,this)},i.prototype.render=function(){return this.lightbox.renderWithRenderer(this.editView),this.lightbox.disableCloseControls(),this},i.prototype.handleUpdated=function(){return this.model.get("is_changing_type")?void 0:this.lightbox.closeBox()},i.prototype.handleTypeChangeStart=function(t){return t.pollForTypeChange()},i.prototype.handleTypeChangeEnd=function(){return window.location.reload(!0)},i.show=function(t){return this.instance||(this.instance=new Strava.Labs.Activities.ChangingActivityTypeLightboxView({model:t})),this.instance.render()},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ChangingActivityType=function(){function t(){}return t.displayOverlay=function(t){return t.set({is_changing_type:!0}),Strava.Labs.Activities.ChangingActivityTypeLightboxView.show(t),t.trigger("typeChange:start",t)},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamTransform=function(){function t(){}return t.prototype.transform=function(t,e){return e},t.prototype.dependentStreams=function(){return[]},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ConvertedUnitStreamTransform=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.transform=function(t,e){var i,r,n;return n=this.constructor,r=function(){switch(t){case"distance":case"grade_adjusted_distance":case"altitude":return i=n.metersToConverted(t),function(t){return i*t};case"grade_adjusted_pace":case"pace":case"instantaneous_pace":case"instantaneous_grade_adjusted_pace":return i=n.metersToConverted(t),function(t){return t/i};case"velocity":case"velocity_smooth":return i=n.metersToConverted(t),function(t){return t*i*3600};case"temp":return n.getMeasurementUnits().tempConvert;default:return null}}(),r?e.map(r):e},i.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},i.metersToConverted=function(t){var e;switch(e=this.getMeasurementUnits(),t){case"distance":case"grade_adjusted_distance":case"pace":case"grade_adjusted_pace":case"velocity":case"velocity_smooth":case"instantaneous_pace":case"instantaneous_grade_adjusted_pace":return e.longConvert;case"altitude":return e.shortConvert;default:return 1}},i.convertedToMeters=function(t){return 1/this.metersToConverted(t)},i.conversions=function(){return["distance","grade_adjusted_distance","altitude"].reduce(function(t){return function(e,i){return e[i]=t.convertedToMeters(i),e}}(this),{})},i}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){Strava.module("Strava.Labs.Activities.Pages"),Strava.Labs.Activities.PrimaryPhoto=function(){function t(t){this.primaryPhotoUrl=t}return t.prototype.render=function(){return jQuery("#primary-photo").css("background-image","url("+this.primaryPhotoUrl+")"),jQuery("#logo-zwift").show(),jQuery("#primary-photo-loader").remove()},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.SocialController=function(e){function i(){this.hash={},i.__super__.constructor.call(this)}return t(i,e),i.prototype.addToHash=function(t,e){return e.length||(e=[]),this.hash[t]=e},i.prototype.addToKey=function(t,e){return null==this.hash[t]&&(this.hash[t]=[]),this.hash[t].push(e)},i.prototype.setHash=function(t){return""!==t?this.hash=t:void 0},i.prototype.getFromHash=function(t){return this.hash[t]||[]},i.prototype.existsInHash=function(t){return null!=this.hash[t]},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.AchievementsController=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.fetchAchievements=function(t,e,i,r){var n;return n=t+"-"+e,this.existsInHash(n)?void i(this.getFromHash(n)):this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"achievements"),success:function(t){return function(e,r){var a;return a=r.achievements,t.addToHash(n,a),i(a)}}(this),error:function(t,e){return null!=r?r(e):void 0}})},i}(Strava.Lib.SocialController)}.call(this),function(){Strava.module("Strava.Lib"),Strava.Lib.CacheableModel={REQUEST_CACHE:{},read:function(t,e){var i,r,n;return n=t.url(),r=jQuery.Deferred(),i=Strava.Lib.CacheableModel.REQUEST_CACHE[n],null!=i?(t.set(i,e),r.resolve(i)):Backbone.sync("read",t,e).done(function(i){return t.set(i,e),Strava.Lib.CacheableModel.REQUEST_CACHE[n]=_.clone(i)}).done(function(){return r.resolve()}).fail(function(){return r.reject()}),r.promise()},sync:function(t,e,i){var r;return null==i&&(i={}),r=function(){switch(t){case"read":return i.cache?Strava.Lib.CacheableModel.read(e,i):Backbone.sync("read",e,i);case"create":throw new Error("Create not supported");case"update":throw new Error("Update not supported");case"delete":throw new Error("Delete not supported")}}(),i.success&&r.done(function(){return i.success()}),i.error&&r.fail(function(){return i.error()}),r}}}.call(this),function(){Strava.module("Strava.Lib"),Strava.Lib.EntityMap=function(){function t(){}return t.entity_map={Activity:"activity",AthleteFeedEntry:"athlete-feed-entry",Post:"post"},t.getUrl=function(t,e,i){return"/feed/"+this.entity_map[t]+"/"+e+"/"+i},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.CommentsController=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){return this.commentable=!0},i.prototype.comment=function(t,e,i){var r,n;return r={comment:i},n=t+"-"+e,this.save(null,{url:Strava.Lib.EntityMap.getUrl(t,e,"comment"),type:"POST",data:JSON.stringify(r),contentType:"application/json",success:function(t){return function(e,i){return t.addToKey(n,i),t.dispatchCommentCreate(i,n)}}(this),complete:function(t){return function(){return t.dispatchCommentCompleted(n)}}(this)})},i.prototype.dispatchCommentCreate=function(t,e){return this.trigger("commentCreated",t,e)},i.prototype.dispatchCommentCompleted=function(t){return this.trigger("commentCompleted",t)},i.prototype.dispatchCommentDelete=function(t,e){return this.trigger("commentDeleted",t,e)},i.prototype.dispatchCommentsReturned=function(t){return this.trigger("commentsReturned",t)},i.prototype.deleteComment=function(t,e){return this.fetch({url:"/feed/comment",type:"DELETE",data:JSON.stringify({id:e}),contentType:"application/json",success:function(i){return function(r,n){return i.removeCommentFromHash(t,e),i.dispatchCommentDelete(t,n)}}(this)})},i.prototype.parse=function(){return{id:1}},i.prototype.removeCommentFromHash=function(t,e){var i,r,n,a,s,o;for(r=this.getFromHash(t),o=[],n=a=0,s=r.length;s>a;n=++a){if(i=r[n],i.comment_id===e){r.splice(n,1);break}o.push(void 0)}return o},i.prototype.fetchComments=function(t,e,i,r){var n;return n=t+"-"+e,this.existsInHash(n)?void i(this.getFromHash(n)):this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"comments"),success:function(t){return function(e,r){var a;return a=r.comments,t.addToHash(n,a),i(a)}}(this),error:function(t,e){return null!=r?r(e):void 0}})},i.prototype.forceFetchComments=function(t,e){var i;return i=t+"-"+e,this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"comments"),success:function(t){return function(e,r){return t.addToHash(i,r.comments)}}(this)})},i}(Strava.Lib.SocialController)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.KudosController=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.kudo=function(t,e){return this.save(null,{url:Strava.Lib.EntityMap.getUrl(t,e,"kudo"),contentType:"application/json",type:"POST",success:function(i){return function(){return i.dispatchKudosCreate(t,e)}}(this)})},i.prototype.dispatchKudosCreate=function(t,e){return this.trigger("kudoCreated",t,e)},i.prototype.fetchKudos=function(t,e,i,r){return this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"kudos"),success:function(t,e){return i(e.athletes,e.kudosable,e.isOwner)},error:function(){return r("")}})},i.prototype.parse=function(){return{id:1}},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.Athlete=function(e){function i(t,e){this.url=t,this.id=e,i.__super__.constructor.call(this)}return t(i,e),i.prototype.get=function(t){var e,r,n,a,s,o;switch(t){case"name":return r=i.__super__.get.call(this,"firstname"),r=null!=r?r:"",n=i.__super__.get.call(this,"lastname"),n=null!=n?n:"",[r,n];case"birthday":return o=i.__super__.get.call(this,"dateofbirth(1i)"),s=i.__super__.get.call(this,"dateofbirth(2i)"),e=i.__super__.get.call(this,"dateofbirth(3i)"),[s,e,o];case"location":return a=i.__super__.get.call(this,"city")+", "+i.__super__.get.call(this,"state")+" "+i.__super__.get.call(this,"country"),jQuery.trim(a).replace(/^,\s/,"").replace(/,$/,"");default:return i.__super__.get.call(this,t)}},i.prototype.set=function(t,e){var r,n,a,s,o,l,c;if(null!=t)return null!=t.name&&(l=t.name,a=l[0],s=l[1],t.firstname=a,t.lastname=s,delete t.name,t.modified=""),null!=t.birthday&&(r=t.birthday,o=r[0],n=r[1],c=r[2],t["dateofbirth(2i)"]=o,t["dateofbirth(3i)"]=n,t["dateofbirth(1i)"]=c,delete t.birthday,t.modified=""),i.__super__.set.call(this,t,e)},i.prototype.parse=function(t){var e,i;return e=jQuery.extend(!0,{},t),i=null!=e.success&&e.success,null!=e.success&&delete e.success,i?e:{}},i.prototype.toJSON=function(t){return"boolean"==typeof t&&t===!0?i.__super__.toJSON.call(this):{athlete:i.__super__.toJSON.call(this,t)}},i}(Backbone.Model),Strava.Athletes.PremiumAthlete=function(e){function i(t){this.id=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.url="/account/athlete_detail",i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava"),Strava.base_module={initializeAttributes:function(t){var e,i,r;i=[];for(e in t)r=t[e],i.push(this.initAttribute(e,r));return i},setOrGet:function(t,e){return void 0!==e?(this[t]=e,this):this[t]},initAttribute:function(t,e){var i;return this.constructor.prototype[t]=function(t){return this.setOrGet(i,t)},i="_"+t,this[i]=!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor?e:_.clone(e)},create_template:function(t){var e;return e=jQuery(t),this.template=_.template(e.html())},create_template_for:function(t){var e;return e=jQuery(t),_.template(e.html())}},Strava.chart_module={shouldAnimate:function(t){return null!=this.animate()?this.animate():t}},Strava.local_storage_module={initializeStorageAttributes:function(t,e,i){var r,n,a;null==i&&(i=!1),i&&this.setLocalStorage(e,{}),n=[];for(r in t)a=t[r],n.push(this.initStorageAttribute(r,a,e));return n},getLocalStorage:function(t){var e;return e=localStorage[t],e?JSON.parse(localStorage[t])||{}:{}},setLocalStorage:function(t,e){return localStorage[t]=JSON.stringify(e)},setOrGetStorage:function(t,e,i){var r;return r=this.getLocalStorage(i),void 0!==e?(r[t]=e,this.setLocalStorage(i,r),this):r[t]},initStorageAttribute:function(t,e,i){var r,n;if(this.constructor.prototype[t]=function(t){return this.setOrGetStorage(r,t,i)},r="_"+t,!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor)return n=this.setOrGetStorage(r,void 0,i),void 0!==n&&(e=n),this.setOrGetStorage(r,e,i);throw new Error("cannot store non-primitive types in localstorage")}},Strava.Base=function(){function t(){}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.base_module),t.prototype.$=function(t,e){return e.find(t)},t.prototype.$$=function(t){return jQuery(t)},t.prototype.$document=function(){return jQuery(document)},t.prototype.one=function(t,e,i){var r,n,a,s;return s=this,r=e,n=t,a=function(){return r.call(this),s.unbind(n,a)},this.bind(t,a,i)},t.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},t.prototype.isTouchDevice=function(){return Modernizr?Modernizr.touch:!1},t}(),Strava.Controller=function(e){function i(){i.__super__.constructor.call(this)}return t(i,e),Strava.includeModule(i,Strava.base_module),i.prototype.parse=function(){return{id:0}},i}(Backbone.Model)}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.I18n=function(){function t(){}return t.stringFormatter=function(t){return new Strava.Util.I18n.StringFormatter(t)},t}(),Strava.Util.I18n.StringFormatter=function(){function t(t){this.RE_URL_ENDING="(?:"+this.RE_URL_MIDCHAR+"*"+this.RE_URL_ENDCHAR+")?",this.RE_FULL_URL=this.RE_URL_SCHEME+"\\w+(?:.\\w+)"+this.RE_URL_ENDING,this.RE_OTHER_URL="\\w[\\w_-]*(?:\\.\\w[\\w_-]*)*\\."+this.RE_TLD+"(?:\\/"+this.RE_URL_ENDING+")?\\b",this.text=t}return t.prototype.RE_EMAIL_PATTERN="\\b[\\w.-]+\\+*[\\w.-]+@(?:(?:[\\w-]+\\.)+[A-Za-z]{2,6}|(?:\\d{1,3}\\.){3}\\d{1,3})",t.prototype.RE_TLD="(?:aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)",t.prototype.RE_URL_MIDCHAR="[\\S]",t.prototype.RE_URL_ENDCHAR="[\\w@?^=%&/~+#-]",t.prototype.RE_URL_SCHEME="(?:http|ftp|https|news|mms)://",t.prototype.pluralize=function(t){var e;return e=t>1?this.text+"s":this.text,t+" "+e},t.prototype.nl2br=function(){var t;return null===this.text||void 0===this.text?(this.text="",this):(t=(""+this.text).replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />"),this.text=t,this)},t.prototype.truncate=function(t,e){return null==e&&(e="..."),null==this.text&&(this.text=""),this.text.length>t&&(this.text=this.text.substring(0,t-e.length).trim()+e),this},t.prototype.linkify=function(t){var e;return e=this.text,e=this.match_and_replace(this.RE_EMAIL_PATTERN,e,!1,!1,t),e=this.match_and_replace(this.RE_FULL_URL,e,!0,!1,t),e=this.match_and_replace(this.RE_OTHER_URL,e,!0,!0,t),this.text=e,this},t.prototype.match_and_replace=function(t,e,i,r,n){var a,s,o,l,c,h,u,p,d,f,v,m,g,y;for(g=f=p=h=c=0,l=/<\/[aA]>/,v=new RegExp(t,"g"),u={},d=20;(u=v.exec(e))&&(c++,!(c>d));)if(g=u.index,p=u[0].length,y=e.substring(f,g),y.search(/<[aA]/)>=0){if(l.lastIndex=f,o=e.substring(f,e.length).search(l),0>o)return e;h=o+f,v.lastIndex=h+4,f=h+4}else s=e.substr(g,p),a=e.substr(g,p),r&&(a="http://"+a),m='<a target="_blank" rel="nofollow noopener noreferrer" href="',i||(m+="mailto:"),a=a.replace(/"/g,"%22"),m+=a+'"',m+=' title="',m+=i?a:"Email "+a,m+='"',n&&s.length>n&&(s=s.substr(0,n)+"..."),m+=">"+s.replace(new RegExp("([/=])","g"),"<wbr>$1")+"</a>",e=e.slice(0,g)+m+e.slice(g+p,e.length),v.lastIndex=g+m.length,f=g+m.length;return e},t.prototype.end=function(){var t;return t=this.text,this.text=null,t},t.prototype.start=function(t){return this.text=t,this},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Lap=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.distancePer100=function(){return this.get("abbr").speed.short.match(/\/100/)},i.prototype.distanceConversion=function(){return this.distancePer100()?strava.i18n.measurementUnits().mediumConvert:strava.i18n.measurementUnits().longConvert},i.prototype.altitudeConversion=function(){return strava.i18n.measurementUnits().shortConvert},i.prototype.indices=function(){return[this.get("start_index"),this.get("end_index")]},i.prototype.spans=function(t,e){return this.get("start_index")===t&&this.get("end_index")===e},i.prototype.elevationDifference=function(){return this.get("elev_difference")*this.altitudeConversion()},i.prototype.elevationGainLoss=function(){return this.has("raw_stream_split")?this.get("raw_stream_split").elevation():null},i.prototype.distance=function(){return this.get("distance")*this.distanceConversion()},i.prototype.defaultTimeKey=function(){var t;return t=this.collection.activity,null!=t&&t.isRun()&&!t.isRace()?"moving_time":"elapsed_time"},i.prototype.defaultSpeedKey=function(){var t;return t=this.collection.activity,null!=t&&t.isRun()&&!t.isRace()?"avg_moving_speed":"avg_speed"},i.prototype.time=function(){return this.get(this.defaultTimeKey())},i.prototype.speed=function(t){return null==t&&(t={}),this.avgSpeed(_.extend({},t,{speed:this.defaultSpeedKey()}))},i.prototype.hasSpeed=function(){return!!this.speed()},i.prototype.formatNumber=function(t,e){return null==e&&(e=0),null==t?"":(new TwitterCldr.DecimalFormatter).format(t,{precision:e})},i.prototype.formatTime=function(t){return(new Strava.I18n.TimespanFormatter).display(t)},i.prototype.formattedPace=function(t){var e,i,r,n;return null==t&&(t="avg_speed"),n=this.get(t),0===n?null:(e=n*this.distanceConversion(),this.distancePer100()&&(e/=100),i=e/3600,r=1/i,this.formatTime(r))},i.prototype.avgSpeed=function(t){return null==t&&(t={}),t=_.extend({si:!1,speed:"avg_speed"},t),t.si?this.get(t.speed)/3600:this.get(t.speed)*this.distanceConversion()},i.prototype.avgGap=function(){return this.has("raw_stream_split")?this.get("raw_stream_split").gap():null},i.prototype.grade=function(){return 100*this.get("elev_difference")/this.get("distance")},i.prototype.summarize=function(){var t;return t=this.get("abbr"),{lap:this,index:this.get("index"),distance:{value:this.formatNumber(this.distance(),this.distancePer100()?0:1),abbr:{title:t.distance.long,value:t.distance.short}},time:this.formatTime(this.get("elapsed_time")),elapsed_time:this.get("elapsed_time"),elevation:{value:this.elevationGainLoss(),abbr:{title:t.elevation.long,value:t.elevation.short},grade:{value:this.formatNumber(this.grade(),1),abbr:{value:"%"}}},heartrate:{value:this.formatNumber(this.get("avg_hr")),abbr:{title:t.heartrate.long,value:t.heartrate.short}},pace:{value:this.formattedPace(),abbr:{title:t.speed.long,value:t.speed.short}},gap:{value:this.avgGap(),abbr:{title:t.speed.long,value:t.speed.short}},speed:{value:this.formatNumber(this.avgSpeed(),1),abbr:{title:t.speed.long,value:t.speed.short}},power:{value:this.formatNumber(this.get("avg_watts")),abbr:{title:t.power.long,value:t.power.short}}}},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Laps=function(e){function i(t){this.activity=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.model=Strava.Models.Lap,i.prototype.url=function(){return"/activities/"+this.activity.id+"/lap_efforts"},i}(Backbone.Collection)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EffortRowView=function(e){function i(t,e,r){this.viewModel=t,this.template=e,this.supportsGap=r,this.viewModel.on("select",this.select,this),this.viewModel.on("unselect",this.unselect,this),this.viewModel.on("highlight",this.highlight,this),this.viewModel.on("unhighlight",this.unhighlight,this),i.__super__.constructor.call(this)}return t(i,e),i.prototype.tagName="tr",i.prototype.events={click:"handleClick",mouseover:"handleMouseOver",mouseout:"handleMouseOut"},i.prototype.render=function(){return this.viewModel.hasFullColumns&&this.$el.addClass("full-columns"),this.renderTemplate(_.extend(this.viewModel.summarize(),{supportsGap:this.supportsGap})),this},i.prototype.select=function(){return this.$el.addClass("selected")},i.prototype.unselect=function(){return this.$el.removeClass("selected")},i.prototype.highlight=function(){return this.$el.addClass("highlighted")},i.prototype.unhighlight=function(){return this.$el.removeClass("highlighted")},i.prototype.handleClick=function(){return this.viewModel.toggleSelect({broadcast:!0})},i.prototype.handleMouseOver=function(){return this.viewModel.highlight({broadcast:!0})},i.prototype.handleMouseOut=function(){return this.viewModel.unhighlight({broadcast:!0})},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EffortRowViewModel=function(){function t(t,e,i,r){this.effortIntensityVisible=t,this.hasFullColumns=e,this.effort=i,this.dispatcher=r,this.selected=!1,this.highlighted=!1}return Strava.includeModule(t,Backbone.Events),t.prototype.toggleSelect=function(t){return null==t&&(t={}),this.selected?this.unselect(t):this.select(t)},t.prototype.select=function(t){return null==t&&(t={}),this.selected=!0,this.trigger("select"),t.broadcast?this.dispatcher.trigger("select",this):void 0},t.prototype.unselect=function(t){return null==t&&(t={}),this.selected=!1,this.trigger("unselect"),t.broadcast?this.dispatcher.trigger("unselect",this):void 0},t.prototype.highlight=function(t){return null==t&&(t={}),this.highlighted=!0,this.trigger("highlight"),t.broadcast?this.dispatcher.trigger("highlight",this):void 0},t.prototype.unhighlight=function(t){return null==t&&(t={}),this.highlighted=!1,this.trigger("unhighlight"),t.broadcast?this.dispatcher.trigger("unhighlight",this):void 0},t.prototype.indices=function(){return this.effort.indices()},t.prototype.summarize=function(){return _.extend(this.effort.summarize(),{effortIntensityVisible:this.effortIntensityVisible,hasFullColumns:this.hasFullColumns})},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EffortsTableContext=function(){function t(t){this.eventDispatcher=t}return Strava.includeModule(t,Backbone.Events),t.prototype.getEfforts=function(){throw"Must be overriden"},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EffortsTableView=function(e){function i(t,e){this.el=t,this.tableViewModel=e,i.__super__.constructor.call(this),this.tableViewModel.effortsLoaded()?this.render():this.tableViewModel.on("ready",function(t){return function(){return t.render()}}(this))}return t(i,e),i.prototype.render=function(){throw"Implement in subclass"},i.prototype.renderLaps=function(){throw"Implement in subclass"},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EventDispatcher=function(e){function i(){i.__super__.constructor.call(this),this.mouseIndexes={},this.hoverExtent=null,this.selection=null}return t(i,e),i.prototype.addListener=function(t,e){return this.bind("mouseOver",function(i,r,n){return t!==i?e.handleStreamMouseOver(r,n):void 0}),this.bind("slide",function(i,r,n){return t!==i&&null!=e.handleStreamSlide?e.handleStreamSlide(r,n):void 0}),this.bind("slideReset",function(i,r,n){return t!==i&&null!=e.handleStreamSlideReset?e.handleStreamSlideReset(r,n):void 0}),this.bind("mouseOut",function(i,r){return t!==i&&null!=e.handleStreamMouseOut?e.handleStreamMouseOut(r):void 0}),this.bind("click",function(i,r,n){return t!==i?e.handleStreamClick(r,n):void 0}),this.bind("doubleClick",function(i,r,n){return t!==i?e.handleStreamDoubleClick(r,n):void 0}),this.bind("hover",function(i,r,n,a){return t!==i&&null!=e.handleStreamHover?e.handleStreamHover(r,n,a):void 0}),this.bind("hoverOut",function(i,r,n,a){return t!==i&&null!=e.handleStreamHoverOut?e.handleStreamHoverOut(r,n,a):void 0}),this.bind("select",function(i,r,n,a){return t!==i?e.handleStreamSelect(r,n,a):void 0}),this.bind("unselect",function(i,r,n,a){return t!==i?e.handleStreamUnselect(r,n,a):void 0}),this.bind("zoomSelect",function(i,r,n,a,s){return t!==i&&null!=e.handleZoomSelect?e.handleZoomSelect(r,n,a,s):void 0}),this.bind("zoomUnselect",function(i,r,n,a){return t!==i&&null!=e.handleZoomUnselect?e.handleZoomUnselect(r,n,a):void 0}),this.bind("indexedZoom",function(i,r,n,a){return t!==i&&null!=e.handleIndexedZoom?e.handleIndexedZoom(r,n,a):void 0}),this.bind("initiateZoom",function(i,r,n,a){return t!==i&&null!=e.handleInitiateZoom?e.handleInitiateZoom(r,n,a):void 0}),this.bind("zoomChange",function(i,r){return t!==i&&null!=e.handleZoomChange?e.handleZoomChange(i,r):void 0}),this.bind("changeXAxisType",function(i,r){return t!==i&&null!=e.handleChangeXAxisType?e.handleChangeXAxisType(r):void 0}),this.bind("markerClick",function(i,r,n,a){return t!==i&&null!=e.handleMarkerClick?e.handleMarkerClick(r,n,a):void 0})},i.prototype.dispatchMouseOver=function(t,e,i){return this.mouseIndexes[e]!==i?(this.mouseIndexes[e]=i,this.trigger("mouseOver",t,e,i)):void 0},i.prototype.dispatchSlide=function(t,e,i){return this.trigger("slide",t,e,i)},i.prototype.dispatchSlideReset=function(t,e,i){return this.trigger("slideReset",t,e,i)},i.prototype.dispatchClick=function(t,e,i){return this.trigger("click",t,e,i)},i.prototype.dispatchDoubleClick=function(t,e,i){return this.trigger("doubleClick",t,e,i)},i.prototype.dispatchHover=function(t,e,i,r){return this.hoverExtent=[i,r],null==this.selection?this.trigger("hover",t,e,i,r):void 0},i.prototype.dispatchUnconditionalHover=function(t,e,i,r){return this.hoverExtent=[i,r],this.trigger("hover",t,e,i,r)},i.prototype.dispatchHoverOut=function(t,e,i,r){return this.hoverExtent=null,null==this.selection?this.trigger("hoverOut",t,e,i,r):void 0},i.prototype.dispatchSelect=function(t,e,i,r){return this.selection=[i,r],this.trigger("select",t,e,i,r)},i.prototype.dispatchUnselect=function(t,e,i,r){var n,a,s;return this.selection=null,this.trigger("unselect",t,e,i,r),this.hoverExtent?(s=this.hoverExtent,a=s[0],n=s[1],this.trigger("hover",t,e,a,n)):void 0},i.prototype.dispatchZoomSelect=function(t,e,i,r,n){return this.trigger("zoomSelect",t,e,i,r,n)},i.prototype.dispatchZoomUnselect=function(t,e,i,r){return this.trigger("zoomUnselect",t,e,i,r)},i.prototype.dispatchMouseOut=function(t,e){return-1===this.mouseIndexes[e],this.trigger("mouseOut",t,e)},i.prototype.dispatchIndexedZoom=function(t,e,i,r){return this.trigger("indexedZoom",t,e,i,r)},i.prototype.dispatchInitiateZoom=function(t,e,i,r){return this.trigger("initiateZoom",t,e,i,r)},i.prototype.dispatchZoomChange=function(t,e){return this.trigger("zoomChange",t,e)},i.prototype.dispatchChangeXAxisType=function(t,e){return this.trigger("changeXAxisType",t,e)},i.prototype.dispatchMarkerClick=function(t,e,i,r){return this.trigger("markerClick",t,e,i,r)},i.prototype.reset=function(){return this.off(),this.selection=null,this.hoverExtent=null},i}(Strava.Base),Strava.Labs.Activities.listener_module={handleStreamMouseOver:function(){},handleStreamSlide:function(){},handleStreamSlideReset:function(){},handleStreamMouseOut:function(){},handleStreamClick:function(){},handleStreamDoubleClick:function(){},handleStreamSelect:function(){},handleStreamUnselect:function(){},handleStreamHover:function(){},handleStreamHoverOut:function(){},handleChangeXAxisType:function(){},handleMarkerClick:function(){}}}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EffortsTableViewModel=function(){function t(t,e){this.context=t,this.pageEventTag=e,this.context.eventDispatcher.addListener(this,this),this.effortDispatcher=_.extend({},Backbone.Events),this.effortDispatcher.on("select",this.select,this),this.effortDispatcher.on("unselect",this.unselect,this),this.effortDispatcher.on("highlight",this.highlight,this),this.effortDispatcher.on("unhighlight",this.unhighlight,this),this._effortIntensityVisible=!1}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.Labs.Activities.listener_module),t.prototype.effortIntensityVisible=function(t){return void 0!==t?this._effortIntensityVisible=t:this._effortIntensityVisible},t.prototype.effortsLoaded=function(){return this.context.effortsLoaded()},t.prototype.getViewModels=function(){var t;return this.viewModels?this.viewModels:(t=this.context.getEfforts(),t?this.viewModels=t.map(function(t){return function(e){return new Strava.Labs.Activities.EffortRowViewModel(t.effortIntensityVisible(),t.hasFullColumns(),e,t.effortDispatcher)}}(this)):[])},t.prototype.each=function(t){return this.getViewModels().forEach(t)},t.prototype.findEffort=function(t,e){return _.find(this.getViewModels(),function(i){return i.effort.spans(t,e)})},t.prototype.findEffortById=function(t){return _.find(this.getViewModels(),function(e){return e.effort.id===t
})},t.prototype.effortIndices=function(t){return this.context.chartContext.convertStreamIndices(t.indices())},t.prototype.select=function(t){var e,i,r;return this.selected&&(this.selected.unselect(),this.unselect(this.selected)),this.selected=t,i=this.effortIndices(t),r=i[0],e=i[1],this.context.eventDispatcher.dispatchSelect(this,"efforts",r,e)},t.prototype.unselect=function(t){var e,i,r;return this.selected=null,i=this.effortIndices(t),r=i[0],e=i[1],this.context.eventDispatcher.dispatchUnselect(this,"efforts",r,e)},t.prototype.highlight=function(t){var e,i,r;return i=this.effortIndices(t),r=i[0],e=i[1],this.context.eventDispatcher.dispatchHover(this,"efforts",r,e)},t.prototype.unhighlight=function(t){var e,i,r;return i=this.effortIndices(t),r=i[0],e=i[1],this.context.eventDispatcher.dispatchHoverOut(this,"efforts",r,e)},t.prototype.handleStreamSelect=function(t,e,i){var r;if(t===this.pageEventTag)return r=this.findEffort(e,i),this.selected&&(this.selected.unselect(),this.selected.unhighlight()),this.selected=r,r.select()},t.prototype.handleStreamUnselect=function(t,e,i){var r;if(t===this.pageEventTag)return this.selected=null,r=this.findEffort(e,i),r.unselect()},t.prototype.handleStreamHover=function(t,e,i){var r;if(t===this.pageEventTag)return r=this.findEffort(e,i),r.highlight()},t.prototype.handleStreamHoverOut=function(t,e,i){var r;if(t===this.pageEventTag)return r=this.findEffort(e,i),r.unhighlight()},t.prototype.handleStreamMouseOver=function(){},t.prototype.handleStreamMouseOut=function(){},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.LapEffortsTableContext=function(e){function i(t,e,n,a,s){var o;this.lapsCollection=t,this.chartContext=e,this.streamIndexOffset=s,i.__super__.constructor.call(this,n),this.deferred=new jQuery.Deferred,a.require(r),o=this.lapsCollection.fetch({success:function(t){return function(e){return t.laps=e}}(this)}),jQuery.when(a.deferred,o).then(function(t){return function(){return t.handleReady()}}(this))}var r;return t(i,e),r=["time","distance","altitude","heartrate","cadence","pace","grade_adjusted_pace"],i.prototype.getEfforts=function(){return this.laps},i.prototype.effortsLoaded=function(){return null!=this.laps},i.prototype.getUnit=function(t){return this.chartContext.getUnit(t)},i.prototype.handleReady=function(){return this.laps.forEach(function(t){return function(e){var i,r,n,a,s;return r=t.chartContext.convertStreamIndices([e.get("start_index"),e.get("end_index")]),n=r[0],i=r[1],a=new Strava.Labs.Activities.StreamSplit(t.chartContext.streamsContext.data,n,i),s=a.summarize(),e.set({stream_split:s,raw_stream_split:a,start_index:n,end_index:i})}}(this)),this.trigger("lapsLoaded"),this.deferred.resolve()},i}(Strava.Labs.Activities.EffortsTableContext)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.LapEffortsTableViewModel=function(e){function i(t){i.__super__.constructor.call(this,t,"laps"),this.context.on("lapsLoaded",function(t){return function(){return t.trigger("ready")}}(this))}return t(i,e),i.prototype.hasFullColumns=function(){return this.hasHeartrate()?!0:!1},i.prototype.effortIndices=function(t){return t.indices()},i.prototype.getUnit=function(t){return this.context.getUnit(t)},i.prototype.hasHeartrate=function(){return this.context.effortsLoaded()&&this.hasEfforts()&&this.context.getEfforts().at(0).has("avg_hr")},i.prototype.hasEfforts=function(){return this.context.getEfforts().length>0},i}(Strava.Labs.Activities.EffortsTableViewModel)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_other"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps-list'>\n  <thead>\n    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n      <th>\n        <abbr title='"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elevation_gain_loss")))+"'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elev")))),i.push("        </abbr>\n      </th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.speed")))+"</th>"),this.hasHeartrate&&i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>"),i.push("    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps-list'>\n  <thead>\n    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n      <th>\n        <abbr title='"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elevation_gain_loss")))+"'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elev")))),i.push("        </abbr>\n      </th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.speed")))+"</th>"),this.effortIntensityVisible?(i.push("      <th colspan='"+e(t(2))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.power")))),i.push("        /\n        <span class='glossary-link power-version' data-glossary-term='definition-segment-intensity' href='javascript:;'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.effort_intensity")))),i.push("        </span>\n      </th>")):i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.power")))+"</th>"),this.hasHeartrate&&i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>"),i.push("    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps marginless padded-values'>\n  <thead>\n    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n      <th>\n        <span class='glossary-link run-version' data-glossary-term='definition-elapsed-time'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.pace")))),i.push("        </span>\n      </th>\n      <th>\n        <abbr class='glossary-link run-version' title='"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.grade_adjusted_pace")))+"' data-glossary-term='definition-gap'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.gap")))),i.push("        </abbr>\n      </th>\n      <th>\n        <abbr title='"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elevation_gain_loss")))+"'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elev")))),i.push("        </abbr>\n      </th>"),this.hasHeartrate&&i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>"),i.push("    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_run_narrow"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<section class='laps with-border'>\n  <h3>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.laps")))+"</h3>\n  <table class='dense hoverable labs laps marginless run'>\n    <thead>\n      <tr>\n        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.pace")))+"</th>\n        <th>\n          <abbr class='glossary-link run-version' title='"+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.grade_adjusted_pace")))+"' data-glossary-term='definition-gap'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.gap")))),i.push("          </abbr>\n        </th>"),i.push(this.hasHeartrate?"        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>":"        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elev")))+"</th>"),i.push("      </tr>\n    </thead>\n    <tbody></tbody>\n  </table>\n</section>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_swim"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps padded-values'>\n  <thead>\n    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.pace")))+"</th>"),this.hasHeartrate&&i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>"),i.push("    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_stationary_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps-list'>\n  <thead>\n    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.speed")))+"</th>"),this.effortIntensityVisible?(i.push("      <th colspan='"+e(t(2))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.power")))),i.push("        /\n        <span class='glossary-link power-version' data-glossary-term='definition-segment-intensity' href='javascript:;'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.effort_intensity")))),i.push("        </span>\n      </th>")):i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.power")))+"</th>"),this.hasHeartrate&&i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>"),i.push("    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/table_stationary_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps marginless padded-values'>\n  <thead>\n    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.lap")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.distance")))+"</th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.time")))+"</th>\n      <th>\n        <span class='glossary-link run-version' data-glossary-term='definition-elapsed-time'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.pace")))),i.push("        </span>\n      </th>"),this.hasHeartrate&&i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.hr")))+"</th>"),i.push("    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_other"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.lap.get("index"),3))),i.push("</td>\n<td>"),i.push("  "+t(new Strava.I18n.DistanceFormatter(Strava.I18n.UnitSystem.get(),2).abbreviated(this.lap.get("distance")))),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.ChartLabelElevationFormatter).abbreviated(this.lap.elevationGainLoss()))),i.push("</td>\n<td>"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.lap.get("elapsed_time"))))),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.DistancePerTimeFormatter).abbreviated(this.lap.get("avg_speed")))),i.push("</td>"),this.lap.get("avg_hr")&&(i.push("<td>"),i.push("  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr")))),i.push("</td>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.lap.get("index"),3))),i.push("</td>\n<td>"),i.push("  "+t(new Strava.I18n.DistanceFormatter(Strava.I18n.UnitSystem.get(),2).abbreviated(this.lap.get("distance")))),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.ChartLabelElevationFormatter).abbreviated(this.lap.elevationGainLoss()))),i.push("</td>\n<td>"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.lap.get("elapsed_time"))))),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.DistancePerTimeFormatter).abbreviated(this.lap.get("avg_speed")))),i.push("</td>\n<td>"),this.lap.get("avg_watts")&&i.push("  "+t((new Strava.I18n.PowerFormatter).abbreviated(this.lap.get("avg_watts")))),i.push("</td>\n<td class='effort-intensity-col-js hidden'>\n  <div class='effort-intensity' data-elapsedtime='"+e(t(this.lap.get("elapsed_time")))+"' data-watts='"+e(t(this.lap.get("avg_watts")))+"'></div>\n</td>"),this.lap.get("avg_hr")&&(i.push("<td>"),i.push("  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr")))),i.push("</td>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.lap.get("index"),3))),i.push("</td>\n<td>"),i.push("  "+t(new Strava.I18n.DistanceFormatter(Strava.I18n.UnitSystem.get(),2).abbreviated(this.lap.get("distance")))),i.push("</td>\n<td>"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.lap.time())))),i.push("</td>\n<td>"),i.push(this.lap.hasSpeed()?"  "+t((new Strava.I18n.PaceFormatter).abbreviated(this.lap.speed({si:!0}))):"  &mdash;"),i.push("</td>\n<td>"),i.push(this.lap.avgGap()?"  "+t((new Strava.I18n.ChartLabelPaceFormatter).abbreviated(this.lap.avgGap())):"  &mdash;"),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.ChartLabelElevationFormatter).abbreviated(this.lap.elevationGainLoss()))),i.push("</td>"),this.lap.get("avg_hr")&&(i.push("<td>"),i.push("  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr")))),i.push("</td>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_run_narrow"]=function(t){return function(){var t,e,i;return t=window.HAML.cleanValue,e=[],i=Strava.Util.StringUtils.lpad,e.push("<td>"),e.push("  "+t(i(this.lap.get("index"),3))),e.push("</td>\n<td>"),e.push("  "+t(new Strava.I18n.DistanceFormatter(Strava.I18n.UnitSystem.get(),2).abbreviated(this.lap.get("distance")))),e.push("</td>\n<td>"),e.push("  "+t(i((new Strava.I18n.TimespanFormatter).display(this.lap.time(),5)))),e.push("</td>\n<td>"),e.push(this.lap.hasSpeed()?"  "+t((new Strava.I18n.PaceFormatter).abbreviated(this.lap.speed({si:!0}))):"  &mdash;"),e.push("</td>\n<td>"),e.push(this.lap.avgGap()?"  "+t((new Strava.I18n.ChartLabelPaceFormatter).abbreviated(this.lap.avgGap())):"  &mdash;"),e.push("</td>\n<td>"),e.push(this.hasFullColumns?"  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr"))):"  "+t((new Strava.I18n.ChartLabelElevationFormatter).abbreviated(this.lap.elevationGainLoss()))),e.push("</td>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_swim"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.lap.get("index"),3))),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.SwimDistanceFormatter).abbreviated(this.lap.get("distance")))),i.push("</td>\n<td>"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.lap.get("moving_time"))))),i.push("</td>\n<td>"),i.push(this.lap.get("avg_speed")?"  "+t((new Strava.I18n.SwimPaceFormatter).abbreviated(this.lap.avgSpeed({si:!0,speed:"avg_moving_speed"}))):"  &mdash;"),i.push("</td>"),this.lap.get("avg_hr")&&(i.push("<td>"),i.push("  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr")))),i.push("</td>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_stationary_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.lap.get("index"),3))),i.push("</td>\n<td>"),i.push("  "+t(new Strava.I18n.DistanceFormatter(Strava.I18n.UnitSystem.get(),2).abbreviated(this.lap.get("distance")))),i.push("</td>\n<td>"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.lap.get("elapsed_time"))))),i.push("</td>\n<td>"),i.push("  "+t((new Strava.I18n.DistancePerTimeFormatter).abbreviated(this.lap.get("avg_speed")))),i.push("</td>\n<td>"),this.lap.get("avg_watts")&&i.push("  "+t((new Strava.I18n.PowerFormatter).abbreviated(this.lap.get("avg_watts")))),i.push("</td>\n<td class='effort-intensity-col-js hidden'>\n  <div class='effort-intensity' data-elapsedtime='"+e(t(this.lap.get("elapsed_time")))+"' data-watts='"+e(t(this.lap.get("avg_watts")))+"'></div>\n</td>"),this.lap.get("avg_hr")&&(i.push("<td>"),i.push("  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr")))),i.push("</td>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/row_stationary_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.lap.get("index"),3))),i.push("</td>\n<td>"),i.push("  "+t(new Strava.I18n.DistanceFormatter(Strava.I18n.UnitSystem.get(),2).abbreviated(this.lap.get("distance")))),i.push("</td>\n<td>"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.lap.get("elapsed_time"))))),i.push("</td>\n<td>"),i.push(this.lap.get("avg_speed")?"  "+t((new Strava.I18n.PaceFormatter).abbreviated(this.lap.avgSpeed({si:!0}))):"  &mdash;"),i.push("</td>"),this.lap.get("avg_hr")&&(i.push("<td>"),i.push("  "+t((new Strava.I18n.HeartRateFormatter).abbreviated(this.lap.get("avg_hr")))),i.push("</td>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.LapEffortsTableView=function(e){function i(t,e,r,n,a){this.effortIntensityView=r,this.template=n,this.rowTemplate=a,i.__super__.constructor.call(this,t,e)}return t(i,e),i.prototype.render=function(){return this.renderTemplate({hasHeartrate:this.tableViewModel.hasHeartrate(),effortIntensityVisible:null!=this.effortIntensityView}),this.renderLaps(),null!=this.effortIntensityView&&(this.effortIntensityView.createIntensity(),this.$("td.effort-intensity-col-js").show()),this},i.prototype.renderLaps=function(){var t,e;return t=this.rowTemplate,e=this.$("tbody"),this.tableViewModel.each(function(i){var r;return r=new Strava.Labs.Activities.EffortRowView(i,t),e.append(r.render().el)})},i}(Strava.Labs.Activities.EffortsTableView)}.call(this),function(){window.strava||(window.strava={}),window.strava.Math||(window.strava.Math={smoothIndices:function(t,e,i,r){for(var n=[],a=0;a<t.length;a++){for(var s=a,o=a,l=0,c=!0;(r?2:1)>l&&(i>o-s+1||t[o]-t[s]<e);){var h=!1;c&&s>0&&(s--,h=!0),!c&&o<t.length-1&&(o++,h=!0),l=h?0:l+1,c=!r||!c}n.push([s,o])}return n},calculateSpeed:function(t,e,i,r,n,a){for(var s=strava.Math.smoothIndices(i?t:e,r,n,i),o=[],l=0,c=0;c<s.length;c++){var h=s[c][0],u=s[c][1],p=e[u]-e[h],d=0;if(p>0){var f=t[u]-t[h];if(d=f/p,c>0){var v=(d-o[l])/(e[c]-e[l]);v>a&&(d=null)}}o.push(null!=d?d:o[l]),null!=d&&(l=c)}return o},yMin:function(t){var e=Math.min.apply(null,t),i=Math.max.apply(null,t),r=i-e,n=Math.floor(Math.log(r)/Math.log(10));n-=1,0>n&&(n=0);var a=Math.pow(10,n),s=Math.floor(e/a)*a;return s-=a},yMax:function(t){return Math.max.apply(null,t)},intervalLength:function(t,e){var i=t/e,r=Math.floor(Math.log(i)/Math.log(10)),n=Math.pow(10,r);return n*Math.ceil(i/n)},isClosest:function(t,e,i){if(i>=t.length-1)return!0;var r=t[i],n=t[i+1];return Math.abs(r-e)<Math.abs(n-e)},closestIndex:function(t,e,i){for(i||(i=0);!strava.Math.isClosest(t,e,i);)i++;return i},range:function(t){return t[t.length-1]-t[0]},patchDataSet:function(t){for(var e=0,i=0,r=0;r<t.length;r++){var n=t[r];if(n){var a=e-(n+i);a>0&&(i+=a),i>0&&(t[r]=n+i),e=t[r]}else t[r]=e}return t},getIntervalIndices:function(t,e){var i=[];if(t.length<=e){for(var r=0;r<t.length;r++)i.push(r);for(r=t.length-1;r>=0;r--)t[r-1]==t[r]&&i.splice(r-1,1)}else{var n=strava.Math.range(t),a=n/(e-1);i=strava.Math.getIndicesAt(t,a)}return i},getIndicesAt:function(t,e,i){var r=[],n=t[0];i&&(n+=e);for(var a=0;a<t.length-1;)for(a=strava.Math.closestIndex(t,n,a),r.push(a);a<t.length-1&&strava.Math.isClosest(t,n,a);)n+=e;return r},rabbitData:function(t,e){for(var i=strava.Math.range(e.time)-strava.Math.range(t.time),r=strava.Math.range(t.distance)/strava.Math.range(e.distance),n={indices:[],timeBehind:[]},a=0,s=0,o=0,l=0;l<t.time.length;l++){var c=t.time[l]-t.time[0]+e.time[0];if(c>e.time[e.time.length-1])a=t.time.length-1,o=i;else{s=strava.Math.closestIndex(e.time,c,s);var h=t.distance[0]+(e.distance[s]-e.distance[0])*r;a=strava.Math.closestIndex(t.distance,h,a),o=t.time[l]-t.time[a]}n.indices.push(a),n.timeBehind.push(o)}return n},closestPoint:function(t,e){var i=t.data;if(i.length<=1||e<=i[0].x)return i[0];for(var r=null,n=0;n<i.length;n++){var a=Math.abs(i[n].x-e);if(null!=r&&a>=r)return i[n-1];r=a}return i[i.length-1]},getSeriesIndices:function(t,e){for(var i=[],r=strava.Math.range(t),n=e;r>n;){var a=i.length>0?i[i.length-1]:0;i.push(strava.Math.closestIndex(t,n,a)),n+=e}return i}})}(jQuery),function(t){window.strava||(window.strava={}),window.strava.globalDispatch||(window.strava.globalDispatch=_.extend({},Backbone.Events)),window.strava.asset||(window.strava.asset={host:function(){return window._asset_host},image:function(t){return strava.asset.url("/images/"+t)},url:function(t){return strava.asset.host()+t},sprite:function(){return"//d3nn82uaxijpm6.cloudfront.net/assets/sprites/sprites-map-9edbefa3bd42dbf847ae5421c0fa9b65ec40ea91ec53f5d42555a61f9af64fc6.png"}}),window.strava.forms||(window.strava.forms={Slider:function(e,i){i=t.extend({start:0,end:100,step:1,start_input:"#"+e+"_start",end_input:"#"+e+"_end",label:"."+e,div:"#"+e,plus:!1,time:!1,hours:!0,minutes:!0,seconds:!0,round:!0},i),this.perform_slide=function(e,r){t(i.start_input).val(e),t(i.end_input).val(r);var n=e,a=r;i.time?(n=(new Strava.I18n.TimespanFormatter).display(60*e*60),a=(new Strava.I18n.TimespanFormatter).display(60*r*60)):(n=(new TwitterCldr.DecimalFormatter).format(e),a=(new TwitterCldr.DecimalFormatter).format(r)),t(i.label).html(i.plus&&r==i.end?n+" - "+a+"+":n+" - "+a)},this.start=t(i.start_input).val(),this.end=t(i.end_input).val(),this.start=i.round?parseInt(this.start):parseFloat(this.start),this.end=i.round?parseInt(this.end):parseFloat(this.end);var r=this;this.actual_slider=t(i.div).slider({range:!0,min:i.start,max:i.end,step:i.step,values:[this.start,this.end],slide:function(t,e){r.perform_slide(e.values[0],e.values[1])}}),this.reset=function(){return r.actual_slider?(r.actual_slider.slider("values",0,i.start),void r.actual_slider.slider("values",1,i.end)):!1},this.perform_slide(this.start,this.end)}}),window.strava.sliders||(window.strava.sliders={Slider:function(e,i){i=t.extend({start_icon:"select-start",end_icon:"select-end",start_color:"#54B03A",end_color:"#F00",color:"#105CB6",start:null,end:null,highlight:null,selector:"#slider-range",step:1,slide:null},i);var r=this;this.object=t(i.selector),this.route=e,this.map=e.map,this.start=i.start,this.end=i.end,this.min=0,this.max=r.route.polyline.getLength()-1,this.start="first"==i.start?this.min:this.start?parseInt(this.start):this.min,this.end="last"==i.end?this.max:this.end?parseInt(this.end):Math.floor(e.polyline.getLength()/2),this.start_icon=new strava.maps.Icon(i.start_icon,e.polyline.getAt(this.start),this.map),this.end_icon=new strava.maps.Icon(i.end_icon,e.polyline.getAt(this.end),this.map),this.route.setHighlight(this.start,this.end),this.object.append("<div class='actual-slider'/>"),this.object.append("<div id='start-control'/>"),this.object.find("#start-control").append("<div class='label'>"+Strava.I18n.Locale.t("strava.ui.slider.move_start")+"</div>"),this.object.find("#start-control").append("<button id='move-start-back' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.back")+"</button>"),this.object.find("#start-control").append("<button id='move-start-forward' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.forward")+"</button>"),this.object.append("<div id='end-control'/>"),this.object.find("#end-control").append("<div class='label'>"+Strava.I18n.Locale.t("strava.ui.slider.move_end")+"</div>"),this.object.find("#end-control").append("<button id='move-end-back' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.back")+"</button>"),this.object.find("#end-control").append("<button id='move-end-forward' class='minimal compact'>"+Strava.I18n.Locale.t("strava.ui.slider.forward")+"</button>"),this.actual_slider=this.object.find(".actual-slider"),this.performSlide=function(e,n){e>n&&n==r.end&&(e=r.start),e<r.min&&(e=r.min),n>r.max&&(n=r.max),e>n&&(n=r.end),r.start!=e&&(r.start=e,r.start_icon.move(r.route.polyline.getAt(r.start)),r.start_icon.visible()||r.start_icon.center()),r.end!=n&&(r.end=n,r.end_icon.move(r.route.polyline.getAt(r.end)),r.end_icon.visible()||r.end_icon.center()),r.route.setHighlight(r.start,r.end),t.isFunction(i.slide)&&i.slide(r.start,r.end,r.start_icon,r.end_icon)},this.getStep=function(){var t=r.map.google.getZoom();return t>=17?1:t>=15?2:t>=13?5:t>=10?10:20},this.object.find("#move-start-forward").on("click",function(){r.actual_slider.slider("values",0,r.start+r.getStep()),r.performSlide(r.actual_slider.slider("values",0),r.end)}),this.object.find("#move-start-back").on("click",function(){r.actual_slider.slider("values",0,r.start-r.getStep()),r.performSlide(r.actual_slider.slider("values",0),r.end)}),this.object.find("#move-end-forward").on("click",function(){r.actual_slider.slider("values",1,r.end+r.getStep()),r.performSlide(r.start,r.actual_slider.slider("values",1))}),this.object.find("#move-end-back").on("click",function(){r.actual_slider.slider("values",1,r.end-r.getStep()),r.performSlide(r.start,r.actual_slider.slider("values",1))}),this.actual_slider.slider({range:!0,min:r.min,max:r.max,values:[r.start,r.end],step:i.step,slide:function(t,e){r.performSlide(e.values[0],e.values[1])}}),t(".ui-slider-handle:first").css("background",i.start_color),t(".ui-slider-handle:last").css("background",i.end_color),t(".ui-slider-range").css("background",i.color),this.performSlide(this.start,this.end)}}),window.strava.shareDialogs||(window.strava.shareDialogs={dialogs:{email:t("#email-share-activity-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,height:390,width:440,title:"Email",open:Strava.Util.Dialog.setupModalCloseClick}),embed:t("#embed-share-activity-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,width:470,title:"Embed a Widget on your Blog",open:Strava.Util.Dialog.setupModalCloseClick})},openShareDialog:function(t){for(var e in strava.shareDialogs.dialogs)e!=t&&strava.shareDialogs.dialogs[e].dialog("close");strava.shareDialogs.dialogs[t].dialog("open")},openEmail:function(t){this.inProgressMessage=t.inProgressMessage,this.menuSelector=t.menuSelector;var e=this.dialogs.email.find("form");e.find("input[name='activity_id']").attr("value",t.id),e.find("input[name='menu_selector']").attr("value",this.menuSelector),this.dialogs.email.dialog("option","title",t.title),this.openShareDialog("email")},openEmbed:function(t){var e=this.dialogs.embed.find("form");e.find("#embed-label").text(t.label),e.find("textarea").text("<iframe height='405' width='590' frameborder='0' allowtransparency='true' scrolling='no' src='"+t.url+"'></iframe>"),this.dialogs.embed.dialog("option","title",t.title),this.openShareDialog("embed")},menuSelector:"",inProgressMessage:"",initialized:!1,initialize:function(){t("form#share-by-email").submitWithAjax(function(){return strava.shareDialogs.dialogs.email.dialog("close"),jQuery(strava.shareDialogs.menuSelector+" .menu-title").hide(),jQuery(strava.shareDialogs.menuSelector+" .status").html(strava.shareDialogs.inProgressMessage).show(),!0}),t("ul.options, ul.share").on("click","a.twitter-dialog",function(){return!0}),t("ul.options, ul.share").on("click","a.embed-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openEmbed(t)}),!1}),t("ul.options, ul.share").on("click","a.email-dialog",function(){return t.get(t(this).attr("href"),null,function(t){strava.shareDialogs.openEmail(t)}),!1})}}),t.fn.ajaxAnchorLink=function(e){e=t.extend({loadingMsg:"Loading...",beforeLinkHandler:null,afterLinkHandler:null,emptyLinkHandler:null,container:"#secondary-nav"},e),t(window).hashchange(function(){var i=location.hash.replace(/^#/,"");
if(i.length>0){var r=t(this).parents(".ajax-loading-container");0==r.length&&(r=t(e.container));var n=r.find(".ajax-loading-status span");t.isFunction(e.beforeLinkHandler)&&e.beforeLinkHandler(this),e.loadingMsg&&(n.html(e.loadingMsg),n.show()),t.getScript(window.location.pathname+"/"+i,function(){t.isFunction(e.afterLinkHandler)&&e.afterLinkHandler(this),n.hide()})}else t.isFunction(e.emptyLinkHandler)&&e.emptyLinkHandler(this)}),t(window).hashchange()},t.fn.clientSideAnchorLink=function(e){e=t.extend({linkHandler:null,emptyLinkHandler:null},e),t(window).hashchange(function(){var i=location.hash.replace(/^#/,"");i.length>0?t.isFunction(e.linkHandler)&&e.linkHandler(i):t.isFunction(e.emptyLinkHandler)&&e.emptyLinkHandler()}),t(window).hashchange()}}(jQuery),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelElevationFormatter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.convert=function(t){return t},i}(Strava.I18n.ElevationFormatter)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelPaceFormatter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.convert=function(t){return t},i}(Strava.I18n.PaceFormatter)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.DoubledStepCadenceFormatter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.convert=function(t){return 2*t},i}(Strava.I18n.StepCadenceFormatter)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamSplit=function(){function t(t,e,i){this.streamData=t,this.start=e,this.end=i,this.paceFormatter=new Strava.I18n.ChartLabelPaceFormatter,this.elevationFormatter=new Strava.I18n.ChartLabelElevationFormatter,this.heartRateFormatter=new Strava.I18n.HeartRateFormatter,this.cadenceFormatter=new Strava.I18n.DoubledStepCadenceFormatter}return t.prototype.indices=function(){return[this.start,this.end]},t.prototype.setLabel=function(t){return this.label=t},t.prototype.pace=function(){var t,e;return e=this.streamData.get("time"),t=this.distance(),null!=t?(e[this.end]-e[this.start])/t:void 0},t.prototype.formattedPace=function(t){return null==t&&(t=!0),t?this.paceFormatter.abbreviated(this.pace()):this.paceFormatter.format(this.pace())},t.prototype.formattedGAP=function(){return this.paceFormatter.abbreviated(this.gap())},t.prototype.distance=function(){var t;return t=this.streamData.get("distance"),null!=t?t[this.end]-t[this.start]:void 0},t.prototype.gap=function(){var t,e;return this.streamData.has("grade_adjusted_distance")?(t=this.streamData.get("grade_adjusted_distance"),e=this.streamData.get("time"),(e[this.end]-e[this.start])/(t[this.end]-t[this.start])):null},t.prototype.heartrate=function(){var t;return this.streamData.has("heartrate")?(t=this.streamData.get("heartrate"),d3.round(d3.mean(t.slice(this.start,+this.end+1||9e9)))):null},t.prototype.formattedHeartrate=function(){var t;return t=this.heartrate(),t?this.heartRateFormatter.abbreviated(t):null},t.prototype.cadence=function(){var t;return this.streamData.has("cadence")?(t=this.streamData.get("cadence"),d3.round(d3.mean(t.slice(this.start,+this.end+1||9e9)),0)):null},t.prototype.formattedCadence=function(){var t;return t=this.cadence(),t?this.cadenceFormatter.abbreviated(t):null},t.prototype.elevation=function(){var t;return this.streamData.has("altitude")?(t=this.streamData.get("altitude"),t[this.end]-t[this.start]):null},t.prototype.elapsedTime=function(){var t;return t=this.streamData.get("time"),t[this.end]-t[this.start]},t.prototype.spans=function(t,e){return t===this.start&&e===this.end},t.prototype.summarize=function(){var t;return t=null!=this.elevation()?this.elevationFormatter.abbreviated(this.elevation()):void 0,{pace:this.formattedPace(),distance:this.distance(),heartrate:this.formattedHeartrate(),cadence:this.formattedCadence(),gap:this.formattedGAP(),elevation:t,label:this.label,start:this.start,end:this.end}},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamData=function(e){function i(t,e){null==t&&(t={}),null==e&&(e={}),i.__super__.constructor.call(this),this.initializeAttributes(r),this.data=t,this.derivedData={},this.conversionsToMeters(e)}var r;return t(i,e),r={conversionsToMeters:{}},i.prototype.conversionToMeters=function(t){return this.conversionsToMeters()[t]||1},i.prototype.all=function(){return this.data},i.prototype.get=function(t){return this.data[t]},i.prototype.getInMeters=function(t){var e,i,r;return i=this.data[t],e=this.conversionToMeters(t),null!=e&&1!==e&&(i=function(){var t,n,a;for(a=[],t=0,n=i.length;n>t;t++)r=i[t],a.push(r*e);return a}()),i},i.prototype.has=function(t){return null!=this.data[t]},i.prototype.types=function(){return Object.keys(this.data)},i.prototype.add=function(t,e){return this.data[t]=e},i.prototype.extend=function(t,e){return this.data[t]?this.data[t]=this.data[t].concat(e):this.add(t,e)},i.prototype.length=function(){var t,e;return this.has("time")?this.get("time").length:this.has("distance")?this.get("distance").length:(e=this.types(),(t=e&&e[0])?this.get(t).length:void 0)},i.prototype.getAveragePace=function(){return this.fullSplit().pace()},i.prototype.getAverageGap=function(){return this.fullSplit().gap()},i.prototype.getIntervalMax=function(t,e,i){return this.data[t]?d3.max(this.data[t].slice(e,+i+1||9e9)):null},i.prototype.getIntervalAverage=function(t,e,i){var r,n,a,s,o,l,c,h,u,p,d,f,v;if(!this.data[t]||!this.data.time)return null;for(e=e?parseInt(e):0,i=i?parseInt(i):this.data[t].length-1,d=this.data.time.slice(e,+i+1||9e9),f=this.data[t].slice(e,+i+1||9e9),this.data.moving&&(h=this.data.moving.slice(e,+i+1||9e9)),a="cadence"===t,p=0,u=0,o=l=0,c=f.length;c>l;o=++l)v=f[o],null!=h&&!h[o]||a&&0===v||(r=0,o>0&&(r=d[o]-d[o-1]),p+=v*r,u+=r);return"velocity_smooth"===t||"velocity"===t?this.data.distance?(n=this.data.distance[i]-this.data.distance[e],s=u/3600,n/s):null:u>0?p/u:null},i.prototype.estimatedPowerBuckets=function(){var t,e,i,r,n,a;if(null==this.data.watts_calc)return{};for(e=[],n=0,r=0,this.data.watts_calc.forEach(function(t){return function(i,a){var s,o,l;return s=t.data.time[a],l=s-n,n=s,o=Math.round(i),null!=e[o]?e[o]+=l:e[o]=l,o>r?r=o:void 0}}(this)),t=i=0,a=r;a>=i;t=i+=1)null==e[t]&&(e[t]=0);return e},i.prototype.time=function(){return null==this.data.time?null:this.data.time[this.data.time.length-1]-this.data.time[0]},i.prototype.getSmoothPace=function(t,e){var i,r,n,a,s,o,l,c,h,u,p,d,f,v,m,g,y,w,S,b,_,x,A,L;for(null==e&&(e="pace"),c="grade_adjusted_pace"===e?"grade_adjusted_distance":"distance",l=this.get("distance"),v=this.getInMeters("distance"),g=this.getInMeters(c),x=this.get("time"),a=1/this.conversionToMeters("distance"),d=v.length,A=v[d-1],L=t/a,h=L/2,b={time:[],distance:[],pace:[]},p=-1,i=h/2,r=u=0,y=A+i,w=h;w>0?y>=u:u>=y;r=u+=w)f=d3.bisectLeft(v,r-h,0),S=d3.bisectLeft(v,r+h,f,d-1),n=d3.bisectLeft(v,r,f,S),n!==p&&(b.time.push(x[n]),b.distance.push(l[n]),o=x[S]-x[f],s=g[S]-g[f],o>0&&s>0?(_=s/o,m=1/(_*a)):m=b.pace[b.pace.length-1]||0,b.pace.push(m),p=n);return[b.pace,b.distance,b.time]},i.prototype.splits=function(){return this.cachedSplits||(this.cachedSplits=this.splitsForDistanceUnit())},i.prototype.fullSplit=function(){return this.cachedFullSplit||(this.cachedFullSplit=new Strava.Labs.Activities.StreamSplit(this,0,this.length()-1))},i.prototype.splitsForDistanceUnit=function(){var t,e,i,r;return r=this.all(),e=function(t){return function(e,i,r){return new Strava.Labs.Activities.StreamSplit(t,i,r)}}(this),i=this.bucketedIndices(this.get("distance"),1,e),0===i.length?[]:(t=i.length,i.forEach(function(e,i){var r,n,a;return r=e.distance(),a=d3.round(r,1),n=i===t-1&&1>a?(new Strava.I18n.ChartLabelDistanceFormatter).format(r,2):i+1,e.setLabel(n)}),parseFloat(i[t-1].distance())>=.1||i.pop(),i)},i.prototype.bucketedIndices=function(t,e,i){var r,n,a,s,o,l,c,h,u,p;if(p=0,s=Math.ceil(d3.max(t)/e)*e,e>s)return[];for(h=[],r=a=o=e,l=s,c=e;c>0?l>=a:a>=l;r=a+=c)n=d3.bisectLeft(t,r,p),n===t.length&&(n-=1),u=i(t,p,n),p=n,h.push(u);return h},i.prototype.addIntegratedSeries=function(t,e,i){var r,n,a,s,o,l;if(null!=this.derivedData[i])return this.derivedData[i];if(o=this.data[t],l=this.data[e],null!=o&&null!=l){for(a=[0],r=n=1,s=l.length-1;s>=n;r=n+=1)a[r]=a[r-1]+l[r]*(o[r]-o[r-1]);return this.derivedData[i]=a,a}return null},i.prototype.maxSlopeSubstream=function(t,e,i){var r,n,a,s,o,l,c,h,u;if(u=this.derivedData[t],l=this.data[i],null==u||null==l)return null;for(o=[0,0],s=0,r=null,a=0,h=l.length-1,c=a,n=a;h>n;){for(;h>n&&l[n]-l[c]<e;)n+=1;for(;l[n]-l[c+1]>=e;)c+=1;l[n]-l[c]>=e&&(r=(u[n]-u[c])/(l[n]-l[c]),r>s&&(o=[c,n],s=r)),c+=1}return[e,o[0],o[1],Math.round(s)]},i.prototype.maxForInterval=function(t,e,i){return this.data[t]?d3.max(this.data[t].slice(e,i+1)):0},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamsRequest=function(){function t(t){this.streams=t,this.reset()}return t.prototype.reset=function(){return this.required=[],this.deferred=new jQuery.Deferred},t.prototype.require=function(t,e){return this.required=_.uniq(this.required.concat(t)),e&&null!=e.onReady?this.onReady(e.onReady):void 0},t.prototype.request=function(){return 0!==this.required.length?this.streams.fetchStreams(this.required,{success:function(t){return function(){return t.deferred.resolve(),t.reset()}}(this),error:function(t){return function(){return t.deferred.reject(),t.deferred=new jQuery.Deferred}}(this)}):void 0},t.prototype.onReady=function(t){return this.deferred.done(t)},t.prototype.onError=function(t){return this.deferred.fail(t)},t}()}.call(this),function(){Strava.module("Strava.Logging"),Strava.Logging.AjaxLatency=function(){function t(){}var e,i,r;return e="/logging/v1/ajax_latency",i=0,r=0,t.logActivityStreams=!1,t.logSegmentStreams=!1,t.activityStreams=function(t,r,n){return Strava.Logging.AjaxLatency.logActivityStreams?(i++,jQuery.ajax({type:"POST",url:e,data:{metric:"activity_streams",latency:(n/1e3).toFixed(3),details:{request_number:i,types:r,types_count:r.length,activity_id:t},dataType:"json"}})):void 0},t.segmentStreams=function(t,i,n){return Strava.Logging.AjaxLatency.logSegmentStreams?(r++,jQuery.ajax({type:"POST",url:e,data:{metric:"segment_streams",latency:(n/1e3).toFixed(3),details:{request_number:r,types:i,types_count:i.length,segment_id:t},dataType:"json"}})):void 0},t}()}.call(this),function(){var t,e,i,r=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),i=function(t,e,i){return strava.Math.calculateSpeed(t,e,i,100,3,2)},e=function(t,e,r){var n,a,s,o,l;for(s=i(t,e,r),o=[],n=0,a=s.length;a>n;n++)l=s[n],o.push(0===l?0:1/l);return o},t=function(t,e){var i,r;return r=function(){var r,n,a;for(a=[],i=r=1,n=t.length-1;n>=1?n>=r:r>=n;i=n>=1?++r:--r)a.push((t[i]-t[i-1])/(e[i]-e[i-1]));return a}()},Strava.Labs.Activities.Streams=function(n){function a(t,e){null==e&&(e=!1),this.activityId=t,this.streamData=new Strava.Labs.Activities.StreamData,this.requestedTypes=[],this.loggedOut=e,a.__super__.constructor.call(this)}var s,o;return r(a,n),a.calculateSpeed=i,a.calculatePace=e,a.calculateDerivative=t,o=["latlng","time","distance","velocity_smooth","watts","watts_calc","grade_adjusted_distance","grade_smooth","heartrate","cadence","resting","altitude","temp","outlier","moving","timer_time"],s={pace:{required:["distance","time"],convert:function(t){var e,i,r;return r=t.get("time"),i=t.get("distance"),e=!0,Strava.Labs.Activities.Streams.calculatePace(i,r,e)}},grade_adjusted_pace:{required:["grade_adjusted_distance","time","altitude"],convert:function(t){var e,i,r;return r=t.get("time"),i=t.get("grade_adjusted_distance"),e=!0,Strava.Labs.Activities.Streams.calculatePace(i,r,e)}},velocity:{required:["distance","time"],convert:function(t){var e,i,r;return r=t.get("time"),i=t.get("distance"),e=!1,Strava.Labs.Activities.Streams.calculateSpeed(i,r,e)}},instantaneous_speed:{required:["distance","time"],convert:function(t){var e,i,r;return i=t.get("time"),e=t.get("distance"),r=Strava.Labs.Activities.Streams.calculateDerivative(e,i),r.unshift(0),r}},instantaneous_acceleration:{required:["instantaneous_speed","time"],convert:function(t){var e,i,r;return i=t.get("time"),e=t.get("instantaneous_speed"),r=Strava.Labs.Activities.Streams.calculateDerivative(e,i),r.unshift(0),r}},instantaneous_pace:{required:["instantaneous_speed"],convert:function(t){var e;return e=t.get("instantaneous_speed"),e.map(function(t){return 1/t})}},instantaneous_grade_adjusted_pace:{required:["grade_adjusted_distance","time"],convert:function(t){var e,i,r;return i=t.get("time"),e=t.get("grade_adjusted_distance"),r=Strava.Labs.Activities.Streams.calculateDerivative(e,i),r.unshift(0),r.map(function(t){return 1/t})}}},a.LOCAL_STREAMS=s,a.REMOTE_STREAMS=o,a.prototype.fetchStreams=function(t,e){var i,r,n,a,s,o,l,c,h;return o=this.classifyTypes(t),c=o[0],r=o[1],i=this.dependentsOf(r),h=_.uniq(t.concat(i)),n=this.neededTypes(h),l=this.classifyTypes(n),s=l[0],a=l[1],this.fetchRemote(s,{success:function(t){return function(i){var r;return r=_.extend(i,t.fetchLocal(a)),t.trigger("fetchSuccess",t.availableStreams()),e.success()}}(this),error:e.error})},a.prototype.localTypes=function(){return Object.keys(s)},a.prototype.streamParentType=function(){return"activity"},a.prototype.classifyTypes=function(t){var e,i;return i=_.intersection(t,o),e=_.intersection(t,this.localTypes()),[i,e]},a.prototype.dependentsOf=function(t){var e,i,r,n;for(e=[],i=0,r=t.length;r>i;i++)n=t[i],e=_.uniq(e.concat(s[n].required));return e},a.prototype.cachedTypes=function(){return this.streamData.types()},a.prototype.handleStreamsFetched=function(t,e){return this.addRequestedTypes(t),this.setStreamsFromResponse(e)},a.prototype.fetchRemote=function(t,e){var i,r;return t.length>0?(r=new Date,i={type:"GET",url:this.fetchUrl(),data:this.fetchData(t),cache:!1,success:function(i){return function(n,a){var s;return s=new Date,"activity"===i.streamParentType()&&Strava.Logging.AjaxLatency.activityStreams(i.activityId,t,s.getTime()-r.getTime()),"segment"===i.streamParentType()&&Strava.Logging.AjaxLatency.segmentStreams(i.segmentId,t,s.getTime()-r.getTime()),i.handleStreamsFetched(t,a),e.success(a)}}(this),error:e.error},this.fetch(i)):e.success({})},a.prototype.fetchUrl=function(){return this.loggedOut?"/stream/"+this.activityId:"/activities/"+this.activityId+"/streams"},a.prototype.fetchData=function(t){return this.loggedOut?{streams:t}:{stream_types:t}},a.prototype.fetchLocal=function(t){var e,i,r,n,a,o;for(i={},r=0,n=t.length;n>r;r++)o=t[r],e=s[o],this.streamsFetched(e.required)&&(a=e.convert(this.streamData),this.streamData.add(o,a),i[o]=a);return i},a.prototype.neededTypes=function(t){var e;return e=this.cachedTypes(),_.difference(t,e,this.requestedTypes)},a.prototype.addRequestedTypes=function(t){return this.requestedTypes=_.union(this.requestedTypes,t)},a.prototype.setStreamsFromResponse=function(t){var e,i,r;e=[];for(r in t)i=t[r],e.push(this.streamData.add(r,i));return e},a.prototype.streamsFetched=function(t){return t.every(function(t){return function(e){return t.streamFetched(e)}}(this))},a.prototype.streamFetched=function(t){return this.streamData.has(t)},a.prototype.getStream=function(t){return this.streamData.get(t)},a.prototype.availableStreams=function(){return this.streamData.all()},a}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.MovingTimeStreamTransform=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.transform=function(t,e){var i,r,n,a,s,o,l,c;switch(t){case"resting":return this.resting=e,e.filter(function(t){return function(e,i){return!t.resting[i]}}(this));case"time":if(null==this.resting)return[];for(l=0,i=0,n=[],a=s=0,o=e.length;o>s;a=++s)c=e[a],r=c-l,this.resting[a]||(i+=r,n.push(i)),l=c;return this.filtered_time=n,n;case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_distance,this.filtered_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_grade_adjusted_distance,this.filtered_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.filtered_distance,this.filtered_time,!1);default:return null==this.resting?[]:(n=e.filter(function(t){return function(e,i){return!t.resting[i]}}(this)),("distance"===t||"grade_adjusted_distance"===t)&&(this["filtered_"+t]=n),n)}},i.prototype.dependentStreams=function(){return["resting"]},i}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/overview_stats"]=function(t){return function(){var t,e,i,r;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<tr>\n  <td>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_stats.avg")))+"</td>\n  <td>"),this.avgSpeed?(r=new Strava.I18n.PaceFormatter,i.push("    "+t(r.abbreviated(this.avgSpeed)))):i.push("    &mdash;"),i.push("  </td>"),this.supportsGap&&i.push("  <td class='gap'>&mdash;</td>"),i.push("  <td>"),this.avgHeartRate?(r=new Strava.I18n.HeartRateFormatter,i.push("    "+t(r.abbreviated(this.avgHeartRate)))):i.push("    &mdash;"),i.push("  </td>"),this.avgCadence&&(i.push("  <td>"),r=new Strava.I18n.DoubledStepCadenceFormatter,i.push("    "+t(r.abbreviated(this.avgCadence))),i.push("  </td>")),this.avgTemp&&(i.push("  <td>"),r=new Strava.I18n.TemperatureFormatter,i.push("    "+t(r.abbreviated(this.avgTemp))),i.push("  </td>")),i.push("</tr>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.Labs.Activities.OverviewStatsView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.context=t,this.template="activities/overview_stats"},i.prototype.render=function(){var t,e,i,r,n;return t=this.context.activity(),e={avgSpeed:t.get("average_speed")/3600,avgHeartRate:t.get("avg_hr"),avgTemp:t.get("avg_temp"),avgCadence:t.get("avg_cadence"),supportsGap:t.supportsGap()},this.renderTemplate(e),t.supportsGap()&&(r=this.context.getAvgGap(),i=null!=r?(new Strava.I18n.TimespanFormatter).display(r):"&mdash;",n=this.create_template_for("#avg-gap-template"),this.$(".gap").html(n({gap:i}))),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=[].slice;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.PageContext=function(e){function r(){r.__super__.constructor.call(this),this.initializeAttributes(n)}var n;return t(r,e),n={fullscreen:!1,view:"overview",upsells:[],segmentEffortId:null,lapEffortId:null,analysisRange:null,startMenu:"overview"},r.prototype.enterFullScreen=function(){return this.fullscreen(!0),this.trigger("fullscreenchange",!0)},r.prototype.exitFullScreen=function(){return this.fullscreen(!1),this.trigger("fullscreenchange",!1)},r.prototype.isUpsell=function(t){return this.upsells().some(function(e){return e===t})},r.prototype.anyUpsells=function(){var t;return t=1<=arguments.length?i.call(arguments,0):[],this.upsells().some(function(e){return t.indexOf(e)>=0})},r}(Strava.Base)}.call(this),function(){Strava.module("Strava.Activities.Ui"),Strava.Activities.Ui={initialize:function(t){return this.isInitialized?void 0:(this.expandDescription=!!t.expandDescription,this.prepareSlideMenu(),this.prepareCollapsingPanels(),this.prepareActivityHeading(),this.prepareViewResultsButton(),this.prepareMoreStats(),Strava.Ui.Global.prepareAutoresizingTextbox(),t&&t.editableActivity&&this.prepareRefreshAchievementsBox(t.editableActivity),Modernizr.localstorage&&"1"===localStorage.getItem("activity_more_stats")&&this.toggleMoreStats(),this.isInitialized=!0)},prepareCollapsingPanels:function(){return jQuery("a.collapse").off("click").on("click",function(){var t;return t=jQuery(this),t.closest("section").toggleClass("collapsed").find(".collapsable").slideToggle(300)})},prepareActivityHeading:function(){var t,e,i,r,n;return n=jQuery("#heading"),e=n.find("div.comments .thread"),t=n.find(".toggle-more"),i=n.find("div.activity-description div.content").height(),r=n.find("div.activity-description").height(),this.activityHeadingDescToggle=!0,t.on("click",function(e){return function(){return e.activityHeadingDescToggle?(n.find("div.activity-description").addClass("expanded").height(i),t.attr("title",Strava.I18n.Locale.t("strava.activities.ui.view_less"))):(n.find("div.activity-description").height(r),t.attr("title",Strava.I18n.Locale.t("strava.activities.ui.view_more"))),e.activityHeadingDescToggle=!e.activityHeadingDescToggle}}(this)),i>40&&(t.fadeIn(100),this.expandDescription)?t.click():void 0},prepareSlideMenu:function(){var t,e,i,r;return t=240,r=jQuery(".slide-menu"),i=jQuery(".pagenav").height()||0,e=r.find(".options").height(),i>t&&e>i?r.addClass("align-top"):i>e?r.addClass("align-bottom"):void 0},prepareViewResultsButton:function(){return jQuery(".js-view-all-results").on("click",function(t){var e,i;return i=jQuery(t.currentTarget).attr("href"),e=jQuery("#elevation-profile").outerHeight(),jQuery("html, body").animate({scrollTop:jQuery(i).offset().top-e},600),!1})},prepareMoreStats:function(){return jQuery(".show-more-js").on("click",function(t){return function(){return t.toggleMoreStats(),Modernizr.localstorage?localStorage.setItem("activity_more_stats",jQuery(".show-more-block-js:visible").length):void 0}}(this))},toggleMoreStats:function(){return jQuery(".show-more-block-js").toggle(),jQuery(".show-more-js").toggle()},prepareRefreshAchievementsBox:function(t){return jQuery("#refresh-achievements").on("click",function(e){return e.preventDefault(),Strava.Labs.Activities.RefreshAchievements.show({activityId:t.id},"div.app-icon.icon-nav-more")})}}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.MenuView=function(e){function i(t){this.router=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.el="#pagenav",i.prototype.events={"click li a":"handleMenuClick"},i.prototype.initialize=function(){return this.$("li a").each(function(t){return function(e,i){var r,n;return n=t.$(i).data("menu"),r=t.$(i).data("menu-alt"),t.router.bind("route:"+n,function(){return t.handleRouteChange(n)}),r?t.router.bind("route:"+r,function(){return t.handleRouteChange(r)}):void 0}}(this))},i.prototype.handleMenuClick=function(t){var e,i;return t.preventDefault(),e=this.$$(t.currentTarget),i=e.data("menu"),this.router.changeMenuTo(i)},i.prototype.handleRouteChange=function(t){return this.$("li").removeClass("selected"),this.$("a[data-menu='"+t+"'],a[data-menu-alt='"+t+"']").parent("li").addClass("selected")},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.transform=function(t,e){var i,r,n,a,s,o,l,c;switch(t){case"resting":return this.resting=e,e;case"time":if(null==this.resting)return[];for(l=0,i=0,n=[],a=s=0,o=e.length;o>s;a=++s)c=e[a],r=c-l,this.resting[a]||(i+=r),n.push(i),l=c;return this.filtered_time=n,n;case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_distance,this.filtered_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.filtered_grade_adjusted_distance,this.filtered_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.filtered_distance,this.filtered_time,!1);default:return null==this.resting?[]:(("distance"===t||"grade_adjusted_distance"===t)&&(this["filtered_"+t]=e),e)}},i.prototype.dependentStreams=function(){return["resting"]},i}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.TimerTimeStreamTransform=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.transform=function(t,e){switch(t){case"timer_time":return this.timer_time=e;case"time":return null==this.timer_time?[]:this.timer_time;case"resting":return e.map(function(){return function(){return!1}}(this));case"pace":return Strava.Labs.Activities.Streams.calculatePace(this.distance,this.timer_time,!0);case"grade_adjusted_pace":return Strava.Labs.Activities.Streams.calculatePace(this.grade_adjusted_distance,this.timer_time,!0);case"velocity":return Strava.Labs.Activities.Streams.calculateSpeed(this.distance,this.timer_time,!1);default:return null==this.timer_time?[]:(("distance"===t||"grade_adjusted_distance"===t)&&(this[t]=e),e)}},i.prototype.dependentStreams=function(){return["timer_time"]},i}(Strava.Labs.Activities.StreamTransform)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ConvertedSwimUnitStreamTransform=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.transform=function(t,e){var i,r,n;return n=this.constructor,r=function(){switch(t){case"distance":case"altitude":return i=n.metersToConverted(t),function(t){return i*t};case"pace":return i=n.metersToConverted(t),function(t){return 100*i*t};case"temp":return n.getMeasurementUnits().tempConvert;default:return null}}(),r?e.map(r):e},i.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},i.metersToConverted=function(t){var e;switch(e=this.getMeasurementUnits(),t){case"distance":case"pace":return e.mediumConvert;case"altitude":return e.shortConvert;default:return 1}},i}(Strava.Labs.Activities.ConvertedUnitStreamTransform)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamTransformSet=function(e){function i(t){this.initializeAttributes(r),this.transforms=t.map(function(t){return new t})}var r;return t(i,e),r={conversionsToMeters:{}},i.CONVERTED_MOVING_TIME="converted-moving-time",i.CONVERTED_ELAPSED_TIME="converted-elapsed-time",i.CONVERTED_TIMER_TIME="converted-timer-time",i.CONVERTED_SWIM_MOVING_TIME="converted-swim-moving-time",i.get=function(t){var e,i;switch(e=this,t){case e.CONVERTED_MOVING_TIME:return i=new e([Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform,Strava.Labs.Activities.ConvertedUnitStreamTransform]),i.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());case e.CONVERTED_ELAPSED_TIME:return i=new e([Strava.Labs.Activities.ConvertedUnitStreamTransform]),i.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());case e.CONVERTED_SWIM_MOVING_TIME:return i=new e([Strava.Labs.Activities.EqualLengthMovingTimeStreamTransform,Strava.Labs.Activities.ConvertedSwimUnitStreamTransform]),i.conversionsToMeters(Strava.Labs.Activities.ConvertedSwimUnitStreamTransform.conversions());case e.CONVERTED_TIMER_TIME:return i=new e([Strava.Labs.Activities.TimerTimeStreamTransform,Strava.Labs.Activities.ConvertedUnitStreamTransform]),i.conversionsToMeters(Strava.Labs.Activities.ConvertedUnitStreamTransform.conversions());default:return new e([])}},i.prototype.dependentStreams=function(){return this.transforms.reduce(function(t,e){return _.union(t,e.dependentStreams())},[])},i.prototype.transform=function(t,e){var i;return i=e,this.transforms.forEach(function(e){return i=e.transform(t,i)}),i},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.PointsOfInterest=function(e){function i(t,e,r){null==t&&(t={}),this.splits=r,i.__super__.constructor.call(this),this.data=t,this.initializePOIScale(e)}return t(i,e),i.prototype.initializePOIScale=function(t){var e,i,r,n,a,s,o,l,c,h,u,p;for(c=1609.34,n=function(){switch(!1){case"meters"!==t:return 1e3;case"feet"!==t:return c}}(),l=42195,p=10*c,e=50*c,i=l/2,this.configuration=[{type:"5k",pois:function(){var t,e,i,r;for(r=[],s=t=e=n,i=n;i>0?4999>=t:t>=4999;s=t+=i)r.push(s);return r}(),usesSplits:!0,distance:5e3,range:[4500,5500]},{type:"10k",pois:function(){var t,e,i,r;for(r=[],s=t=e=n,i=n;i>0?9999>=t:t>=9999;s=t+=i)r.push(s);return r}(),usesSplits:!0,distance:1e4,range:[9500,10500]},{type:"halfmarathon",pois:function(){var t,e,r;for(r=[],s=t=5e3,e=i;e>=t;s=t+=5e3)r.push(s);return r}(),distance:i,range:[i-1e3,i+500]},{type:"marathon",pois:function(){var t,e,i;for(i=[],s=t=5e3,e=l;e>=t;s=t+=5e3)i.push(s);return i}(),distance:l,range:[l-2700,l+2700]}],r=[{feet:{type:"50mi",pois:function(){var t,e;for(e=[],s=t=10;40>=t;s=t+=10)e.push(s*c);return e}(),distance:e,range:[e-7e3,e+7e3]},meters:{type:"50mi",pois:function(){var t,i,r;for(r=[],s=t=2e4,i=e;i>=t;s=t+=2e4)r.push(s);return r}(),distance:e,range:[e-7e3,e+7e3]}}],u=[],a=0,o=r.length;o>a;a++)h=r[a],h[t]&&u.push(this.configuration.push(h[t]));return u},i.prototype.getStandardPOI=function(t){var e,i,r,n;for(n=this.configuration,e=0,i=n.length;i>e;e++)if(r=n[e],this.inRange(t,r.range))return r},i.prototype.getPOI=function(t){var e,i,r;return i=this.getStandardPOI(t),i||(r=t/4,i={type:"undefined",pois:function(){var i,n,a,s,o;for(o=[],e=i=n=r,a=t-r,s=r;s>0?a>=i:i>=a;e=i+=s)o.push(e);return o}(),labels:["25%","50%","75%"],distance:t}),i},i.prototype.inRange=function(t,e){return t>=e[0]&&t<=e[1]},i.prototype.pointsOfInterest=function(){var t,e,i,r,n,a,s,o,l,c;return r=this.data.distance,s=r.length,e=this.getPOI(r[s-1]),t=e.pois,l=this.data.time,e.usesSplits&&this.splits.length>=t.length?(c=0,o=function(){var r,a,s;for(s=[],n=r=0,a=t.length;a>r;n=++r)i=t[n],c+=this.splits[n].pace(),s.push({distance:i,time:c,race_type:e.type,isHalfMarathon:21097.5===i,isFinish:!1,label:void 0});return s}.call(this)):(a=0,o=function(){var o,c,h;for(h=[],n=o=0,c=t.length;c>o;n=++o)i=t[n],i>r[s-1]||h.push(function(t){var i;return a=d3.bisectLeft(r,t,a),i=e.labels?e.labels[n]:void 0,{distance:t,time:l[a],race_type:e.type,isHalfMarathon:21097.5===t,isFinish:!1,label:i}}(i));return h}()),o.push({distance:r[s-1],time:l[l.length-1],race_type:e.type,isHalfMarathon:!1,isFinish:!0}),o},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamsContext=function(){function t(t,e){this.streams=t,this.streams.bind("fetchSuccess",function(t){return function(e){return t.handleFetchSuccess(e)
}}(this)),this.transformSet=Strava.Labs.Activities.StreamTransformSet.get(e),this.data=new Strava.Labs.Activities.StreamData({},this.transformSet.conversionsToMeters())}return Strava.includeModule(t,Backbone.Events),t.prototype.handleFetchSuccess=function(t){var e,i,r,n,a,s,o;for(e=Object.keys(t),o=_.difference(e,this.data.types()),i=this.transformSet.dependentStreams(),a=_.sortBy(o,function(t){var e;return e=i.indexOf(t),e>-1?e:1/0}),r=0,n=a.length;n>r;r++)s=a[r],this.transform(s,t[s]);return this.trigger("fetchSuccess")},t.prototype.transform=function(t,e){var i;return this.data.has(t)?this.data.get(t):(i=this.transformSet.transform(t,e),this.data.add(t,i),i)},t.prototype.get=function(t){return this.data.get(t)},t.prototype.getInMeters=function(t){return this.data.getInMeters(t)},t.prototype.streamFetched=function(t){return this.data.has(t)},t.prototype.valueAt=function(t,e){return this.data.has(t)?this.data.get(t)[e]:void 0},t.prototype.setValueAt=function(t,e,i){return null==i&&(i=0),this.data.get(t)[e]=i,this.trigger("streamsDataChanged")},t.prototype.valuesAt=function(t){var e,i,r,n;n={},e=this.data.all();for(r in e)i=e[r],n[r]=i[t];return n},t.prototype.length=function(){return this.data.length()},t.prototype.splits=function(){return this.data.splits()},t.prototype.pointsOfInterest=function(t){return this.poi?this.poi.pointsOfInterest():(this.poi=new Strava.Labs.Activities.PointsOfInterest({time:this.get("time"),distance:this.getInMeters("distance")},t,this.splits()),this.poi.pointsOfInterest())},t.prototype.createRequest=function(){var t;return t=new Strava.Labs.Activities.StreamsRequest(this.streams),t.require(this.transformSet.dependentStreams()),t},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ContextManager=function(){function t(t,e,i){this.streams=t,this.activity=e,this.factories=i,this.contexts={}}return t.TYPES={MAP:"map",CHART:"chart"},t.prototype.defaultTransformSetName=function(){return this.activity.defaultTransformSetName()},t.prototype.contextFor=function(t,e){return e||(e=this.defaultTransformSetName()),this.contexts[t]&&this.contexts[t][e]?this.contexts[t][e]:this.createContext(t,e)},t.prototype.reset=function(){var t,e,i,r,n,a;i=this.contexts,r=[];for(a in i)e=i[a],r.push(function(){var i;i=[];for(n in e)t=e[n],t.off(),i.push(a===this.constructor.TYPES.CHART?t.resetInfobox():void 0);return i}.call(this));return r},t.prototype.createContext=function(t,e){var i,r,n;return n=this.createStreamsContext(e),r=this.factories[t](n),(i=this.contexts)[t]||(i[t]={}),this.contexts[t][e]=r,r},t.prototype.createStreamsContext=function(t){var e;return this.streamsContexts||(this.streamsContexts={}),null!=this.streamsContexts[t]?this.streamsContexts[t]:(e=new Strava.Labs.Activities.StreamsContext(this.streams,t),this.streamsContexts[t]=e)},t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/kudo_current_athlete"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<li class='current-athlete'>\n  <div class='media'>\n    <div class='media-object'>\n      <a class='avatar avatar-athlete avatar-sm' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.display_name))+"'>\n        <img class='avatar-img' src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"' title='"+e(t(this.athlete.display_name))+"'>\n      </a>\n    </div>\n    <div class='media-content'>\n      <div class='media-body'>\n        <span class='name'>\n          <a class='athlete-name minimal' href='/athletes/"+e(t(this.athlete.id))+"'>"),i.push("            "+e(t(this.athlete.display_name))),this.athlete.member_type&&i.push("            <div class='app-icon-wrapper'>\n              <div class='"+["app-icon","icon-sm","icon-badge-"+e(t(this.athlete.member_type))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.athletes.member_types."+this.athlete.member_type)))+"'></div>\n            </div>"),i.push("          </a>\n        </span>\n        <span class='location'>"+e(t(this.athlete.display_location))+"</span>\n      </div>\n    </div>\n  </div>\n</li>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.KudosView=function(e){function i(t,e){this.controller=t,this.activityId=e,i.__super__.constructor.call(this),this.controller.on("kudoCreated",function(t){return function(){return t.handleKudoSuccess()}}(this)),this.kudosFetched=!1}return t(i,e),i.prototype.el="div.give-kudos.button-group",i.prototype.events={"click .kudo.button":"handleAddKudo"},i.prototype.handleAddKudo=function(){return this.$(".kudo.button").hasClass("disabled")?void 0:(this.$(".kudo.button").addClass("disabled"),this.controller.kudo("Activity",this.activityId))},i.prototype.handleKudoSuccess=function(){var t,e;return this.kudosFetched&&(t=this.getTemplateFor("feed/kudos_current_athlete"),this.kudoList.find(".athletes").prepend(t({}))),this.$(".show-kudos .app-icon").addClass("kudoed animate-kudoed"),this.$(".kudo.button").remove(),e=this.$("div.show-kudos .count"),e.text(e.data("count")+1),e.data("count")>0?void 0:this.$(".show-kudos").removeClass("disabled")},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ActivityHeaderView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.tagName="header",i.prototype.initialize=function(t){return this.template=t.template,this.data=t.data},i.prototype.render=function(){return this.renderTemplate(this.data).hide(0,function(){return jQuery(this).show()}),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Grid=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder(t)}var r;return t(i,e),r={builder:null,xOffset:0},i.prototype.create=function(){var t,e,i,r;return t=this.builder(),e=t.axis().xAxis.ticks(),r=t.axis().xScale.ticks(e[0]),i=t.mainGroup.append("svg:g").attr("id","grid"),i.append("rect").attr({x:0,y:0,height:t.height(),width:t.width()-this.xOffset(),"class":"event-rect"}).style("fill","transparent").on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],t.trigger("mousemove",r,n)}}(this))).on("click",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],t.trigger("gridclick",r,n)}}(this))).on("mouseout",this.createHandler(function(t){return function(e){return t.insideChart(d3.event.relatedTarget)?void 0:t.trigger("gridout",e)}}(this))),i.selectAll("line.vgrid-line").data(r).enter().insert("line",":first-child").attr({x1:t.axis().xScale,x2:t.axis().xScale,y1:0,y2:t.height(),"class":"grid-line vgrid-line"}),e=t.axis().yAxis.ticks(),r=t.axis().yScale.ticks(e[0]),i.selectAll("line.hgrid-line").data(r).enter().insert("line",":first-child").attr({x1:0,x2:t.width(),y1:t.axis().yScale,y2:t.axis().yScale,"class":"grid-line hgrid-line"})},i.prototype.update=function(){var t,e,i,r,n,a;return t=this.builder(),i=t.mainGroup.select("#grid"),e=t.axis().xAxis.ticks(),r=t.axis().xScale.ticks(e[0]),n=i.selectAll("line.vgrid-line").data(r),n.enter().insert("line",":first-child").attr({x1:t.axis().xScale,x2:t.axis().xScale,y1:0,y2:t.height(),"class":"grid-line vgrid-line"}),n.transition().attr({x1:t.axis().xScale,x2:t.axis().xScale}),n.exit().remove(),e=t.axis().yAxis.ticks(),r=t.axis().yScale.ticks(e[0]),a=i.selectAll("line.hgrid-line").data(r),a.enter().insert("line",":first-child").attr({x1:0,x2:t.width(),y1:t.axis().yScale,y2:t.axis().yScale,"class":"grid-line hgrid-line"}),a.transition().attr({x1:0,x2:t.width(),y1:t.axis().yScale,y2:t.axis().yScale}),a.exit().remove()},i.prototype.updateCanvas=function(){return this.builder().mainGroup.select(".event-rect").attr({width:this.builder().width()-this.xOffset()}),this.update()},i.prototype.checkGridOut=function(t){return this.insideChart(d3.event.relatedTarget)?void 0:this.trigger("gridout",t)},i.prototype.insideChart=function(t){return jQuery(t).closest(".chartGroup").length>0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Base=function(e){function i(){i.__super__.constructor.call(this),this.originalDomainX=null,this.originalDomainY=null}return t(i,e),Strava.includeModule(i,Strava.chart_module),i.prototype.create=function(){return this.originalDomainX=this.xScale().domain(),this.originalDomainY=this.yScale().domain()},i.prototype.zoom=function(t,e,i){return null==e&&(e=null),null==i&&(i=!0),i=this.shouldAnimate(i),this.xScale().domain(t),e&&this.yScale().domain(e),this.update(i)},i.prototype.resetZoom=function(t){return null==t&&(t=!0),this.zoom(this.originalDomainX,this.originalDomainY,t)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Line=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.clipPathId("clip"+Math.floor(1e3*Math.random())),this.filter=(new Strava.D3.Charts.DataFilter).graph(this)}var r;return t(i,e),r={builder:null,data:[],fill:!0,style:"simple-line",strokeWidth:"1.5px",xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),id:"generic-line",interpolator:"",duration:1e3,stroke:null,clipPathId:"",animate:null},i.prototype.create=function(){var t,e,r,n;return i.__super__.create.call(this),t=this.builder(),this.animate(t.animate()),n=t.root,n.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:0,height:t.height(),width:t.width()}),this.line=d3.svg.line().x(function(t){return function(e){return t.xScale()(e.x)}}(this)).y(function(t){return function(e){return t.yScale()(e.y)}}(this)),""!==this.interpolator()&&this.line.interpolate(this.interpolator()),e=t.mainGroup.insert("svg:g","g#crossBar").attr({id:this.id(),"clip-path":"url(#"+this.clipPathId()+")"}),r=this.filter.filter(),e.selectAll("path").data([r]).enter().append("path").attr({fill:"none","stroke-width":this.strokeWidth(),"class":this.style(),d:this.line})},i.prototype.update=function(t){var e,i,r,n,a;return null==t&&(t=!0),t=this.shouldAnimate(t),e=this.builder(),i=e.mainGroup.select("#"+this.id()),r=this.filter.filter(),n=i.selectAll("path").data([r]),n.enter().append("path").attr({fill:"none","stroke-width":this.strokeWidth(),"class":this.style(),d:this.line}),a=t?n.transition().duration(this.duration()).delay(0):n,a.attr({d:this.line}),n.exit().remove()},i.prototype.updateWithoutDelay=function(){var t,e,i,r;return t=this.builder(),i=this.filter.filter(),e=t.mainGroup.select("#"+this.id()),r=e.selectAll("path").data([i]),r.attr("d",this.line)},i.prototype.show=function(){return this.builder().mainGroup.select("#"+this.id()).attr("display","")},i.prototype.hide=function(){return this.builder().mainGroup.select("#"+this.id()).attr("display","none")},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.BarChart=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.clipPathId("clip"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={builder:null,data:null,fill:!0,style:"simple-bar default",xScale:null,yScale:null,id:"generic-bar",interpolator:"",duration:1e3,clipPathId:"",width:960,yOffset:0,xOffset:0},i.prototype.create=function(){var t,e;return e=this.builder().root,e.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:-4,height:this.builder().height()-this.yOffset()+4,width:this.width()}),t=this.builder().mainGroup.append("svg:g").attr({id:this.id(),"clip-path":"url(#"+this.clipPathId()+")"}).attr("transform","translate("+this.xOffset()+","+this.yOffset()+")"),t.selectAll("rect").data(this.data()).enter().append("rect").attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),y:function(t){return function(e){return t.yScale()(e.y)}}(this),width:function(t){return function(e){return t.xScale()(e.width)}}(this),height:function(t){return function(e){return null!=e.height?e.height:t.builder().height()-t.yScale()(e.y)}}(this),"class":function(t){return function(e){return t.style()+" "+e.tag}}(this),id:function(t){return"split-"+t.index}}).on("mouseover",this.createHandler(function(t){return function(e){var i,r;return i=d3.select(e),r=i.attr("id").slice(6),t.trigger("barEnter",r,null!=t.selectedId)}}(this))).on("click",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.select(e),n=i.classed("selected"),r=i.attr("id").slice(6),n?t.unSelectSplits():(t.unSelectSplits(),t.selectSplit(r)),t.trigger("barClick",r,n)}}(this))).on("mouseout",this.createHandler(function(t){return function(e){var i,r;return i=d3.select(e),r=i.attr("id").slice(6),t.unHighlightSplits(),t.trigger("barOut",e,r,null!=t.selectedId)}}(this))).on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],t.trigger("mousemove",r,n)}}(this)))},i.prototype.update=function(t){var e,i;return null==t&&(t=!1),e=this.builder().mainGroup.select("#"+this.id()),i=e.selectAll("rect").data(this.data()),t&&(i=i.transition().delay(0)),i.attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),width:function(t){return function(e){return Math.abs(t.xScale()(e.width)-t.xScale()(0))}}(this),height:function(t){return function(e){return null!=e.height?e.height:t.builder().height()-t.yScale()(e.y)}}(this)})},i.prototype.show=function(){var t;return t=this.builder().mainGroup.select("#"+this.id()),t.attr("display",""),t.selectAll("rect").transition().duration(300).delay(0).attr({height:function(t){return function(e){return null!=e.height?e.height:t.builder().height()-t.yScale()(e.y)}}(this),y:function(t){return function(e){return t.yScale()(e.y)}}(this)})},i.prototype.hide=function(){return this.builder().mainGroup.select("#"+this.id()).selectAll("rect").attr({height:0,y:this.builder().height()}),this.builder().mainGroup.select("#"+this.id()).attr("display","none")},i.prototype.getSelectedSplitId=function(){return this.selectedId},i.prototype.selectSplit=function(t){return this.selectedId=null,this.highlightSplit(t),this.builder().mainGroup.select("#"+this.id()).selectAll("rect#split-"+t).classed("selected",!0),this.selectedId=t},i.prototype.unSelectSplits=function(){return this.builder().mainGroup.select("#"+this.id()).selectAll("rect.simple-bar").classed("selected",!1),this.selectedId=null},i.prototype.highlightSplit=function(t){return this.selectedId?void 0:this.builder().mainGroup.select("#"+this.id()).selectAll("rect#split-"+t).classed("highlighted",!0)},i.prototype.unHighlightSplits=function(){return this.builder().mainGroup.select("#"+this.id()).selectAll("rect.simple-bar").classed("highlighted",!1)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.BarChartKey=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={builder:null,data:null,fill:!0,style:"simple-bar",xDomain:null,xScale:null,yScale:null,id:"generic-bar",interpolator:"",duration:1e3,xTranslation:0,keyWidth:15,keyToElbow:5,elbowToEnd:5,endToText:5,circleRadius:3,textBoxHeight:30,xOffset:0,yOffset:0},i.prototype.create=function(){var t,e;return t=this.builder(),e=t.mainGroup.append("svg:g").attr("id",this.id()).attr("transform","translate("+this.xTranslation()+", "+this.yOffset()+")"),this.data().key&&(e.selectAll("rect").data(this.data().key).enter().append("rect").attr("width",this.keyWidth()).attr("x",0).attr("y",function(t){return function(e){return t.yScale()(e.upperBound)}}(this)).attr("height",function(t){return function(e){return t.yScale()(e.upperBound)-t.yScale()(e.lowerBound)}}(this)).attr("class",function(t){return function(e){return t.style()+" "+e.tag}}(this)),e.selectAll(".key-text").data(this.data().keyText).enter().append("text").classed("chart-label",!0).attr("x",this.keyWidth()/2).attr("y",function(){return function(t){return t.y}}(this)).text(function(){return function(t){return t.text}}(this)).attr("text-anchor","middle")),this.addLines(this.data().lineData)},i.prototype.update=function(){},i.prototype.addLines=function(t){var e,i;return e=this.builder().mainGroup.append("svg:g").attr("id","avg-line").attr("transform","translate(0, "+this.yOffset()+")"),this.addLine(e,t.middle),i=this.builder().mainGroup.append("svg:g").attr("id","fast-slow-lines").attr("transform","translate(0, "+this.yOffset()+")"),this.addLine(i,t.top,this.findOffset("top",t.middle.raw,t.top.raw)),this.addLine(i,t.bottom,this.findOffset("bottom",t.middle.raw,t.bottom.raw))},i.prototype.findOffset=function(t,e,i){var r,n;return r=this.yScale()(e),n=this.yScale()(i),"top"===t?n>=r?-1*(this.textBoxHeight()+(n-r)):n>=r-this.textBoxHeight()?-1*(this.textBoxHeight()-(r-n)):0:r>=n?this.textBoxHeight()+(r-n):n<=r+this.textBoxHeight()?this.textBoxHeight()-(n-r):0},i.prototype.addLine=function(t,e,i){var r,n,a,s,o,l;return a={x:this.xScale()(e.split),y:this.yScale()(e.raw)},s={x:this.xTranslation()+this.keyWidth()+this.keyToElbow()+this.elbowToEnd()},null!=i&&0!==i?(s.y=this.yScale()(e.raw)+i+1,r={x:s.x-this.elbowToEnd(),y:a.y},n={x:s.x-this.elbowToEnd(),y:s.y},t.append("line").attr("class",e.className).attr("x1",a.x).attr("y1",a.y).attr("x2",r.x).attr("y2",r.y),t.append("line").attr("class",e.className).attr("x1",r.x).attr("y1",r.y).attr("x2",n.x).attr("y2",n.y),t.append("line").attr("class",e.className).attr("x1",n.x).attr("y1",n.y).attr("x2",s.x).attr("y2",s.y)):(s.y=this.yScale()(e.raw),t.append("line").attr("class",e.className).attr("x1",a.x).attr("y1",a.y).attr("x2",s.x).attr("y2",s.y)),-1===e.className.indexOf("avg")&&t.append("circle").attr("class",e.className).attr("cx",a.x).attr("cy",a.y).attr("r",this.circleRadius()),o={x:s.x+this.endToText(),y:s.y-8},l={x:s.x+this.endToText(),y:s.y+5},t.append("text").classed("chart-label",!0).attr("x",o.x).attr("y",o.y).attr("dy",".35em").text(e.text1).attr("text-anchor","left"),t.append("text").classed("chart-value",!0).attr("x",l.x).attr("y",l.y).attr("dy",".35em").text(e.text2).attr("text-anchor","left"),t.append("line").attr("class",e.className.replace(/-avg/,"")).attr("x1",o.x-this.endToText()).attr("y1",o.y+5).attr("x2",l.x-this.endToText()).attr("y2",l.y-2)},i.prototype.showFastSlowLines=function(){return this.builder().mainGroup.select("#fast-slow-lines").attr("display","")},i.prototype.hideFastSlowLines=function(){return this.builder().mainGroup.select("#fast-slow-lines").attr("display","none")},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.DataFilter=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={graph:null,streamData:null},i.prototype.filter=function(){var t,e,i,r,n,a,s,o,l,c,h;if(null==this.graph())return[];if(null==this.graph().data()||!this.graph().data().length)return[];for(e=this.graph().data(),h=this.graph().xScale()(e[0].x),t=this.graph().xScale()(e[e.length-1].x),a=t-h,s=Math.max(1,Math.round(this.graph().data().length/a)),n=function(t){return function(e){var i,r,n;return r=t.graph().xScale().domain(),i=(r[1]-r[0])/2,r[0]-i<=(n=e.x)&&n<=r[1]+i}}(this),c=[],r=i=0,o=e.length,l=s;l>0?o>i:i>o;r=i+=l)n(e[r])&&c.push(e[r]);return c},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Util={autoDomain:function(t,e){var i,r,n,a,s,o,l,c,h,u;return null==e&&(e={}),_.defaults(e,{paddingBottom:0,paddingTop:0,innerClamp:0}),r=d3.extent(t),a=r[0],n=r[1],o=n-a,e.outerClamp||(e.outerClamp=d3.max([e.innerClamp,o])),i=100-(e.paddingBottom+e.paddingTop),e.innerRange||(e.innerRange=i),u=d3.scale.linear().domain([e.innerClamp,e.outerClamp]).range([e.innerRange,i]).clamp(!0),s=u(o),l=e.paddingBottom+i/2,h=[l-s/2,l+s/2],c=d3.scale.linear().domain(r).range(h),[c.invert(0),c.invert(100)]},closestOrdinalValue:function(t,e){var i,r,n,a,s,o,l;for(o=e.range(),r=n=0,a=o.length;a>n;r=++n)if(l=o[r],l>t||r===o.length-1?i=r:(s=o[r+1],s>t&&(i=s-t>t-l?r:r+1)),"number"==typeof i)return e.domain()[i]},getPathPositionAt:function(t,e){var i,r,n,a;for(n=e,i=t.getTotalLength(),a=null;;){if(a=Math.floor((n+i)/2),r=t.getPointAtLength(a),(a===i||a===n)&&r.x!==e)break;if(r.x>e)i=a;else{if(!(r.x<e))break;n=a}}return r},niceTimeTicks:function(t,e){var i,r,n;return n=t.map(function(t){return new Date(d3.round(1e3*t))}),i=d3.time.scale().domain(n),r=i.ticks(e),r.map(function(t){return t.getTime()/1e3})}}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.AreaLine=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.groupId("area"+Math.floor(1e3*Math.random())),this.clipPathId("clip"+Math.floor(1e3*Math.random())),this.filter=(new Strava.D3.Charts.DataFilter).graph(this)}var r;return t(i,e),r={builder:null,data:[],fill:!0,style:"area-chart-curr",interpolator:"",groupId:"",clipPathId:"",xOffset:0,xClipOffset:0,yOffset:0,startHidden:!1,xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),animate:null,cloneAreaToClipPath:!1},i.prototype.create=function(){var t,e,r;return i.__super__.create.call(this),this.animate(this.builder().animate()),r=this.builder().root,r.insert("defs",":first-child").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:-4,height:this.builder().height()-this.yOffset()+4,width:this.builder().width()-this.xClipOffset()}),this.line=d3.svg.line().x(function(t){return function(e){return t.xScale()(e.x)}}(this)).y(function(t){return function(e){return t.yScale()(e.y)}}(this)),""!==this.interpolator()&&this.line.interpolate(this.interpolator()),this.area=d3.svg.area().x(function(t){return function(e){return t.xScale()(e.x)}}(this)).y0(this.builder().height()).y1(function(t){return function(e){return t.yScale()(e.y)}}(this)),""!==this.interpolator()&&this.area.interpolate(this.interpolator()),t=this.createContainer(),e=this.filter.filter(),t.selectAll("path#line").data([e]).enter().append("path").attr("id","line").attr("class",this.style()).attr("d",this.line),t.selectAll("path#area").data([e]).enter().append("path").attr("id","area").attr("class",this.style()+"-fill").attr("d",this.area),this.cloneAreaToClipPath()&&(r.insert("defs",":first-child").append("clipPath").attr({id:"master-"+this.clipPathId()}).append("rect").attr({x:0,y:-this.builder().height()+4,height:this.builder().height()-this.yOffset()+4,width:this.builder().width()-this.xClipOffset()}),this.clonedClipPath=r.append("defs",":first-child").append("clipPath").data([e]).attr({id:"child-"+this.clipPathId()}).attr({"clip-path":"url(#master-"+this.clipPathId()+")"}).append("path").attr("d",this.area).attr("transform","translate(0, -"+(this.builder().height()-1)+")")),this.startHidden()?this.hide():void 0},i.prototype.createContainer=function(){return this.builder().mainGroup.append("svg:g").attr({id:this.groupId(),"clip-path":"url(#"+this.clipPathId()+")"}).attr("transform","translate("+this.xOffset()+","+this.yOffset()+")")},i.prototype.update=function(t){var e,i,r,n,a;return null==t&&(t=!0),t=this.shouldAnimate(t),r=this.builder().mainGroup.select("g#"+this.groupId()),n=this.filter.filter(),a=r.selectAll("path#line").data([n]),a=t?a.transition().duration(500).delay(0):a,a.attr("d",this.line),e=r.selectAll("path#area").data([n]),e=t?e.transition().duration(500).delay(0):e,e.attr("d",this.area),this.cloneAreaToClipPath()?(i=this.clonedClipPath.data([n]),i=t?e.transition().duration(500).delay(0):i,i.attr("d",this.area)):void 0},i.prototype.updateCanvas=function(){return this.builder().root.select("rect#"+this.clipPathId()).attr("width",this.builder().width()),this.update()},i.prototype.show=function(){return this.builder().mainGroup.select("#"+this.groupId()).attr("display","")},i.prototype.hide=function(){return this.builder().mainGroup.select("#"+this.groupId()).attr("display","none")},i.prototype.hidden=function(){return"none"===this.builder().mainGroup.select("#"+this.groupId()).attr("display")},i.prototype.getPositionAt=function(t){var e,i;return e=this.builder().mainGroup.select("g#"+this.groupId()),i=e.select("path#line").node(),Strava.D3.Charts.Util.getPathPositionAt(i,t)},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.PlotGraph=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.groupId("plot"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={builder:null,data:[],fillColor:null,style:"plot-graph",groupId:"",xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100])},i.prototype.create=function(){var t,e;return i.__super__.create.call(this),t=this.builder(),e=t.mainGroup.append("svg:g").attr("id",this.groupId()),e.selectAll(".point").data(this.data()).enter().append("circle").attr({stroke:"none",fill:this.fillColor(),"pointer-events":"all",r:2}).attr("cx",function(t){return function(e){return t.xScale()(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale()(e.y)}}(this)).on("click",function(){})},i.prototype.update=function(){var t,e,i;return t=this.builder(),e=t.mainGroup.select("g#"+this.groupId()),i=e.selectAll("circle").data([this.data()]),i.enter().append("svg:circle").attr("stroke","none").attr("fill",this.fillColor()).attr("pointer-events","all").attr("cx",function(t){return function(e){return t.xScale()(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale()(e.y)}}(this)).attr("r",3).on("click",function(){}),i.transition().duration(500).delay(0).attr("cx",function(t){return function(e){return t.xScale()(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale()(e.y)}}(this)),i.exit().remove()},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Axis=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder(t),this.animate(t.animate()),this.xScale=d3.scale.linear().domain([0,0]).range([0,this.builder().width()]),this.yScale=d3.scale.linear().domain([0,0]).range([this.builder().height(),0]).nice(),this.clipPathId("clip"+Math.floor(1e3*Math.random())),this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.yScale).orient("left")}var r;return t(i,e),Strava.includeModule(i,Strava.chart_module),r={builder:null,selectedClass:"",clipPathId:"",xClipOffset:0,addClip:!1,animate:null},i.prototype.addClipRectangle=function(t){var e;return null==t&&(t={}),this.addClip()?(e={width:this.builder().width()-this.xClipOffset(),height:this.builder().height(),x:0,y:0},_.extend(e,t),this.builder().root.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:e.x,y:e.y,height:e.height,width:e.width}),this.builder().root.select("g#xaxis").attr("clip-path","url(#"+this.clipPathId()+")")):void 0},i.prototype.create=function(){var t,e;switch(t=this.builder(),t.yAxisOrientation()){case"left":e=t.padding().left;break;case"right":e=t.padding().left+t.width(),this.yAxis.orient("right")}return this.xAxis.tickFormat(t.context.xTickFormat()),this.yAxis.tickFormat(t.context.yTickFormat()),this.addAxis(t.root,this.xAxis,"xaxis","axis xaxis",t.padding().left,t.height()+t.padding().top),this.addClipRectangle(),this.addAxis(t.root,this.yAxis,"yaxis","axis yaxis",e,t.padding().top),this.bindEvents(),this},i.prototype.createYAxis2=function(t,e){var i,r;return i=this.builder(),i.root.select(".yaxis2").remove(),this.yScale2=e,this.yAxis2=d3.svg.axis().scale(e).orient("right").ticks(5).tickFormat(function(){return function(e){return i.context.getTickFormat(t,e)}}(this)),r=i.padding().left+i.width(),this.addAxis(i.root,this.yAxis2,"yaxis2","axis yaxis2",r,i.padding().top),this},i.prototype.createForBarChart=function(t,e,i,r){var n,a,s,o,l,c;return n=this.builder(),this.xScale=t,this.yScale=e,this.xAxis=d3.svg.axis().scale(t).orient("bottom"),this.xAxis.tickValues(i),this.addAxis(n.root,this.xAxis,"xaxis","axis xaxis",n.padding().left,n.height()+n.padding().top),this.addClipRectangle(),a=function(t){return(new Strava.I18n.TimespanFormatter).display(Math.round(t))},this.yAxis=d3.svg.axis().scale(e).orient("left").tickFormat(a).tickValues(r),this.addAxis(n.root,this.yAxis,"yaxis","axis yaxis",n.padding().left,n.padding().top),o=n.padding().left-35,c=n.padding().top-10,s="min"+n.context.getUnit("pace"),this.addAxisLabel(s,o,c),l=t.rangeExtent?t.rangeExtent()[1]:t.range()[1],o=n.padding().left+l+10,c=n.height()+n.padding().top+16,s=n.context.getUnit("pace").slice(1),this.addAxisLabel(s,o,c),this.bindEvents(),this},i.prototype.createForIntegratedChart=function(t,e,i,r,n){var a,s,o;return a=this.builder(),this.xScale=t,this.yScale=e,s=a.padding().left,o=a.padding().top+a.height(),this.xAxis=d3.svg.axis().scale(t).orient("bottom").tickValues(i),this.addAxis(a.root,this.xAxis,"xaxis","axis xaxis",s,o),n&&this.addClipRectangle(n),this.xAxisIntegrated=d3.svg.axis().scale(t).orient("bottom").tickValues(i).tickSize(-a.height(),0,0).tickFormat(""),this.addAxis(a.root,this.xAxisIntegrated,"xaxis-integrated","axis xaxis-integrated",s,o,n.clipPathId),this.yAxis=d3.svg.axis().scale(e).orient("left").tickValues(r),this.addAxis(a.root,this.yAxis,"yaxis","axis yaxis",a.padding().left,a.padding().top),this.bindEvents(),this},i.prototype.addAxisLabel=function(t,e,i){var r;return r=this.builder().topGroupDimensions(),i+=r.height,this.builder().root.append("svg:g").attr({"class":"axis text",transform:"translate("+e+", "+i+")","text-anchor":"left"}).append("text").text(t)},i.prototype.hideAxis=function(t){var e;return e=this.builder(),"x"===t?e.root.select("g.xaxis").attr("display","none"):e.root.select("g.yaxis").attr("display","none")},i.prototype.update=function(t){var e;return t=this.shouldAnimate(t),this.xAxis.scale(this.xScale),this.yAxis.scale(this.yScale),this.xAxisIntegrated&&this.xAxisIntegrated.scale(this.xScale),this.yAxis2&&this.yAxis2.scale(this.yScale2),e=this.builder(),t?(e.root.select("g.yaxis").transition().call(this.yAxis),e.root.select("g.xaxis").transition().call(this.xAxis),this.xAxisIntegrated&&e.root.select("g.xaxis-integrated").transition().call(this.xAxisIntegrated),this.yAxis2&&e.root.select("g.yaxis2").transition().call(this.yAxis2)):(e.root.select("g.yaxis").call(this.yAxis),e.root.select("g.xaxis").call(this.xAxis),this.xAxisIntegrated&&e.root.select("g.xaxis-integrated").call(this.xAxisIntegrated),this.yAxis2&&e.root.select("g.yaxis2").call(this.yAxis2)),this.bindEvents(),this
},i.prototype.updateCanvas=function(){return this.builder().root.select("rect#"+this.clipPathId()).attr({width:this.builder().width()-this.xClipOffset()}),this.update()},i.prototype.zoom=function(t,e){return this.xScale.domain(t),this.yScale.domain(e),this.xAxis.ticks(5),this.update()},i.prototype.resetZoom=function(){return this.zoom(this.originalDomainX,this.originalDomainY)},i.prototype.bindEvents=function(){var t;return t=this.builder().root.selectAll(".xaxis text"),t.on("click",this.createHandler(function(e){return function(i,r){var n,a;return e.trigger("axisClick",e.xScale(r)),null!=e.selectedClass()&&e.selectedClass().length?(n=d3.select(i),a=n.classed(e.selectedClass()),t.classed(e.selectedClass(),!1),n.classed(e.selectedClass(),!a)):void 0}}(this)))},i.prototype.unbindEvents=function(){return this.builder().root.selectAll(".xaxis text").on("click",null)},i.prototype.clearAxisStyle=function(){return this.builder().root.selectAll(".xaxis text").classed(this.selectedClass(),!1)},i.prototype.getAxis=function(t){switch(t){case"x":return this.xAxis;case"y2":return this.yAxis2;case"xIntegrated":return this.xAxisIntegrated;default:return this.yAxis}},i.prototype.getAxisElement=function(t){switch(t){case"x":return this.builder().root.select(".xaxis");case"y2":return this.builder().root.select(".yaxis2");case"xIntegrated":return this.builder().root.select(".xaxis-integrated");default:return this.builder().root.select(".yaxis")}},i.prototype.getScale=function(t){switch(t){case"x":return this.xScale;case"y2":return this.yScale2;default:return this.yScale}},i.prototype.setScale=function(t,e){switch(t){case"x":this.xScale=e;break;case"y2":this.yScale2=e;break;default:this.yScale=e}return this},i.prototype.setScaleDomain=function(t,e){var i;return i=this.getScale(t),"x"===t?this.originalDomainX=e:this.originalDomainY=e,i.domain(e),this},i.prototype.setAxisTicks=function(t,e){var i;return i=this.getAxis(t),i.ticks(e),this},i.prototype.setScaleNice=function(t){var e;return e=this.getScale(t),e.nice(),this},i.prototype.addAxis=function(t,e,i,r,n,a,s){var o,l;return l=this.builder().topGroupDimensions(),o={"class":r,id:i,transform:"translate("+n+".5, "+(a+l.height)+".5)"},s&&(o["clip-path"]="url(#"+s+")"),t.append("svg:g").attr(o).call(e)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.InfoBox=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.contentCallback(t)}var r;return t(i,e),r={builder:null,fixed:!1,position:0,infobox:null,contentCallback:function(){},infobox:null,disabled:!1,lineHeight:16,boxWidth:150,xOffset:10,negativeXOffset:180,yOffset:20,textHeight:13,textTopPadding:5,textBottomPadding:15,textXOffset:10,allowFixedState:!0,containerWidth:null},i.prototype.create=function(){var t;return t=this.builder().mainGroup.append("svg:g").attr("id","infoBox"),this.infobox(t),this.infobox().append("rect").attr({x:0,y:this.yOffset(),width:this.boxWidth()}),this.containerWidth()||this.containerWidth(this.builder().width()),this},i.prototype.update=function(t){return this.disabled()?this.hide():(this.show(),this.fixed()?void 0:this.move(t))},i.prototype.move=function(t){var e,i,r,n,a;this.position(t),i=this.contentCallback()(t),t+this.boxWidth()+this.xOffset()>this.containerWidth()?(r=t-(this.boxWidth()+this.xOffset()),this.transitionGroup(r)):(r=t+this.xOffset(),this.transitionGroup(r)),this.infobox().selectAll("text").attr("display","none"),e=0;for(n in i)a=i[n],this.createText(n),e++,this.moveText(n,a,e);return this.infobox().select("rect").attr({height:""+(e*this.lineHeight()+this.textBottomPadding())})},i.prototype.transitionGroup=function(t){return this.infobox().attr({transform:"translate("+t+", 0)",display:""})},i.prototype.createText=function(t){var e;return e=this.infobox().select("text#infobox-text-"+t).node(),null==e?(e=this.infobox().append("text").attr({id:"infobox-text-"+t,x:this.textXOffset(),width:this.boxWidth(),height:this.textHeight(),"pointer-events":"none"}),e.append("tspan").attr({"class":"title","pointer-events":"none"}),e.append("tspan").attr({"class":"value","pointer-events":"none"})):void 0},i.prototype.updateText=function(){return this.fixed()?this.move(this.position()):void 0},i.prototype.moveText=function(t,e,i){var r;return r=this.infobox().select("text#infobox-text-"+t).attr({y:""+(i*this.lineHeight()+this.textTopPadding()+this.yOffset()),x:this.textXOffset(),display:""}),r.select(".title").text(e.title+": "),r.select(".value").attr("font-weight","bold").text(""+e.val)},i.prototype.toggleFixedState=function(){return!this.disabled()&&this.allowFixedState()?this.fixed(!this.fixed()):void 0},i.prototype.forceFixedState=function(t){return!this.disabled()&&this.allowFixedState()?this.position()===t&&this.fixed()?(this.fixed(!1),this.hide()):(this.fixed(!0),this.show(),this.move(t)):void 0},i.prototype.hide=function(){return this.fixed()?void 0:this.infobox().attr("display","none")},i.prototype.show=function(){return this.infobox().attr("display","")},i.prototype.disable=function(){return this.disabled(!0),this.fixed(!1),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i.prototype.zoom=function(){},i.prototype.resetZoom=function(){},i.prototype.updateCanvas=function(){return this.containerWidth(this.builder().width())},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pointInfoBox"]=function(t){return function(){var t,e,i,r,n,a;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<ul class='point-on-path-box-items'>"),a=this.items;for(r in a)n=a[r],i.push("  <li class='point-on-path-box-item point-on-path-box-item"+n.title.toLowerCase().replace(/\W/,"")+"'>\n    <span class='point-on-path-box-item-label'>"+e(t(n.title))+"</span>"),i.push("    "+e(t(n.val))),i.push("  </li>");return i.push("</ul>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.PointInfoBox=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.contentCallback(t),this.alignObject=e}var r;return t(i,e),r={builder:null,contentCallback:function(){},disabled:!1,xOffset:0,yOffset:20,containerWidth:null,containerHeight:null,crossBarClassName:"smooth-pace-info-crossbar",pointClassName:"smooth-pace-info-point",pointBoxClassName:"point-on-path-box",token:Math.floor(1e3*Math.random()),pointRadius:3.5,yThreshold:500,yFloor:null,visible:!1,container:null},i.prototype.create=function(){return this.flexibleTextBox=this.$$("<div></div>").attr("class",this.pointBoxClassName()).attr("id",this.pointBoxClassName()+"-"+this.token()).append(JST["activities/pointInfoBox"]({items:[]})),this.flexibileCrossBar=this.builder().mainGroup.append("line").attr("id",this.crossBarClassName()+"-"+this.token()).attr("class",this.crossBarClassName()).attr("x1",100).attr("y1",this.yOffset()).attr("x2",100).attr("y2",200).style("opacity",0),this.container().append(this.flexibleTextBox),this.flexibleTextBox=this.$$("#"+this.pointBoxClassName()+"-"+this.token()),this.yFloor(this.yFloor()+this.yThreshold()),this.c=this.builder().mainGroup.append("svg:circle").attr("class",this.pointClassName()).attr("id",this.pointClassName()+"-"+this.token()).attr("r",0).attr("stroke","#4788b9").style("opacity",0),this},i.prototype.update=function(t,e){return this.disabled()?this.hide():this.visible()?(this.move(t,e),this.show()):void 0},i.prototype.move=function(t,e){var i,r,n,a;return r=this.contentCallback()(t),n=this.alignObject.getPositionAt(t),e<this.yFloor()?(this.updateText(JST["activities/pointInfoBox"]({items:r})),a=this.flexibleTextBox.outerWidth(),i=this.flexibleTextBox.height()+2,this.moveTextBox(t+a+this.xOffset()>this.containerWidth()+this.xOffset()?this.containerWidth()-a+this.xOffset():t+this.xOffset()),this.moveCrossBar(t,i,this.containerHeight()),this.movePoint(t,n.y),this.show()):this.hide()},i.prototype.moveCrossBar=function(t,e,i){return this.flexibileCrossBar.attr("x1",t).attr("x2",t).attr("y1",e).attr("y2",i)},i.prototype.movePoint=function(t,e){return this.c.attr("transform","translate("+t+","+e+")")},i.prototype.updateText=function(t){return this.flexibleTextBox.html(t)},i.prototype.moveTextBox=function(t){var e;return e=/Constructor/.test(window.HTMLElement)?-1:0,this.flexibleTextBox.css({left:t+e+"px",top:this.yOffset()+"px"})},i.prototype.hide=function(){return this.visible()?(this.c.transition().duration(100).attr("r",0).style("opacity",0),this.flexibileCrossBar.style("opacity",0),this.flexibleTextBox.removeClass("point-on-path-box-visible"),this.visible(!1)):void 0},i.prototype.show=function(){return this.visible()===!1&&this.disabled()===!1?(this.c.transition().duration(100).attr("r",this.pointRadius()).style("opacity",1),this.flexibileCrossBar.style("opacity",1),this.flexibleTextBox.addClass("point-on-path-box-visible"),this.visible(!0)):void 0},i.prototype.disable=function(){return this.disabled(!0),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i.prototype.updateCanvas=function(){return this.containerWidth(this.builder().width())},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["controls/scrollBar"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+this.className+"' id='"+this.id+"' style='"+e(t(this.size))+"'>\n  <div class='"+this.gutterClassName+"'></div>\n  <div class='"+this.gripClassName+"'></div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.ScrollBar=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.context(t),this.builder(e),this.className(this.baseClassName()+" "+this.style()+" "+this.baseClassName()+"-"+this.type()),this.id(this.baseClassName()+"-"+this.token())}var r;return t(i,e),Strava.includeModule(i,Strava.chart_module),r={context:null,builder:null,container:null,type:"horizontal",baseClassName:"s-scrollbar",style:"",id:null,className:null,disabled:!1,token:Math.floor(1e3*Math.random()),hideWhenNotNeeded:!0,body:null,gripClassName:"s-scrollbar-grip",gutterClassName:"s-scrollbar-gutter",grip:null,gutter:null,scrollBar:null,isVisible:!1,size:null,minimalGripSize:20,contentSize:0,windowSize:0,gutterSize:0,gripSize:0,windowContentRatio:0,windowScrollAreaSize:0,windowPosition:0,windowPositionRatio:0,trackScrollAreaSize:0,gripPositionOnTrack:0,mousePosition:0,containerOffset:{}},i.prototype.create=function(){var t,e,i,r;return t=this.builder(),this.body(this.$$("body")),r="horizontal"===this.type()?"width":"height",i={id:this.id(),className:this.className(),size:r+": "+this.size()+"px;",gutterClassName:this.gutterClassName(),gripClassName:this.gripClassName()},e=JST["controls/scrollBar"](i),this.container().append(e),this.scrollBar(this.$$("#"+this.id())),this.grip(this.$$("#"+this.id()+" ."+this.gripClassName())),this.gutter(this.$$("#"+this.id()+" ."+this.gutterClassName())),this.containerOffset(this.container().offset()),this.windowSize(this.size()),this.gutterSize(this.windowSize()),this.scaleComponents(this.gripPositionOnTrack()),this.bindEvents()},i.prototype.scaleComponents=function(t){var e,i;return this.windowScrollAreaSize(this.contentSize()-this.windowSize()),this.windowContentRatio(this.windowSize()/this.contentSize()),this.gripSize(Math.round(this.gutterSize()*this.windowContentRatio())),this.gripSize()<this.minimalGripSize()?this.gripSize(this.minimalGripSize()):this.gripSize()>=this.size()?(this.gripSize(this.size()),this.windowPosition(0),this.hideWhenNotNeeded()&&this.hide(),this.trigger("noContentAvailable",this)):this.show(),"horizontal"===this.type()?this.grip().css("width",this.gripSize()+"px"):this.grip().css("height",this.gripSize()+"px"),this.trackScrollAreaSize(this.gutterSize()-this.gripSize()),e=t,this.gripPositionOnTrack()>this.trackScrollAreaSize()&&(e=this.trackScrollAreaSize()),this.positionGrip(e,!0),i=this.gripPositionOnTrack()/this.trackScrollAreaSize(),this.positionWindow(i*this.windowScrollAreaSize())},i.prototype.positionWindow=function(t,e){var i;return null==e&&(e=!1),this.windowPosition(t),i=this.windowPosition()/this.windowScrollAreaSize(),1===i&&this.trigger("atContentEnd",this),0===i&&this.trigger("atContentStart",this),i>0&&1>i?(this.trigger("contentAvailableStart",this),this.trigger("contentAvailableEnd",this)):void 0},i.prototype.positionGrip=function(t,e){var i,r;return null==e&&(e=!1),this.gripPositionOnTrack(t),i="horizontal"===this.type()?"left":"top",e===!1?this.grip().css(i,this.gripPositionOnTrack()+"px"):(r={},r[i]=this.gripPositionOnTrack()+"px",this.grip().animate(r,200))},i.prototype.bindEvents=function(){return this.grip().on("mousedown.scrollBar"+this.token(),function(t){return function(e){return t.handleStart(e)}}(this)),this.gutter().on("click.scrollBar"+this.token(),function(t){return function(e){return t.handleGutterPositioning(e)}}(this))},i.prototype.handleGutterPositioning=function(t){var e,i;return t.preventDefault(),i=t.pageX-this.gutter().offset().left,i<this.gripPositionOnTrack()&&this.positionGrip(i,!0),i>this.gripPositionOnTrack()+this.gripSize()&&(i-this.gripSize()>this.trackScrollAreaSize()?this.positionGrip(this.trackScrollAreaSize(),!0):this.positionGrip(i-this.gripSize(),!0)),e=this.gripPositionOnTrack()/this.trackScrollAreaSize(),this.positionWindow(e*this.windowScrollAreaSize()),this.trigger("change",this,t)},i.prototype.handleChange=function(t){var e,i,r;return t.preventDefault(),"horizontal"===this.type()?(e=t.pageX-this.containerOffset().left-this.mousePosition(),this.mousePosition(t.pageX-this.containerOffset().left)):(e=t.pageY-this.containerOffset().top-this.mousePosition(),this.mousePosition(t.pageY-this.containerOffset().top)),i=this.gripPositionOnTrack()+e,0>i&&(i=0),i>this.trackScrollAreaSize()&&(i=this.trackScrollAreaSize()),this.positionGrip(i),r=i/this.trackScrollAreaSize(),this.positionWindow(r*this.windowScrollAreaSize()),this.trigger("change",this,t)},i.prototype.handleStart=function(t){var e;return t.preventDefault(),this.disabled()?void 0:(this.mousePosition("horizontal"===this.type()?t.pageX-this.containerOffset().left:t.pageY-this.containerOffset().top),this.scrollBar().addClass(this.baseClassName()+"-dragging"),e=this.body(),e.on("mousemove.scrollBar"+this.token(),function(t){return function(e){return t.handleChange(e)}}(this)),e.on("mouseup.scrollBar"+this.token(),function(t){return function(e){return t.handleEnd(e)}}(this)),e.addClass("interaction-grabbing"),this.trigger("start",this,t))},i.prototype.handleEnd=function(t){var e;return this.scrollBar().removeClass(this.baseClassName()+"-dragging"),e=this.body(),e.off("mousemove.scrollBar"+this.token()),e.off("mouseup.scrollBar"+this.token()),e.removeClass("interaction-grabbing"),this.trigger("end",this,t)},i.prototype.update=function(t,e){return e||(e=this.gripPositionOnTrack()),this.contentSize(t),this.scaleComponents(e),this.trigger("change",this)},i.prototype.disable=function(){return this.disabled(!0),this.scrollBar().addClass(this.baseClassName()+"-disabled"),this.trigger("disable",this)},i.prototype.enable=function(){return this.disabled(!1),this.scrollBar().removeClass(this.baseClassName()+"-disabled"),this.trigger("enable",this)},i.prototype.hide=function(){return this.disable(),this.scrollBar().addClass(this.baseClassName()+"-hidden"),this.isVisible(!1),this.trigger("hide",this)},i.prototype.show=function(){return this.enable(),this.scrollBar().removeClass(this.baseClassName()+"-hidden"),this.isVisible(!0),this.trigger("show",this)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Filter=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder(t),this.id(e)}var r;return t(i,e),r={builder:null,id:"filter",height:"200%",width:"200%",originX:"-20%",originY:"-20%"},i.prototype.DEFAULTS={basicShadow:{x:1,y:1,blur:10,opacity:10}},i.prototype.basicShadow=function(t,e){var i,r,n;return e=_.extend({},this.DEFAULTS.basicShadow,e),n=this.builder().root,i=n.append("defs").append("filter").attr("id",this.id()).attr("height",this.height()).attr("x",this.originX()).attr("y",this.originY()).attr("width",this.width()),i.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",e.blur),i.append("feOffset").attr("dx",e.x).attr("dy",e.y).attr("result","offsetBlur"),i.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",e.opacity),r=i.append("feMerge"),r.append("feMergeNode"),r.append("feMergeNode").attr("in","SourceGraphic"),d3.select(t).attr("filter","url(#"+this.id()+")")},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.CrossBar=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.convertToTitle(t)}var r;return t(i,e),r={crossBarStyle:"crossbar",builder:null,fixed:!1,position:0,boxWidth:150,xOffset:10,negativeXOffset:180,textXOffset:0,textYOffset:15,convertToTitle:function(){},disabled:!1,allowFixedState:!0,containerWidth:null,groupName:"crossBar"},i.prototype.create=function(){var t,e;return t=this.builder(),e=t.mainGroup.append("svg:g").attr("id",this.groupName()),e.append("line").attr({x1:0,x2:0,y1:t.height(),y2:0,"class":this.crossBarStyle(),display:"none"}),e.append("text").attr({x:this.textXOffset(),y:this.textYOffset(),"class":"crossbar-text","text-anchor":"left",display:"none","pointer-events":"none"}),this.containerWidth()||this.containerWidth(this.builder().width()),this},i.prototype.update=function(t){return this.disabled()?this.hide():(this.show(),this.fixed()?void 0:this.move(t))},i.prototype.move=function(t){var e;return this.position(t),e=t+this.boxWidth()+this.xOffset()>this.containerWidth()?t-(this.boxWidth()+this.xOffset()):t+this.xOffset(),this.getBar().attr({x1:t-.5,x2:t-.5,display:"","class":this.crossBarStyle()}),this.getTitle().attr({x:e+this.textXOffset(),display:""}).text(this.convertToTitle()(t))},i.prototype.toggleFixedState=function(){var t;if(!this.disabled()&&this.allowFixedState())return this.fixed(!this.fixed()),t=this.crossBarStyle(),this.fixed()?t="crossbar crossbar-clicked":this.builder().axis().clearAxisStyle(),this.getBar().attr("class",t)},i.prototype.forceFixedState=function(t){return!this.disabled()&&this.allowFixedState()?this.position()===t&&this.fixed()?(this.fixed(!1),this.hide()):(this.fixed(!0),this.show(),this.move(t),this.getBar().attr("class","crossbar crossbar-clicked")):void 0},i.prototype.hide=function(){var t;return this.fixed()?void 0:(t=this.builder().mainGroup.select("g#"+this.groupName()),t.attr("display","none"))},i.prototype.disable=function(){return this.disabled(!0),this.fixed(!1),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i.prototype.show=function(){var t;return t=this.builder().mainGroup.select("g#"+this.groupName()),t.attr("display","")},i.prototype.getBar=function(){var t;return t=this.builder().mainGroup.select("g#"+this.groupName()),t.selectAll("line")},i.prototype.getTitle=function(){var t;return t=this.builder().mainGroup.select("g#"+this.groupName()),t.selectAll("text")},i.prototype.zoom=function(){},i.prototype.resetZoom=function(){},i.prototype.updateCanvas=function(){return this.containerWidth(this.builder().width())},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.BarCallout=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.getSplitIdFromX(t),this.getSplitData(e)}var r;return t(i,e),r={builder:null,callout:null,getSplitIdFromX:function(){},getSplitData:function(){},callout:null,disabled:!1,lineHeight:16,boxWidth:150,xOffset:0,yOffset:0,textHeight:13,textTopPadding:5,textBottomPadding:15,textXOffset:25,xScale:null,yScale:null,fixed:!1},i.prototype.create=function(){var t;return t=this.builder().mainGroup.append("svg:g").attr({id:"callout","class":"tooltip-group"}),this.callout(t),this.callout().append("rect").attr({fill:"#F5F5F5","fill-opacity":".95","stroke-width":".1",stroke:"#000000",width:this.boxWidth(),"pointer-events":"none","class":"chart-tooltip"}),this},i.prototype.updateFromGridEvent=function(t){var e;if(!this.fixed())return e=this.getSplitIdFromX()(t),e?this.update(e):void 0},i.prototype.updateFromBarEvent=function(t){return this.fixed()?void 0:this.update(t)},i.prototype.fixedAt=function(t){return this.fixed(!0),this.forceUpdate(t)},i.prototype.forceUpdate=function(t){return this.update(t)},i.prototype.update=function(t){var e;return this.disabled()?this.hide():(this.show(),e=this.getSplitData()(t),this.showCallout(e),this.highlightBar(e))},i.prototype.highlightBar=function(t){return this.builder().graphs().paceAnalysisBars.unHighlightSplits(),this.builder().graphs().paceAnalysisBars.highlightSplit(t.split.index)},i.prototype.showCallout=function(t){var e,i,r,n,a,s,o,l,c;i=t.streams,n=t.split,c=this.xScale()(n.label),o=Math.round(this.yScale()(n.y))+this.yOffset()-this.textBottomPadding()-this.textTopPadding(),l=this.builder().graphs().paceAnalysisBars.width(),c+this.boxWidth()>l?(r={x:Math.min(c,l)-this.boxWidth(),y:o},this.transitionGroup(r)):(r={x:Math.max(c,0),y:o},this.transitionGroup(r)),e=0;for(a in i)s=i[a],this.createText(a),e++,this.moveText(a,s,e);return this.callout().select("rect").attr({height:""+(e*this.lineHeight()+this.textBottomPadding())})},i.prototype.transitionGroup=function(t){return this.callout().attr({transform:"translate("+t.x+", "+t.y+")",display:""})},i.prototype.createText=function(t){var e;return e=this.callout().select("text#callout-text-"+t).node(),null==e?(e=this.callout().append("text").attr({id:"callout-text-"+t,x:this.textXOffset(),width:this.boxWidth(),height:this.textHeight(),"pointer-events":"none"}),e.append("tspan").attr({"class":"chart-tooltip-label","pointer-events":"none"}),e.append("tspan").attr({"class":"chart-tooltip-value","pointer-events":"none"}),e.append("tspan").attr({"class":"chart-tooltip-unit","pointer-events":"none"})):void 0},i.prototype.moveText=function(t,e,i){var r;return r=this.callout().select("text#callout-text-"+t).attr({y:""+(i*this.lineHeight()+this.textTopPadding()),x:this.textXOffset(),display:""}),r.select(".chart-tooltip-label").text(e.title+": "),r.select(".chart-tooltip-value").text(""+e.val),r.select(".chart-tooltip-unit").text(""+e.label),this},i.prototype.hide=function(){return this.fixed()?void 0:this.callout().attr("display","none")},i.prototype.show=function(){return this.callout().attr("display","")},i.prototype.disable=function(){return this.fixed(!1),this.disabled(!0),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.PartialAreaLine=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.segmentClipPathId("clip"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={startIndex:0,endIndex:-1,extentConvertor:null,segmentClipPathId:""},i.prototype.create=function(){return i.__super__.create.call(this),this.hide(!1)},i.prototype.createContainer=function(){var t,e;return this.builder().root.insert("defs",":first-child").append("clipPath").attr({id:this.segmentClipPathId()}).append("rect").attr({id:this.segmentClipPathId(),x:0,y:-4,height:this.builder().height()-this.yOffset()+4,width:0}),t=this.builder().mainGroup.append("svg:g").attr({"clip-path":"url(#"+this.clipPathId()+")"}).attr("transform","translate("+this.xOffset()+","+this.yOffset()+")"),e=t.append("svg:g").attr({id:this.groupId(),"clip-path":"url(#"+this.segmentClipPathId()+")"})},i.prototype.extent=function(){var t,e,i,r;return i=null!=this.startIndex()?this.startIndex():0,t=null==this.endIndex()||-1===this.endIndex()?this.data().length-1:this.endIndex(),null!=this.extentConvertor()?this.extentConvertor()(this.xScale(),i,t):(r=this.xScale()(this.data()[i].x),e=this.xScale()(this.data()[t].x),[r,e])},i.prototype.update=function(t){var e,r,n,a;return null==t&&(t=!0),i.__super__.update.call(this,t),t=this.shouldAnimate(t),e=this.builder(),r=this.extent(),n=e.root,a=n.select("rect#"+this.segmentClipPathId()),a=t?a.transition().duration(500).delay(0):a,a.attr({x:r[0],y:0,height:e.height()-this.yOffset(),width:r[1]-r[0]})},i.prototype.hide=function(t){var e;return null==t&&(t=!0),t=this.shouldAnimate(t),e=this.builder().root.select("rect#"+this.segmentClipPathId()),e=t?e.transition().delay(0):e,e.attr("width",0)},i.prototype.show=function(){return this.update(!1)},i.prototype.resetZoom=function(){return i.__super__.resetZoom.call(this,!1),this.hide(!1)},i}(Strava.D3.Charts.AreaLine)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.DraggableRect=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.origin=0}var r;return t(i,e),r={builder:null,data:[],xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),mod:0},i.prototype.create=function(){var t,e,i,r;return t=this.builder(),i=this.createHandler(function(e){return function(i){var r;return r=d3.event.x,0>=r&&(r=0),r+t.width()/e.mod()>=t.width()&&(r=t.width()-t.width()/e.mod()),d3.select(i).attr("x",r),e.trigger("dragmove",r,Math.round(r+t.width()/e.mod()))}}(this)),e=d3.behavior.drag().origin(function(t){return function(){return{x:t.origin,y:0}}}(this)).on("drag",i).on("dragend",this.createHandler(function(t){return function(e){var i,r,n;return t.origin=parseInt(d3.select(e).attr("x"),10),r=t.getBounds(),n=r[0],i=r[1],t.trigger("dragend",n,i)}}(this))),r=t.mainGroup.append("svg:g").attr("id","drag-rect"),r.append("rect").attr({x:0,y:0,height:t.height(),style:"cursor: move",width:0,"class":"drag-rect"}).call(e).on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],r>t.builder().width()?void 0:t.trigger("mousemove",r,n)}}(this))).on("mouseout",this.createHandler(function(t){return function(){return t.trigger("mouseout")}}(this)))},i.prototype.update=function(t){var e,i,r,n,a;return e=this.builder(),r=e.mainGroup.select("#drag-rect"),this.mod(Math.pow(2,t)),this.origin=e.width()/2-e.width()/this.mod()/2,r.select("rect").attr("height",e.height()),r.select("rect").transition().duration(300).attr({width:e.width()/this.mod(),x:this.origin,opacity:1}),n=this.getBounds(),a=n[0],i=n[1],this.trigger("initiateZoom",a,i)},i.prototype.getBounds=function(){return[this.origin,Math.round(this.origin+this.builder().width()/this.mod())]},i.prototype.isVisible=function(){var t;return t=this.builder().mainGroup.select("#drag-rect").select("rect"),null!=t[0]&&null!=t.attr("opacity")&&0!==parseInt(t.attr("opacity"),10)},i.prototype.hide=function(){return this.builder().mainGroup.select("#drag-rect").select("rect").transition().delay(0).attr({width:this.builder().width(),opacity:0,x:0}).each("end",function(){return d3.select(this).attr("height",0)}),this.trigger("initiateZoom",0,this.builder().width())},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Brush=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={builder:null,xScale:d3.scale.linear().domain([1,10]).range([0,100]),id:"brush"},i.prototype.create=function(){return this.brush=d3.svg.brush().x(this.xScale()).on("brush",function(t){return function(){return _.throttle(t.brushEvent(),100)}}(this)).on("brushend",function(t){return function(){return t.brush.empty()?t.trigger("click"):t.brushEndEvent()}}(this)),this.builder().mainGroup.append("svg:g").attr("id",""+this.id()).call(this.brush).selectAll("rect").attr("height",this.builder().height()).on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return t.insideBrushEvent(d3.event.currentTarget)?(i=d3.mouse(e),r=i[0],n=i[1],t.trigger("mousemove",r,n)):void 0}}(this))).on("mouseout",this.createHandler(function(t){return function(e){return t.trigger("mouseout",e)}}(this))),this},i.prototype.rebuildBrush=function(){return this.brush.x(this.xScale()),this.builder().mainGroup.selectAll("#brush").call(this.brush)},i.prototype.setExtent=function(t){return this.brush?(this.brush.extent(t),this.rebuildBrush()):void 0},i.prototype.getExtent=function(){return this.brush&&!this.brush.empty()?this.brush.extent():void 0},i.prototype.clearExtent=function(){return this.brush?(this.brush.clear(),this.rebuildBrush()):void 0},i.prototype.brushEvent=function(){var t;return this.brush.empty()?this.trigger("empty"):(t=this.brush.extent(),t[0]===t[1]?this.trigger("empty"):this.trigger("change",t))},i.prototype.brushEndEvent=function(){return this.brush.empty()?void 0:this.trigger("stop",this.brush.extent())},i.prototype.insideBrushEvent=function(t){var e;return e=jQuery(t),e.closest(".background").length>0||e.closest(".extent").length>0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Marker=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.id("marker"+Math.floor(1e3*Math.random())),this.clipPathId("clip"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={builder:null,id:"",clipPathId:"",xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),style:"marker",radius:50,textGenerator:function(){},xClipOffset:0,data:[],finishWidth:100,yFlagOffset:0},i.prototype.deltas=function(){var t,e;return t=[],e=null,this.data().forEach(function(i,r){return i.isHalfMarathon||i.isFinish?void 0:(0!==r&&t.push({time:i.time-e.time,distance:e.x+(i.x-e.x)/2,startDistance:e.x,endDistance:i.x}),e=i)}),t},i.prototype.render=function(){var t,e,i,r,n,a,s,o,l,c,h,u,p,d,f;for(t=this.builder(),f=t.topGroupDimensions(),i=function(){var t,i,r,n;for(r=this.data(),n=[],t=0,i=r.length;i>t;t++)e=r[t],e.isFinish||n.push(e);return n}.call(this),t.topGroup.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:0,height:t.height()+f.height,width:t.width()-this.xClipOffset()}),s=t.topGroup.append("svg:g").attr({id:this.id(),"clip-path":"url(#"+this.clipPathId()+")",opacity:0}),s.selectAll("line.vertical").data(i).enter().append("line").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this),y2:2*this.radius(),y1:t.height()+f.height,"class":"vertical "+this.style()}),n=this.style()+"-distance",d=this.style()+"-time",p=this.style()+"-small-time",u=this.style()+"-small-time-container",r=this.deltas(),s.selectAll("g.timeLine").data(r).enter().append("svg:g").attr("class","timeLine"),s.selectAll("g.timeLine").append("line").attr({x1:function(t){return function(e){return t.xScale()(e.startDistance)
}}(this),x2:function(t){return function(e){return t.xScale()(e.endDistance)}}(this),y1:this.radius(),y2:this.radius(),"class":"time "+this.style()}),s.selectAll("g.timeLine").append("rect").attr({x:function(t){return function(e){return t.xScale()(e.distance)-19}}(this),y:this.radius()-7,width:38,height:14,"class":u}),s.selectAll("g.timeLine").append("text").attr({x:function(t){return function(e){return t.xScale()(e.distance)}}(this),y:function(t){return function(){return t.radius()+5}}(this),"class":p}).text(this.createHandler(function(){return function(t,e){return(new Strava.I18n.TimespanFormatter).display(e.time)}}(this))),s.selectAll("g.circle").data(i).enter().append("svg:g").attr("class","circle"),s.selectAll("g.circle").append("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this),cy:function(t){return function(e){return e.isHalfMarathon?3*t.radius():t.radius()}}(this),r:this.radius(),"class":this.style()}),s.selectAll("g.circle").append("text").attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),y:function(t){return function(e){return e.isHalfMarathon?3*t.radius()+13:t.radius()+13}}(this),"class":n}).text(this.createHandler(function(t){return function(e,i){var r;return r=t.textGenerator()(i),r.distance}}(this))),s.selectAll("g.circle").append("text").attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),y:function(t){return function(e){return e.isHalfMarathon?3*t.radius():t.radius()}}(this),"class":d}).text(this.createHandler(function(t){return function(e,i){var r;return r=t.textGenerator()(i),r.time}}(this))),h=this.data(),l=0,c=h.length;c>l;l++)e=h[l],e.isFinish&&(a=e);return t.topGroup.selectAll("g.finish").data([a]).enter().append("svg:g").attr({"class":"finish","clip-path":"url(#"+this.clipPathId()+")"}),o=t.topGroup.selectAll("g.finish"),this.yFlagOffset(2*this.radius()),o.append("line").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this),y2:this.yFlagOffset(),y1:t.height()+f.height,"class":"vertical "+this.style()+"-finish-pole"}),o.append("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this),cy:this.yFlagOffset(),r:4,"class":this.style()+"-finish-top"}),o.append("polygon").attr({points:function(t){return function(e){var i;return i=t.xScale()(e.x),t.getFlagPoints(i)}}(this),"class":this.style()+"-finish-flag"}),o.append("text").attr({x:function(t){return function(e){return t.xScale()(e.x)+50-t.finishWidth()}}(this),y:3*this.radius()+5,"class":this.style()+"-finish-time"}).text(this.createHandler(function(){return function(t,e){return(new Strava.I18n.TimespanFormatter).display(e.time)}}(this))),this},i.prototype.show=function(t){var e,i;return i="g#"+this.id(),e=t?t.select(i):this.builder().topGroup.select(i),e.attr("opacity",1)},i.prototype.update=function(){var t,e,i,r,n,a;return t=this.style()+"-distance",a=this.style()+"-time",n=this.style()+"-small-time",r=this.style()+"-small-time-container",i=this.builder().topGroup.select("g#"+this.id()),i.selectAll("line.vertical").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("text."+a).attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("rect."+r).attr({x:function(t){return function(e){return t.xScale()(e.distance)-19}}(this)}),i.selectAll("text."+t).attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("text."+n).attr({x:function(t){return function(e){return t.xScale()(e.distance)}}(this)}),i.selectAll("line.time").attr({x1:function(t){return function(e){return t.xScale()(e.startDistance)}}(this),x2:function(t){return function(e){return t.xScale()(e.endDistance)}}(this)}),e=this.builder().topGroup.select("g.finish"),e.selectAll("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this)}),e.selectAll("line").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this)}),e.selectAll("text").attr({x:function(t){return function(e){return t.xScale()(e.x)+50-t.finishWidth()}}(this)}),e.selectAll("polygon").attr({points:function(t){return function(e){var i;return i=t.xScale()(e.x),t.getFlagPoints(i)}}(this),"class":this.style()+"-finish-flag"})},i.prototype.getFlagPoints=function(t){var e;return e=[],e.push(t+","+(this.yFlagOffset()+10)),e.push(t-this.finishWidth()+","+(this.yFlagOffset()+10)),e.push(t-this.finishWidth()+10+","+(this.yFlagOffset()+26)),e.push(t-this.finishWidth()+","+(this.yFlagOffset()+43)),e.push(t+","+(this.yFlagOffset()+43)),e.join(" ")},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Builder=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.context=t,this.mainId("main-container-"+Math.floor(1e3*Math.random())),this.topId("top-container-"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={selector:".base-chart",width:868,height:250,padding:{top:0,bottom:20,right:40,left:60},topArea:{height:110,width:868},topAreaHidden:!0,gridClass:Strava.D3.Charts.Grid,lineClass:Strava.D3.Charts.Line,plotGraphClass:Strava.D3.Charts.PlotGraph,crossBarClass:Strava.D3.Charts.CrossBar,infoBoxClass:Strava.D3.Charts.InfoBox,pointInfoBoxClass:Strava.D3.Charts.PointInfoBox,scrollBarClass:Strava.D3.Charts.ScrollBar,filterClass:Strava.D3.Charts.Filter,barCalloutClass:Strava.D3.Charts.BarCallout,barClass:Strava.D3.Charts.BarChart,barChartKeyClass:Strava.D3.Charts.BarChartKey,areaClass:Strava.D3.Charts.AreaLine,partialAreaClass:Strava.D3.Charts.PartialAreaLine,axisClass:Strava.D3.Charts.Axis,draggableRectClass:Strava.D3.Charts.DraggableRect,brushClass:Strava.D3.Charts.Brush,axis:null,grid:null,eventDispatcher:null,graphs:{},splitCrossBars:{},mainId:null,topId:null,yAxisOrientation:"left",yAxisTicks:5,xAxisTicks:10,animate:null,yAxisSnap:20,controls:{},responsive:!1},i.prototype.build=function(t){var e,i,r,n,a;return this.axis()||this.axis(new this._axisClass(this)),this.grid(new this._gridClass(this)),e=this.$(this.selector(),t)[0],n=this.topGroupDimensions(),a=this.width()+(this.padding().right+this.padding().left),i=this.height()+n.height+(this.padding().top+this.padding().bottom),this.root=d3.select(e).append("svg"),this.root.attr(this.responsive()?{width:"100%",height:i,viewBox:"0 0 "+a+" "+i,preserveAspectRatio:"xMinYMinmeet"}:{width:a,height:i}),this.topAreaHidden()||(this.topGroup=this.root.append("svg:g").attr({id:this.topId(),transform:"translate("+this.padding().left+", "+this.padding().top+")","class":"topGroup"})),r=this.padding().top+n.height,this.mainGroup=this.root.append("svg:g").attr("class","chartGroup").attr("id",this.mainId()).attr("transform","translate("+this.padding().left+", "+r+")"),this},i.prototype.topGroupDimensions=function(){return this.topAreaHidden()?{height:10,width:0}:this.topArea()},i.prototype.buildAxis=function(){return this.axis().create(),this},i.prototype.buildGrid=function(t){return null==t&&(t=function(){}),t(this.grid()),this.grid().create(),this},i.prototype.buildLine=function(t,e,i,r,n,a){var s;return null==r&&(r="generic-line"),null==n&&(n="basis-open"),null==a&&(a=function(){}),s=new this._lineClass,s.builder(this).data(t).id(r).xScale(e).yScale(i).interpolator(n),a(s),s.create(),this.graphs()[r]=s,this},i.prototype.setEventDispatcher=function(t){return this.eventDispatcher(t),this.grid().bind("mousemove",function(t){return function(e,i){return t.handleGridMouseMove(e,i)}}(this)).bind("gridclick",function(t){return function(e,i){return t.handleGridClick(e,i)}}(this)).bind("gridout",function(t){return function(e,i){return t.handleGridOut(e,i)}}(this)),t.addListener(this,this),this},i.prototype.buildPaceBarCallout=function(t,e,i,r,n,a){return null==a&&(a=function(){}),this.paceBarCallout=new this._barCalloutClass(r,n),this.paceBarCallout.builder(this).xScale(t).yScale(e).create(),a(this.paceBarCallout),this.grid().bind("mousemove",function(t){return function(e,i){return t.paceBarCallout.updateFromGridEvent(e,i)}}(this)).bind("gridout",function(t){return function(){return t.paceBarCallout.hide()}}(this)),this.graphs().paceAnalysisBars.bind("barEnter",function(t){return function(e){return t.paceBarCallout.updateFromBarEvent(e)}}(this)).bind("barOut",function(t){return function(){return t.paceBarCallout.hide()}}(this)),this.graphs()[i]=this.paceBarCallout,this},i.prototype.buildCrossBar=function(t,e){return null==e&&(e=function(){}),this.crossBar=new this._crossBarClass(t),this.crossBar.builder(this).create(),e(this.crossBar),this.grid().bind("mousemove",function(t){return function(e,i){return t.crossBar.update(e,i)}}(this)).bind("gridclick",function(t){return function(){return t.crossBar.toggleFixedState()}}(this)).bind("gridout",function(t){return function(){return t.crossBar.hide()}}(this)),this.axis().selectedClass("selected").bind("axisClick",function(t){return function(e){return t.crossBar.forceFixedState(e)}}(this)),this},i.prototype.buildSplitCrossBar=function(t,e,i){var r;return null==i&&(i=function(){}),r=new this._crossBarClass(e).crossBarStyle("split-crossbar").groupName(t),r.builder(this).create(),i(r),this.splitCrossBars()[t]=r,this},i.prototype.buildInfoBox=function(t,e){return null==e&&(e=function(){}),this.infoBox=new this._infoBoxClass(t),this.infoBox.builder(this),e(this.infoBox),this.infoBox.create(),this.grid().bind("mousemove",function(t){return function(e,i){return t.infoBox.update(e,i)}}(this)).bind("gridclick",function(t){return function(){return t.infoBox.toggleFixedState()}}(this)).bind("gridout",function(t){return function(){return t.infoBox.hide()}}(this)),this.axis().selectedClass("selected").bind("axisClick",function(t){return function(e){return t.infoBox.forceFixedState(e)}}(this)),this},i.prototype.buildPointInfoBox=function(t,e,i){return null==i&&(i=function(){}),this.pointInfoBox=new this._pointInfoBoxClass(t,e),this.pointInfoBox.builder(this),i(this.pointInfoBox),this.pointInfoBox.create(),this.grid().bind("mousemove",function(t){return function(e,i){return t.pointInfoBox.move(e,i)}}(this)).bind("gridout",function(t){return function(){return t.pointInfoBox.hide()}}(this)),this},i.prototype.buildScrollBar=function(t,e){return null==e&&(e=function(){}),this.scrollBar=new this._scrollBarClass(this.context,this),e(this.scrollBar),this.scrollBar.create(),this.controls()[t]=this.scrollBar,this},i.prototype.buildBarChart=function(t,e,i,r,n,a){var s;return null==a&&(a=function(){}),s=(new this._barClass).width(r),s.builder(this).xScale(e).yScale(i).data(t).id(n).bind("barOut",function(t){return function(e){return t.grid().checkGridOut(e)}}(this)),this.grid().bind("gridout",function(){return function(){return s.unHighlightSplits()}}(this)),a(s),s.create(),this.graphs()[n]=s,this},i.prototype.buildBarChartAxis=function(t,e,i,r,n){return null==n&&(n=function(){}),this.axis(new this._axisClass(this)),n(this.axis()),this.axis().createForBarChart(t,e,i,r),this},i.prototype.buildBarChartKey=function(t,e,i,r,n,a,s){var o;return null==s&&(s=function(){}),o=(new this._barChartKeyClass).xTranslation(r).keyWidth(e).builder(this).data(t).xScale(n).yScale(i).id(a),s(o),o.create(),this.graphs()[a]=o,this},i.prototype.buildIntegratedAxis=function(t,e,i,r,n,a){return null==n&&(n={}),null==a&&(a=function(){}),this.axis(new this._axisClass(this)),a(this.axis()),this.axis().createForIntegratedChart(t,e,i,r,n),this},i.prototype.buildDraggableRect=function(t,e){return this.dragRect=new this._draggableRectClass,this.dragRect.builder(this).xScale(e).data(t).create(),this},i.prototype.buildBrush=function(t){return this.brush=new this._brushClass,this.brush.builder(this).xScale(t).create()},i.prototype.buildAreaLine=function(t,e,i,r,n){var a;return null==n&&(n=function(){}),a=new this._areaClass,a.builder(this).xScale(e).yScale(i).data(t),n(a),a.create(),this.graphs()[r]=a,this},i.prototype.buildStyledAreaLine=function(t,e,i,r,n,a,s){var o;return null==s&&(s=function(){}),o=new this._areaClass,o.builder(this).xScale(e).yScale(i).data(t).style(n).groupId(a),s(o),o.create(),this.graphs()[r]=o,this},i.prototype.updateStyledAreaLine=function(t,e,i){var r;return null==i&&(i=function(){}),r=this.graphs()[t],r.data(e),r.update(!1),this},i.prototype.buildPlotGraph=function(t,e,i,r,n){var a;return null==n&&(n=function(){}),a=new this._plotGraphClass,a.builder(this).xScale(e).yScale(i).data(t),n(a),a.create(),this.graphs()[r]=a,this},i.prototype.buildMarkers=function(t,e,i,r,n){var a;return null==n&&(n=function(){}),a=new Strava.D3.Charts.Marker,a.builder(this).xScale(e).yScale(i).data(t),n(a),a.render(),this.graphs()[r]=a,this},i.prototype.buildPartialAreaLine=function(t,e,i,r,n,a,s){var o;return null==s&&(s=function(){}),o=new this._partialAreaClass,o.builder(this).xScale(e).yScale(i).data(t).startIndex(n).endIndex(a),s(o),o.create(),this.graphs()[r]=o,this},i.prototype.buildFilter=function(t,e,i,r){var n;return n=new this._filterClass(this,i),n[e](t,r),this},i.prototype.zoomWithPadding=function(t,e){var i,r,n,a,s;a=this.xAxisExtent(t,e),s=this.yAxisExtent(t,e),this.zoomAxis(a,s),n=this._graphs;for(r in n)i=n[r],"altitude"===r||"segment"===r?i.zoom(a,s):i.zoom(a);return this},i.prototype.xAxisExtent=function(t,e){var i,r;return r=this.context.getStream("distance"),i=.1*(r[e]-r[t]),[Math.max(r[0],r[t]-i),Math.min(r[r.length-1],r[e]+i)]},i.prototype.yAxisExtent=function(t,e){var i,r,n,a;return(a=this.context.getStream("altitude"))?(i=d3.extent(a.slice(t,e+1)),r=.1*(i[1]-i[0]),n=this.yAxisSnap()*this.context.getMeasurementUnits().shortConvert,[Math.floor((i[0]-r)/n)*n,Math.ceil((i[1]+r)/n)*n]):[0,1]},i.prototype.resetZoom=function(){var t,e,i,r;this.resetAxis(),i=this._graphs,r=[];for(e in i)t=i[e],r.push(t.resetZoom());return r},i.prototype.zoomAxis=function(t,e){return this.axis().zoom(t,e),this.grid().update()},i.prototype.resetAxis=function(){return this.axis().resetZoom(),this.grid().update()},i.prototype.updateAxis=function(){return this.axis().update(),this.grid().update(),this},i.prototype.updateRoot=function(){return this.root.attr({width:this.width()+(this.padding().right+this.padding().left),height:this.height()+this.topGroupDimensions().height+(this.padding().top+this.padding().bottom)}),this},i.prototype.iterateGraphs=function(t){var e,i,r,n;i=this.graphs(),r=[];for(n in i)e=i[n],r.push(t(n,e));return r},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.Bands=function(e){function r(t){r.__super__.constructor.call(this),this.builder=t,this.context=t.context,this.initializeAttributes(n)}var n;return t(r,e),n={bands:{},order:[],baseStream:"distance",invertedStreams:["pace","grade_adjusted_pace"]},r.prototype.addLines=function(t,e){var i,r,n,a;for(i=function(t){return function(i){var r,n,a;return r=t.context.data(t.baseStream(),i),n=t.context.getStream(i),a=d3.scale.linear().domain(d3.extent(n)).range(t.getInsertionRange()).nice(),t.builder.buildLine(r,e,a,i),t.bands()[i]=t.builder.graphs()[i],t.order().unshift(i)}}(this),r=0,n=t.length;n>r;r++)a=t[r],i(a);return this.updateBands(!1)},r.prototype.addLine=function(t,e){return this.addLines([t],e)},r.prototype.updateBands=function(t){var e,i,r,n,a,s,o;for(null==t&&(t=!0),o=0,n=this._order,a=[],i=0,r=n.length;r>i;i++)s=n[i],e=this.bands()[s],e.yScale().range(this.getRange(o,this.count(),s)),o++,a.push(e.update(t));return a},r.prototype.getRange=function(t,e,r){var n,a,s,o;return 1===e?a=[this.builder.height(),0]:(s=this.getHeight(e),o=this.builder.height()-s*t,n=5,a=[o-n,o-s+n]),i.call(this.invertedStreams(),r)>=0&&a.reverse(),a},r.prototype.getHeight=function(t){return this.builder.height()/t},r.prototype.getInsertionRange=function(){return[this.builder.height(),this.builder.height()-1]},r.prototype.addLinesToBands=function(t){var e,i,r,n;for(e=function(t){return function(e){return t.bands()[e.streamType]=e.line,t.order().indexOf(e.streamType)<0?t.order().unshift(e.streamType):void 0}}(this),i=0,n=t.length;n>i;i++)r=t[i],e(r);return this.updateBands(!1)},r.prototype.addToBands=function(t,e){return this.bands()[t]=e,this.order().indexOf(t)<0&&(e.yScale().range(this.getInsertionRange()),e.updateWithoutDelay(),this.order().unshift(t)),this.updateBands()},r.prototype.removeBand=function(t){var e;return e=this.order().indexOf(t),e>=0?(delete this.bands()[t],this.order().splice(e,1),this.updateBands()):void 0},r.prototype.count=function(){return Object.keys(this.bands()).length},r.prototype.streamTypes=function(){return Object.keys(this.bands())},r.prototype.get=function(t){return this.bands()[t]},r}(Strava.Base)}.call(this),function(){Strava.module("Strava.Charts"),Strava.Charts.ChartHelper=function(){function t(){}return t.colorGradient=function(t,e,i,r){var n,a,s,o;return null==r&&(r=[.1,.7]),7===t.length&&(t=t.substr(0,7)),o=parseInt(t.substr(0,2),16),a=parseInt(t.substr(2,2),16),n=parseInt(t.substr(4,2),16),s=e/(i-1),.5>=s?(s=(s-.5)*(1-2*r[0])+.5,s=1-2*s,o=Math.round((255-o)*s+o),a=Math.round((255-a)*s+a),n=Math.round((255-n)*s+n)):(s=(s-.5)*(1-2*(1-r[1]))+.5,s=2*(1-s),o=Math.round(o*s),a=Math.round(a*s),n=Math.round(n*s)),"rgb("+o+", "+a+", "+n+")"},t.formatTimeSummary=function(t){return 0>=t?"0":60>t?t+" sec":t%3600===0?t/3600+" hr":Math.round(t/6,1)/10+" min"},t.cpId2Time=function(t){return t=Math.round(t),300>t?t+1:600>t?305+5*(t-300):900>t?1830+30*(t-600):1200>t?11100+300*(t-900):void 0},t.cpTime2Id=function(t){return t=Math.floor(t.toFixed(5)),0>=t?0:300>t?t-1:1800>t?299+Math.floor((t-300)/5):10800>t?599+Math.floor((t-1800)/30):899+Math.floor((t-10800)/300)},t.findClosestXFromVal=function(t,e,i){var r,n,a;for(a=0,n=t.length-1;n-a>1;)r=Math.round((a+n)/2),t[r][i]>e?n=r:a=r;return n!==a&&e-t[a][i]<t[n][i]-e?a:n},t.getAccuracy=function(t){switch(t){case"altitude":case"watts":case"watts_calc":case"temp":case"cadence":case"heartrate":return 0;case"grade_smooth":case"velocity":case"velocity_smooth":return 1;default:return 2}},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=[].slice;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.Activity=function(e){function r(t,e){r.__super__.constructor.call(this),this.context=t,this.builder=new Strava.D3.Charts.Builder(t),this.bands=new Strava.Charts.Activities.Bands(this.builder),this.bands.baseStream(t.xAxisType()),e.require(t.defaultInfoboxStreamTypes().concat("altitude"),{onReady:function(t){return function(){return t.handleStreamsReady()}}(this)}),t.bind("hideStreamType",function(t){return function(e){return t.bands.removeBand(e),t.builder.graphs()[e].hide(),null!=t.builder.infoBox&&t.builder.infoBox.updateText(),t.handleStreamBandsChange()}}(this)).bind("showStreamType",function(t){return function(e){return t.handleShowStreamType(e),null!=t.builder.infoBox&&t.builder.infoBox.updateText(),t.handleStreamBandsChange()}}(this))}return t(r,e),Strava.includeModule(r,Strava.Labs.Activities.listener_module),r.prototype.handleStreamBandsChange=function(){var t,e;return 1!==this.bands.count()?this.builder.root.select(".yaxis2").remove():(e=this.bands.streamTypes()[0],this.context.isPaceStream(e)?(t=this.bands.get(e).yScale(),this.builder.axis().createYAxis2(e,t)):void 0)},r.prototype.handleStreamsReady=function(){return this.hasAltitude=!this.context.trainer()&&this.context.getStream("altitude"),this.createScales(),this.hasAltitude&&this.createAltitudeGraph(),this.createSegment(0,0),this.builder.axis().setScaleDomain("x",this.xDomain).setScaleDomain("y",this.yDomain).setAxisTicks("y",this.builder.yAxisTicks()).setAxisTicks("x",this.builder.xAxisTicks()).setScaleNice("y"),this.hasAltitude?this.builder.axis().setAxisTicks("y",this.builder.yAxisTicks()):this.builder.axis().getAxis("y").tickFormat(function(){return""}),this.builder.updateAxis(),this.builder.buildCrossBar(function(t){return function(e){var i,r;return i=t.getIndex(t.xScale,e),r=t.context.streamValAt("time",i),(new Strava.I18n.TimespanFormatter).display(d3.round(r))}}(this)),this.builder.buildInfoBox(function(t){return function(e){var i,r,n,a,s,o;for(i={},r=t.getIndex(t.xScale,e),o=t.context.getInfoboxStreamTypes(),n=0,a=o.length;a>n;n++)s=o[n],i[s]=t.createInfoRow(s,r);return i}}(this)),this.setEventDispatcher()},r.prototype.handleShowStreamType=function(t){var e;return e=this.builder.graphs()[t],e?(this.bands.addToBands(t,e),e.show()):(this.createLineData(t),null!=this.builder.infoBox?this.builder.infoBox.updateText():void 0)},r.prototype.createLineData=function(t){return null==this.xScale&&this.createScales(),this.bands.addLine(t,this.xScale)},r.prototype.createAltitudeGraph=function(){var t,e;return t=this.context.data(this.context.xAxisType(),"altitude"),e=this.builder.graphs().altitude,e?(e.data(t).xScale(this.xScale).update(!0),e.show()):this.builder.buildAreaLine(t,this.xScale,this.yScale,"altitude")},r.prototype.createScales=function(){var t,e,i;return t=this.context.getStream(this.context.xAxisType()),this.xDomain=d3.extent(t),this.hasAltitude?(i=this.context.getStream("altitude"),e=d3.extent(i),this.yDomain=this.context.getAdjustedYDomain(e)):this.yDomain=[0,1],this.xScale=d3.scale.linear().domain(this.xDomain).range([0,this.builder.width()]),this.yScale=d3.scale.linear().domain(this.yDomain).range([this.builder.height(),0]).nice()},r.prototype.createInfoRow=function(t,e){var i;return i=this.context.formatter(t),{val:i.formatShort(this.context.streamValAt(t,e)),title:this.context.getStreamLabel(t)}},r.prototype.showSegment=function(t,e){var i;return i=this.builder.graphs().segment,i?i.startIndex(t).endIndex(e).update():void 0},r.prototype.hideSegment=function(){var t;return t=this.builder.graphs().segment,t?t.hide():void 0},r.prototype.createSegment=function(t,e){var i,r,n,a,s,o,l,c;if(this.hasAltitude)return r=this.context.xAxisType(),c=this.context.getStream("altitude"),s=this.context.getStream(r),o=d3.extent(c),o=this.context.getAdjustedYDomain(o),n=[0,s[s.length-1]],a=d3.scale.linear().domain(n).range([0,this.builder.width()]),l=d3.scale.linear().domain(o).range([this.builder.height(),0]).nice(),i=this.context.data(r,"altitude"),this.builder.buildPartialAreaLine(i,a,l,"segment",t,e)},r.prototype.render=function(t){return this.builder.build(t).buildGrid().buildAxis()},r.prototype.getDistanceIndex=function(t,e){var i;return i=t.invert(e),this.context.findIndex("distance",i)},r.prototype.getDistanceIndices=function(){var t,e,r,n,a;for(t=1<=arguments.length?i.call(arguments,0):[],a=[],r=0,n=t.length;n>r;r++)e=t[r],a.push(this.getDistanceIndex(this.xScale,e));return a},r.prototype.getTimeIndex=function(t,e){var i;return i=t.invert(e),this.context.findIndex("time",i)},r.prototype.getIndex=function(t,e){return this.context.findIndex(this.context.xAxisType(),t.invert(e))},r.prototype.setEventDispatcher=function(){return this.builder.grid().bind("mousemove",function(t){return function(e,i){return t.handleGridMouseMove(e,i)}}(this)).bind("gridclick",function(t){return function(e,i){return t.handleGridClick(e,i)}}(this)).bind("gridout",function(t){return function(e,i){return t.handleGridOut(e,i)}}(this)),this.context.eventDispatcher().addListener(this,this),this},r.prototype.handleGridMouseMove=function(t){return this.context.eventDispatcher().dispatchMouseOver(this,this.context.xAxisType(),this.getIndex(this.xScale,t))},r.prototype.handleGridClick=function(t){return this.context.eventDispatcher().dispatchClick(this,this.context.xAxisType(),this.getIndex(this.xScale,t))},r.prototype.handleGridOut=function(){return this.context.eventDispatcher().dispatchMouseOut(this,this.context.xAxisType())},r.prototype.handleStreamSelect=function(t,e,i){return this.showSegment(e,i)},r.prototype.handleStreamUnselect=function(t,e,i){return this.hideSegment(e,i)},r.prototype.handleInitiateZoom=function(){return this.hideSegment()},r.prototype.handleStreamHover=function(t,e,i){var r;return r=this.builder.graphs().segment,r?r.startIndex(e).endIndex(i).update():void 0},r.prototype.handleStreamHoverOut=function(){var t;return t=this.builder.graphs().segment,t?t.hide():void 0},r}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/overview_toggles"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<tr>\n  <td></td>\n  <td data-type='pace'>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.pace")))+"</div>\n    <div class='"+["toggle-button",""+e(t(this.hasDistance?"":"disabled"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <div class='btn'>\n        <div class='light pace'></div>\n      </div>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.toggle_on")))+"</div>\n    </div>\n  </td>"),this.supportsGap&&(i.push("  <td data-type='grade_adjusted_pace'>\n    <div class='label'>\n      <abbr class='glossary-link run-version' data-glossary-term='definition-gap' title='"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.grade_adjusted_pace")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.gap")))),i.push("      </abbr>\n    </div>\n    <div class='"+["toggle-button",""+e(t(this.hasGap?"":"disabled"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <div class='btn'>\n        <div class='grade_adjusted_pace light'></div>\n      </div>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.toggle_on")))+"</div>\n    </div>\n  </td>")),i.push("  <td data-type='heartrate'>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.heart_rate")))+"</div>\n    <div class='"+["toggle-button",""+e(t(this.hasHeartRate?"":"disabled"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <div class='btn'>\n        <div class='heartrate light'></div>\n      </div>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.toggle_on")))+"</div>\n    </div>\n  </td>"),this.hasCadence&&i.push("  <td data-type='cadence'>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.cadence")))+"</div>\n    <div class='toggle-button'>\n      <div class='btn'>\n        <div class='cadence light'></div>\n      </div>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.toggle_on")))+"</div>\n    </div>\n  </td>"),this.avgTemp&&i.push("  <td data-type='temp'>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.temperature")))+"</div>\n    <div class='toggle-button'>\n      <div class='btn'>\n        <div class='light temp'></div>\n      </div>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.overview_toggles.toggle_on")))+"</div>\n    </div>\n  </td>"),i.push("</tr>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.Labs.Activities.ToggleControlsView=function(e){function i(t){this.context=t,i.__super__.constructor.call(this),this.defaultStreamTypes=this.context.defaultToggleStreamTypes(),this.template="activities/overview_toggles"}return t(i,e),i.prototype.events={"click .toggle-button":"updateStreamView"},i.prototype.tagName="table",i.prototype.render=function(){var t,e,i,r,n,a,s;for(t={hasDistance:null!=this.context.streamsContext.get("distance"),hasAltitude:null!=this.context.streamsContext.get("altitude"),hasHeartRate:null!=this.context.streamsContext.get("heartrate"),hasGap:null!=this.context.streamsContext.get("grade_adjusted_pace"),hasCadence:null!=this.context.streamsContext.get("cadence"),supportsGap:this.context.activity().supportsGap(),avgTemp:this.context.activity().get("avg_temp")},this.renderTemplate(t),n=this.defaultStreamTypes,i=0,r=n.length;r>i;i++)a=n[i],e=this.$("td[data-type='"+a+"'] .toggle-button"),e.length&&!e.hasClass("disabled")&&(e.addClass("active"),this.context.showStream(a));return s=new Strava.Labs.Activities.OverviewStatsView(this.context),this.$el.append(s.render().$el.find("tr")),this},i.prototype.updateStreamView=function(t){var e,i;return e=this.$(t.currentTarget),e.hasClass("disabled")?void 0:(e.toggleClass("active"),i=e.closest("td").data("type"),e.hasClass("active")?this.context.showStream(i):this.context.hideStream(i))},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.StreamsChartView=function(e){function i(t,e,r){this.context=t,this.pageContext=e,this.streamsRequest=r,i.__super__.constructor.call(this),this.streamsRequest.require(["heartrate","cadence","temp"]),this.streamsRequest.onReady(function(t){return function(){return t.handleStreamsReady()}}(this))}return t(i,e),i.prototype.render=function(){return this.renderTemplate(),this.chart=new this.chartFactory(this.context,this.streamsRequest),"Run"===this.context.activityType()?(this.chart.builder.width(800),this.chart.builder.padding().right=100):this.chart.builder.height(100),this.chart.render(this.$el),this},i.prototype.handleStreamsReady=function(){return this.$$("div.streams-loader").remove(),"Run"===this.context.activityType()?this.handleRenderControls():void 0},i.prototype.handleRenderControls=function(){var t;return t=new Strava.Labs.Activities.ToggleControlsView(this.context),this.$("#chart-controls").append(t.render().el)},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/elevation_chart"]=function(t){return function(){var t;return t=[],t.push("<div class='base-chart' id='elevation-chart'></div>\n<div class='inline-inputs' id='chart-controls'></div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ElevationChartView=function(e){function i(t,e,r){this.chartFactory=Strava.Charts.Activities.Activity,this.template="activities/elevation_chart",e.bind("fullscreenchange",function(t){return function(e){return t.handleFullScreenChange(e)}}(this)),r.require(["altitude"]),i.__super__.constructor.call(this,t,e,r)}return t(i,e),i.prototype.handleFullScreenChange=function(t){return t?this.enterFullScreen():this.exitFullScreen()},i.prototype.enterFullScreen=function(){return this.$el.parent().css({left:Math.floor(screen.width/2-550)})},i.prototype.exitFullScreen=function(){return this.$el.parent().css({left:""})},i}(Strava.Labs.Activities.StreamsChartView)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/basic_analysis/selection_details"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<strong>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.basic_analysis.selection")))),i.push("</strong>\n&nbsp; &nbsp;"),i.push(""+e(t(this.distance))),i.push("&nbsp; &nbsp;"),this.elevation&&this.elevation.value&&(i.push(""+e(t(this.elevation.value))),this.elevation.grade&&(i.push("&nbsp; &nbsp;"),i.push(""+e(t(this.elevation.grade)))),i.push("&nbsp; &nbsp;")),i.push(""+e(t(this.time))),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t
}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.BasicAnalysisElevation=function(e){function i(t,e){this.context=t,i.__super__.constructor.call(this),this.detailsTemplate="activities/basic_analysis/selection_details",this.initializeAttributes(r),this.builder=new Strava.D3.Charts.Builder(this.context),this.context.eventDispatcher().addListener(this,this),this.deferred=new jQuery.Deferred,e.onReady(function(t){return function(){return t.handleStreamsReady()}}(this))}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.listener_module),i.prototype.STREAM_TYPES=["distance","time","altitude","grade_smooth"],r={width:868,height:100,sidebarWidth:120,stackHeight:25,padding:{left:150,bottom:20},xAxisType:"distance",lastXAxisType:"distance",detailSelector:"#effort-detail"},i.prototype.render=function(t){return null!=t&&(this.container=t),this.builder.height(this.height()).width(this.width()).padding({top:0,bottom:this.padding().bottom,right:this.sidebarWidth(),left:this.padding().left}).build(this.container),this.labelGroup=this.builder.root.append("svg:g").attr({"class":"labelGroup",transform:"translate("+(this.builder.width()+this.padding().left)+", 10)"})},i.prototype.handleStreamsReady=function(){return this.hasAltitude=null!=this.context.getStream("altitude"),this.buildChart(),this.buildInfoBoxes(),this.builder.buildCrossBar(),this.builder.buildAxis(),this.builder.axis().unbindEvents(),this.deferred.resolve()},i.prototype.handleStreamsChange=function(){return this.buildChart(),this.lastXAxisType(this.xAxisType())},i.prototype.buildChart=function(){return this.createScales(),this.hasAltitude&&this.createAltitudeGraph(),this.createBrush(),this.builder.axis().setScaleDomain("x",this.xDomain).setScaleDomain("y",this.yDomain).setAxisTicks("y",this.builder.yAxisTicks()).setAxisTicks("x",this.builder.xAxisTicks()).setScaleNice("y").setScale("x",this.xScale),this.builder.updateAxis()},i.prototype.buildInfoBoxes=function(){var t,e,i,r,n,a,s;for(e=[],a=this.STREAM_TYPES,i=r=0,n=a.length;n>r;i=++r)s=a[i],e.push({streamType:s,topY:i*this.stackHeight()});return t=new Strava.Charts.Activities.ListenerBox(this.labelGroup).boxWidth(this.sidebarWidth()).boxHeight(this.stackHeight()).valueCallback({execute:function(t){return function(e,i){var r,n;return n=t.context.streamValAt(i,e),"time"===i?(new Strava.I18n.TimespanFormatter).display(n):n?(r=t.context.formatter(i),r.formatShort(n)):void 0}}(this)}).defaultValueCallback({execute:function(){return function(){return"--"}}(this)}).builder(this.builder),t.build(e)},i.prototype.handleMouseMove=function(t,e){return this.builder.crossBar.update(t,e),this.context.eventDispatcher().dispatchMouseOver(this,this.xAxisType(),this.getIndex(this.xScale,t))},i.prototype.handleMouseOut=function(){return this.builder.crossBar.hide(),this.context.eventDispatcher().dispatchMouseOut(this,this.xAxisType())},i.prototype.handleChangeXAxisType=function(t){return this.xAxisType(t),this.handleStreamsChange()},i.prototype.handleStreamMouseOver=function(t,e){var i;return i=this.context.streamValAt(t,e),this.builder.crossBar.update(this.xScale(i))},i.prototype.handleStreamMouseOut=function(){return this.builder.crossBar.hide()},i.prototype.handleZoomSelect=function(t,e,i,r){return null==r?(this.setSelection([e,i]),this.$$(this.detailSelector()).html(this.displayDetails(e,i))):void 0},i.prototype.getIndex=function(t,e){return this.context.findIndex(this.xAxisType(),t.invert(e))},i.prototype.createScales=function(){var t,e;return t=this.context.getStream(this.xAxisType()),e=this.hasAltitude?d3.extent(this.context.getStream("altitude")):[0,0],this.xDomain=d3.extent(t),this.yDomain=this.context.getAdjustedYDomain(e),this.xScale=d3.scale.linear().domain(this.xDomain).range([0,this.builder.width()]),this.yScale=d3.scale.linear().domain(this.yDomain).range([this.builder.height(),0]),this.builder.axis().xAxis.tickFormat(function(t){return function(e){return t.context.getTickFormat(t.xAxisType(),e)}}(this))},i.prototype.createAltitudeGraph=function(){var t,e;return t=this.context.data(this.xAxisType(),"altitude"),e=this.builder.graphs().altitude,e?(e.data(t).xScale(this.xScale).update(!1),e.show()):this.builder.buildAreaLine(t,this.xScale,this.yScale,"altitude")},i.prototype.createBrush=function(){var t;return t=this.getSelection(),this.brush?this.brush.xScale(this.xScale).rebuildBrush():(this.brush=this.builder.buildBrush(this.xScale,this.yScale),this.brush.on("change empty",function(t){return function(e){var i,r;return null!=e?(r=t.context.findIndex(t.xAxisType(),e[0]),i=t.context.findIndex(t.xAxisType(),e[1]),r===i&&(0!==r?r-=1:i+=1),t.context.eventDispatcher().dispatchUnconditionalHover(t,t.xAxisType(),r,i),t.$$(t.detailSelector()).html(t.displayDetails(r,i))):(t.context.eventDispatcher().dispatchZoomUnselect(t,t.xAxisType()),t.$$(t.detailSelector()).html("")),t.trigger("brushChange",e)}}(this)).on("stop",function(t){return function(e){var i,r;return null!=e?(r=t.context.findIndex(t.xAxisType(),e[0]),i=t.context.findIndex(t.xAxisType(),e[1]),r===i&&(0!==r?r-=1:i+=1),t.context.eventDispatcher().dispatchSelect(t,t.xAxisType(),r,i)):void 0}}(this)).on("mousemove",function(t){return function(e,i){return t.handleMouseMove(e,i)}}(this)).on("mouseout",function(t){return function(){return t.handleMouseOut()}}(this))),t?this.setSelection(t):void 0},i.prototype.setSelection=function(t){var e;return e=this.context.getStream(this.xAxisType()),this.brush.setExtent([e[t[0]],e[t[1]]])},i.prototype.getSelection=function(){var t,e;return this.brush&&(t=this.brush.getExtent())?(e=this.context.getStream(this.lastXAxisType()),[d3.bisectLeft(e,t[0]),d3.bisectRight(e,t[1])]):void 0},i.prototype.clearSelection=function(){return this.brush.clearExtent(),this.$$(this.detailSelector()).html("")},i.prototype.displayDetails=function(t,e){var i,r,n,a,s,o,l;return n={},s=this.context.getStream("distance"),o=s[e]-s[t],n.distance=this.context.formatValue(o,"distance"),this.hasAltitude&&(i=this.context.getStream("altitude"),r=i[e]-i[t],n.elevation={value:this.context.formatValue(r,"altitude"),grade:this.getGrade(r,o)}),l=this.context.getStream("time"),a=l[e]-l[t],n.time=(new Strava.I18n.TimespanFormatter).display(a),JST[this.detailsTemplate](n)},i.prototype.getGrade=function(t,e){var i,r;return i=t/this.context.getMeasurementUnits().shortConvert,r=e/this.context.getMeasurementUnits().longConvert,(new Strava.I18n.PercentFormatter).formatShort(100*i/r)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.LabelBox=function(e){function i(t){this.container=t,i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.listener_module),r={builder:null,boxWidth:40,boxHeight:69,minorTextHeight:10,minorTextPadding:5,maxCallback:{execute:function(){}},avgCallback:{execute:function(){}}},i.prototype.build=function(t){return this.groups=this.container.selectAll("g.label-box").data(t).enter().append("svg:g").attr({"class":"label-box",transform:function(t){return"translate(0, "+(t.topY+1)+")"}}),this.groups.append("rect").attr({"class":"static-label-box",x:0,y:0,width:this.boxWidth(),height:this.boxHeight()-1}),this.groups.append("text").attr({"class":"static-label-box label",x:this.boxWidth()/2,y:0,dy:"2em"}).text(function(t){return t.label}),this.groups.append("text").attr({"class":"static-label-box detail max-js",x:this.boxWidth()/2,y:0,dy:"4em"}).text("--"),this.groups.append("text").attr({"class":"static-label-box detail avg-js",x:this.boxWidth()/2,y:0,dy:"5.5em"}).text("--"),this.groups.append("text").attr({"class":"static-label-box top",x:this.boxWidth()+this.minorTextPadding(),y:this.minorTextHeight()+this.minorTextPadding()}).text(function(t){return t.max}),this.groups.append("text").attr({"class":"static-label-box bottom",x:this.boxWidth()+this.minorTextPadding(),y:this.boxHeight()-this.minorTextPadding()}).text(function(t){return t.min}),this.handleStreamHover(),this.builder().context.eventDispatcher().addListener(this,this)},i.prototype.handleZoomSelect=function(t,e,i){return this.handleStreamHover(t,e,i)},i.prototype.handleZoomUnselect=function(){return this.handleStreamHover()},i.prototype.handleStreamHover=function(t,e,i){return this.groups.selectAll("text.static-label-box.max-js").text(function(t){return function(r){return Strava.I18n.Locale.t("strava.charts.activities.label_box.hover_max",{metric:t.maxCallback().execute(r.streamType,e,i)})}}(this)),this.groups.selectAll("text.static-label-box.avg-js").text(function(t){return function(r){return Strava.I18n.Locale.t("strava.charts.activities.label_box.hover_avg",{metric:t.avgCallback().execute(r.streamType,e,i)})}}(this))},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.ListenerBox=function(e){function i(t){this.container=t,i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.listener_module),r={builder:null,valueCallback:{execute:function(){}},defaultValueCallback:{execute:function(){}},boxWidth:70,boxHeight:70,title:null},i.prototype.build=function(t){return this.groups=this.container.selectAll("g.listener-box").data(t).enter().append("svg:g").attr({"class":"listener-box",transform:function(t){return"translate(0, "+(t.topY+1)+")"}}),this.groups.append("rect").attr({"class":"static-info-box",x:0,y:0,width:this.boxWidth(),height:this.boxHeight()-1}),this.groups.append("text").attr({"class":"static-info-box top",x:this.boxWidth()/2,y:this.boxHeight()/2-16}).text(this.title()),this.groups.append("text").attr({"class":"static-info-box bottom",x:this.boxWidth()/2,y:this.boxHeight()/2+20}).text(function(t){return t.label}),this.groups.append("text").attr({"class":"static-info-box value",x:this.boxWidth()/2,y:this.boxHeight()/2,dy:"0.3em"}).text(function(t){return function(e){return t.defaultValueCallback().execute(e.avg,e.streamType)}}(this)),this.builder().context.eventDispatcher().addListener(this,this)},i.prototype.update=function(t){return this.groups.selectAll("text.static-info-box.value").text(function(e){return function(i){return e.valueCallback().execute(t,i.streamType)}}(this)),this.groups.selectAll("text.static-info-box.top").text("")},i.prototype.showDefault=function(){return this.groups.selectAll("text.static-info-box.value").text(function(t){return function(e){return t.defaultValueCallback().execute(e.avg,e.streamType)}}(this)),this.groups.selectAll("text.static-info-box.top").text(this.title())},i.prototype.handleStreamMouseOver=function(t,e){return this.update(e)},i.prototype.handleStreamMouseOut=function(){return this.showDefault()},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.BasicAnalysisStacked=function(e){function i(t,e){this.context=t,i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder=new Strava.D3.Charts.Builder(this.context),this.deferred=new jQuery.Deferred,this.streamTypes=this.context.analysis().stackedStreamTypes,e.onReady(function(t){return function(){return t.handleStreamsReady()}}(this))}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.listener_module),r={width:758,stackHeight:70,sidebarWidth:90,minMaxWidth:30,defaultContainer:"#stacked-chart",yScales:{},xAxisType:"distance",xAxisHeight:30,xAxisTitle:Strava.I18n.Locale.t("strava.charts.activities.basic_analysis_stacked.distance"),timeButtonTitle:Strava.I18n.Locale.t("strava.charts.activities.basic_analysis_stacked.time")},i.prototype.render=function(t){return this.builder.height(this.stackHeight()*this.streamTypes.length).width(this.width()).padding({top:this.xAxisHeight(),bottom:1,right:this.sidebarWidth(),left:this.sidebarWidth()+this.minMaxWidth()}).topAreaHidden(!1).topArea({height:0,width:this.width()}).build(t).buildGrid(),this.labelGroup=this.builder.root.append("svg:g").attr({"class":"labelGroup",transform:"translate(0, "+this.xAxisHeight()+")"}),this.listenerGroup=this.builder.root.append("svg:g").attr({"class":"listenerGroup",transform:"translate("+(this.builder.width()+this.sidebarWidth()+this.minMaxWidth())+", "+this.xAxisHeight()+")"})},i.prototype.buildAxis=function(){var t,e,i,r,n,a,s,o;return this.xAxis=d3.svg.axis().scale(this.xScale).orient("top").tickFormat(function(t){return function(e){return t.context.getTickFormat(t.xAxisType(),e)}}(this)).tickSubdivide(4),this.xAxisContainer=this.builder.root.append("svg:g").attr("class","xaxis-container"),this.xAxisContainer.append("rect").attr({x:0,y:0,width:this.width()+2*this.sidebarWidth()+this.minMaxWidth(),height:this.xAxisHeight(),"class":"background"}),o=this.xAxisContainer.append("svg:g").attr({"class":"chart-controls",transform:"translate(10,3)"}),n=35,t=24,i={height:t,width:n},r={d:"M0 "+t+" L0 0 L"+n+" 0"},e={height:16,width:n,x:0,y:4},a=o.append("svg:g").attr({"class":"button","data-type":"distance",transform:"translate(0,0)"}),a.append("svg:title").text(this.xAxisTitle()),a.append("svg:rect").attr(i),a.append("path").attr(r),a.append("svg:image").attr(e).attr("xlink:href","/assets/svg/icon-distance.svg"),s=o.append("svg:g").attr({"class":"button","data-type":"time",transform:"translate("+(n+1)+",0)"}),s.append("svg:title").text(this.timeButtonTitle()),s.append("svg:rect").attr(i),s.append("path").attr(r),s.append("svg:image").attr(e).attr("xlink:href","/assets/svg/icon-time.svg"),o.select(".button[data-type='"+this.context.xAxisType()+"']").classed("selected",!0),this.xAxisContainer.append("svg:g").attr({"class":"axis xaxis",id:"xaxis",transform:"translate("+(this.sidebarWidth()+this.minMaxWidth())+", "+this.xAxisHeight()+")"}).call(this.xAxis),this.xAxisContainer.selectAll(".minor").attr("y2",-3)},i.prototype.setDomainScale=function(){var t;return t=this.context.getStream(this.xAxisType()),null!=this.zoomStart&&null!=this.zoomEnd&&(t=t.slice(this.zoomStart,this.zoomEnd)),this.xDomain=d3.extent(t),this.xDomain[0]===this.xDomain[1]&&(this.xDomain[1]+=.001),this.xScale=d3.scale.linear().domain(this.xDomain).range([0,this.width()])},i.prototype.handleStreamsReady=function(){var t,e,i,r,n,a,s;for(this.setDomainScale(),t=[],a=0,n=this.streamTypes,e=function(e){return function(i){var r,n,s,o,l,c,h,u,p;return h=e.context.getStream(i),null==h||"watts_calc"===i&&(e.context.trainer()||null!=e.context.getStream("watts"))?void 0:(u=a*e.stackHeight(),p=d3.scale.linear().domain(d3.extent(h)).range([u+e.stackHeight(),u]).nice(),e.yScales()[i]=p,s=e.context.data(e.xAxisType(),i),e.builder.buildLine(s,e.xScale,p,i,""),n=e.context.formatter(i),c=[d3.min(h),d3.max(h),d3.mean(h)],l=c[0],o=c[1],r=c[2],t.push({streamType:i,topY:u,avgY:e.yScales()[i](r),bottomY:u+e.stackHeight(),label:e.context.getStreamLabel(i),unit:e.context.getUnit(i),min:n.format(l),max:n.format(o),avg:"--"}),a++)}}(this),i=0,r=n.length;r>i;i++)s=n[i],e(s);return this.buildOrUpdateAvgLines(t),this.buildBottomLines(t),this.buildLabelBoxes(t),this.buildListenerBoxes(t),this.buildBrush(),this.builder.height(this.stackHeight()*a),this.builder.updateRoot(),this.builder.buildCrossBar(),this.buildAxis(),this.setEventDispatcher(),this.deferred.resolve()},i.prototype.buildBrush=function(){return this.brush=this.builder.buildBrush(this.xScale,this.yScale),this.brush.on("stop",function(t){return function(e){var i,r;return null!=e?(r=t.context.findIndex(t.xAxisType(),e[0]),i=t.context.findIndex(t.xAxisType(),e[1]),r===i&&(0!==r?r-=1:i+=1),t.brush.clearExtent(),t.context.eventDispatcher().dispatchZoomSelect(t,t.xAxisType(),r,i),t.handleZoomSelect(t.xAxisType(),r,i)):void 0}}(this)).on("mousemove",function(t){return function(e,i){return t.handleMouseMove(e,i)}}(this)).on("mouseout",function(t){return function(){return t.handleMouseOut()}}(this)).on("click",function(t){return function(){return t.handleZoomUnselect(),t.trigger("brushCleared"),t.context.eventDispatcher().dispatchZoomUnselect(t,t.xAxisType())}}(this))},i.prototype.buildOrUpdateAvgLines=function(t){var e;return e=this.builder.mainGroup.selectAll("line.avg-line").data(t).attr({y1:function(t){return t.avgY},y2:function(t){return t.avgY}}),e.enter().append("line").attr({"class":function(t){return"simple-line avg-line "+t.streamType},x1:0,y1:function(t){return t.avgY},x2:this.builder.width(),y2:function(t){return t.avgY}}),e.exit().remove()},i.prototype.buildBottomLines=function(t){return this.builder.mainGroup.selectAll("line.bottom-line.partial").data(t).enter().append("line").attr({"class":"bottom-line partial",x1:-30,y1:function(t){return t.bottomY},x2:this.builder.width(),y2:function(t){return t.bottomY}})},i.prototype.buildLabelBoxes=function(t){var e;return e=new Strava.Charts.Activities.LabelBox(this.labelGroup).boxWidth(this.sidebarWidth()).boxHeight(this.stackHeight()).builder(this.builder).maxCallback({execute:function(t){return function(e,i,r){var n,a;return a=t.context.streamsContext.data.getIntervalMax(e,i,r),null==a||isNaN(a)?void 0:(n=t.context.formatter(e),n.format(a))}}(this)}).avgCallback({execute:function(t){return function(e,i,r){var n,a;return a=t.context.streamsContext.data.getIntervalAverage(e,i,r),null==a||isNaN(a)?void 0:(n=t.context.formatter(e),n.format(a))}}(this)}),e.build(t)},i.prototype.buildListenerBoxes=function(t){var e,i,r,n;for(r=0,n=t.length;n>r;r++)i=t[r],i.label=i.unit;return e=new Strava.Charts.Activities.ListenerBox(this.listenerGroup).boxWidth(this.sidebarWidth()).boxHeight(this.stackHeight()).valueCallback({execute:function(t){return function(e,i){var r,n;return n=t.context.streamValAt(i,e),null==n||isNaN(n)?"--":(r=t.context.formatter(i),r.format(n))}}(this)}).defaultValueCallback({execute:function(){return function(){return"--"}}(this)}).builder(this.builder),e.build(t)},i.prototype.setEventDispatcher=function(){return this.builder.grid().bind("mousemove",function(t){return function(e,i){return t.handleGridMouseMove(e,i)}}(this)).bind("gridout",function(t){return function(){return t.handleGridOut()}}(this)).unbind("gridclick").bind("gridclick",function(t){return function(e,i){return t.handleGridClick(e,i)}}(this)),this.context.eventDispatcher().addListener(this,this),this},i.prototype.handleGridMouseMove=function(t){return this.context.eventDispatcher().dispatchMouseOver(this,this.xAxisType(),this.getIndex(this.xScale,t))},i.prototype.handleGridClick=function(t){return this.context.eventDispatcher().dispatchClick(this,this.xAxisType(),this.getIndex(this.xScale,t))},i.prototype.handleGridOut=function(){return this.context.eventDispatcher().dispatchMouseOut(this,this.xAxisType())},i.prototype.getIndex=function(t,e){return this.context.findIndex(this.xAxisType(),t.invert(e))},i.prototype.handleZoomSelect=function(t,e,i){return this.handleStreamHover(t,e,i)},i.prototype.handleStreamHover=function(t,e,i){return this.setZoom(e,i),this.setDomainScale(),this.zoomGraphs(),this.updateXAxis(),this.brush.xScale(this.xScale).rebuildBrush()},i.prototype.handleZoomUnselect=function(){return this.unsetZoom(),this.setDomainScale(),this.zoomGraphs(),this.updateXAxis(),this.brush.xScale(this.xScale).rebuildBrush()},i.prototype.zoomGraphs=function(){var t;return t=[],this.builder.iterateGraphs(function(e){return function(i,r){var n;return r.xScale(e.xScale).update(!1),n=e.zoomStart&&e.zoomEnd?e.context.streamsContext.data.getIntervalAverage(i,e.zoomStart,e.zoomEnd):d3.mean(e.context.getStream(i)),t.push({streamType:i,avgY:e.yScales()[i](n)})}}(this)),this.buildOrUpdateAvgLines(t)},i.prototype.setZoom=function(t,e){return this.zoomStart=t,this.zoomEnd=e},i.prototype.unsetZoom=function(){return this.zoomStart=null,this.zoomEnd=null},i.prototype.updateXAxis=function(){return this.brush.xScale(this.xScale).rebuildBrush(),this.xAxis.scale(this.xScale),this.builder.root.select("g.xaxis").call(this.xAxis),this.xAxisContainer.selectAll(".minor").attr("y2",-3)},i.prototype.handleChangeXAxisType=function(t){return this.xAxisType(t),this.setDomainScale(),this.builder.iterateGraphs(function(t){return function(e,i){return i.data(t.context.data(t.xAxisType(),e)).xScale(t.xScale).update(!1)}}(this)),this.updateXAxis()},i.prototype.handleStreamMouseOver=function(t,e){var i;return i=this.context.getStream(this.xAxisType())[e],this.builder.crossBar.update(this.xScale(i),0)},i.prototype.handleStreamMouseOut=function(){return this.builder.crossBar.hide()},i.prototype.handleMouseMove=function(t,e){return this.builder.crossBar.update(t,e),this.context.eventDispatcher().dispatchMouseOver(this,this.xAxisType(),this.getIndex(this.xScale,t))},i.prototype.handleMouseOut=function(){return this.builder.crossBar.hide(),this.context.eventDispatcher().dispatchMouseOut(this,this.xAxisType())},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.EffortInfoBox=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={},i.prototype.render=function(t){return this.box=d3.select(t).insert("div",":first-child").style("position","relative").append("div").style({position:"absolute",display:"none",height:"50px",top:"-50px","pointer-events":"none"}).attr("class","infobox"),this.box.append("div").attr("class","infobox-inner")},i.prototype.show=function(t,e,i){return this.box.style("display","block"),this.box.select(".infobox-inner").html(t),this.box.style("left",e+"px"),null!=i?this.box.style("top",i+"px"):void 0},i.prototype.hide=function(){return this.box.style("display","none")},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/basic_analysis/lap_details"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<strong>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.basic_analysis.lap_name",{index:this.get("index")})))),i.push("</strong>\n&nbsp; &nbsp;"),i.push(""+e(t((new Strava.I18n.DistanceFormatter).formatShort(this.get("distance"))))),i.push("&nbsp; &nbsp;"),this.elevationGainLoss()&&(i.push(""+e(t((new Strava.I18n.ElevationFormatter).formatShort(this.elevationGainLoss())))),this.grade()&&(i.push("&nbsp; &nbsp;"),i.push(""+e(t((new Strava.I18n.PercentFormatter).formatShort(this.grade()))))),i.push("&nbsp; &nbsp;")),i.push(""+e(t((new Strava.I18n.TimespanFormatter).display(this.get("elapsed_time"))))),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/basic_analysis/lap_infobox"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div>\n  <div class='title'>\n    <strong>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.basic_analysis.lap_name",{index:this.get("index")})))),i.push("    </strong>\n  </div>\n  <div class='details'>"),i.push("    "+e(t((new Strava.I18n.DistanceFormatter).formatShort(this.get("distance"))))),i.push("    &nbsp; &nbsp;"),this.elevationGainLoss()&&(i.push("    "+e(t((new Strava.I18n.ElevationFormatter).formatShort(this.elevationGainLoss())))),i.push("    &nbsp; &nbsp;")),i.push("    "+e(t((new Strava.I18n.TimespanFormatter).display(this.get("elapsed_time"))))),i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.BasicAnalysisLaps=function(e){function i(t,e,n){this.context=t,this.lapEffortsTableContext=e,i.__super__.constructor.call(this),this.detailsTemplate="activities/basic_analysis/lap_details",this.infoboxTemplate="activities/basic_analysis/lap_infobox",this.initializeAttributes(r),this.builder=new Strava.D3.Charts.Builder(this.context),this.builder.padding({top:2,bottom:5,right:this.paddingRight(),left:this.paddingLeft()}),this.builder.topAreaHidden(!1).topArea({height:0,width:0}),this.infobox=new Strava.Charts.Activities.EffortInfoBox,this.context.eventDispatcher().addListener(this,this),jQuery.when(n.deferred,this.lapEffortsTableContext.deferred).then(function(t){return function(){return t.handleReady()}}(this))}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.listener_module),i.prototype.MIN_LAPS=2,r={selector:".base-chart",detailSelector:"#effort-detail",width:868,height:10,paddingLeft:150,paddingRight:90,xAxisType:"distance",labelPosition:{x:45,y:11}},i.prototype.render=function(t){return null!=t&&(this.container=t),this.builder.height(this.height()).width(this.width()).build(this.container),this.builder.root.insert("text").attr({"class":"laps-label",x:this.labelPosition().x,y:this.labelPosition().y,width:this.paddingRight(),height:this.height()}).text(Strava.I18n.Locale.t("strava.charts.activities.basic_analysis_laps.laps")),this.infobox.render(this.$(this.selector(),this.container)[0])},i.prototype.handleChangeXAxisType=function(t){return this.xAxisType(t),this.handleReady()},i.prototype.handleReady=function(){return this.createScales(),this.createLapBars()},i.prototype.createScales=function(){var t;return t=this.context.getStream(this.xAxisType()),this.xDomain=d3.extent(t),this.xScale=d3.scale.linear().domain(this.xDomain).range([0,this.builder.width()]),this.yScale=d3.scale.linear().domain([0,100]).range([this.builder.height(),0])},i.prototype.createLapBars=function(){var t,e,i;return this.laps=this.lapEffortsTableContext.getEfforts(),this.laps.length<this.MIN_LAPS?void this.container.hide():(i=this.context.getStream(this.xAxisType()),t=[],this.laps.each(function(){return function(e,r){var n,a;return a=e.get("start_index"),n=e.get("end_index"),t.push({x:i[a],y:100,width:i[n]-i[a],index:r,tag:"lapbar"})}}(this)),e=this.builder.graphs().lapBars,e?(e.data(t).xScale(this.xScale).update(!1),e.show()):(this.builder.buildBarChart(t,this.xScale,this.yScale,this.builder.width(),"lapBars"),e=this.builder.graphs().lapBars,e.on("barClick",function(t){return function(e,i){return t.handleBarClick(e,i)}}(this)).on("barEnter",function(t){return function(e,i){return t.handleBarEnter(e,i)}}(this)).on("barOut",function(t){return function(){return t.handleBarOut()}}(this))))},i.prototype.handleBarClick=function(t,e){var i,r,n;return r=this.laps.at(t),n=r.get("start_index"),i=r.get("end_index"),e?(this.unSelectLaps(),this.$$(this.detailSelector()).html(""),this.context.eventDispatcher().dispatchZoomUnselect(this,this.xAxisType())):(this.context.eventDispatcher().dispatchZoomSelect(this,this.xAxisType(),n,i,"lap"),this.$$(this.detailSelector()).html(JST[this.detailsTemplate](r))),this.trigger("lapClicked",{id:t,selected:e,startIndex:n,endIndex:i})},i.prototype.handleBarEnter=function(t){var e,i,r,n,a,s;return i=this.laps.at(t),s=this.context.getStream(this.xAxisType()),n=i.get("start_index"),e=i.get("end_index"),r=Math.round((n+e)/2),a=this.xScale(s[r]),this.infobox.show(JST[this.infoboxTemplate](i),a)},i.prototype.handleBarOut=function(){return this.infobox.hide()},i.prototype.unSelectLaps=function(){var t;return t=this.builder.graphs().lapBars,t?(t.unSelectSplits(),t.unHighlightSplits()):void 0},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.SegmentLevels=function(){function t(){}return t.compute=function(t){var e,i,r,n,a,s,o,l,c,h,u,p,d,f,v,m;for(v=[],l=0,u=t.length;u>l;l++){for(n=t[l],e=!1,c=0,p=v.length;p>c;c++){for(f=v[c],m=!1,h=0,d=f.length;d>h;h++)if(o=f[h],n.id!==o.id&&(r=parseInt(n.get("start_index")),i=parseInt(n.get("end_index")),s=parseInt(o.get("start_index")),a=parseInt(o.get("end_index")),r>=s&&a>=r||i>=s&&a>=i||s>=r&&i>=a)){m=!0;break}if(!m){f.push(n),e=!0;break}}e||v.push([n])}return v},t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/basic_analysis/segment_details"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<b>\n  <a href='/activities/"+e(t(this.activity_id))+"/segments/"+e(t(this.id))+"' data-segment-effort-id='"+e(t(this.id))+"'>"),i.push("    "+e(t(this.name))),i.push("  </a>\n</b>\n&nbsp; &nbsp;"),i.push(""+t(this.distance)),i.push("&nbsp; &nbsp;"),i.push(""+t(this.elev_difference)),i.push("&nbsp; &nbsp;"),i.push(""+t(this.avg_grade)),i.push("&nbsp; &nbsp;"),i.push(""+t(this.elapsed_time)),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/basic_analysis/segment_infobox"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],this.achievement_sprite_name&&i.push("<div class='"+["app-icon","icon-sm",""+e(t(this.achievement_sprite_name))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>"),i.push("<div class='details'>\n  <div class='title'>"+e(t(this.name))+"</div>\n  <ul class='inline-stats'>\n    <li>"),i.push("      "+t(this.distance)),i.push("    </li>"),this.elev_difference&&(i.push("    <li>"),i.push("      "+t(this.elev_difference)),i.push("    </li>")),i.push("    <li>"),i.push("      "+t(this.elapsed_time)),i.push("    </li>\n  </ul>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.BasicAnalysisSegments=function(e){function i(t,e,n){this.context=t,i.__super__.constructor.call(this),this.detailsTemplate="activities/basic_analysis/segment_details",this.infoboxTemplate="activities/basic_analysis/segment_infobox",this.initializeAttributes(r),this.segmentEfforts=e,this.builder=new Strava.D3.Charts.Builder(this.context),this.builder.padding({top:2,bottom:5,right:this.paddingRight(),left:this.paddingLeft()}),this.builder.topAreaHidden(!1).topArea({height:0,width:0}),this.infobox=new Strava.Charts.Activities.EffortInfoBox,this.context.eventDispatcher().addListener(this,this),this.deferred=new jQuery.Deferred,jQuery.when(n.deferred,e.deferred).then(function(t){return function(){return t.handleReady()}}(this))}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.listener_module),r={selector:".base-chart",detailSelector:"#effort-detail",width:868,height:10,stackPadding:2,xAxisType:"distance",paddingRight:90,paddingLeft:150,labelPosition:{x:45,y:11}},i.prototype.render=function(t){return null!=t&&(this.container=t),this.builder.height(this.height()).width(this.width()).build(this.container),this.builder.root.insert("text").attr({"class":"segments-label",x:this.labelPosition().x,y:this.labelPosition().y,width:this.paddingRight(),height:this.height()}).text(Strava.I18n.Locale.t("strava.charts.activities.basic_analysis_segments.segments")),this.infobox.render(this.$(this.selector(),this.container)[0])},i.prototype.handleChangeXAxisType=function(t){return this.xAxisType(t),this.handleReady()},i.prototype.handleReady=function(){return this.createScales(),this.createSegmentBars(),this.deferred.resolve()},i.prototype.createScales=function(){var t;return t=this.context.getStream(this.xAxisType()),this.xDomain=d3.extent(t),this.xScale=d3.scale.linear().domain(this.xDomain).range([0,this.builder.width()]),this.yScale=d3.scale.identity()},i.prototype.createSegmentBars=function(){var t,e,i,r,n,a,s,o,l,c,h,u,p,d,f;
if(i=this.segmentEfforts.slice(0),0===i.length)return void this.container.hide();for(i=i.sort(function(t,e){return parseFloat(e.get("distance"))-parseFloat(t.get("distance"))}),f=this.context.getStream(this.xAxisType()),t=[],c=Strava.Charts.Activities.SegmentLevels.compute(i),a=o=0,h=c.length;h>=0?h>o:o>h;a=h>=0?++o:--o)for(s=l=0,u=c[a].length;u>=0?u>l:l>u;s=u>=0?++l:--l)e=c[a][s],p=this.context.convertStreamIndices([e.get("start_index"),e.get("end_index")]),d=p[0],r=p[1],t.push({x:f[d],y:a*(this.height()+this.stackPadding()),width:f[r]-f[d],height:this.height(),index:e.id,tag:"segmentbar"});return this.builder.height((this.height()+this.stackPadding())*c.length),this.builder.updateRoot(),n=this.builder.graphs().segmentBars,n?(n.data(t).xScale(this.xScale).update(!1),n.show()):(this.builder.buildBarChart(t,this.xScale,this.yScale,this.builder.width(),"segmentBars"),n=this.builder.graphs().segmentBars,n.on("barClick",function(t){return function(e,i){return t.handleBarClick(e,i)}}(this)).on("barEnter",function(t){return function(e,i){return t.handleBarEnter(e,i)}}(this)).on("barOut",function(t){return function(){return t.handleBarOut()}}(this)))},i.prototype.handleBarClick=function(t,e){var i,r,n,a,s,o;return a=this.segmentEfforts.get(t),n=this.context.convertStreamIndices([a.get("start_index"),a.get("end_index")]),o=n[0],r=n[1],e?(this.unSelectSegments(),this.$$(this.detailSelector()).html(""),this.context.eventDispatcher().dispatchZoomUnselect(this,this.xAxisType())):(s=this.$$(this.detailSelector()),this.context.eventDispatcher().dispatchZoomSelect(this,this.xAxisType(),o,r,"segment"),i=_.extend({},a.toJSON(),{activity_id:this.context.activity().id}),_.defer(function(t){return function(){return s.html(JST[t.detailsTemplate](i))}}(this))),this.trigger("segmentClicked",{id:t,selected:e,startIndex:o,endIndex:r})},i.prototype.handleBarEnter=function(t){var e,i,r,n,a,s,o;return n=this.segmentEfforts.get(t),o=this.context.getStream(this.xAxisType()),r=this.context.convertStreamIndices([n.get("start_index"),n.get("end_index")]),a=r[0],e=r[1],i=Math.round((a+e)/2),s=this.xScale(o[i]),this.infobox.show(JST[this.infoboxTemplate](n.toJSON()),s)},i.prototype.handleBarOut=function(){return this.infobox.hide()},i.prototype.unSelectSegments=function(){var t;return t=this.builder.graphs().segmentBars,t?(t.unSelectSplits(),t.unHighlightSplits()):void 0},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/basic_analysis/view"]=function(t){return function(){var t;return t=[],t.push("<section class='capped'>\n  <div id='map-canvas'>\n    <div class='basic-analysis-loader spinner'>\n      <div class='graphic'></div>\n    </div>\n  </div>\n  <div class='grabber'></div>\n</section>\n<section class='chart'>\n  <div id='elevation-chart'>\n    <div class='base-chart'></div>\n  </div>\n  <div id='effort-detail'></div>\n  <div id='laps-chart'>\n    <div class='base-chart'></div>\n  </div>\n  <div id='segments-chart'>\n    <div class='base-chart'></div>\n  </div>\n  <div id='stacked-chart'>\n    <div class='base-chart'></div>\n  </div>\n</section>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=[].slice;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.BasicAnalysisView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.CHART_WIDTH=696,r.prototype.SIDEBAR_WIDTH=120,r.prototype.events={"click .chart-controls .button":"changeAxis","click #effort-detail a":"handleSegmentEffortClick"},r.prototype.tagName="section",r.prototype.id="basic-analysis",r.prototype.initialize=function(t,e,i){return this.page=t,this.streamsRequest=e,this.chartContext=i,this.template="activities/basic_analysis/view",this.lapEffortsTableContext=this.page.lapEffortsTableContext()},r.prototype.render=function(){return this.renderTemplate(),this.$el.addClass("with-border"),this.streamsRequest.require(this.chartContext.analysis().streamTypes,{onReady:function(t){return function(){return t.handleStreamsReady()}}(this)}),this},r.prototype.handleStreamsReady=function(){var t;return t=[],this.page.isSwim()?this.$("#elevation-chart").hide():(this.page.showMap()&&this.createElevationChart(),this.elevationChart?(this.elevationChart.render(this.$("#elevation-chart")),t.push(this.elevationChart.deferred)):this.$("#elevation-chart").hide(),this.createLapsChart(),this.lapsChart.render(this.$("#laps-chart")),this.page.showSegments()&&this.createSegmentsChart(),this.segmentsChart&&(this.segmentsChart.render(this.$("#segments-chart")),t.push(this.segmentsChart.deferred)),this.chartContext.eventDispatcher().on("select",function(t){return function(e,i,r,n){return t.page.router().changeMenuTo("analysis/"+r+"/"+n,!1)}}(this)),this.chartContext.eventDispatcher().on("zoomSelect",function(t){return function(e,i,r,n){return t.page.router().changeMenuTo("analysis/"+r+"/"+n,!1)}}(this)),this.chartContext.eventDispatcher().on("zoomUnselect",function(t){return function(){return t.page.router().changeMenuTo("analysis",!1)}}(this))),this.createStackedChart(),this.stackedChart.render(this.$("#stacked-chart")),t.push(this.stackedChart.deferred),jQuery.when.apply(jQuery,t).then(function(t){return function(){return t.handleSegmentEffortSelected()}}(this))},r.prototype.handleSegmentEffortSelected=function(){var t,e,r;return(r=this.page.pageContext().segmentEffortId())?(this.segmentsChart.builder.mainGroup.selectAll("rect#split-"+r).classed("selected",!0),this.segmentsChart.handleBarClick(r,!1),this.page.pageContext().segmentEffortId(null)):(t=this.page.pageContext().analysisRange())?((e=this.chartContext.eventDispatcher()).dispatchZoomSelect.apply(e,[this,this.chartContext.xAxisType()].concat(i.call(t))),this.page.pageContext().analysisRange(null)):void 0},r.prototype.createElevationChart=function(){return this.elevationChart=new Strava.Charts.Activities.BasicAnalysisElevation(this.chartContext,this.streamsRequest),this.elevationChart.width(this.CHART_WIDTH).sidebarWidth(this.SIDEBAR_WIDTH),this.elevationChart.on("brushChange",function(t){return function(){return t.lapsChart&&t.lapsChart.unSelectLaps(),t.segmentsChart?t.segmentsChart.unSelectSegments():void 0}}(this))},r.prototype.createStackedChart=function(){return this.stackedChart=new Strava.Charts.Activities.BasicAnalysisStacked(this.chartContext,this.streamsRequest),this.stackedChart.width(this.CHART_WIDTH).sidebarWidth(this.SIDEBAR_WIDTH).xAxisType(this.chartContext.xAxisType()),this.stackedChart.on("brushCleared",function(t){return function(){return t.elevationChart&&t.elevationChart.clearSelection(),t.lapsChart&&t.lapsChart.unSelectLaps(),t.segmentsChart?t.segmentsChart.unSelectSegments():void 0}}(this))},r.prototype.createLapsChart=function(){return this.lapsChart=new Strava.Charts.Activities.BasicAnalysisLaps(this.chartContext,this.lapEffortsTableContext,this.streamsRequest),this.lapsChart.width(this.CHART_WIDTH).paddingLeft(this.SIDEBAR_WIDTH).paddingRight(this.SIDEBAR_WIDTH).xAxisType(this.chartContext.xAxisType()),this.lapsChart.on("lapClicked",function(t){return function(e){return t.segmentsChart&&t.segmentsChart.unSelectSegments(),t.handleBarClick(e)}}(this))},r.prototype.createSegmentsChart=function(){return this.segmentsChart=new Strava.Charts.Activities.BasicAnalysisSegments(this.chartContext,this.page.segmentEfforts(),this.streamsRequest),this.segmentsChart.width(this.CHART_WIDTH).paddingLeft(this.SIDEBAR_WIDTH).paddingRight(this.SIDEBAR_WIDTH),this.segmentsChart.on("segmentClicked",function(t){return function(e){return t.lapsChart&&t.lapsChart.unSelectLaps(),t.handleBarClick(e)}}(this))},r.prototype.changeAxis=function(t){var e;return e=d3.select(t.currentTarget),e.classed("selected")?void 0:(d3.selectAll(".xaxis-container .button").classed("selected",!1),e.classed("selected",!0),this.chartContext.eventDispatcher().dispatchChangeXAxisType(this,e.attr("data-type")))},r.prototype.handleBarClick=function(t){return this.elevationChart?t.selected?this.elevationChart.clearSelection():this.elevationChart.setSelection([t.startIndex,t.endIndex]):void 0},r.prototype.handleSegmentEffortClick=function(t){var e,i;return t.preventDefault(),e=jQuery(t.currentTarget),i=e.data("segment-effort-id"),this.page.router().changeMenuTo("segments/"+i,!0)},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/heart_rate/zone_distribution_row"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<tr>\n  <td>"+e(t(this.zone.name))+"</td>\n  <td class='name'>"+e(t(this.zone.description))+"</td>\n  <td class='range'>"+e(t(this.zone.range))+"</td>\n  <td class='time'>\n    <strong>"+e(t(this.zone.time))+"</strong>\n  </td>\n  <td class='percent'>\n    <strong>"+e(t(this.zone.percent))+"</strong>\n  </td>\n  <td>\n    <div class='bar'>\n      <div class='"+["fill","heartrate",""+e(t(this.zone.tag))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' style='width: "+e(t(this.zone.width))+"%'></div>\n    </div>\n  </td>\n</tr>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.HeartRateZonesView=function(e){function i(t,e){this.el=t,this.heartRateZones=e,i.__super__.constructor.call(this),this.heartRateZones.on("heartRateZonesFetched",function(t){return function(){return t.handleHeartRateZonesFetched(t.heartRateZones.getHeartRateZones())}}(this))}return t(i,e),i.prototype.handleHeartRateZonesFetched=function(t){var e,i,r,n,a;for(e=this.$("tbody"),this.$$("div.heartrate-loader").remove(),n=this.getTemplateFor("activities/heart_rate/zone_distribution_row"),i=0,r=t.length;r>i;i++)a=t[i],e.append(n({zone:a}));return this.$(".bar .fill").each(function(){var t,e;return t=jQuery(this),e=t.width(),t.width(0).animate({width:e},400)})},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/heart_rate/header"]=function(t){return function(){var t,e,i,r,n,a;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<ul class='float-left inline-stats'>\n  <li>\n    <strong>"),r=new Strava.I18n.DistanceFormatter,i.push("      "+e(t(r.format(this.activity.distance)))),i.push("      \x91<abbr class='unit' title='"+e(t(r.unitLong()))+"'>"+e(t(r.unitShort()))+"</abbr>\x92\n    </strong>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.distance")))+"</div>\n  </li>\n  <li>\n    <strong>"),i.push("      "+e(t((new Strava.I18n.TimespanFormatter).display(this.activity.moving_time)))),i.push("    </strong>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.time")))+"</div>\n  </li>"),"Run"===this.activity.type?this.activity.average_speed&&(i.push("  <li>\n    <strong>"),a=new Strava.I18n.PaceFormatter,i.push("      "+e(t(a.format(this.activity.average_speed/3600)))),i.push("      \x91<abbr class='unit' title='"+e(t(a.unitLong()))+"'>"+e(t(a.unitShort()))+"</abbr>\x92\n    </strong>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.pace")))+"</div>\n  </li>")):this.activity.elev_gain&&(i.push("  <li>\n    <strong>"),n=new Strava.I18n.ElevationFormatter,i.push("      "+e(t(n.format(this.activity.elev_gain)))),i.push("      \x91<abbr class='unit' title='"+e(t(n.unitLong()))+"'>"+e(t(n.unitShort()))+"</abbr>\x92\n    </strong>\n    <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.elevation")))+"</div>\n  </li>")),i.push("</ul>\n<ul class='float-right heartrate-analysis inline-stats right'>"),this.heartRateZones.bucket&&i.push("  <li>\n    <strong>"+e(t(this.heartRateZones.bucket))+"</strong>\n    <div class='label'>&nbsp;</div>\n  </li>"),i.push("  <li class='suffer-score'>\n    <strong>"),this.heartRateZones.score?this.isOwner?(i.push("      <a href='/activities/"+e(t(this.activity.id))+"/relative-effort' data-menu='relative-effort'>"),i.push("        "+e(t(this.heartRateZones.score))),i.push("      </a>")):i.push("      "+e(t(this.heartRateZones.score))):i.push("      &mdash;"),i.push("    </strong>\n    <div class='label'>\n      <span class='glossary-link new-version' data-glossary-term='definition-suffer-score'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.relative_effort")))),i.push("      </span>\n    </div>\n  </li>\n</ul>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/heart_rate/zone_distribution"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],this.upsellHeartRateMonitor?(i.push("<section class='centered container-fluid inset upsell with-border' id='js-snw-adp-heartrate-analysis-upsell'>\n  <div class='row'>\n    <div class='offset4 spans8'>\n      <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.title")))+"</h2>\n      <div class='centered in-app-upsell'>\n        <div class='sprite suffer-score'></div>\n        <h3 class='bottomless'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.heading")))),i.push("        </h3>\n        <p class='mt-xs'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.description")))),i.push("        </p>\n        <a class='btn-primary button' id='js-snw-adp-heartrate-analysis-upsell-cta' href='/premium?source=suffer-score#suffer-score'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.analysis_pack_cta")))),i.push("        </a>\n      </div>\n    </div>\n  </div>\n</section>")):this.upsellHeartRateMonitorBuy?i.push("<section class='with-border'>\n  <header></header>\n  <div class='inset main'>\n    <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.title")))+"</h2>\n    <p>"+t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.upsell_shop_html_v3",{monitor_url:"http://www.wahoofitness.com/devices/wahoo-tickr-heart-rate-strap-1.html?acc=a01a0380ca3c61428c26a231f0e49a09"}))+"</p>\n  </div>\n</section>"):(i.push("<section class='with-border'>\n  <header></header>"),this.upsellWithHeartRateMonitor&&(i.push("  <div class='border-bottom-light upsell-others' id='js-snw-adp-heartrate-analysis-upsell'>\n    <span class='badge inlined md premium'></span>\n    <h3 class='inlined marginless'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.upsell_title_2")))),i.push("    </h3>\n    <a class='btn-primary button' id='js-snw-adp-heartrate-analysis-upsell-cta' href='/premium?source=suffer-score#suffer-score'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.analysis_pack_cta")))),i.push("    </a>\n  </div>")),i.push("  <div class='inset main'>\n    <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.title")))+"</h2>\n    <div class='heartrate-loader'>"),i.push("      "+t(this.renderPartial("partials/spinner_tag"))),i.push("    </div>\n    <table class='distribution-chart unstyled'>\n      <tbody></tbody>"),this.isOwner&&i.push("      <tfoot>\n        <tr>\n          <td colspan='"+e(t(3))+"'>\n            <p>"+t(Strava.I18n.Locale.t("templates.activities.heart_rate.zone_distribution.update_settings_html"))+"</p>\n          </td>\n        </tr>\n      </tfoot>"),i.push("    </table>\n  </div>\n</section>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["partials/spinner_tag"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+["spinner","sm",""+e(t(this["class"]))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='graphic'></div>"),this.status&&i.push("  <span class='status'>"+e(t(this.status))+"</span>"),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/overview"]=function(t){return function(){var t;return t=[],t.push("<section class='pinnable-view with-border' id='ride-overview'>"),this.showMapSection&&t.push("  <div id='map-canvas'>\n    <div class='spinner streams-loader'>\n      <div class='graphic'></div>\n    </div>\n  </div>\n  <div class='grabber'></div>"),t.push("  <div class='pinnable-anchor' id='elevation-profile'>\n    <div class='chart pinnable' id='chart-container'></div>\n  </div>\n  <div class='elev-chart-large spinner streams-loader'>\n    <div class='graphic'></div>\n  </div>\n  <div id='segments-container'></div>\n</section>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/overview_run"]=function(t){return function(){var t;return t=[],this.showRaceResultsSection&&t.push("<section id='race-results'></section>"),t.push("<section class='with-border'>"),this.showMapSection&&t.push("  <div class='no-margins row'>\n    <div class='spans4' id='splits-container'></div>\n    <div class='border-left map spans12'>\n      <div id='map-canvas'></div>\n    </div>\n  </div>\n  <div class='grabber'></div>"),t.push("  <div id='elevation-profile'>\n    <div class='chart' id='chart-container'></div>\n  </div>\n  <div class='elev-chart-large spinner streams-loader'>\n    <div class='graphic'></div>\n  </div>\n</section>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/view"]=function(t){return function(){var t;return t=[],t.push("<section class='with-border' id='laps'>\n  <section class='capped no-margins row'>\n    <div class='spans8'>\n      <div id='map-canvas'></div>\n    </div>\n    <div class='spans8'>\n      <div id='chart-container'></div>\n      <div class='elev-chart-small spinner streams-loader'>\n        <div class='graphic'></div>\n      </div>\n    </div>\n  </section>\n  <section id='efforts-table'>\n    <div class='segments-loader spinner'>\n      <div class='graphic'></div>\n    </div>\n  </section>\n</section>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/laps/view_trainer"]=function(t){return function(){var t;return t=[],t.push("<section class='with-border' id='laps'>\n  <section id='efforts-table'>\n    <div class='segments-loader spinner'>\n      <div class='graphic'></div>\n    </div>\n  </section>\n</section>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/relative_effort/relative_effort"]=function(t){return function(){var t,e,i,r,n,a;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<section class='with-border'>\n  <header>\n    <ul class='float-left inline-stats'>"),this.activity.distance&&(i.push("      <li>\n        <strong>"),r=new Strava.I18n.DistanceFormatter,i.push("          "+e(t(r.format(this.activity.distance)))),i.push("          \x91<abbr class='unit' title='"+e(t(r.unitLong()))+"'>"+e(t(r.unitShort()))+"</abbr>\x92\n        </strong>\n        <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.distance")))+"</div>\n      </li>")),this.activity.moving_time&&(i.push("      <li>\n        <strong>"),i.push("          "+e(t((new Strava.I18n.TimespanFormatter).display(this.activity.moving_time)))),i.push("        </strong>\n        <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.time")))+"</div>\n      </li>")),"Run"===this.activity.type?this.activity.average_speed&&(i.push("      <li>\n        <strong>"),a=new Strava.I18n.PaceFormatter,i.push("          "+e(t(a.format(this.activity.average_speed/3600)))),i.push("          \x91<abbr class='unit' title='"+e(t(a.unitLong()))+"'>"+e(t(a.unitShort()))+"</abbr>\x92\n        </strong>\n        <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.pace")))+"</div>\n      </li>")):this.activity.elev_gain&&(i.push("      <li>\n        <strong>"),n=new Strava.I18n.ElevationFormatter,i.push("          "+e(t(n.format(this.activity.elev_gain)))),i.push("          \x91<abbr class='unit' title='"+e(t(n.unitLong()))+"'>"+e(t(n.unitShort()))+"</abbr>\x92\n        </strong>\n        <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.heart_rate.header.elevation")))+"</div>\n      </li>")),i.push("    </ul>\n  </header>\n  <div class='main'>\n    <div id='relative-effort' data-react-class='RelativeEffort' data-react-props='"+e(t(this.props))+"'></div>\n  </div>\n</section>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ViewFactory=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={page:null,menuFactory:Strava.Labs.Activities.MenuView,kudosViewFactory:Strava.Labs.Activities.KudosView,headerViewFactory:Strava.Labs.Activities.ActivityHeaderView,activityChartViewFactory:Strava.Labs.Activities.ElevationChartView,scrollListener:null},i.prototype.createMenuView=function(){var t;return t=new this._menuFactory(this.page().router()),t.render(),t},i.prototype.createKudosView=function(t,e){var i;return i=new this._kudosViewFactory(t,e)},i.prototype.createOverviewView=function(t){var e,i,r,n;return t.require(this.page().chartContext().overviewStreamTypes()),i={showMapSection:!this.page().activity().get("trainer")},r=this.page().isRun()?(i.showRaceResultsSection=this.page().activity().get("raceData"),"activities/overview_run"):"activities/overview",e=this.$$("#view"),e.html(JST[r](i)),n=new this._activityChartViewFactory(this.page().chartContext(),this.page().pageContext(),t),n.setElement(e.find("#chart-container")).render(),n},i.prototype.createLapsView=function(){var t,e,i,r,n,a,s,o,l;return e=this.page().activity(),l=e.get("trainer")?"activities/laps/view_trainer":"activities/laps/view",t=this.$$("#view"),t.html(JST[l]()),this.page().isOwner()&&this.page().power().visible&&(r=new Strava.Activities.PowerPanel.EffortIntensityView(this.page().activityAthlete().id,e.get("startDateLocal"),{listSelector:"table.laps-list",rowSelector:"tr",maxBarWidth:50,enableHoverHandler:!1})),i=this.page().lapEffortsTableContext(),a=e.isRide()?e.isTrainer()?["activities/laps/table_stationary_ride","activities/laps/row_stationary_ride"]:["activities/laps/table_ride","activities/laps/row_ride"]:e.isSwim()?["activities/laps/table_swim","activities/laps/row_swim"]:e.isRun()?e.isTrainer()?["activities/laps/table_stationary_run","activities/laps/row_stationary_run"]:["activities/laps/table_run","activities/laps/row_run"]:["activities/laps/table_other","activities/laps/row_other"],o=a[0],s=a[1],n=new Strava.Labs.Activities.LapEffortsTableView(this.$$("#efforts-table"),new Strava.Labs.Activities.LapEffortsTableViewModel(i),r,o,s)},i.prototype.createRelativeEffortView=function(){var t,e,i,r,n;return n=JST["activities/relative_effort/relative_effort"],e={activity:this.page().activity().attributes,props:JSON.stringify({athleteId:this.page().currentAthlete().id,activityId:this.page().activity().get("id")})},t=this.$$("#view"),t.html(n(e)),r=this.$$("#relative-effort"),i=new CustomEvent("JSCreatedReactNode",{detail:{node:r}}),document.dispatchEvent(i)},i.prototype.createHeartRateZonesView=function(){var t,e,i,r;return i=JST["activities/heart_rate/zone_distribution"],e={upsellHeartRateMonitor:this.page().pageContext().isUpsell("heart_rate_monitor"),upsellHeartRateMonitorBuy:this.page().pageContext().isUpsell("heart_rate_monitor_buy"),upsellWithHeartRateMonitor:this.page().pageContext().isUpsell("with_heart_rate_monitor"),isOwner:this.page().isOwner()},t=this.$$("#view"),t.html(i(e)),this.page().heartRateZones().on("heartRateZonesFetched",function(e){return function(){var i;return i={heartRateZones:e.page().heartRateZones().attributes,activity:e.page().activity().attributes,isOwner:e.page().isOwner()},e.addHeaderView(t,"activities/heart_rate/header",i)}}(this)),r=new Strava.Labs.Activities.HeartRateZonesView(t.find(".distribution-chart"),this.page().heartRateZones()),this.addHeartRateZonesLogging(t)},i.prototype.addHeaderView=function(t,e,i){var r;return null==i&&(i={}),r=new this._headerViewFactory({template:e,data:i,el:t.find("header")[0]}),r.render()},i.prototype.createBasicAnalysisView=function(t){var e,i,r,n;return r=this.page(),i=r.basicAnalysisChartContext(),n=new Strava.Labs.Activities.BasicAnalysisView(r,t,i),e=this.$$("#view"),e.html(n.render().el),r.showMap()||(e.find("#map-canvas").hide(),e.find(".grabber").hide()),n},i.prototype.addHeartRateZonesLogging=function(t){var e;return this.$$("#js-snw-adp-heartrate-analysis-upsell").length>0?(Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"screen_enter",element:"join_summit_heartrate"}),e="#js-snw-adp-heartrate-analysis-upsell-cta",t.off("click",e).on("click",e,function(){return function(){return Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"click",element:"join_summit_heartrate"})}}(this))):void 0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Maps.CustomControlOptions=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={useGoogle:!0,zones:null,privacyZonesEnabled:!1,fullScreenSelector:"custom-map-controls-fullscreen-template",regularSelector:"custom-map-controls-template",isOwner:!1},i.prototype.supportsFullscreen=function(){return this.fakeFullScreen()||this.fullScreen()},i.prototype.fakeFullScreen=function(){return this.fullScreen()?!1:jQuery.browser.msie||!Modernizr.touch&&jQuery.browser.safari},i.prototype.fullScreen=function(){return jQuery.browser.mozilla||jQuery.browser.chrome&&!Modernizr.touch},i.prototype.privacyZones=function(t){return this.zones(t),t&&t.length>0?(this.privacyZonesEnabled(!0),this.fullScreenSelector("custom-map-controls-show-privacy-fullscreen-template"),this.regularSelector("custom-map-controls-show-privacy-template")):this.isOwner()&&(this.fullScreenSelector("custom-map-controls-suggest-privacy-fullscreen-template"),this.regularSelector("custom-map-controls-suggest-privacy-template")),this},i.prototype.selector=function(){return this.supportsFullscreen()?this.useGoogle()?"#labs-google-"+this.fullScreenSelector():"#"+this.fullScreenSelector():this.useGoogle()?"#labs-google-"+this.regularSelector():"#"+this.regularSelector()},i.prototype.toHash=function(){return{privacyZones:this.zones(),fullScreenEnabled:this.fullScreen(),fauxScreenEnabled:this.fakeFullScreen(),privacyZonesEnabled:this.privacyZonesEnabled(),controlsTemplate:this.selector()}},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Maps.CustomControlView=function(e){function i(t,e,r,n,a){i.__super__.constructor.call(this),this.createTemplate(t),this.pageContext=e,this.showToggleFullButton=r,this.showGpxDownload=n,this.showPrivacyToggle=a}var r;return t(i,e),i.prototype.events={"click #gpx-download":"handleGpxDownload","click .map-type-selector":"handleMapTypeSelector","click #toggle-fullscreen":"handleToggleFullScreen","click #start-street-view":"handleShowStartStreetView","click #end-street-view":"handleShowEndStreetView","change #privacy_toggle":"handlePrivacyToggle"},r={terrain:Strava.I18n.Locale.t("strava.maps.google.custom_control.terrain"),standard:Strava.I18n.Locale.t("strava.maps.google.custom_control.standard"),satellite:Strava.I18n.Locale.t("strava.maps.google.custom_control.satellite")},i.prototype.render=function(){return this.renderTemplate({}),this.showToggleFullButton||this.$("#toggle-fullscreen").css("display","none"),this.showPrivacyToggle||this.$("#privacy_toggle").closest("li").css("display","none"),this.showGpxDownload||this.$("#gpx-download").css("display","none"),this},i.prototype.map=function(t){return this.setOrGet("_map",t)},i.prototype.handleGpxDownload=function(t){return t.preventDefault(),t.stopPropagation(),this.trigger("gpxDownload",t)},i.prototype.handleMapTypeSelector=function(t){var e,i,n;return e=this.$$(t.target),n=e.data("map-type-id"),i=this.$("#selected-map").data("map-type-id"),e.data("map-type-id",i),e.html(r[i]),this.$("#selected-map").data("map-type-id",n),this.$("#selected-map").html(r[n]),this.changeMapType(n)},i.prototype.handleToggleFullScreen=function(){return this.trigger("toggleFullScreen")},i.prototype.handleShowStartStreetView=function(){return this.trigger("showStartStreetView")},i.prototype.handleShowEndStreetView=function(){return this.trigger("showEndStreetView")},i.prototype.handlePrivacyToggle=function(t){var e;return e=this.$(t.target).is(":checked"),this.trigger("togglePrivacy",e)},i.prototype.enterFullScreen=function(t){return this.initialMapHeight=this.$$("#map-canvas").height(),this.$$("body").addClass("fullscreen"),this.$("#toggle-fullscreen").addClass("fullscreen-on"),this.pageContext.enterFullScreen(),this.map().enteredFullScreen(t)},i.prototype.exitFullScreen=function(){return this.$$("body").removeClass("fullscreen"),this.$("#toggle-fullscreen").removeClass("fullscreen-on"),this.pageContext.exitFullScreen(),this.map().exitedFullScreen(this.initialMapHeight)},i.prototype.enterFauxScreen=function(t){return this.initialMapHeight=this.$$("#map-canvas").height(),this.$$("body").addClass("fauxscreen"),this.$("#toggle-fullscreen").addClass("fullscreen-on"),this.map().enteredFullScreen(t)},i.prototype.exitFauxScreen=function(){return this.$$("body").removeClass("fauxscreen"),this.$("#toggle-fullscreen").removeClass("fullscreen-on"),this.map().exitedFullScreen(this.initialMapHeight)},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google"),Strava.Maps.Google.CustomControlView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.changeMapType=function(t){return this.map().google.setMapTypeId(this.mapTypeIdMap(t))},i.prototype.mapTypeIdMap=function(t){var e;return e={terrain:google.maps.MapTypeId.TERRAIN,standard:google.maps.MapTypeId.ROADMAP,satellite:google.maps.MapTypeId.HYBRID},e[t]},i}(Strava.Maps.CustomControlView)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google"),Strava.Maps.Google.PrivacyZoneControl=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.view(t),this.view().bind("togglePrivacy",function(t){return function(e){return t.handleTogglePrivacy(e)
}}(this))}var r;return t(i,e),r={zones:null,overlays:[],view:null},i.prototype.removeZones=function(){var t,e,i,r;for(r=this.overlays(),t=0,e=r.length;e>t;t++)i=r[t],i.remove();return this.overlays([])},i.prototype.showZones=function(){var t,e,i,r,n;for(i=this.zones(),r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(this.createPrivacyZone(n));return r},i.prototype.createPrivacyZone=function(t){var e;return e=new Strava.Maps.Google.PrivacyZone,e.create(t.radius,t.position,this.view().map()),this.overlays().push(e)},i.prototype.handleTogglePrivacy=function(t){return t?this.showZones():this.removeZones()},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["performance_goals/tooltip"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='js-snw-performance-goals-upsell'>\n  <a class='dismiss' href='javascript:;'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.dismiss")))),i.push("  </a>\n  <h4 class='h5 title'>\n    <div class='badge premium sm'></div>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.goals")))),i.push("  </h4>\n  <div class='content'>"),i.push("    "+t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.upsell_v2_html"))),i.push("  </div>\n  <div class='arrow bottom'></div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.TooltipView=function(e){function i(t){i.__super__.constructor.call(this),JST[t]?this.template=t:this.createTemplate(t)}return t(i,e),i.prototype.tagName="div",i.prototype.className="super-tooltip",i.prototype.attributes={style:"display: none"},i.prototype.events={"click .dismiss":"dismissTooltip"},i.prototype.render=function(t,e){return this.renderTemplate({data:this.prepareData(t)}),this.delegateEvents(),this.show(e),this},i.prototype.prepareData=function(t){return t},i.prototype.show=function(t){var e,i,r,n,a,s;return this.$$(".super-tooltip").remove(),this.$$("body").append(this.el),i=this.$$(t),s=i.offset(),e=this.$("div.arrow"),n=e.hasClass("top")?s.top+i.outerHeight()+10:s.top-(this.$el.height()+15),a=!1,0>n?(n=0,a=!0):n+this.$el.outerHeight()>this.$$(window).height()+window.pageYOffset&&(n=this.$$(window).height()+window.pageYOffset-this.$el.outerHeight(),a=!0),r=s.left-this.$el.width()/2+i.outerWidth()/2,0>r?(r=0,a=!0):r+this.$el.outerWidth()>this.$$(window).width()+window.pageXOffset&&(r=this.$$(window).width()+window.pageXOffset-this.$el.outerWidth(),a=!0),a&&e.hide(),this.$el.css({left:r,top:n}),this.$el.fadeIn("fast")},i.prototype.dismissTooltip=function(){return this.$el.remove(),!1},i.createInstance=function(t,e){return null==this.instance&&(this.instance=new e(t),this.instance.$document().click(function(t){return function(e){return t.instance.$el.is(":visible")&&!jQuery(e.target).parents(".super-tooltip").length?t.instance.dismissTooltip():void 0}}(this))),this.instance},i.show=function(t,e){return this.instance.render(t,e)},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Activities"),Strava.Activities.PremiumTooltip=function(e){function i(t){i.__super__.constructor.call(this,t)}return t(i,e),i.createInstance=function(t){return Strava.Ui.TooltipView.createInstance(t,this)},i.show=function(t,e){return Strava.Ui.TooltipView.show(t,e)},i}(Strava.Ui.TooltipView)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/gpx_download_upsell"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<a class='dismiss' href='javascript:;'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.gpx_download_upsell.dismiss")))),i.push("</a>\n<h4 class='h5 title'>\n  <div class='badge premium sm'></div>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.gpx_download_upsell.premium_feature_v2")))),i.push("</h4>\n<div class='content'>"),i.push("  "+t(Strava.I18n.Locale.t("templates.activities.gpx_download_upsell.upgrade_v2_html"))),i.push("</div>\n<div class='arrow bottom'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Activities.Gpx"),Strava.Activities.Gpx.DownloadHandler=function(e){function i(){this._premiumUser=!1,this._activityId=null,this._name=null,i.__super__.constructor.call(this)}return t(i,e),i.prototype.name=function(t){return this.setOrGet("_name",t)},i.prototype.premium=function(t){return this.setOrGet("_premiumUser",t)},i.prototype.activityId=function(t){return this.setOrGet("_activityId",t)},i.prototype.execute=function(t){return this.premium()?this.handleDownload():this.handleUpsell(t)},i.prototype.handleDownload=function(){return window.location="/activities/"+this.activityId()+"/export_gpx"},i.prototype.handleUpsell=function(t){return Strava.Activities.PremiumTooltip.createInstance("activities/gpx_download_upsell"),Strava.Activities.PremiumTooltip.show({name:this.name()},t.target)},i.prototype.setOrGet=function(t,e){return null!=e?(this[t]=e,this):this[t]},i.prototype.handler=function(){return function(t){return function(e){return t.execute(e)}}(this)},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Maps.FullScreenHandler=function(e){function i(){i.__super__.constructor.call(this)}var r;return t(i,e),r=null,i.getInstance=function(t){return null==r&&(r=new this,document.addEventListener("fullscreenchange",function(){return r.handleFullScreenChange(document.fullscreen)}),document.addEventListener("mozfullscreenchange",function(){return r.handleFullScreenChange(document.mozFullScreen)}),document.addEventListener("webkitfullscreenchange",function(){return r.handleFullScreenChange(document.webkitIsFullScreen)})),r.setControl(t),r},i.prototype.setControl=function(t){return this.control=t},i.prototype.handleFullScreenChange=function(t){return t?this.enter():this.exit()},i.prototype.enter=function(){return this.control.enterFullScreen(this.availableHeight)},i.prototype.exit=function(){return this.control.exitFullScreen()},i.prototype.execute=function(){var t,e,i;return t=/safari/.test(navigator.userAgent.toLowerCase())&&!/chrome/.test(navigator.userAgent.toLowerCase()),i=jQuery("#view")[0],e=jQuery("#view").outerHeight(),this.availableHeight=screen.height-e,!Modernizr.fullscreen||t?jQuery("body").hasClass("fauxscreen")?this.control.exitFauxScreen():this.control.enterFauxScreen(this.availableHeight):(document.fullscreen?document.exitFullscreen():i.requestFullscreen&&i.requestFullscreen(),document.mozFullScreen?document.mozCancelFullScreen():i.mozRequestFullScreen&&i.mozRequestFullScreen(),document.webkitIsFullScreen?document.webkitCancelFullScreen():i.webkitRequestFullScreen?i.webkitRequestFullScreen():void 0)},i.prototype.handler=function(){return function(t){return function(){return t.execute()}}(this)},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.Maps.Google.Construction"),Strava.Maps.Google.Construction.MapBuilder=function(){function t(t){this.context=t}return t.prototype.getMap=function(){return this.map},t.prototype.createMap=function(t,e,i){return null==t[0]?null:(this.map||(this.map=e?new Strava.Maps.Google.Map:new Strava.Maps.Google.NoninteractiveMap,this.map.defaultLayer(i),this.map.canvas(t).initialize()),this.map)},t.prototype.addCustomControl=function(t,e,i,r){var n,a,s,o;return o=this.getCustomControlOptions().toHash(),n=new Strava.Maps.Google.CustomControlView(o.controlsTemplate,t,i,e,r),e&&(s=(new Strava.Activities.Gpx.DownloadHandler).premium(this.context.isPremium()).activityId(this.context.activityId()).name(""),n.bind("gpxDownload",s.handler())),i&&(a=Strava.Maps.FullScreenHandler.getInstance(n),n.bind("toggleFullScreen",a.handler())),o.privacyZonesEnabled&&new Strava.Maps.Google.PrivacyZoneControl(n).zones(this.context.privacyZones()),this.map.addCustomControl(n)},t.prototype.fitBounds=function(t){return this.map.fitBounds(t)},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.Maps.Google.Construction.ActivityMapBuilder=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.addStreamPath=function(t){return null==t&&(t={}),this.streamPath=new Strava.Maps.Google.StreamPathBuilder(this.map,this.context).buildActivity(t).buildFromStream(this.context.latlngStream()).addMarkers(this.context.activityData()).setEventDispatcher(this.context.eventDispatcher()).end()},i.prototype.getStreamPath=function(){return this.streamPath},i.prototype.getCustomControlOptions=function(){return(new Strava.Maps.CustomControlOptions).isOwner(this.context.isOwner()).privacyZones(this.context.privacyZones())},i}(Strava.Maps.Google.Construction.MapBuilder)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Strava.module("Strava.Maps"),Strava.Maps.Loader=function(){function e(){this.getJSON=t(this.getJSON,this),this.cache=new Array}var i;return i=null,e.getInstance=function(){return null==i&&(i=new this),i},e.prototype.hasItem=function(t){return null!=this.cache[t]},e.prototype.getJSON=function(t,e){return this.hasItem(t)?e(this.cache[t]):jQuery.getJSON(t,function(i){return function(r){return i.cache[t]=r,e(i.cache[t])}}(this))},e}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google"),Strava.Maps.Google.createMap=function(t,e,i,r){var n;return this.controller=new Strava.Maps.StreamsController(t,e),n=jQuery(i+":eq(0)"),this.map=(new Strava.Maps.Google.Map).canvas(n).initialize(),this.activity=new Strava.Maps.Google.Activity(this.map,r),this.builder=new Strava.Maps.Google.StreamPathBuilder,this.builder.buildFromStream(this.activity,this.controller.streamsData()),this.builder.addMarkers(this.activity,this.map,this.controller.activityData()),this.activity.show()},Strava.Maps.Google.Base=function(e){function i(){i.__super__.constructor.call(this)}return t(i,e),i.createPath=function(){return new google.maps.MVCArray},i.prototype.createPath=function(){return Strava.Maps.Google.Base.createPath()},i.prototype.createBounds=function(){return new google.maps.LatLngBounds},i.prototype.createPolyline=function(){var t;return t={path:this.path(),strokeColor:this.color(),strokeOpacity:this.opacity(),strokeWeight:this.weight(),clickable:this.clickable(),map:this.map().google,zIndex:this.zIndex()},new google.maps.Polyline(t)},i.prototype.createLatLng=function(t,e){return new google.maps.LatLng(t,e)},i.prototype.createMap=function(t,e){return new google.maps.Map(t,e)},i.prototype.createBoundingBox=function(t){var e,i,r,n,a,s;for(i=this.createBounds(),e=function(t){return function(e){return i.extend(t.createLatLng(e[0],e[1]))}}(this),n=function(t){return!(0===t[0]&&0===t[1])},r=0,a=t.length;a>r;r++)s=t[r],n(position)&&addPosition(position);return i},i.createSize=function(t,e){return new google.maps.Size(t,e)},i.createPoint=function(t,e){return new google.maps.Point(t,e)},i.createMarkerImage=function(t,e,i,r,n,a){return new google.maps.MarkerImage(t,a,this.createPoint(e,i),this.createPoint(r,n))},i.createMarker=function(t){return new google.maps.Marker(t)},i.prototype.createCircle=function(t,e,i){var r,n;return r=this.createLatLng(e.lat,e.lng),n={strokeColor:this.color(),strokeOpacity:this.opacity(),strokeWeight:this.weight(),fillColor:this.fillColor(),fillOpacity:this.fillOpacity(),map:i.google,center:r,radius:t},new google.maps.Circle(n)},i.prototype.addListener=function(t,e,i){return google.maps.event.addListener(t,e,i)},i.prototype.createPolygon=function(t){var e;return e={clickable:!1,fillColor:"#ff9900",fillOpacity:.2,strokeColor:"#ff9900",strokeOpacity:.6,strokeWeight:2},e=jQuery.extend({},e,t),new google.maps.Polygon(e)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google"),Strava.Maps.Google.Polyline=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.path(Strava.Maps.Google.Base.createPath()),this.map(t)}var r;return t(i,e),r={map:null,path:null,color:"#F00",tight:!1,google:null,bounds:null,opacity:1,weight:3,clickable:!1,callback:function(){},centered:!0,encoded:!1,zIndex:0},i.prototype.hide=function(){return this.google().setMap(null)},i.prototype.show=function(){return this.google().setMap(this.map().google)},i.prototype.toggle=function(){return null!=this.google().getMap()?this.hide():this.show()},i.prototype.setColor=function(t){return this.google().setOptions({strokeColor:t}),this},i.prototype.setOpacity=function(t){return this.google().setOptions({strokeOpacity:t}),this},i.prototype.setZIndex=function(t){return this.google().setOptions({zIndex:t}),this},i.prototype.getLength=function(){return this.path().getLength()},i.prototype.getAt=function(t){return this.path().getAt(t)},i.prototype.first=function(){return this.path().getAt(0)},i.prototype.last=function(){return this.path().getAt(this.getLength()-1)},i.prototype.setPath=function(t){return this.google().setPath(t),this.bounds(null)},i.prototype.handlePathClick=function(t){return this.trigger("pathclick",t.latLng)},i.prototype.handlePathMouseOver=function(t){return this.trigger("mouseover",t.latLng)},i.prototype.createSubPath=function(t,e){var i,r,n,a,s,o,l,c;for(n=this.getLength(),c=0>t?0:t,i=e>n?n:e,s=this.createPath(),a=r=o=c,l=i;l>=o?l>r:r>l;a=l>=o?++r:--r)s.push(this.getAt(a));return s},i.prototype.createPathBounds=function(t,e){var i,r,n,a,s,o,l,c;for(a=this.getLength(),c=0>t?0:t,r=e>a?a:e,i=this.createBounds(),s=n=o=c,l=r;l>=o?l>n:n>l;s=l>=o?++n:--n)i.extend(this.getAt(s));return i},i.prototype.center=function(){var t;if(this.google())return this.bounds()||(this.bounds(this.createBounds()),this.google().getPath().forEach(function(t){return function(e){return e?t.bounds().extend(e):void 0}}(this))),t=this.map().google,this.map().fitBounds(this.bounds()),this.tight()&&t.getZoom()<15?t.setZoom(t.getZoom()+1):void 0},i.prototype.setGoogle=function(){var t;return t=this.createPolyline(),this.google(t),this.addListener(t,"click",function(t){return function(e){return t.handlePathClick(e)}}(this)),this.addListener(t,"mouseover",function(t){return function(e){return t.handlePathMouseOver(e)}}(this)),this.centered()&&this.center(),this.callback()(this),this},i}(Strava.Maps.Google.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google"),Strava.Maps.Google.Map=function(e){function i(){i.__super__.constructor.call(this),n.forceZoomTerrainTypeId=google.maps.MapTypeId.ROADMAP,n.mapTypeId=google.maps.MapTypeId.TERRAIN,this.initializeAttributes(n)}var r,n;return t(i,e),n={selector:"#map_canvas",mapTypeId:null,mapTypeControl:!1,mapTypeControlOptions:null,defaultLayer:"terrain",streetViewControl:!0,draggable:!0,draggableCursor:null,disableDefaultUI:!1,disableDoubleClickZoom:!1,center:null,panControlOptions:null,zoom:null,zoomControl:!0,zoomControlOptions:null,width:null,height:null,canvas:null,bounds:null,scrollwheel:!1,minZoom:4,forceZoomTerrainTypeId:null},r={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:1,fillColor:"#FF0000",fillOpacity:.35},i.prototype.initialize=function(){var t,e;return t=this.canvas()[0],this.updateDefaultMapTypeId(),e={mapTypeId:this.mapTypeId(),scrollwheel:this.scrollwheel(),scaleControl:!1,center:this.center(),panControlOptions:this.panControlOptions(),zoom:this.zoom(),zoomControl:this.zoomControl(),zoomControlOptions:this.zoomControlOptions(),mapTypeControl:this.mapTypeControl(),mapTypeControlOptions:this.mapTypeControlOptions(),streetViewControl:this.streetViewControl(),draggable:this.draggable(),draggableCursor:this.draggableCursor(),disableDefaultUI:this.disableDefaultUI(),disableDoubleClickZoom:this.disableDoubleClickZoom(),navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},minZoom:this.minZoom()},this.google=this.createMap(t,e),this.addListeners(),this},i.prototype.updateDefaultMapTypeId=function(){var t;return t=this.defaultLayer(),"terrain"===t?this.mapTypeId(google.maps.MapTypeId.TERRAIN):"standard"===t?this.mapTypeId(google.maps.MapTypeId.ROADMAP):"satellite"===t?this.mapTypeId(google.maps.MapTypeId.HYBRID):void 0},i.prototype.loader=function(){return Strava.Maps.Loader.getInstance()},i.prototype.implementor=function(){return this.google},i.prototype.fitBounds=function(t){return this.bounds(t),this.google.fitBounds(t),this},i.prototype.resize=function(){return google.maps.event.trigger(this.google,"resize"),null!=this.bounds()?this.google.fitBounds(this.bounds()):void 0},i.prototype.enteredFullScreen=function(t){var e,i;return i=this.canvas().outerHeight(),e=t>0?i+t:i,this.canvas().css({height:Math.max(300,e)}),this.google.setOptions({scrollwheel:!0}),this.resize()},i.prototype.exitedFullScreen=function(t){return this.canvas().css({height:t}),this.google.setOptions({scrollwheel:!1}),this.resize()},i.prototype.addCustomControl=function(t){var e;return t.map(this),e=t.render().el,this.google.controls[google.maps.ControlPosition.TOP_RIGHT].push(e),this},i.prototype.addListeners=function(){return null!=this.forceZoomTerrainTypeId()?(this.wasTerrain=this.mapTypeId()===google.maps.MapTypeId.TERRAIN,google.maps.event.addListener(this.google,"zoom_changed",function(t){return function(){if(t.google.getZoom()<=14){if(t.wasTerrain)return t.google.setMapTypeId(google.maps.MapTypeId.TERRAIN)}else if(t.google.getMapTypeId()===google.maps.MapTypeId.TERRAIN)return t.google.setMapTypeId(t.forceZoomTerrainTypeId()),t.wasTerrain=!0}}(this)),google.maps.event.addListener(this.google,"maptypeid_changed",function(t){return function(){return t.wasTerrain=t.google.getMapTypeId()===google.maps.MapTypeId.TERRAIN}}(this))):void 0},i}(Strava.Maps.Google.Base),Strava.Maps.Google.NoninteractiveMap=function(e){function i(){i.__super__.constructor.call(this),this.streetViewControl(!1),this.mapTypeControl(!1),this.zoomControl(!1),this.draggable(!1),this.disableDefaultUI(!0),this.disableDoubleClickZoom(!0)}return t(i,e),i}(Strava.Maps.Google.Map)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google"),Strava.Maps.Google.PrivacyZone=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={color:"#FF0000",opacity:.8,weight:1,fillColor:"#FF0000",fillOpacity:.35},i.prototype.create=function(t,e,i){return this.circle=this.createCircle(t,e,i)},i.prototype.remove=function(){return this.circle.setMap(null)},i}(Strava.Maps.Google.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Google.Construction"),Strava.Maps.Google.Construction.MapFactory=function(e){function i(t,e,n,a){this.context=t,this.canvas=e,this.pageContext=n,this.mbr=null!=a?a:null,i.__super__.constructor.call(this),this.initializeAttributes(r),null!=this.context&&this.context.bind("ready",function(t){return function(){return t.handleStreamsReady()}}(this))}var r;return t(i,e),r={showFullScreenToggle:!0,showGpxDownload:!0,showPrivacyToggle:!0,interactiveMap:!0,defaultLayer:"terrain",polylineColor:null,isRoute:!1,builderClass:Strava.Maps.Google.Construction.ActivityMapBuilder},i.prototype.handleStreamsReady=function(){return this.createMap(!0)},i.prototype.createMap=function(t,e){return null==this.mapBuilder&&(this.mapBuilder=new this._builderClass(this.context)),null==this.mapBuilder.getMap()&&(this.mapBuilder.createMap(this.canvas,this.interactiveMap(),this.defaultLayer()),null!=e&&this.mapBuilder.fitBounds(e),this.interactiveMap()&&this.mapBuilder.addCustomControl(this.pageContext,this.showGpxDownload(),this.showFullScreenToggle(),this.showPrivacyToggle())),t?this.mapBuilder.addStreamPath({polylineColor:this.polylineColor()}):void 0},i.prototype.initializeMap=function(){var t,e,i;return null==this.canvas[0]?this:this.mbr?(i=new google.maps.LatLng(this.mbr[0][0],this.mbr[0][1]),e=new google.maps.LatLng(this.mbr[1][0],this.mbr[1][1]),t=new google.maps.LatLngBounds(i,e),this.createMap(this.context.latlngStream().ready(),t),this):this},i.prototype.getMap=function(){return null!=this.map?this.map:this.mapBuilder.getMap()},i.prototype.getStreamPath=function(){return this.mapBuilder.getStreamPath()},i.prototype.createNoActivityMap=function(t,e){var i;return i=Strava.Maps.Google.NonInteractiveMap,this.interactiveMap()&&(i=Strava.Maps.Google.Map),this.map=new i,t=this.map.createLatLng(t.lat,t.lng),this.map.zoom(e).center(t).canvas(this.canvas).initialize()},i.prototype.createPrivacyZone=function(){return new Strava.Maps.Google.PrivacyZone},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.Base=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.on=function(t,e){return this.implementor().on(t,e)},i.prototype.off=function(t,e){return this.implementor().off(t,e)},i.prototype.fire=function(t){return this.implementor().fire(t)},i.setMapIds=function(t){return this.mapIds=t},i.prototype.getMapIds=function(){return Strava.Maps.Mapbox.Base.mapIds},i.createLatLng=function(t,e){return new L.LatLng(t,e)},i.prototype.createLatLng=function(t,e){return Strava.Maps.Mapbox.Base.createLatLng(t,e)},i.createBounds=function(t,e){return L.latLngBounds(t,e)},i.createPoint=function(t,e){return L.point(t,e)},i.createSize=function(t,e){return L.point(t,e)},i.createMarker=function(t,e,i){return L.marker(e,i).addTo(t.implementor())},i.createMarkerImage=function(t,e,i){return null==i&&(i="blip"),L.divIcon({className:"map-marker-sprite "+t,iconSize:e,html:"<div class='"+i+"'></div>"})},i.prototype.createBounds=function(){return new L.LatLngBounds},i.prototype.createLayer=function(t){var e,i,r;return null==t&&(t="terrain"),L.mapbox.accessToken||(L.mapbox.accessToken=window._maps_api),"run-bike-hike"===t&&(t="runbikehike"),r=this.getMapIds(),i=r[t+"_id"],i||(i=r.terrain_id),e=L.mapbox.tileLayer(i),e.mapId=i,e},i.prototype.createMap=function(t,e,i){var r,n;return null==i&&(i=null),L.mapbox.accessToken||(L.mapbox.accessToken=window._maps_api),i=i||this.createLayer(),e.accessToken=window._maps_api,n=e.zoomControl,e.zoomControl=!1,r=L.mapbox.map(t,null,e),n&&(n=L.control.zoom({zoomInTitle:Strava.I18n.Locale.t("strava.maps.mapbox.zoom_in"),zoomOutTitle:Strava.I18n.Locale.t("strava.maps.mapbox.zoom_out")}),r.addControl(n)),i.addTo(r),r._tilejson={id:i.mapId},r},i.prototype.createCircle=function(t,e,i){var r,n,a;return r=this.createLatLng(e.lat,e.lng),a={stroke:!0,color:this.color(),opacity:this.opacity(),weight:this.weight(),fill:!0,fillColor:this.fillColor(),fillOpacity:this.fillOpacity(),radius:t},n=L.circle(r,t,a),i.implementor().addLayer(n),n},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.Map=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.touchZoom(this.isTouchDevice()),this.layers={}}var r;return t(i,e),r={dragging:!0,attributionControl:!0,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!0,boxZoom:!0,zoomControl:!0,maxZoom:19,center:null,canvas:null,bounds:null,rabbit:null,zoom:14,defaultLayer:"terrain"},i.prototype.initialize=function(){var t,e,i;return t=this.canvas()[0],i={attributionControl:this.attributionControl(),dragging:this.dragging(),touchZoom:this.touchZoom(),scrollWheelZoom:this.scrollWheelZoom(),doubleClickZoom:this.doubleClickZoom(),boxZoom:this.boxZoom(),zoomControl:this.zoomControl(),maxZoom:this.maxZoom(),zoom:this.zoom(),center:this.center()},this.layers.standard=this.createLayer("standard"),this.layers.terrain=this.createLayer("terrain"),this.layers.satellite=this.createLayer("satellite"),this.layers.runbikehike=this.createLayer("run-bike-hike"),this.layers[this.defaultLayer()]||(this.layers[this.defaultLayer()]=this.createLayer(this.defaultLayer())),e=this.layers[this.defaultLayer()],e||(e=this.layers.terrain),this.instance=this.createMap(t,i,e),this},i.prototype.implementor=function(){return this.instance},i.prototype.setLayer=function(t){var e,i,r,n;r=this.layers;for(e in r)n=r[e],this.instance.removeLayer(n);return i=this.layers[t],i||(i=this.layers.terrain),this.instance._tilejson=i._tilejson,this.instance.addLayer(i)},i.prototype.getCenter=function(){return this.getBounds().getCenter()},i.prototype.getBounds=function(){return this.instance.getBounds()},i.prototype.fitBounds=function(t,e){return null==e&&(e={}),e.maxZoom=18,this.bounds(t),this.instance.fitBounds(t,e),this},i.prototype.latlngToLayerPoint=function(t){return this.implementor().latLngToLayerPoint(t)},i.prototype.setZoom=function(t){return this.instance.setZoom(t)},i.prototype.getZoom=function(){return this.instance.getZoom()},i.prototype.resize=function(){return null!=this.bounds()?(this.implementor().invalidateSize({}),this.implementor().fitBounds(this.bounds())):void 0},i.prototype.setView=function(t,e){return null==e&&(e=12),this.instance.setView(t,e)},i.prototype.panTo=function(t){return this.instance.panTo(t)},i.prototype.enteredFullScreen=function(t){var e,i;return i=this.canvas().outerHeight(),e=t>0?i+t:i,this.canvas().css({height:Math.max(300,e)}),this.implementor().scrollWheelZoom.enable(),this.resize()},i.prototype.exitedFullScreen=function(t){return this.canvas().css({height:t}),this.scrollWheelZoom()||this.implementor().scrollWheelZoom.disable(),this.resize()},i.prototype.addCustomControl=function(t){var e;return t.map(this),e=t.render().el,this.canvas().append(e),this},i.prototype.whenReady=function(t){return this.implementor().whenReady(t)},i.prototype.addLayer=function(t){return t.addTo(this.implementor())},i.createLayer=function(t,e){var i,r;return i={},e.version&&(i.v=e.version),e.px&&(i.px=e.px),r=e.detectRetina&&L.Browser.retina?"@2x.png":".png",L.tileLayer(t+"/{z}/{x}/{y}"+r+"?"+jQuery.param(i),e)},i.prototype.fireEvent=function(t,e){return this.implementor().fireEvent(t,e)},i.prototype.getRabbit=function(t,e){var i,r;return i=this.createLatLng(t,e),null!=this.rabbit()?this.rabbit().move(i):(r=Strava.Maps.Mapbox.Icon.createRabbit(i,this),this.rabbit(r)),this.rabbit()},i}(Strava.Maps.Mapbox.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.NonInteractiveMap=function(e){function i(){i.__super__.constructor.call(this),this.dragging(!1),this.touchZoom(!1),this.scrollWheelZoom(!1),this.doubleClickZoom(!1),this.zoomControl(!1)}return t(i,e),i}(Strava.Maps.Mapbox.Map)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.PrivacyZone=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={color:"#FF0000",opacity:.8,weight:1,fillColor:"#FF0000",fillOpacity:.35},i.prototype.create=function(t,e,i){return this.map=i,this.circle=this.createCircle(t,e,i)},i.prototype.remove=function(){return this.map.implementor().removeLayer(this.circle)},i}(Strava.Maps.Mapbox.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.PrivacyZoneControl=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.view(t),this.view().bind("togglePrivacy",function(t){return function(e){return t.handleTogglePrivacy(e)}}(this))}var r;return t(i,e),r={zones:null,overlays:[],view:null},i.prototype.removeZones=function(){var t,e,i,r;for(r=this.overlays(),t=0,e=r.length;e>t;t++)i=r[t],i.remove();return this.overlays([])},i.prototype.showZones=function(){var t,e,i,r,n;for(i=this.zones(),r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(this.createPrivacyZone(n));return r},i.prototype.createPrivacyZone=function(t){var e;return e=new Strava.Maps.Mapbox.PrivacyZone,e.create(t.radius,t.position,this.view().map()),this.overlays().push(e)},i.prototype.handleTogglePrivacy=function(t){return t?this.showZones():this.removeZones()},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.MapBox"),Strava.Maps.Mapbox.CustomControlView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.changeMapType=function(t){return this.map().setLayer(this.mapTypeIdMap(t))},i.prototype.mapTypeIdMap=function(t){var e;return e={terrain:"terrain",standard:"standard",satellite:"satellite",runbikehike:"run-bike-hike"},e[t]},i.prototype.render=function(){return i.__super__.render.call(this),this.$el.addClass("mapbox-container"),this},i}(Strava.Maps.CustomControlView)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),L.Path.CLIP_PADDING=3,Strava.Maps.Mapbox.Polyline=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.path([]),this.map(t)}var r;return t(i,e),r={map:null,path:null,color:"#FF0000",tight:!1,bounds:null,opacity:1,weight:3,clickable:!1,callback:function(){},centered:!0,encoded:!1,zIndex:0,implementor:null},i.prototype.hide=function(){return this.map().implementor().removeLayer(this.implementor())},i.prototype.hideFromMap=function(t){return t.implementor().removeLayer(this.implementor())},i.prototype.show=function(){return this.implementor().addTo(this.map().implementor()),this},i.prototype.showOnMap=function(t){return this.implementor().addTo(t.implementor()),this},i.prototype.setMap=function(t){return this.implementor().setMap(t),this},i.prototype.toggle=function(){return this.map().implementor().hasLayer(this.implementor())?this.hide():this.show()},i.prototype.setColor=function(t){return this.implementor().setStyle({color:t}),this},i.prototype.setOpacity=function(t){return this.implementor().setStyle({opacity:t}),this},i.prototype.bringToFront=function(){return this.implementor().bringToFront(),this},i.prototype.bringToBack=function(){return this.implementor().bringToBack(),this
},i.prototype.getLength=function(){return this.path().length},i.prototype.getAt=function(t){return this.path()[t]},i.prototype.distanceFrom=function(t){var e,i,r,n,a,s,o,l,c;for(o=this.path(),i=this.map().latlngToLayerPoint(t),s=1/0,r=n=0,a=o.length;a>n;r=++n)t=o[r],r<o.length-2&&(c=this.map().latlngToLayerPoint(o[r]),l=this.map().latlngToLayerPoint(o[r+1]),e=L.LineUtil.pointToSegmentDistance(i,c,l),s>e&&(s=e));return s},i.prototype.first=function(){return this.path()[0]},i.prototype.last=function(){return this.path()[this.getLength()-1]},i.prototype.setPath=function(t){return this.implementor().setLatLngs(t),this.bounds(null)},i.prototype.handlePathClick=function(){},i.prototype.handlePathMouseOver=function(){},i.prototype.createSubPath=function(t,e){var i,r,n,a,s,o,l,c;for(n=this.getLength(),c=0>t?0:t,i=e>n?n:e,s=[],a=r=o=c,l=i;l>=o?l>r:r>l;a=l>=o?++r:--r)s.push(this.getAt(a));return s},i.prototype.createPathBounds=function(t,e){var i,r,n,a,s,o,l,c;for(a=this.getLength(),c=0>t?0:t,r=e>a?a:e,i=this.createBounds(),s=n=o=c,l=r;l>=o?l>n:n>l;s=l>=o?++n:--n)i.extend(this.getAt(s));return i},i.prototype.center=function(){return this.implementor()?(this.bounds()||(this.bounds(this.createBounds()),this.implementor().getLatLngs().forEach(function(t){return function(e){return e?t.bounds().extend(e):void 0}}(this))),this.map()?this.map().fitBounds(this.bounds(),{animate:!1}):void 0):void 0},i.prototype.setImplementor=function(){var t;return t={color:this.color(),opacity:this.opacity(),weight:this.weight(),clickable:this.clickable()},this.implementor(new L.Polyline(this.path(),t)),this.centered()&&this.center(),this.callback()(this),this},i}(Strava.Maps.Mapbox.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.Path=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),this.context=e,this.initializeAttributes(r)}var r;return t(i,e),r={start:null,end:null,startIcon:null,endIcon:null,markers:[],dependentColor:"#105CB6",dependentBackgroundColor:"#FF0000",hidden:!1,dependents:{},highlight:null,rabbit:null,orangeRabbit:null,secondOrangeRabbit:null},i.prototype.setImplementor=function(){return i.__super__.setImplementor.call(this),this.setColor(this.color()),this.setOpacity(this.opacity()),this.start()&&this.setStart(this.start()),this.end()&&this.setEnd(this.end()),this.hidden()&&this.hide(),this.markers()&&this.setMarkers(),this},i.prototype.getDependent=function(t,e){return this.dependents()[t+"|"+e]},i.prototype.setDependent=function(t,e,i){return this.dependents()[t+"|"+e]=i},i.prototype.hideDependent=function(t,e){var i;return(i=this.getDependent(t,e))?(i.hide(),this.setColor(this.color()),this.center()):void 0},i.prototype.hideAllDependents=function(t){var e,i,r;null==t&&(t=!0),i=this.dependents();for(e in i)r=i[e],r.hide();return t?this.center():void 0},i.prototype.showDependent=function(t,e,i){var r,n;return i=null!=i?i:!0,this.hideAllDependents(i),e<this.path().length?(this.setColor(this.dependentBackgroundColor()),r=this.getDependent(t,e),r||(n=this.createSubPath(t,e),r=new Strava.Maps.Mapbox.Polyline(this.map()),r.path(n).centered(i).color(this.dependentColor()).setImplementor(),this.setDependent(t,e,r)),r.show(),i&&r.center(),r.bringToFront().setColor(this.dependentColor())):void 0},i.prototype.setHighlight=function(){},i.prototype.hide=function(){var t,e,r,n,a,s,o,l;for(i.__super__.hide.call(this),s=this.markers(),e=0,n=s.length;n>e;e++)a=s[e],a.hide();o=this.dependents(),l=[];for(r in o)t=o[r],l.push(t.hide());return l},i.prototype.show=function(){var t,e,r,n,a,s,o,l;for(i.__super__.show.call(this),s=this.markers(),e=0,n=s.length;n>e;e++)a=s[e],a.show();o=this.dependents(),l=[];for(r in o)t=o[r],l.push(t.show());return l},i.prototype.setStart=function(){var t;return t=Strava.Maps.Mapbox.Icon.createStart(this.first(),this.map()),this.startIcon(t),this.startIcon().addClickListener(function(t){return function(e){return t.handleIconClick(e)}}(this)),this.markers().push(t)},i.prototype.handleIconClick=function(t){var e,i,r;return e=t.position().lat,i=t.position().lng,r=t.index(),this.eventDispatcher.dispatchMarkerClick(this,r,e,i)},i.prototype.setEnd=function(){var t;return t=Strava.Maps.Mapbox.Icon.createEnd(this.last(),this.map()),this.endIcon(t),this.endIcon().addClickListener(function(t){return function(e){return t.handleIconClick(e)}}(this)),this.markers().push(t)},i.prototype.setMarkers=function(){},i.prototype.setEventDispatcher=function(t){return this.eventDispatcher=t,this.bind("pathclick",function(t){return function(e){return t.handlePathClick(e)}}(this)),this.bind("mouseover",function(t){return function(e){return t.handleMouseOver(e)}}(this)),this.eventDispatcher.addListener(this,this),this},i.prototype.getRabbit=function(t,e){var i,r;return i=this.createLatLng(t,e),null==this.rabbit()&&(r=Strava.Maps.Mapbox.Icon.createRabbit(i,this.map()),this.rabbit(r)),this.rabbit().move(i)},i.prototype.getOrangeRabbit=function(t,e){var i;return i=this.createLatLng(t,e),null==this.orangeRabbit()&&this.orangeRabbit(Strava.Maps.Mapbox.Icon.createOrangeRabbit(this.createLatLng(t,e),this.map())),this.orangeRabbit().move(i)},i.prototype.getSecondOrangeRabbit=function(t,e){var i;return i=this.createLatLng(t,e),null==this.secondOrangeRabbit()&&this.secondOrangeRabbit(Strava.Maps.Mapbox.Icon.createOrangeRabbit(this.createLatLng(t,e),this.map())),this.secondOrangeRabbit().move(i)},i.prototype.handlePathClick=function(){},i.prototype.handleMouseOver=function(){},i.prototype.handleStreamMouseOver=function(t,e){return this.context.latLngAt(e,function(t){return function(e,i){var r;return r=t.getRabbit(e,i),r.show(),r.move(t.createLatLng(e,i))}}(this))},i.prototype.handleStreamMouseOut=function(){return null!=this.rabbit()?this.rabbit().hide():void 0},i.prototype.handleStreamClick=function(){},i.prototype.handleStreamDoubleClick=function(){},i.prototype.handleStreamSelect=function(t,e,i){return this.showDependent(e,i)},i.prototype.handleStreamUnselect=function(t,e,i){return this.hideDependent(e,i)},i.prototype.handleZoomSelect=function(t,e,i){return this.showDependent(e,i)},i.prototype.handleZoomUnselect=function(){return this.hideAllDependents()},i.prototype.handleStreamHover=function(t,e,i){return this.showDependent(e,i,!1)},i.prototype.handleStreamHoverOut=function(){return this.hideAllDependents(!1)},i.prototype.handleStreamSlide=function(t,e){var i,r,n,a,s,o;return i=e[0],r=e[1],o=null,a=this.context.streamsContext().data.data.latlng[r.startIndex],null!=a&&(n=a[0],s=a[1],o="activityOne"===i.name?this.getOrangeRabbit(n,s):(i.name="activityTwo")?this.getSecondOrangeRabbit(n,s):void 0),null!=o?o.show():void 0},i.prototype.handleStreamSlideReset=function(){return null!=this.orangeRabbit()&&this.orangeRabbit().hide(),null!=this.secondOrangeRabbit()?this.secondOrangeRabbit().hide():void 0},i.prototype.handleEstimateStreamMouseOver=function(t,e){var i;return i=this.getRabbit(e[0],e[1]),i.show(),i.move(this.createLatLng(e[0],e[1]))},i}(Strava.Maps.Mapbox.Polyline)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.Activity=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),this.clickable(!0),this.start("start"),this.end("end")}return t(i,e),i}(Strava.Maps.Mapbox.Path)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.Route=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),this.clickable(!0),this.start("start"),this.end("end")}return t(i,e),i}(Strava.Maps.Mapbox.Path)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox"),Strava.Maps.Mapbox.Beacon=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),this.centered(!1),this.clickable(!0),this.start("start"),this.end("end"),this.endIconType="blink-rabbit"}var r;return t(i,e),r=18,i.prototype.show=function(){return i.__super__.show.call(this)},i.prototype.setEnd=function(){var t;return t="blink-rabbit"===this.endIconType?Strava.Maps.Mapbox.Icon.createBeaconRabbit(this.last(),this.map()):"no-blink-rabbit"===this.endIconType?Strava.Maps.Mapbox.Icon.createRabbit(this.last(),this.map()):Strava.Maps.Mapbox.Icon.createEnd(this.last(),this.map()),t.show(),this.endIcon(t),this.endIcon().addClickListener(function(t){return function(e){return t.handleIconClick(e)}}(this)),this.markers().push(t)},i.prototype.recenterToEndpoint=function(){if(!this.context.latlngStream())throw"Error: missing stream.";return this.map().panTo(this.last())},i.prototype.refocusToEndpoint=function(t){var e;if(null==t&&(t=r),!this.context.latlngStream())throw"Error: missing stream.";return e=this.last(),this.map().setView([e.lat,e.lng],t)},i.prototype.updateStreamData=function(t){var e,i,r,n,a;if(this.path().length!==t.length){for(e=i=n=this.path().length,a=t.length;a>=n?a>i:i>a;e=a>=n?++i:--i)r=this.createLatLng(t[e][0],t[e][1]),this.path().push(r);return this.implementor().setLatLngs(t),this.bounds(null)}},i.prototype.updateMarkers=function(){return this.markers().forEach(function(){return function(t){return t.remove()}}(this)),this.start()&&this.setStart(this.start()),this.end()?this.setEnd(this.end()):void 0},i}(Strava.Maps.Mapbox.Path)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox.Construction"),Strava.Maps.Mapbox.Construction.StreamPathBuilder=function(e){function i(t,e){this.map=t,this.context=e,i.__super__.constructor.call(this),this.polyline=null}return t(i,e),i.prototype.buildStreamPath=function(t,e){return null==e&&(e={}),this.polyline=new t(this.map,this.context),null!=e.polylineColor&&this.polyline.color(e.polylineColor),null!=e.hideEndpoints&&this.polyline.start(null).end(null),this.context.path(this.polyline),this},i.prototype.buildActivity=function(t){return null==t&&(t={}),this.buildStreamPath(Strava.Maps.Mapbox.Activity,t)},i.prototype.buildRoute=function(t){return null==t&&(t={}),this.buildStreamPath(Strava.Maps.Mapbox.Route,t)},i.prototype.buildBeacon=function(t){return null==t&&(t={}),this.buildStreamPath(Strava.Maps.Mapbox.Beacon,t)},i.prototype.end=function(){return this.polyline.show(),this.polyline},i.prototype.start=function(){return this.polyline=null,this},i.prototype.buildFromStream=function(t){return this.polyline?(t.each(function(t){return function(e,i,r){var n;return n=t.createLatLng(i,r),n.index=e,t.polyline.path().push(n)}}(this)),this.polyline.setImplementor(),this):this},i.prototype.addMarkers=function(){return this},i.prototype.setEventDispatcher=function(t){return this.polyline?(this.polyline.setEventDispatcher(t),this):this},i}(Strava.Maps.Mapbox.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Maps.StreetViewControlHandler=function(e){function i(t){this.eventDispatcher=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.useStart=function(t,e){return this.start={lat:t,lng:e}},i.prototype.useEnd=function(t,e){return this.end={lat:t,lng:e}},i.prototype.handleShowStartStreetView=function(){return null!=this.start?this.eventDispatcher.dispatchMarkerClick(this,"start",this.start.lat,this.start.lng):void 0},i.prototype.handleShowEndStreetView=function(){return null!=this.end?this.eventDispatcher.dispatchMarkerClick(this,"end",this.end.lat,this.end.lng):void 0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps.Mapbox.Construction"),Strava.Maps.Mapbox.Construction.MapFactory=function(e){function i(t,e,n,a){if(this.context=t,this.canvas=e,this.pageContext=null!=n?n:null,this.mbr=null!=a?a:null,i.__super__.constructor.call(this),this.initializeAttributes(r),null==this.canvas[0])throw"Missing map canvas";this.map=null,this.streamPath=null,null!=this.context&&this.context.bind("ready",function(t){return function(){return t.handleStreamsReady()}}(this))}var r;return t(i,e),r={showFullScreenToggle:!0,showGpxDownload:!0,showPrivacyToggle:!0,interactiveMap:!0,showLayerSelector:!0,defaultLayer:"terrain",polylineColor:null,isRoute:!1,isBeacon:!1},i.prototype.handleStreamsReady=function(){return this.createMap(!0)},i.prototype.createMap=function(t,e){var i;return this.buildMap(),this.addCustomControl(),null!=e&&this.map.fitBounds(e),t&&(i=this.addStreamPath({polylineColor:this.polylineColor()}),this.updateStreetViewControl()),this.context.map(this.map)},i.prototype.buildMap=function(){return null==this.map?(this.map=this.interactiveMap()?new Strava.Maps.Mapbox.Map:new Strava.Maps.Mapbox.NonInteractiveMap,this.map.defaultLayer(this.defaultLayer()),this.map.canvas(this.canvas).initialize()):void 0},i.prototype.initializeMap=function(){var t,e,i,r,n,a,s;return this.mbr?(n=this.mbr[0],e=n[0],i=n[1],s=Strava.Maps.Mapbox.Base.createLatLng(e,i),a=this.mbr[1],e=a[0],i=a[1],r=Strava.Maps.Mapbox.Base.createLatLng(e,i),t=Strava.Maps.Mapbox.Base.createBounds(s,r),this.createMap(this.context.latlngStream().ready(),t),this):this},i.prototype.getMap=function(){return this.map},i.prototype.getStreamPath=function(){return this.streamPath},i.prototype.addStreamPath=function(){var t;return t=new Strava.Maps.Mapbox.Construction.StreamPathBuilder(this.map,this.context),this.isRoute()?t.buildRoute({polylineColor:this.polylineColor()}):this.isBeacon()?t.buildBeacon({polylineColor:this.polylineColor()}):t.buildActivity({polylineColor:this.polylineColor()}),this.streamPath=t.buildFromStream(this.context.latlngStream()).addMarkers(this.context.activityData()).setEventDispatcher(this.context.eventDispatcher()).end()},i.prototype.updateStreetViewControl=function(){var t,e,i;if(null!=this.streetViewControlHandler&&this.context.latlngStream()&&(e=this.context.latlngStream(),i=e.first(),t=e.end(),i&&t))return this.streetViewControlHandler.useStart(i.lat,i.lng),this.streetViewControlHandler.useEnd(t.lat,t.lng)},i.prototype.addCustomControl=function(){var t,e,i;if(this.interactiveMap()&&this.showLayerSelector()&&null==this.customControl)return i=(new Strava.Maps.CustomControlOptions).useGoogle(!1).isOwner(this.context.isOwner()).privacyZones(this.context.privacyZones()).toHash(),this.customControl=new Strava.Maps.Mapbox.CustomControlView(i.controlsTemplate,this.pageContext,this.showFullScreenToggle(),this.showGpxDownload(),this.showPrivacyToggle()),this.streetViewControlHandler=new Strava.Maps.StreetViewControlHandler(this.context.eventDispatcher()),this.customControl.bind("showStartStreetView",function(t){return function(){return t.streetViewControlHandler.handleShowStartStreetView()}}(this)),this.customControl.bind("showEndStreetView",function(t){return function(){return t.streetViewControlHandler.handleShowEndStreetView()}}(this)),this.showGpxDownload()&&(e=(new Strava.Activities.Gpx.DownloadHandler).premium(this.context.isPremium()).activityId(this.context.activityId()).name(""),this.customControl.bind("gpxDownload",e.handler())),this.showFullScreenToggle()&&(t=Strava.Maps.FullScreenHandler.getInstance(this.customControl),this.customControl.bind("toggleFullScreen",t.handler())),i.privacyZonesEnabled&&new Strava.Maps.Mapbox.PrivacyZoneControl(this.customControl).zones(this.context.privacyZones()),this.map.addCustomControl(this.customControl)},i.prototype.createNoActivityMap=function(t,e){var i;return i=Strava.Maps.Mapbox.NonInteractiveMap,this.interactiveMap()&&(i=Strava.Maps.Mapbox.Map),t=Strava.Maps.Mapbox.Map.createLatLng(t.lat,t.lng),this.map=(new i).zoom(e).center(t),this.map.canvas(this.canvas).initialize()},i.prototype.createPrivacyZone=function(){return new Strava.Maps.Mapbox.PrivacyZone},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.Charts.Activities.SegmentEffort=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),e.require(this.context.zoomStreamTypes()),this.builder.width(440).height(85).xAxisTicks(5).animate(!1)}return t(i,e),i.prototype.showSegment=function(t,e){return i.__super__.showSegment.call(this,t,e),this.builder.zoomWithPadding(t,e)},i.prototype.hideSegment=function(t,e){return i.__super__.hideSegment.call(this,t,e),this.builder.resetZoom()},i}(Strava.Charts.Activities.Activity)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/elevation_chart_no_controls"]=function(t){return function(){var t;return t=[],t.push("<div class='base-chart' id='elevation-chart'></div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortChartView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t,e){return this.context=t,this.streamsRequest=e,this.template="activities/elevation_chart_no_controls",this.streamsRequest.onReady(function(t){return function(){return t.$$(".streams-loader").remove()}}(this))},i.prototype.render=function(){return this.renderTemplate(),this.chart=new Strava.Charts.Activities.SegmentEffort(this.context,this.streamsRequest),this.chart.render(this.$el),null!=this.start&&null!=this.end&&this.streamsRequest.onReady(function(t){return function(){return t.chart.showSegment(t.start,t.end)}}(this)),this.streamsRequest.request(),this},i.prototype.showSegment=function(t,e){return this.start=t,this.end=e,this},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortDetailContext=function(){function t(t,e,i,r){this.power=t,this.streams=e,this.isOwner=i,this.chartContext=r}return t.prototype.isPowerVisible=function(){return this.power.visible},t.prototype.convertStreamIndices=function(t){return this.chartContext.convertStreamIndices(t)},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortDetailViewModel=function(){function t(t,e,i){this.context=t,this.model=e,this.initiallyHidden=i}return t.prototype.rowSelector=function(){return"tr[data-segment-effort-id='"+this.model.id+"']"},t.prototype.indices=function(){return this.model.indices()},t.prototype.convertedIndices=function(){return this.context.convertStreamIndices(this.model.indices())},t.prototype.isPR=function(){return this.model.get("pr")},t.prototype.isHazard=function(){return this.model.get("hazard_segment")},t.prototype.isWaived=function(){return this.model.get("hazard_waived")},t.prototype.isRestricted=function(){return this.model.get("restricted_segment")},t.prototype.goalDetail=function(){return{goal_detail:{segment_id:this.model.get("segment_id"),segment_name:this.model.get("name")}}},t.prototype.summarize=function(){var t,e,i,r,n;return this.model.set("is_owner",this.context.isOwner),this.model.set("power_visible",this.context.isPowerVisible()),this.context.isPowerVisible()?(t=this.convertedIndices(),i=this.context.streams.streamData.maxForInterval("watts",t[0],t[1]),this.model.set({max_watts:i})):this.model.unset("max_watts"),this.model.set("is_leaderboard_hidden",this.isLeaderboardHidden()),r=this.context.convertStreamIndices([this.model.get("start_index"),this.model.get("end_index")]),n=r[0],e=r[1],_.extend(this.model.toJSON(),{start_index:n,end_index:e})},t.prototype.isLeaderboardHidden=function(){return this.isHazard()&&!this.isWaived()||this.isRestricted()},t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/detail_ride"]=function(t){return function(){var t,e,i,r;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <div class='effort-details spans9'>\n    <div class='row'>\n      <div class='spans8 this-effort'>\n        <div class='row'>\n          <div class='spans-half'>\n            <time class='current-effort'>"+t(this.segmentEffort.elapsed_time)+"</time>\n            <span class='label marginless'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.this_effort")))),i.push("            </span>\n          </div>\n          <div class='spans-half'>\n            <time class='moving-time'>"+t(this.segmentEffort.moving_time)+"</time>\n            <span class='label marginless'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.moving_time")))),i.push("            </span>\n          </div>\n        </div>\n        <div class='btn-group btn-group-justified effort-actions'>"),this.hidden?(i.push("          <div class='analysis-link-js btn-xs button' data-start-id='"+e(t(this.segmentEffort.start_index))+"' data-end-id='"+e(t(this.segmentEffort.end_index))+"' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.view_analysis")))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.analyze_effort")))),i.push("          </div>")):(i.push("          <div class='analysis-link-js btn-xs button' data-segment-effort-id='"+e(t(this.segmentEffort.id))+"' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.view_analysis")))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.analyze_effort")))),i.push("          </div>")),this.segmentEffort.downhill_ride_segment||this.segmentEffort.hazard_segment||this.segmentEffort.private_segment||(this.segmentEffort.goal?(i.push("          <div class='button compact segment-goal-link'>"),i.push("            "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.goal_html",{url:"/goals/segment/"+this.segmentEffort.goal.id,target:this.segmentEffort.goal.display_target}))),i.push("          </div>")):(i.push("          <div class='btn-xs button set-goal'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.set_goal")))),i.push("          </div>"))),i.push("        </div>"),this.raceShapeHref&&!this.segmentEffort.hazard_segment&&(i.push("        <a class='btn-block btn-xs button raceshape-btn' href='"+e(t(this.raceShapeHref))+"'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.compare_efforts")))),i.push("        </a>")),!this.upsellTrainingPlan||this.segmentEffort.downhill_ride_segment||this.segmentEffort.hazard_segment||this.segmentEffort.private_segment||(i.push("        <a class='btn-block btn-xs button training-plans-btn' href='/training-plans/cycling'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.improve_time")))),i.push("        </a>")),i.push("      </div>\n      <table class='spans8 unstyled'></table>\n    </div>\n    <div class='charts row'>\n      <div class='effort-elevation-profile'>\n        <div class='base-chart'>\n          <div class='streams-loader'>"),i.push("            "+t(this.renderPartial("partials/spinner_tag"))),i.push("          </div>\n        </div>\n      </div>\n      <div class='effort-map'>\n        <div class='streams-loader'>"),i.push("          "+t(this.renderPartial("partials/spinner_tag"))),i.push("        </div>\n      </div>\n    </div>\n  </div>\n  <div class='spans7'>"),this.segmentEffort.is_leaderboard_hidden?(i.push("    <div class='alert-message mb-md warning'>\n      <p>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.hazard")))+"</p>\n      <p>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.hazard_prompt")))),i.push("        <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"?show_waiver=1'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.proceed")))+"</a>\n      </p>\n    </div>")):(this.segmentEffort.hazard_segment&&this.segmentEffort.hazard_waived&&(r=(new Strava.I18n.DateTimeFormatter).format(new Date(this.segmentEffort.hazard_waived_date),{format:"date",type:"short"}),i.push("    <div class='alert-message mb-md warning'>\n      <p>"+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.hazard_waived_html",{date:r}))+"</p>\n    </div>")),i.push("    <div class='leader-board-container'>\n      <h4 class='leaderboard-header'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.top_10")))),i.push("      </h4>\n      <div class='leaderboard'>\n        <div class='leaderboard-loader'>"),i.push("          "+t(this.renderPartial("partials/spinner_tag"))),i.push("        </div>\n      </div>\n    </div>")),i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/detail_run"]=function(t){return function(){var t,e,i,r,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=function(t){return function(e,i,r){return window.HAML.succeed.call(t,e,i,r)}}(this),i=[],i.push("<a class='dismiss topright' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.close")))+"'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.close")))),i.push("</a>\n<div class='bottomless inset'>\n  <h2>\n    <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"' title='"+e(t(this.segmentEffort.name))+"'>"+e(t(this.segmentEffort.name))+"</a>\n  </h2>\n  <div class='stats'>\n    <span>"+t(this.segmentEffort.distance)+"</span>\n    <span>"+t(this.segmentEffort.elev_difference)+"</span>\n    <span>"+t(this.segmentEffort.avg_grade)+"</span>"),this.segmentEffort.downhill_ride_segment||this.segmentEffort.hazard_segment||this.segmentEffort.private_segment||(i.push("    <span class='segment-goal-link'>"),this.segmentEffort.goal?(i.push("      "+e(t(n(":",function(){var i;return i=[],i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.upcoming_goal")))),i.join("\n")})))),i.push("      <a href='/goals/segment/"+e(t(this.segmentEffort.goal.id))+"'>"+t(this.segmentEffort.goal.display_target)+"</a>")):i.push("      <a class='set-goal' href='javascript:;'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.set_goal")))+"</a>"),i.push("    </span>")),i.push("  </div>\n</div>\n<div class='container-fluid'>\n  <div class='effort-details row'>"),this.segmentEffort.is_owner?(i.push("    <div class='spans8'>\n      <div class='this-effort'>\n        <div>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.this_effort")))+"</div>\n        <time>\n          <div class='app-icon icon-at-pr-1 icon-sm tipsy-enabled' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.pr")))+"' style='display: none'></div>"),i.push("          "+t(this.segmentEffort.elapsed_time)),i.push("        </time>\n      </div>\n    </div>")):(i.push("    <div class='spans8'>"),i.push("      "+t(this.renderPartial("partials/current_athlete_avatar"))),i.push("      <div class='this-effort'>\n        <div>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.this_effort")))+"</div>\n        <time>"+t(this.segmentEffort.elapsed_time)+"</time>\n        <div class='pr' style='display: none'>\n          <strong>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.pr")))+"</strong>"),i.push("          "+t(this.segmentEffort.overall_time)),i.push("        </div>\n      </div>\n    </div>")),i.push("    <div class='spans7'>\n      <table class='dense'></table>\n    </div>\n  </div>\n</div>\n<div class='inset'>"),this.segmentEffort.is_leaderboard_hidden?(i.push("  <div class='inset leaderboard-summary'>\n    <p>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.hazard")))+"</p>\n    <p>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.hazard_prompt")))),i.push("      <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"?show_waiver=1'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.proceed")))+"</a>\n    </p>\n  </div>")):(i.push("  <div class='inset leaderboard-summary'>"),this.segmentEffort.hazard_segment&&this.segmentEffort.hazard_waived&&(r=(new Strava.I18n.DateTimeFormatter).format(new Date(this.segmentEffort.hazard_waived_date),{format:"date",type:"short"}),i.push("    <div class='alert-message mb-md warning'>\n      <p>"+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_ride.hazard_waived_html",{date:r}))+"</p>\n    </div>")),i.push("    <div class='centered global-records'>\n      <span id='kom'>\n        <abbr title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.cr")))+"'>"),i.push("          "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.cr_abbr.male_html"))),i.push("        </abbr>\n        <time>"),i.push(this.segmentEffort.kom_time?"          "+t(this.segmentEffort.kom_time):"          &mdash;"),i.push("        </time>\n      </span>\n      <div class='app-icon icon-at-kom-1 icon-md'></div>\n      <span id='qom'>\n        <abbr title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.cr")))+"'>"),i.push("          "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.cr_abbr.female_html"))),i.push("        </abbr>\n        <time>"),i.push(this.segmentEffort.qom_time?"          "+t(this.segmentEffort.qom_time):"          &mdash;"),i.push("        </time>\n      </span>\n    </div>"),this.segmentEffort.is_owner?(i.push("    <div class='personal-records rank'>"),i.push("      "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.my_pr_html"))),i.push("      <time>"),i.push(this.segmentEffort.overall_time?"        "+t(this.segmentEffort.overall_time):"        &mdash;"),i.push("      </time>\n      <br>\n      <strong>"),i.push(this.segmentEffort.overall_rank?"        "+t(this.segmentEffort.overall_rank):"        &mdash;"),i.push("      </strong>"),i.push("      "+e(t("/"+this.segmentEffort.overall_count))),i.push("    </div>")):(i.push("    <div class='compare-records row'>\n      <div class='rank spans8'>"),i.push("        "+t(this.renderPartial("partials/current_athlete_avatar"))),i.push("        "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.pr_html"))),i.push("        <time>"),i.push(this.segmentEffort.overall_time?"          "+t(this.segmentEffort.overall_time):"          &mdash;"),i.push("        </time>\n        <br>\n        <strong>"),i.push(this.segmentEffort.overall_rank?"          "+t(this.segmentEffort.overall_rank):"          &ndash;"),i.push("        </strong>"),i.push("        "+e(t("/"+this.segmentEffort.overall_count))),i.push("      </div>\n      <div class='rank spans8'>"),i.push("        "+t(this.renderPartial("partials/current_athlete_avatar",{athlete:this.currentAthlete}))),i.push("        "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.pr_html"))),i.push("        <time>"),i.push(this.segmentEffort.viewer_overall_time?"          "+t(this.segmentEffort.viewer_overall_time):"          &mdash;"),i.push("        </time>\n        <br>\n        <strong>"),i.push(this.segmentEffort.viewer_overall_rank?"          "+t(this.segmentEffort.viewer_overall_rank):"          &ndash;"),i.push("        </strong>"),i.push("        "+e(t("/"+this.segmentEffort.viewer_overall_count))),i.push("      </div>\n    </div>")),i.push("  </div>\n  <div class='link-menu no-margins row'>\n    <div class='spans8'>\n      <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"?filter=overall'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.overall")))),i.push("      </a>\n    </div>\n    <div class='spans8'>\n      <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"?filter=following'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.following")))),i.push("      </a>\n    </div>\n    <div class='spans8'>\n      <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"?filter=my_results'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.my_results")))),i.push("      </a>\n    </div>\n    <div class='spans8'>\n      <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"?filter=age_group'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.by_age_group")))),i.push("        <div class='badge premium tiny' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.premium_feature_title_v2")))+"'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.premium_feature_v2")))),i.push("        </div>\n      </a>\n    </div>"),this.raceShapeHref&&!this.segmentEffort.hazard_segment&&(i.push("    <div class='spans8'>\n      <a href='"+e(t(this.raceShapeHref))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_run.compare_efforts")))),i.push("      </a>\n    </div>")),i.push("  </div>")),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/detail_swim"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <div class='effort-details spans9'>\n    <div class='row'>\n      <div class='spans9 this-effort'>\n        <div class='row'>\n          <div class='spans-half'>\n            <time class='current-effort'>"+t(this.segmentEffort.elapsed_time)+"</time>\n            <span class='label marginless'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.this_effort")))),i.push("            </span>\n          </div>\n          <div class='spans-half'>\n            <time class='moving-time'>"+t(this.segmentEffort.moving_time)+"</time>\n            <span class='label marginless'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.moving_time")))),i.push("            </span>\n          </div>\n        </div>\n        <div class='effort-actions row'>"),this.hidden||(i.push("          <div class='spans-half'>\n            <span class='analysis-link-js button compact' data-segment-effort-id='"+e(t(this.segmentEffort.id))+"' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.view_analysis")))+"'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.analyze_effort")))),i.push("            </span>\n          </div>")),this.segmentEffort.downhill_ride_segment||this.segmentEffort.hazard_segment||this.segmentEffort.private_segment||(i.push("          <div class='segment-goal-link spans-half'>"),this.segmentEffort.goal?i.push("            "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.goal_html",{url:"/goals/segment/"+this.segmentEffort.goal.id,target:this.segmentEffort.goal.display_target}))):(i.push("            <span class='button compact set-goal'>\n              <span class='badge premium tiny'></span>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.set_goal")))),i.push("            </span>")),i.push("          </div>")),i.push("        </div>\n      </div>\n      <table class='spans7 unstyled'></table>\n    </div>\n    <div class='charts row'>\n      <div class='effort-map'>\n        <div class='streams-loader'>"),i.push("          "+t(this.renderPartial("partials/spinner_tag"))),i.push("        </div>\n      </div>\n    </div>\n  </div>\n  <div class='spans7'>"),this.segmentEffort.hazard_segment?i.push("    <div class='alert-message mb-md warning'>\n      <p>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.hazard")))+"</p>\n      <p class='note'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.hazard_note")))+"</p>\n      <p>\n        <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.view_segment_details")))+"</a>\n      </p>\n    </div>"):(i.push("    <h4 class='leaderboard-header'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_swim.top_10")))),i.push("    </h4>\n    <div class='leaderboard'>\n      <div class='leaderboard-loader'>"),i.push("        "+t(this.renderPartial("partials/spinner_tag"))),i.push("      </div>\n    </div>")),i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/detail_other"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <div class='effort-details spans9'>\n    <div class='row'>\n      <div class='spans8 this-effort'>\n        <div class='row'>\n          <div class='spans-half'>\n            <time class='current-effort'>"+t(this.segmentEffort.elapsed_time)+"</time>\n            <span class='label marginless'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.this_effort")))),i.push("            </span>\n          </div>\n          <div class='spans-half'>\n            <time class='moving-time'>"+t(this.segmentEffort.moving_time)+"</time>\n            <span class='label marginless'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.moving_time")))),i.push("            </span>\n          </div>\n        </div>\n        <div class='btn-group btn-group-justified effort-actions'>"),this.hidden||(i.push("          <div class='analysis-link-js btn-xs button' data-segment-effort-id='"+e(t(this.segmentEffort.id))+"' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.view_analysis")))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.analyze_effort")))),i.push("          </div>")),this.segmentEffort.downhill_ride_segment||this.segmentEffort.hazard_segment||this.segmentEffort.private_segment||(this.segmentEffort.goal?(i.push("          <div class='btn-xs button segment-goal-link spans-half'>"),i.push("            "+t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.goal_html",{url:"/goals/segment/"+this.segmentEffort.goal.id,target:this.segmentEffort.goal.display_target}))),i.push("          </div>")):(i.push("          <div class='btn-xs button set-goal'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.set_goal")))),i.push("          </div>"))),i.push("        </div>\n      </div>\n      <table class='spans8 unstyled'></table>\n    </div>\n    <div class='charts row'>\n      <div class='effort-elevation-profile'>\n        <div class='base-chart'>\n          <div class='streams-loader'>"),i.push("            "+t(this.renderPartial("partials/spinner_tag"))),i.push("          </div>\n        </div>\n      </div>\n      <div class='effort-map'>\n        <div class='streams-loader'>"),i.push("          "+t(this.renderPartial("partials/spinner_tag"))),i.push("        </div>\n      </div>\n    </div>\n  </div>\n  <div class='spans7'>"),this.segmentEffort.hazard_segment?i.push("    <div class='alert-message warning'>\n      <p>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.hazard")))+"</p>\n      <p class='note'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.hazard_note")))+"</p>\n      <p>\n        <a href='/segments/"+e(t(this.segmentEffort.segment_id))+"'>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.view_segment_details")))+"</a>\n      </p>\n    </div>"):(i.push("    <h4 class='leaderboard-header'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.detail_other.top_10")))),i.push("    </h4>\n    <div class='leaderboard'>\n      <div class='leaderboard-loader'>"),i.push("        "+t(this.renderPartial("partials/spinner_tag"))),i.push("      </div>\n    </div>")),i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/stats_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<thead>\n  <tr>\n    <th></th>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.avg")))+"</th>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.max")))+"</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.speed")))+"</th>\n    <td>"+t(this.segmentEffort.avg_speed)+"</td>\n    <td>"+t(this.segmentEffort.max_speed)+"</td>\n  </tr>"),this.segmentEffort.avg_cadence&&i.push("  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.cadence")))+"</th>\n    <td>"+e(t(this.segmentEffort.avg_cadence))+"</td>\n    <td>"+e(t(this.segmentEffort.max_cadence))+"</td>\n  </tr>"),(this.segmentEffort.avg_hr||this.segmentEffort.max_hr)&&(i.push("  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.heartrate")))+"</th>\n    <td>"),this.segmentEffort.avg_hr_raw?(i.push("      "+t(this.segmentEffort.avg_hr)),i.push("      <abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.beats_per_minute")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.beats_per_minute_abbr")))),i.push("      </abbr>")):i.push("      &mdash;"),i.push("    </td>\n    <td>"),this.segmentEffort.max_hr?(i.push("      "+t(this.segmentEffort.max_hr)),i.push("      <abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.beats_per_minute")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.beats_per_minute_abbr")))),i.push("      </abbr>")):i.push("      &mdash;"),i.push("    </td>\n  </tr>")),i.push("  <tr>\n    <th>"),i.push(this.segmentEffort.power_visible?"      "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.power"))):"      "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.est_power")))),i.push("    </th>\n    <td>"),i.push(this.segmentEffort.avg_watts_raw?"      "+t(this.segmentEffort.avg_watts):"      &mdash;"),i.push("    </td>\n    <td>"),this.segmentEffort.max_watts?(i.push("      "+e(t(this.segmentEffort.max_watts))),i.push("      <abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.watts")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.watts_abbr")))),i.push("      </abbr>")):i.push("      &mdash;"),i.push("    </td>\n  </tr>\n  <tbody class='more-stats'>"),this.segmentEffort.vam&&i.push("    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.vam")))+"</th>\n      <td>"+t(this.segmentEffort.vam)+"</td>\n      <td></td>\n    </tr>"),i.push("    <tr>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_ride.elev_diff")))+"</th>\n      <td>"+t(this.segmentEffort.elev_difference)+"</td>\n      <td></td>\n    </tr>\n  </tbody>\n</tbody>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/stats_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<thead>\n  <tr>\n    <th></th>\n    <th></th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_run.avg_pace")))+"</th>\n    <td>"+t(this.segmentEffort.avg_speed)+"</td>\n  </tr>"),this.segmentEffort.avg_hr_raw&&i.push("  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_run.heartrate")))+"</th>\n    <td>"+t(this.segmentEffort.avg_hr)+"</td>\n  </tr>"),i.push("</tbody>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/stats_swim"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<thead>\n  <tr>\n    <th></th>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_swim.avg")))+"</th>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_swim.max")))+"</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_swim.pace")))+"</th>\n    <td>"+t(this.segmentEffort.avg_speed)+"</td>\n    <td>"+t(this.segmentEffort.max_speed)+"</td>\n  </tr>\n</tbody>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segment_efforts/stats_other"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<thead>\n  <tr>\n    <th></th>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.avg")))+"</th>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.max")))+"</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.pace")))+"</th>\n    <td>"+t(this.segmentEffort.avg_speed)+"</td>\n    <td>"+t(this.segmentEffort.max_speed)+"</td>\n  </tr>"),(this.segmentEffort.avg_hr||this.segmentEffort.max_hr)&&(i.push("  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.heartrate")))+"</th>\n    <td>"),this.segmentEffort.avg_hr?(i.push("      "+t(this.segmentEffort.avg_hr)),i.push("      <abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.beats_per_minute")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.beats_per_minute_abbr")))),i.push("      </abbr>")):i.push("      &mdash;"),i.push("    </td>\n    <td>"),this.segmentEffort.max_hr?(i.push("      "+t(this.segmentEffort.max_hr)),i.push("      <abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.beats_per_minute")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.beats_per_minute_abbr")))),i.push("      </abbr>")):i.push("      &mdash;"),i.push("    </td>\n  </tr>\n  <tr>\n    <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.stats_other.elev_diff")))+"</th>\n    <td>"+t(this.segmentEffort.elev_difference)+"</td>\n    <td></td>\n  </tr>")),i.push("</tbody>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["partials/current_athlete_avatar"]=function(t){return function(){var t,e,i,r,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],n=this.size||"lg",("sm"===this.size||"default"===this.size)&&(r="tiny"),i.push("<a class='"+["avatar","avatar-athlete","avatar-"+e(t(n))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.display_name))+"'>"),this.athlete.member_type&&i.push("  <div class='"+["badge",e(t(this.athlete.member_type))+" "+e(t(r))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.athletes.member_types."+this.athlete.member_type)))+"'></div>"),i.push("  <img src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"'>\n</a>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortDetailView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="segment-effort-detail-view",i.prototype.events={"click .dismiss":"close","click .set-goal":"setGoal","click .analysis-link-js":"viewAnalysis"},i.prototype.initialize=function(t){return this.options=t,this.pageView=this.options.pageView,this.template=this.pageView.isRun()?"activities/segment_efforts/detail_run":this.pageView.isSwim()?"activities/segment_efforts/detail_swim":this.pageView.isRide()?"activities/segment_efforts/detail_ride":"activities/segment_efforts/detail_other",this.stats_template=this.pageView.isRun()?"activities/segment_efforts/stats_run":this.pageView.isSwim()?"activities/segment_efforts/stats_swim":this.pageView.isRide()?"activities/segment_efforts/stats_ride":"activities/segment_efforts/stats_other",this.goalsController=new Strava.PerformanceGoals.Controller({current_athlete_id:this.pageView.currentAthlete().id}),this.pageView.hasGoalsAccess()||(this.goalUpsell=new Strava.Ui.TooltipView("performance_goals/tooltip")),this.goalsController.on("goalCreated",function(t){return window.location="/goals/segment/"+t.get("id")}),this.pageView.streams().on("fetchSuccess",function(t){return function(){return t.renderStats()}}(this))},i.prototype.setViewModel=function(t){this.viewModel=t},i.prototype.render=function(){var t,e;return this.renderDetails(),this.renderStats(),this.pageView.isRun()||(this.renderChart(),this.viewModel.isLeaderboardHidden()?_.delay(function(t){return function(){return t.handleSegmentEffortDetailRendered()}}(this)):(t={activity_athlete_id:this.pageView.activityAthlete().id},e=this.pageView.segmentLeaderboards().getDeferred(this.viewModel.model.get("segment_id"),{data:t}),e.done(function(t){return function(e){var i,r;return r=new Strava.Labs.Activities.SegmentLeaderboardViewModel(e),r.currentAthlete=t.pageView.currentAthlete(),r.athleteTime=t.viewModel.model.get("viewer_overall_time"),r.isPremium=t.pageView.isPremium(),r.hasGoalsAccess=t.pageView.hasGoalsAccess(),r.activityAthlete=t.pageView.activityAthlete(),r.activityAthleteTime=t.viewModel.model.get("overall_time"),i=new Strava.Labs.Activities.SegmentLeaderboardView(r),i.on("render",function(){return t.trigger("segmentEffortDetailRendered",t)}),i.render(),t.$(".leaderboard").html(i.el),_.delay(function(){return t.handleSegmentEffortDetailRendered()})}}(this)).fail(function(t){return function(){var e;return e=new Strava.Labs.Activities.SegmentLeaderboardUnavailableView,e.render(),t.$(".leader-board-container").html(e.el),_.delay(function(){return t.handleSegmentEffortDetailRendered()})}}(this)))),this},i.prototype.viewAnalysis=function(t){var e,i,r;return e=this.$(t.currentTarget),e.data("segment-effort-id")?(this.pageView.pageContext().segmentEffortId(e.data("segment-effort-id")),this.pageView.router().changeMenuTo("analysis",!0)):(r=e.data("start-id"),i=e.data("end-id"),this.pageView.router().changeMenuTo("analysis/"+r+"/"+i,!0)),t.preventDefault()},i.prototype.renderDetails=function(){var t,e,i;return e=this.viewModel.summarize(),t=window.btoa?"/segments/"+e.segment_id+"/compare/"+window.btoa(e.id):"https://strava.zendesk.com/entries/49948800",i=this.pageView.canSeeTrainingPlans()&&!this.pageView.hasTrainingPlan()&&this.pageView.activityAthlete().get("id")===this.pageView.currentAthlete().get("id"),this.renderTemplate({segmentEffort:e,hidden:this.viewModel.initiallyHidden,athlete:this.pageView.activityAthlete().toJSON(),currentAthlete:this.pageView.currentAthlete().toJSON(),raceShapeHref:t,upsellTrainingPlan:i}),this.viewModel.isPR()?this.$(".pr-1").show():this.$(".pr").show()},i.prototype.renderStats=function(){return this.$(".effort-details table").html(this.getTemplateFor(this.stats_template)({segmentEffort:this.viewModel.summarize()}))},i.prototype.renderChart=function(){var t,e,i;return i=this.viewModel.convertedIndices(),t=this.$(".effort-elevation-profile"),e=new Strava.Labs.Activities.SegmentEffortChartView(this.pageView.chartContext(),this.pageView.streamsRequest),e.showSegment(i[0],i[1]),t.html(e.render().el)},i.prototype.renderMap=function(){var t,e,i;return i=this.viewModel.convertedIndices(),t=this.$(".effort-map"),e=this.pageView.factory().mapFactory(),this.mapFactory=new e(this.pageView.mapContext(),t,null,this.pageView.mbr()).showFullScreenToggle(!1).showGpxDownload(!1).showPrivacyToggle(!1).interactiveMap(!1).initializeMap(),this.mapFactory.getStreamPath().showDependent(i[0],i[1],!0)},i.prototype.handleSegmentEffortDetailRendered=function(){return this.renderMap(),this.trigger("segmentEffortDetailRendered",this)},i.prototype.close=function(){return this.trigger("segmentEffortDetailClosed",this.viewModel.model.id)},i.prototype.clear=function(){return null!=this.goalUpsell&&this.goalUpsell.dismissTooltip(),this.$el.empty()},i.prototype.setGoal=function(t){var e;return this.pageView.hasGoalsAccess()?(Strava.ExternalAnalytics.trackV2({category:"goals",page:"activity_detail",action:"click",element:"set_goal"}),Strava.PerformanceGoals.Create.View.show(new Strava.PerformanceGoals.SegmentGoal(this.viewModel.goalDetail()),this.goalsController)):(this.goalUpsell.render({},t.currentTarget),Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"screen_enter",element:"join_summit_set_goal"}),e=".content a",jQuery("#js-snw-performance-goals-upsell").off("click",e).on("click",e,function(){return Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"click",element:"join_summit_set_goal"})}))},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.StarredSegment=function(e){function i(t){i.__super__.constructor.call(this,_.extend(t,{id:t.segment_id}))}return t(i,e),i.prototype.url=function(){return"/segments/"+this.get("segment_id")+"/starred?source="+this.get("source")},i.prototype.toggleStar=function(){var t;return t="on"===this.get("active")?"off":"on",this.set("active",t),this.save()},i}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["segments/starred"]=function(t){return function(){var t;return t=[],t.push("<span class='app-icon-wrapper'>\n  <span class='app-icon icon-dark icon-lg icon-star'>&#9733;</span>\n</span>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Segments"),Strava.Segments.StarredSegmentView=function(e){function i(t,e){null==e&&(e={}),i.__super__.constructor.call(this,e),this.starredSegment=t,this.starredSegment.bind("change",this.render,this),this.template="segments/starred","on"===this.starredSegment.get("active")?this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.unstar")):this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.star"))}return t(i,e),i.prototype.className="starred",i.prototype.events={click:"handleStarClick"},i.prototype.render=function(){return this.render_template(this.starredSegment.toJSON()),"on"===this.starredSegment.get("active")?(this.$el.addClass("active"),this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.unstar"))):(this.$el.removeClass("active"),this.$el.attr("title",Strava.I18n.Locale.t("strava.segments.starred_segment_view.star"))),this},i.prototype.handleStarClick=function(){return this.starredSegment.toggleStar(),!1},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Segments"),Strava.Segments.StarredSegmentViewCollection=function(){function t(t){this.starredSegments={},this.starredSegmentViews=[],this.source=t}return t.prototype.addSegmentEffort=function(t,e,i){var r,n;return this.starredSegments[t]?r=this.starredSegments[t]:(r=new Strava.Segments.StarredSegment({segment_id:t,active:e,source:this.source}),this.starredSegments[t]=r),n=new Strava.Segments.StarredSegmentView(r,{el:i}),this.starredSegmentViews.push(n),n},t.prototype.addSegmentEfforts=function(t){return jQuery(t).each(function(t){return function(e,i){var r,n,a;return a=jQuery(i),n=a.data("segment-id"),r=a.hasClass("active")?"on":"off",t.addSegmentEffort(n,r,a)}}(this))},t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/achievement"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+["app-icon","icon-sm","tipsy-enabled",""+e(t(this.effort.achievement_sprite_name))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(this.effort.achievement_description))+"'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/climb_category"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<span class='"+["strava-icon","icon-cat-"+e(t(this.effort.climb_category_desc))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.climb_category.description_"+this.effort.climb_category_desc)))+"'></span>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortRowView=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),this.starredSegmentViewCollection=new Strava.Segments.StarredSegmentViewCollection("new-activity"),this.segmentAchievementTemplate=this.getTemplateFor("activities/segments/achievement"),this.segmentClimbCategoryTemplate=this.getTemplateFor("activities/segments/climb_category")}return t(i,e),i.prototype.FADE_TIME=300,i.prototype.events=function(){return _.extend({},_.result(Strava.Labs.Activities.EffortRowView.prototype,"events")||{},{"click .toggle-effort-visibility":"toggleVisibility"})},i.prototype.render=function(){var t,e,r;return i.__super__.render.call(this),e=this.viewModel.effort,t=e.get("starred_by_current_athlete")?"on":"off",r=this.starredSegmentViewCollection.addSegmentEffort(e.get("segment_id"),t),this.$el.find(".starred-col").html(r.render().el),e.get("has_achievement")&&this.$el.find(".achievement-col").html(this.segmentAchievementTemplate(this.viewModel.summarize())),e.get("climb")&&this.$el.find(".climb-cat-col").html(this.segmentClimbCategoryTemplate(this.viewModel.summarize())),this},i.prototype.attributes=function(){return{"data-segment-effort-id":this.viewModel.effort.id}},i.prototype.unselect=function(){return i.__super__.unselect.call(this),this.$el.find("td, .segment-effort-detail").removeAttr("style")},i.prototype.handleClick=function(t){var e;return this.$(t.originalEvent.target).closest(".segment-effort-detail, .starred, button").length>0?void 0:(i.__super__.handleClick.call(this,t),e=this.viewModel.selected?"SegmentEffort Show":"SegmentEffort Hide",Strava.ExternalAnalytics.track(e,{segmentEffortId:this.viewModel.effort.id}),this.trigger("segmentEffortDetailToggle",this.viewModel.effort.id,this.viewModel.selected))},i.prototype.toggleVisibility=function(){var t,e,i;return e=this.viewModel.effort,t=e.get("hidden")?"unhide":"hide",i="/segments/"+e.get("segment_id")+"/"+t+"?segment_effort_id="+e.id,jQuery.ajax({url:i,dataType:"json",beforeSend:null}).done(function(t){return function(){var i;return e.set("hidden",!e.get("hidden")),i=Strava.I18n.Locale.t(e.get("hidden")?"templates.activities.segments.row.unhide":"templates.activities.segments.row.hide"),t.$el.find(".toggle-effort-visibility").html(i),t.$el.fadeOut(t.FADE_TIME,function(){return e.get("hidden")?t.$$("table.hidden-segments").prepend(t.$el):t.$$("table.segments").append(t.$el),t.$el.fadeIn(t.FADE_TIME,function(){return t.trigger("segmentEffortVisibilityToggle")})})}}(this))},i}(Strava.Labs.Activities.EffortRowView)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortsTableContext=function(e){function i(t,e,r,n){this.segmentEfforts=t,this.chartContext=e,this.pageContext=r,i.__super__.constructor.call(this,n)}return t(i,e),i.prototype.getEfforts=function(){return this.segmentEfforts.models.concat(this.segmentEfforts.hiddenSegmentEfforts)},i.prototype.effortsLoaded=function(){return null!=this.segmentEfforts.models},i.prototype.convertStreamIndices=function(t){return this.chartContext.convertStreamIndices(t)},i}(Strava.Labs.Activities.EffortsTableContext)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortsTableViewModel=function(e){function i(t){i.__super__.constructor.call(this,t,"segments")}return t(i,e),i.prototype.hasFullColumns=function(){return!0},i}(Strava.Labs.Activities.EffortsTableViewModel)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/table_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <div class='spans10'>\n    <h3 class='inset segments-header'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.title")))+"</h3>\n  </div>\n  <div class='align-right inset span6'>\n    <span class='glossary-link help new-version' data-glossary-term='definition-segment'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.view.learn_more")))),i.push("    </span>\n  </div>\n</div>\n<table class='dense hoverable marginless segments'>\n  <thead>\n    <tr>\n      <th class='centered starred-col'></th>\n      <th class='achievement-col centered'></th>\n      <th class='name-col' colspan='"+e(t(2))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.name")))),i.push("      </th>\n      <th class='time-col'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.time")))),i.push("      </th>\n      <th>"),this.speedUnit&&i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.speed."+this.speedUnit)))),i.push("      </th>"),this.effortIntensityVisible?(i.push("      <th colspan='"+e(t(2))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.power")))),i.push("        /\n        <span class='glossary-link power-version' data-glossary-term='definition-segment-intensity' href='javascript:;'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.effort_intensity")))),i.push("        </span>\n      </th>")):i.push("      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.power")))+"</th>"),i.push("      <th>\n        <span class='glossary-link new-version' data-glossary-term='definition-vam'>"),i.push("          "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.vam")))),i.push("        </span>\n      </th>\n      <th>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.hr")))+"</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>\n<div class='show-hide-segments'></div>\n<div class='hidden-segments-container' style='display: none;'>\n  <table class='dense hidden-segments hoverable marginless'>\n    <tbody></tbody>\n  </table>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/table_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable marginless run segments'>\n  <thead>\n    <tr>\n      <th class='centered starred-col'></th>\n      <th class='achievement-col centered'></th>\n      <th class='name-col'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.name")))),i.push("      </th>\n      <th class='time-col'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.time")))+"</th>\n      <th class='expanded-only'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.distance")))),i.push("      </th>\n      <th class='expanded-only'>"),this.speedUnit&&i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.speed."+this.speedUnit)))),i.push("      </th>\n      <th class='expanded-only'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.elev_diff")))),i.push("      </th>\n      <th class='expanded-only'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.hr")))),i.push("      </th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>\n<div class='show-hide-segments'></div>\n<div class='hidden-segments-container' style='display: none;'>\n  <table class='dense hidden-segments hoverable run'>\n    <tbody></tbody>\n  </table>\n</div>\n<div class='segment-effort-detail' id='segment-effort-detail'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/table_swim"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <div class='spans10'>\n    <h3 class='inset'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.title")))+"</h3>\n  </div>\n  <div class='align-right inset span6'>\n    <span class='glossary-link help new-version' data-glossary-term='definition-segment'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.view.learn_more")))),i.push("    </span>\n  </div>\n</div>\n<table class='dense hoverable marginless segments'>\n  <thead>\n    <tr>\n      <th class='centered starred-col'></th>\n      <th class='achievement-col centered'></th>\n      <th>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.name")))),i.push("      </th>\n      <th>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.distance")))),i.push("      </th>\n      <th>"),this.speedUnit&&i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.speed."+this.speedUnit)))),i.push("      </th>\n      <th>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.time")))),i.push("      </th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>\n<div class='show-hide-segments'></div>\n<div class='hidden-segments-container' style='display: none;'>\n  <table class='dense hidden-segments hoverable marginless'>\n    <tbody></tbody>\n  </table>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/table_other"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <div class='spans10'>\n    <h3 class='inset'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.title")))+"</h3>\n  </div>\n  <div class='align-right inset span6'>\n    <span class='glossary-link help new-version' data-glossary-term='definition-segment'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.view.learn_more")))),i.push("    </span>\n  </div>\n</div>\n<table class='dense hoverable marginless segments'>\n  <thead>\n    <tr>\n      <th class='centered starred-col'></th>\n      <th class='achievement-col centered'></th>\n      <th>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.name")))),i.push("      </th>\n      <th>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.time")))),i.push("      </th>\n      <th>"),this.speedUnit&&i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.table.speed."+this.speedUnit)))),i.push("      </th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>\n<div class='show-hide-segments'></div>\n<div class='hidden-segments-container' style='display: none;'>\n  <table class='dense hidden-segments hoverable marginless'>\n    <tbody></tbody>\n  </table>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/row_ride"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td class='centered starred-col'></td>\n<td class='achievement-col centered'></td>\n<td class='name-col'>\n  <div class='name'>"+e(t(this.effort.display_name))+"</div>\n  <div class='stats'>\n    <span title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.distance")))+"'>"),i.push("      "+t(this.effort.distance)),i.push("    </span>\n    <span title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.elevation_diff")))+"'>"),i.push("      "+t(this.effort.elev_difference)),i.push("    </span>\n    <span title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.avg_grade")))+"'>"),i.push("      "+t(this.effort.avg_grade)),i.push("    </span>\n  </div>\n  <div class='segment-effort-detail'>\n    <div class='content'></div>\n  </div>\n</td>\n<td class='climb-cat-col'></td>\n<td class='time-col'>"+t(this.effort.elapsed_time)+"</td>\n<td>"+t(this.effort.avg_speed)+"</td>\n<td>"),i.push(this.effort.avg_watts_raw?"  "+t(this.effort.avg_watts):"  &mdash;"),i.push("</td>"),this.effortIntensityVisible&&i.push("<td>\n  <div class='effort-intensity' data-elapsedtime='"+e(t(this.effort.elapsed_time_raw))+"' data-watts='"+e(t(this.effort.avg_watts_raw))+"'></div>\n</td>"),i.push("<td>"+t(this.effort.vam)+"</td>\n<td>"),this.effort.avg_hr_raw?(i.push("  "+t(this.effort.avg_hr)),i.push("  \x91<abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.beats_per_minute")))+"'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.bpm")))+"</abbr>\x92")):i.push("  &mdash;"),i.push("</td>\n<td>"),this.hidden?(i.push("  <button class='compact minimal toggle-effort-visibility' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.unhide_title")))+"' data-action='unhide'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.unhide")))),i.push("  </button>")):(i.push("  <button class='compact minimal toggle-effort-visibility' data-action='hide' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.hide")))+"'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.hide")))),i.push("  </button>")),i.push("</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/row_run"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td class='centered starred-col'></td>\n<td class='achievement-col centered'></td>\n<td class='name-col'>\n  <div class='name'>"+e(t(this.effort.display_name))+"</div>\n</td>\n<td class='time-col'>"+t(this.effort.elapsed_time)+"</td>\n<td>"+t(this.effort.distance)+"</td>\n<td>"+t(this.effort.avg_speed)+"</td>\n<td>"+t(this.effort.elev_difference)+"</td>\n<td>"),this.effort.avg_hr_raw?(i.push("  "+t(this.effort.avg_hr)),i.push("  \x91<abbr class='unit' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.beats_per_minute")))+"'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.bpm")))+"</abbr>\x92")):i.push("  &mdash;"),i.push("</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/row_swim"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td class='centered starred-col'></td>\n<td class='achievement-col centered'></td>\n<td>"),i.push("  "+e(t(this.effort.display_name))),i.push("  <div class='segment-effort-detail'>\n    <div class='content'></div>\n  </div>\n</td>\n<td>"+t(Strava.Util.StringUtils.lpad(this.effort.distance,5))+"</td>\n<td>"+t(this.effort.avg_speed)+"</td>\n<td>"+t(this.effort.elapsed_time)+"</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/row_other"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td class='centered starred-col'></td>\n<td class='achievement-col centered'></td>\n<td class='name-col'>\n  <div class='name'>"+e(t(this.effort.display_name))+"</div>\n  <div class='stats'>\n    <span title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.distance")))+"'>"),i.push("      "+t(this.effort.distance)),i.push("    </span>\n    <span title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.elevation_diff")))+"'>"),i.push("      "+t(this.effort.elev_difference)),i.push("    </span>\n    <span title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.avg_grade")))+"'>"),i.push("      "+t(this.effort.avg_grade)),i.push("    </span>\n  </div>\n  <div class='segment-effort-detail'>\n    <div class='content'></div>\n  </div>\n</td>\n<td class='time-col'>"+t(this.effort.elapsed_time)+"</td>\n<td>"+t(this.effort.avg_speed)+"</td>\n<td>"),this.hidden?(i.push("  <button class='compact minimal toggle-effort-visibility' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.unhide_title")))+"' data-action='unhide'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.unhide")))),i.push("  </button>")):(i.push("  <button class='compact minimal toggle-effort-visibility' data-action='hide' title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.hide")))+"'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.segments.row.hide")))),i.push("  </button>")),i.push("</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentEffortsTableView=function(e){function i(t,e){this.activity=e.context.chartContext.activity(),this.rowViewModels=[],this.template=this.activity.isRun()?"activities/segments/table_run":this.activity.isSwim()?"activities/segments/table_swim":this.activity.isRide()?"activities/segments/table_ride":"activities/segments/table_other",i.__super__.constructor.call(this,t,e)}return t(i,e),i.prototype.render=function(){var t;return t=strava.i18n.measurementUnits().longLabel,this.renderTemplate({speedUnit:this.activity.get("speedUnit"),effortIntensityVisible:this.tableViewModel.effortIntensityVisible(),distance_unit:t}),this.renderEfforts(),this},i.prototype.renderEfforts=function(){var t,e,i;return e=this.activity.isRun()?"activities/segments/row_run":this.activity.isSwim()?"activities/segments/row_swim":this.activity.isRide()?"activities/segments/row_ride":"activities/segments/row_other",t=jQuery(document.createDocumentFragment()),i=jQuery(document.createDocumentFragment()),this.tableViewModel.each(function(r){return function(n){var a,s;return s=r.instantiateSegmentEffortRowView(n,e),s.on("segmentEffortDetailToggle",function(t,e){return r.trigger("segmentEffortDetailToggle",t,e)}),s.on("segmentEffortVisibilityToggle",function(){return r.trigger("segmentEffortVisibilityToggle")}),a=n.effort.get("hidden")?t:i,a.append(s.render().el),r.rowViewModels.push(s)}}(this)),this.$("table.segments tbody").append(i),this.$("table.hidden-segments tbody").append(t)},i.prototype.instantiateSegmentEffortRowView=function(t,e){return new Strava.Labs.Activities.SegmentEffortRowView(t,e)},i}(Strava.Labs.Activities.EffortsTableView)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentLeaderboardViewModel=function(){function t(t){this.leaderboard=t,this.activityAthlete=null,this.currentAthlete=null,this.isPremium=null,this.hasGoalsAccess=null,this.activityAthleteTime=null,this.athleteTime=null}return t.prototype.getTopResults=function(){return this.leaderboard.get("top_results")},t.prototype.getViewerContext=function(){return this.leaderboard.get("viewer_context")},t.prototype.highlightRow=function(t){return"my_results"!==this.leaderboard.get("filter")&&this.currentAthlete.id===t.athlete_id},t.prototype.myResults=function(){return"my_results"===this.leaderboard.get("filter")},t.prototype.filterSelector=function(){var t,e,i,r;return e=this.leaderboard.get("filter"),t="overall"===e?(i=this.leaderboard.get("gender"),"F"===i?"women":"M"===i?"men":"overall"):e?e:"overall",r="[data-filter="+t+"]","club"===e?r+="[data-club-id="+this.leaderboard.get("club_id")+"]":"age_group"===e?r+="[data-age-group="+this.leaderboard.get("age_group")+"]":"weight_class"===e&&(r+="[data-weight-class="+this.leaderboard.get("weight_class")+"]"),r},t.prototype.summarize=function(){return{segmentId:this.leaderboard.id,currentAthlete:this.currentAthlete.attributes,activityAthlete:this.activityAthlete.attributes,activityAthleteRank:this.leaderboard.get("activity_athlete_rank"),activityAthleteTime:this.activityAthleteTime,viewerRank:this.leaderboard.get("viewer_rank"),viewerTime:this.athleteTime,count:this.leaderboard.get("top_results_count"),clubs:this.leaderboard.get("viewer_clubs"),premium:this.isPremium,fullLeaderboardPath:this.leaderboard.fullLeaderboardPath()}},t}()}.call(this),function(){Strava.module("Strava.Athletes"),Strava.Athletes.WeightClassMap={lbs:{"0_124":[0,125],"125_149":[125,150],"150_164":[150,165],"165_179":[165,180],"180_199":[180,200],"200_224":[200,225],"225_249":[225,250],"250_plus":[250,null]},kg:{"0_54":[0,55],"55_64":[55,65],"65_74":[65,75],"75_84":[75,85],"85_94":[85,95],"95_104":[95,105],"105_114":[105,115],"115_plus":[115,null]}}}.call(this),function(){Strava.module("Strava.Athletes"),Strava.Athletes.WeightClasses={TRANSLATION_KEY_PREFIX:"strava.athletes.weight_classes",byKey:function(t){return this._byKey||(this._byKey=Strava.Athletes.WeightClassMap),this._byKey[t]},valueForKey:function(t,e){return this.byKey(e)[t]},asObjects:function(t,e){return null==e&&(e={fullKey:!1}),_.map(this.byKey(t),function(i){return function(r,n){var a;return a={key:n,value:r},e.fullKey&&_.extend(a,{fullKey:[i.TRANSLATION_KEY_PREFIX,t,n].join(".")}),a}}(this))}}}.call(this),function(){Strava.module("Strava.Athletes"),Strava.Athletes.AgeGroupMap={"0_19":[0,19],"20_24":[20,24],"25_34":[25,34],"35_44":[35,44],"45_54":[45,54],"55_64":[55,64],"65_69":[65,69],"70_74":[70,74],"75_plus":[75,null]}}.call(this),function(){Strava.module("Strava.Athletes"),Strava.Athletes.AgeGroups={TRANSLATION_KEY_PREFIX:"strava.athletes.age_groups",byKey:function(){return this._byKey||(this._byKey=Strava.Athletes.AgeGroupMap)},valueForKey:function(t){return this.byKey()[t]},asObjects:function(t){return null==t&&(t={fullKey:!1}),_.map(this.byKey(),function(e){return function(i,r){var n;return n={key:r,value:i},t.fullKey&&_.extend(n,{fullKey:[e.TRANSLATION_KEY_PREFIX,r].join(".")}),n}}(this))}}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/leaderboard"]=function(t){return function(){var t,e,i,r,n,a,s,o,l,c,h,u,p,d,f,v;if(e=window.HAML.escape,t=window.HAML.cleanValue,u=function(t){return function(e,i,r){return window.HAML.precede.call(t,e,i,r)}}(this),i=[],i.push("<div class='pr-comparison row'>"),this.activityAthlete.id!==this.currentAthlete.id&&(i.push("  <div class='spans-half'>"),i.push("    "+t(this.renderPartial("partials/current_athlete_avatar",{athlete:this.activityAthlete}))),i.push("    <strong>\n      <abbr title='"+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.pr")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.pr_abbr")))),i.push("      </abbr>\n      <time>"),i.push(this.activityAthleteTime?"        "+t(this.activityAthleteTime):"        &mdash;"),i.push("      </time>\n    </strong>\n    <div class='rank'>\n      \x91<strong>"),i.push(this.activityAthleteRank?"        "+e(t(this.activityAthleteRank)):"        &ndash;"),i.push("      </strong>\x92"),i.push("      "+e(t(u("/",function(){var i;return i=[],i.push("      "+e(t(this.count))),i.join("\n")})))),i.push("    </div>\n  </div>")),i.push("  <div class='spans-half'>"),i.push("    "+t(this.renderPartial("partials/current_athlete_avatar",{athlete:this.currentAthlete}))),i.push("    <strong>"),i.push("      "+t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.your_pr_html"))),i.push("      <time>"),i.push(this.viewerTime?"        "+t(this.viewerTime):"        &mdash;"),i.push("      </time>\n    </strong>\n    <div class='rank'>\n      \x91<strong>"),i.push(this.viewerRank?"        "+e(t(this.viewerRank)):"        &ndash;"),i.push("      </strong>\x92"),i.push("      "+e(t(u("/",function(){var i;return i=[],i.push("      "+e(t(this.count))),i.join("\n")})))),i.push("    </div>\n  </div>\n</div>\n<div class='drop-down-menu leaderboard-filter'>\n  <div class='selection'>\n    <span class='activity-sprite leaderboard'></span>\n    <span class='filter-js'>Overall</span>\n  </div>\n  <ul class='options'>\n    <li>\n      <div class='clickable' data-filter='overall'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.all_time")))),i.push("      </div>\n    </li>\n    <li>\n      <div class='clickable' data-filter='current_year'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.this_year")))),i.push("      </div>\n    </li>\n    <li>\n      <div class='clickable' data-filter='men'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.men")))),i.push("      </div>\n    </li>\n    <li>\n      <div class='clickable' data-filter='women'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.women")))),i.push("      </div>\n    </li>\n    <li>\n      <div class='clickable' data-filter='following'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.im_following")))),i.push("      </div>\n    </li>\n    <li>\n      <div class='clickable' data-filter='my_results'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.my_results")))),i.push("      </div>\n    </li>"),this.premium){for(i.push("    <li class='opt-group'>\n      <span class='label'>\n        <span class='badge premium tiny'></span>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.age_groups")))),i.push("      </span>\n      <ul>"),p=Strava.Athletes.AgeGroups.asObjects({fullKey:!0}),a=0,l=p.length;l>a;a++)r=p[a],i.push("        <li>\n          <div class='clickable' data-filter='age_group' data-age-group='"+e(t(r.key))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t(r.fullKey)))),i.push("          </div>\n        </li>");for(i.push("      </ul>\n    </li>\n    <li class='opt-group'>\n      <span class='label'>\n        <span class='badge premium tiny'></span>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.weight_classes")))),i.push("      </span>\n      <ul>"),d=Strava.Athletes.WeightClasses.asObjects(this.currentAthlete.weight_measurement_unit,{fullKey:!0}),s=0,c=d.length;c>s;s++)v=d[s],i.push("        <li>\n          <div class='clickable' data-filter='weight_class' data-weight-class='"+e(t(v.key))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t(v.fullKey)))),i.push("          </div>\n        </li>");i.push("      </ul>\n    </li>")}if(this.clubs){for(i.push("    <li class='opt-group'>\n      <span class='label'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.clubs")))),i.push("      </span>\n      <ul>"),f=this.clubs,o=0,h=f.length;h>o;o++)n=f[o],i.push("        <li>\n          <div class='clickable' data-filter='club' data-club-id='"+e(t(n.id))+"'>"),i.push("            "+e(t(n.name))),i.push("          </div>\n        </li>");i.push("      </ul>\n    </li>")}return i.push("  </ul>\n</div>\n<table class='unstyled'>\n  <thead>\n    <th></th>\n    <th class='results-col-js'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.athlete")))),i.push("    </th>\n    <th class='my-results-col-js'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.date")))),i.push("    </th>\n    <th>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.time")))),i.push("    </th>\n    <th>"),this.speedUnit&&i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.speed."+this.speedUnit)))),i.push("    </th>\n  </thead>\n  <tbody></tbody>\n</table>\n<div class='centered leaderboard-footer'>\n  <a class='button compact' href='"+e(t(this.fullLeaderboardPath))+"'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.segments.leaderboard.view_full_leaderboard")))),i.push("  </a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/leaderboard_row"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<tr class='"+e(t(this.highlightRow?"current-athlete":null))+"'>\n  <td>"+e(t(this.effort.rank))+"</td>\n  <td class='results-col-js'>\n    <a class='minimal' href='/athletes/"+e(t(this.effort.athlete_id))+"'>"+e(t(this.effort.display_name))+"</a>\n  </td>\n  <td class='my-results-col-js'>\n    <a class='minimal' href='/segment_efforts/"+e(t(this.effort.id))+"'>"+e(t(this.effort.start_date_local))+"</a>\n  </td>\n  <td>\n    <a class='minimal' href='/segment_efforts/"+e(t(this.effort.id))+"'>"+t(this.effort.elapsed_time)+"</a>\n  </td>\n  <td>"+t(this.effort.avg_speed)+"</td>\n</tr>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/leaderboard_spacer"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<tr>\n  <td colspan='"+e(t(4))+"'>...</td>\n</tr>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentLeaderboardView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click .drop-down-menu .clickable":"handleFilterClick"},i.prototype.className="segment-leaderboard",i.prototype.RESULTS_COL_SELECTOR="th.results-col-js, td.results-col-js",i.prototype.MY_RESULTS_COL_SELECTOR="th.my-results-col-js, td.my-results-col-js",i.prototype.initialize=function(t){return this.viewModel=t,this.template="activities/segments/leaderboard",this.rowTemplate=this.getTemplateFor("activities/segments/leaderboard_row"),this.spacerTemplate=this.getTemplateFor("activities/segments/leaderboard_spacer")},i.prototype.render=function(){var t,e,i,r,n,a,s,o,l;if(null==this.viewModel)return this;for(this.renderTemplate(this.viewModel.summarize()),i=this.$(".drop-down-menu .clickable"+this.viewModel.filterSelector()).html(),this.$(".selection .filter-js").html(i),t=this.$("table tbody"),o=this.viewModel.getTopResults(),r=0,a=o.length;a>r;r++)e=o[r],t.append(this.rowTemplate({effort:e,highlightRow:this.viewModel.highlightRow(e)}));if(l=this.viewModel.getViewerContext(),null!=l&&l.length>0)for(t.append(this.spacerTemplate()),n=0,s=l.length;s>n;n++)e=l[n],t.append(this.rowTemplate({effort:e,highlightRow:this.viewModel.highlightRow(e)}));return this.showHideCols(),this.trigger("render"),this},i.prototype.showHideCols=function(){return this.viewModel.myResults()?(this.$(this.RESULTS_COL_SELECTOR).hide(),this.$(this.MY_RESULTS_COL_SELECTOR).show()):(this.$(this.MY_RESULTS_COL_SELECTOR).hide(),this.$(this.RESULTS_COL_SELECTOR).show())},i.prototype.handleFilterClick=function(t){var e,i,r;return e=jQuery(t.currentTarget),r=e.data("filter"),i=function(){switch(r){case"men":return{filter:"overall",gender:"M"};case"women":return{filter:"overall",gender:"F"};case"club":return{filter:"club",gender:"all",club_id:e.data("club-id")};case"age_group":return{filter:"age_group",gender:"all",age_group:e.data("age-group")};case"weight_class":return{filter:"weight_class",gender:"all",weight_class:e.data("weight-class")};case"current_year":return{filter:"current_year",date_range:"this_year"};default:return{filter:r,gender:"all"}}}(),"my_results"!==r&&_.extend(i,{activity_athlete_id:this.viewModel.activityAthleteId}),this.viewModel.leaderboard.fetch({data:i}).done(function(t){return function(){return t.render()}}(this))},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/leaderboard_unavailable"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<h3 class='leaderboard-unavailable-label'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.segment_efforts.leaderboard_unavailable")))),i.push("</h3>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentLeaderboardUnavailableView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="segment-leaderboard-unavailable",i.prototype.initialize=function(){return this.template="activities/segments/leaderboard_unavailable"},i.prototype.render=function(){return this.renderTemplate({}),this},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/hidden_prompt"]=function(t){return function(){var t;return t=[],t.push("<button class='compact minimal' id='show-hidden-efforts'></button>\n<button class='compact minimal' id='hide-hidden-efforts'></button>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/none"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='centered no-segments'>\n  <div class='icon-segment-marker-white'></div>\n  <h2 class='h3'>"+e(t(Strava.I18n.Locale.t("templates.activities.segments.none.no_segments")))+"</h2>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/segments/view"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],this.showMapAndChart&&(i.push("<section class='capped map-chart-container no-margins pinnable row'>\n  <div class='spans8'>\n    <div class='segments-loader' id='map-canvas'>"),i.push("      "+t(this.renderPartial("partials/spinner_tag"))),i.push("    </div>\n  </div>\n  <div class='spans8'>\n    <div id='chart-container'></div>\n    <div class='elev-chart-small streams-loader'>"),i.push("      "+t(this.renderPartial("partials/spinner_tag"))),i.push("    </div>\n  </div>\n</section>")),i.push("<section class='"+["segments-list",""+e(t(this.listClass))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='segments-loader'>"),i.push("    "+t(this.renderPartial("partials/spinner_tag"))),i.push("  </div>\n</section>\n<footer>"),this.createSegmentVisible&&(i.push("  <a class='button' href='/publishes/wizard?id="+e(t(this.activityId))+"&origin=activity'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.segments.view.create_segment")))),i.push("  </a>"),this.showMapAndChart&&(i.push("  <span class='inset'>\n    <span class='glossary-link help new-version' data-glossary-term='definition-segment'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.view.learn_more")))),i.push("    </span>\n  </span>")),this.athleteIsActivityOwner&&(i.push("  <div class='float-right'>\n    <a class='minimal' href='/activities/"+e(t(this.activityId))+"/potential-segment-matches'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.segments.view.missing_segments")))),i.push("    </a>\n  </div>"))),i.push("</footer>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentsView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click #show-hidden-efforts":"handleShowHiddenSegmentEffortsClick","click #hide-hidden-efforts":"handleHideHiddenSegmentEffortsClick"},i.prototype.tagName="section",i.prototype.id="segments",i.prototype.className="pinnable-anchor",i.prototype.initialize=function(t){return this.pageView=t,this.template="activities/segments/view",this.context=this.pageView.pageContext(),this.eventDispatcher=this.pageView.eventDispatcher(),this.segmentEfforts=this.pageView.segmentEfforts(),this.segmentEffortDetails=this.pageView.segmentEffortDetails(),this.activityType=this.pageView.activityType(),this.pageView.isOwner()&&this.pageView.power().visible&&(this.effortIntensityView=new Strava.Activities.PowerPanel.EffortIntensityView(this.pageView.activityAthlete().id,this.pageView.activity().get("startDateLocal"),{listSelector:".segments-list table",rowSelector:"tr",maxBarWidth:50})),this.segmentEffortDetails.on("segmentEffortDetailReady",function(t){return function(e){return t.handleSegmentEffortFetched(e),t.segmentEfforts.hiddenSegmentsVisible()?t.showOrHideHiddenEfforts():void 0}}(this))},i.prototype.render=function(){var t,e,i;return e="Run"===(i=this.pageView.activityType())||"Hike"===i||"Walk"===i?"run":this.pageView.isSwim()?"swim":"ride",t={activityId:this.pageView.activityId(),createSegmentVisible:this.pageView.isOwner(),listClass:e,showMapAndChart:this.pageView.isRun(),athleteIsActivityOwner:this.pageView.isOwner()},this.renderTemplate(t),this.pageView.isRun()?this.$(".scrolling-content").css("max-height","500px"):this.$(".segments-list").css("min-height","0"),this.handleSegmentEffortsFetched(),this.showOrHideHiddenEfforts(),this},i.prototype.handleShowHiddenSegmentEffortsClick=function(){return this.segmentEfforts.hiddenSegmentsVisible(!0),this.showOrHideHiddenEfforts()},i.prototype.handleHideHiddenSegmentEffortsClick=function(){return this.segmentEfforts.hiddenSegmentsVisible(!1),this.showOrHideHiddenEfforts()},i.prototype.handleSegmentEffortsFetched=function(){var t,e;return t=this.$(".segments-list"),this.segmentEfforts.length+this.segmentEfforts.hiddenSegmentEfforts.length>0?(e=new Strava.Labs.Activities.SegmentEffortsTableViewModel(this.pageView.segmentEffortsTableContext()),e.effortIntensityVisible(null!=this.effortIntensityView),this.tableView=this.instantiateSegmentEffortsTableView(t,e),this.tableView.on("segmentEffortDetailToggle",function(t){return function(e,i){return t.handleSegmentEffortDetailToggle(e,i)}}(this)),this.tableView.on("segmentEffortVisibilityToggle",function(t){return function(){return t.updateHiddenCount()}}(this)),this.pageView.isRun()&&this.refreshTableCollapsedState(),this.showOrHideHiddenEfforts()):t.html(this.getTemplateFor("activities/segments/none")())},i.prototype.instantiateSegmentEffortsTableView=function(t,e){return new Strava.Labs.Activities.SegmentEffortsTableView(t,e)},i.prototype.showOrHideHiddenEfforts=function(){return 0!==this.segmentEfforts.hiddenSegmentEfforts.length?(this.$(".show-hide-segments").html(this.getTemplateFor("activities/segments/hidden_prompt")()),this.updateHiddenCount(),this.segmentEfforts.hiddenSegmentsVisible()?(this.$("#show-hidden-efforts").addClass("hidden"),this.$("#hide-hidden-efforts").removeClass("hidden"),this.$(".segments-list .hidden-segments-container").slideDown(300)):(this.$("#show-hidden-efforts").removeClass("hidden"),this.$("#hide-hidden-efforts").addClass("hidden"),this.$(".segments-list .hidden-segments-container").slideUp(290))):void 0
},i.prototype.handleSegmentEffortFetched=function(t){var e,i,r,n;return r=_.find(this.segmentEfforts.hiddenSegmentEfforts,function(e){return e.id===t.id}),i=new Strava.Labs.Activities.SegmentEffortDetailViewModel(this.pageView.segmentEffortDetailContext(),t,r),this.$(i.rowSelector()).addClass("selected"),n=this.tableView.tableViewModel.findEffortById(t.id),n.selected=!0,this.pageView.isRun()?(this.collapseTable(),e=this.$("#segment-effort-detail")):e=this.$(i.rowSelector()+" .segment-effort-detail > .content"),this.detailView=this.instantiateSegmentEffortDetailView(),this.detailView.on("segmentEffortDetailClosed",function(t){return function(e){return n=t.tableView.tableViewModel.findEffortById(e),n.unselect({broadcast:!0}),t.tableView.trigger("segmentEffortDetailToggle",e,!1)}}(this)),this.pageView.isRun()||this.detailView.on("segmentEffortDetailRendered",function(t){return function(e){return t.$(".segments-list").css("min-height",e.$el.height()),t.expandRow(),t.segmentEffortDetails.trigger("segmentEffortRendered")}}(this)),this.detailView.setViewModel(i),e.html(this.detailView.render().el),this.pageView.isRun()&&e.show(),this.pageView.isRun()?this.$(".segment-effort-detail").css("bottom","0"):void 0},i.prototype.instantiateSegmentEffortDetailView=function(){return new Strava.Labs.Activities.SegmentEffortDetailView({pageView:this.pageView})},i.prototype.handleSegmentEffortDetailToggle=function(t,e){var i,r;return null!=this.detailView&&this.detailView.remove(),e?(this.pageView.isRun()||this.$(".segments-list tr.selected td, .segments-list tr.selected .segment-effort-detail").removeAttr("style"),this.$(".segments-list tr").removeClass("selected"),this.tableView.tableViewModel.each(function(t){return t.selected=!1}),this.segmentEffortDetails.getDeferred(t),this.pageView.isRun()?(this.collapseTable(),i=this.$$("#view").offset().top,r=window.pageYOffset,r>=i&&this.$$("html, body").animate({scrollTop:i},600)):this.expandRow(),this.pageView.router().changeMenuTo("segments/"+t,!1)):this.pageView.isRun()?(this.pageView.router().changeMenuTo("segments",!1),this.expandTable()):(this.pageView.router().changeMenuTo("",!1),this.$(".segments-list").css("min-height","0"))},i.prototype.expandTable=function(){return this.$(".segments-list").removeClass("collapsed")},i.prototype.collapseTable=function(){return this.$(".segments-list").addClass("collapsed"),""===this.$("#segment-effort-detail").html()?this.$("#segment-effort-detail").html("<div class='spinner centered'><div class='graphic'></div></div>"):void 0},i.prototype.refreshTableCollapsedState=function(){var t;return t=this.$(".segments-list").hasClass("collapsed"),t?this.collapseTable():this.expandTable()},i.prototype.expandRow=function(){var t;return t=this.$(".selected .segment-effort-detail > .content").outerHeight(),this.$(".selected > td").css({"padding-bottom":t}),this.$(".selected .segment-effort-detail").css({height:t}),this.$(".segments-list").css({"min-height":this.$(".segments-list").outerHeight()})},i.prototype.updateHiddenCount=function(){var t;return t=this.$("table.hidden-segments tr.full-columns").length,this.$("#show-hidden-efforts").html(Strava.I18n.Locale.t("strava.labs.activities.segments_view.show_prompt",{count:t})),this.$("#hide-hidden-efforts").html(Strava.I18n.Locale.t("strava.labs.activities.segments_view.hide_prompt",{count:t}))},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.Charts.Activities.ActivitySmall=function(e){function i(t,e,r){null==r&&(r=!1),i.__super__.constructor.call(this,t,e),r&&(this.showStreamsOnZoom=r,r&&(this.zoomStreamTypes=this.context.zoomStreamTypes()),e.require(this.zoomStreamTypes)),this.builder.width(380).height(150).xAxisTicks(5).animate(!1)}return t(i,e),i.prototype.showSegment=function(t,e){return this.showStreamsOnZoom&&this.showSegmentBands(),i.__super__.showSegment.call(this,t,e),this.builder.zoomWithPadding(t,e)},i.prototype.showSegmentBands=function(){var t,e,i,r,n,a,s,o,l,c;if(i=this.streamGraphs(),_.isEmpty(i)){for(null==this.xScale&&this.createScales(),t=this.zoomStreamTypes.filter(function(t){return function(e){return null!=t.context.getStream(e)}}(this)),r=0,s=t.length;s>r;r++)c=t[r],this.context.addInfoboxStreamType(c);this.bands.addLines(t,this.xScale)}else for(l=function(){var t;t=[];for(c in i)e=i[c],this.context.addInfoboxStreamType(c),t.push({line:e,streamType:c});return t}.call(this),this.bands.addLinesToBands(l),a=0,o=l.length;o>a;a++)n=l[a],n.line.show();return null!=this.builder.infoBox?this.builder.infoBox.updateText():void 0},i.prototype.hideSegmentBands=function(){var t,e,i;e=this.streamGraphs();for(i in e)t=e[i],t.hide(),this.bands.removeBand(i),this.context.removeInfoboxStreamType(i);return null!=this.builder.infoBox?this.builder.infoBox.updateText():void 0},i.prototype.hideSegment=function(t,e){return i.__super__.hideSegment.call(this,t,e),this.hideSegmentBands(),this.builder.resetZoom()},i.prototype.streamGraphs=function(){return _.pick(this.builder.graphs(),this.zoomStreamTypes)},i}(Strava.Charts.Activities.Activity)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SegmentsChartView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t,e,i){return this.context=t,this.streamsRequest=e,this.showStreamsOnZoom=null!=i?i:!1,this.template="activities/elevation_chart_no_controls",this.streamsRequest.onReady(function(t){return function(){return t.$$("div.streams-loader").remove()}}(this))},i.prototype.render=function(){return this.renderTemplate(),this.chart=new Strava.Charts.Activities.ActivitySmall(this.context,this.streamsRequest,this.showStreamsOnZoom),this.chart.render(this.$el),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.Resizer=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.el=t,this.container=e,this.el.bind("mousedown",function(t){return function(e){return t.handleMouseDown(e),!1}}(this)),this.id=""+Math.floor(1e3*Math.random())}var r;return t(i,e),r={min:260,size:300,onMove:null,onComplete:null},i.prototype.handleMouseDown=function(t){var e,i,r;return e=this.el.parent().find(this.container),r=e.outerHeight(),i=t.clientY||t.PageY,this.$document().bind("mousemove."+this.id,function(t){return function(n){var a,s;return null!=t.onMove()&&t.onMove()(),s=n.clientY||n.pageY,a=r+s-i,a=Math.max(t.min(),a),e.css("height",a),!1}}(this)).bind("mouseup."+this.id,function(t){return function(){return t.$document().unbind("."+t.id),null!=t.onComplete()&&t.onComplete()(),!1}}(this))},i.prototype.resetToDefault=function(){return this.el.parent().find(this.container).css("height",this.size())},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.OutdoorViewFactory=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={mapFactory:Strava.Maps.Google.Construction.MapFactory,segmentsViewFactory:Strava.Labs.Activities.SegmentsChartView,activityChartViewFactory:Strava.Labs.Activities.ElevationChartView,overviewMapCreatedCallback:function(){}},i.prototype.createBasicAnalysisView=function(t){var e,r,n,a,s,o,l;return l=i.__super__.createBasicAnalysisView.call(this,t),o=this.page(),n=o.basicAnalysisMapContext(),e=this.$$("#view"),r=e.find("#map-canvas"),a=new this._mapFactory(n,r,null,o.mbr()).showFullScreenToggle(!1).showGpxDownload(!1).showPrivacyToggle(!1).initializeMap(),s=this.createResizer(e.find(".grabber"),"#map-canvas"),s.onComplete(function(){return function(){return a.getMap().resize()}}(this)).min(250).size(r.height()),l},i.prototype.createOverviewView=function(t){var e,r,n,a,s;return s=i.__super__.createOverviewView.call(this,t),e=this.$$("#view"),r=e.find("#map-canvas"),this.overviewMapFactory=new this._mapFactory(this.page().mapContext(),r,this.page().pageContext(),this.page().mbr()),this.overviewMapFactory.initializeMap(),n=this.createResizer(e.find(".grabber"),"#map-canvas"),n.onComplete(function(t){return function(){return t.overviewMapFactory.getMap().resize()}}(this)).min(250).size(r.height()),this.page().pageContext().bind("fullscreenchange",function(){return function(t){return t||(n.resetToDefault(),"undefined"==typeof splitsResizer||null===splitsResizer)?void 0:splitsResizer.resetToDefault()}}(this)),this.page().isRun()||(a=this.instantiateSegmentsView(this.page()),e=this.$$("#segments-container"),e.html(a.render().el),this.page().handlePageScroll()),this.overviewMapCreatedCallback()(this.overviewMapFactory.getMap()),{view:s,map:r}},i.prototype.createResizer=function(t,e){var i;return i=new Strava.Ui.Resizer(t,e)},i.prototype.createSegmentsView=function(t){var e,i,r,n,a,s,o,l;return i=Strava.Labs.Activities.ContextManager,r=Strava.Labs.Activities.StreamTransformSet,n=this.page().contexts.contextFor(i.TYPES.CHART,r.CONVERTED_ELAPSED_TIME),a=new this._segmentsViewFactory(n,t,!0),l=this.instantiateSegmentsView(this.page()),e=this.$$("#view").addClass("pinnable-view"),e.html(l.render().el),a.setElement(e.find("#chart-container")).render(),s=e.find("#map-canvas"),o=this.page().contexts.contextFor(i.TYPES.MAP,r.CONVERTED_ELAPSED_TIME),new this._mapFactory(o,s,null,this.page().mbr()).showFullScreenToggle(!1).showGpxDownload(!1).showPrivacyToggle(!1).initializeMap(),this.page().latlngRequest().request(),this.page().handlePageScroll(),l},i.prototype.instantiateSegmentsView=function(t){return new Strava.Labs.Activities.SegmentsView(t)},i.prototype.createLapsView=function(t){var e,r,n,a,s,o,l;return i.__super__.createLapsView.call(this,t),r=Strava.Labs.Activities.ContextManager,n=Strava.Labs.Activities.StreamTransformSet,a=this.page().isRun()?this.page().chartContext():a=this.page().contexts.contextFor(r.TYPES.CHART,n.CONVERTED_ELAPSED_TIME),e=this.$$("#view"),o=e.find("#map-canvas"),l=this.page().contexts.contextFor(r.TYPES.MAP,n.CONVERTED_ELAPSED_TIME),new this._mapFactory(l,o,null,this.page().mbr()).showFullScreenToggle(!1).showGpxDownload(!1).showPrivacyToggle(!1).initializeMap(),this.page().latlngRequest().request(),s=new this._segmentsViewFactory(a,t,!0),s.setElement(e.find("#chart-container")).render()},i.prototype.createFacebookShareMapView=function(t){var e,i,r;return e=this.$$(".create-facebook-open-graph-action-lightbox"),r=this.page().mapContext(),i=e.find(t),new this._mapFactory(r,i).interactiveMap(!1).initializeMap().createMap(r.latlngStream().ready())},i.prototype.getOverviewMap=function(){return null!=this.overviewMapFactory?this.overviewMapFactory.getMap():void 0},i}(Strava.Labs.Activities.ViewFactory)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SplitEffortsTableViewModel=function(e){function i(t){i.__super__.constructor.call(this,t,"splits"),this.context.on("splitsLoaded",function(t){return function(){return t.trigger("ready")}}(this))}return t(i,e),i.prototype.hasFullColumns=function(){return this.hasStream("heartrate")&&this.hasStream("cadence")},i.prototype.getLabel=function(){return this.context.getLabel()},i.prototype.getUnit=function(t){return this.context.getUnit(t)},i.prototype.getTimeReferenceGlossaryTerm=function(){return this.context.isRace()?"definition-elapsed-time":"definition-moving-time"},i.prototype.hasStream=function(t){return this.context.hasStream(t)},i.prototype.effortIndices=function(t){return t.indices()},i}(Strava.Labs.Activities.EffortsTableViewModel)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/splits/table"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<section class='splits with-border'>\n  <h3>\n    <span class='glossary-link run-version' data-glossary-term='"+e(t(this.timeReferenceGlossaryTerm))+"'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.splits")))),i.push("    </span>\n  </h3>\n  <table class='dense hoverable labs marginless run'>\n    <thead>\n      <tr class='"+e(t(this.hasFullColumns?"full-columns":""))+"'>\n        <th>"+e(t(this.label))+"</th>\n        <th>\n          <span class='glossary-link run-version' data-glossary-term='"+e(t(this.timeReferenceGlossaryTerm))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.pace")))),i.push("          </span>\n        </th>\n        <th>\n          <abbr class='glossary-link run-version' title='"+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.grade_adjusted_pace")))+"' data-glossary-term='definition-gap'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.gap")))),i.push("          </abbr>\n        </th>\n        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elev")))+"</th>"),this.hasHeartrate&&i.push("        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.hr")))+"</th>"),this.hasCadence&&i.push("        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.splits.table.cadence")))+"</th>"),this.hasHeartrate||this.hasCadence||i.push("        <th>&nbsp;</th>"),i.push("      </tr>\n    </thead>\n    <tbody></tbody>\n  </table>\n</section>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/splits/table_small"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<header>\n  <h3 class='centered'>\n    <span class='glossary-link run-version' data-glossary-term='"+e(t(this.timeReferenceGlossaryTerm))+"'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table_small.splits")))),i.push("    </span>\n  </h3>\n</header>\n<div class='"+["mile-splits","scrollable-table",""+e(t(this.supportsGap?void 0:"no-gap"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <table class='dense hoverable'>\n    <thead>\n      <tr>\n        <th class='centered'>"+e(t(this.label))+"</th>\n        <th>\n          <span class='glossary-link run-version' data-glossary-term='"+e(t(this.timeReferenceGlossaryTerm))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table_small.pace")))),i.push("          </span>\n        </th>"),this.supportsGap&&(i.push("        <th>\n          <abbr class='glossary-link run-version' data-glossary-term='definition-gap' title='"+e(t(Strava.I18n.Locale.t("templates.activities.splits.table_small.grade_adjusted_pace")))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.activities.splits.table_small.gap")))),i.push("          </abbr>\n        </th>")),i.push("        <th>"+e(t(Strava.I18n.Locale.t("templates.activities.laps.table.elev")))+"</th>\n      </tr>\n    </thead>\n    <tbody id='contents'></tbody>\n  </table>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/splits/row"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"+e(t(this.label))+"</td>\n<td>"+t(this.pace)+"</td>\n<td>"+t(this.gap)+"</td>\n<td>"+t(this.elevation)+"</td>"),this.heartrate&&i.push("<td>"+t(this.heartrate)+"</td>"),this.cadence&&i.push("<td>"+t(this.cadence)+"</td>"),this.heartrate||this.cadence||i.push("<td>&nbsp;</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/splits/row_small"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td class='centered'>"+e(t(this.label))+"</td>\n<td>"+t(this.pace)+"</td>"),this.supportsGap&&i.push("<td>"+t(this.gap)+"</td>"),i.push("<td>"+t(this.elevation)+"</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SplitEffortsTableView=function(e){function i(t,e,r,n){this.el=t,this.tableViewModel=e,this.tableTemplate=r,this.rowTemplate=n,i.__super__.constructor.call(this,this.el,this.tableViewModel)}return t(i,e),i.prototype.render=function(){var t;return t={label:this.tableViewModel.getLabel(),elevationUnit:this.tableViewModel.getUnit("altitude"),hasCadence:this.tableViewModel.hasStream("cadence"),hasHeartrate:this.tableViewModel.hasStream("heartrate"),hasFullColumns:this.tableViewModel.hasFullColumns(),supportsGap:this.supportsGap(),timeReferenceGlossaryTerm:this.tableViewModel.getTimeReferenceGlossaryTerm()},this.renderTemplate(t,this.tableTemplate),this.renderSplits(),this},i.prototype.renderSplits=function(){var t;return t=this.$("tbody"),t.attr("height","360px"),this.tableViewModel.each(function(e){return function(i){var r;return r=new Strava.Labs.Activities.EffortRowView(i,e.rowTemplate,e.supportsGap()),t.append(r.render().el)}}(this))},i.prototype.supportsGap=function(){return this.tableViewModel.context.chartContext.activity().supportsGap()},i}(Strava.Labs.Activities.EffortsTableView)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.RunPaceZonesView=function(e){function i(t,e){this.el=t,this.paceZones=e,i.__super__.constructor.call(this),this.paceZoneRowTemplate=this.create_template_for("script#pace-zone-row-template"),this.paceZones.bind("paceZonesFetched",function(t){return function(){return t.handlePaceZonesFetched(t.paceZones.getPaceZones())}}(this))}return t(i,e),i.prototype.handlePaceZonesFetched=function(t){var e,i,r,n;for(r=this.$("tbody"),e=0,i=t.length;i>e;e++)n=t[e],r.append(this.paceZoneRowTemplate({zone:n}));return this.$(".bar .fill").each(function(){var t,e;return t=jQuery(this),e=t.width(),t.width(0).animate({width:e},400)})},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.EventLogging=function(){function t(t,e,i){this.host=t,this.athleteId=i,this.key=e}return t.stmSource=null,t.trackingSource=function(t){return this.stmSource=t},t.createInstance=function(t,e,i){return this.instance?void 0:this.instance=new Strava.Util.EventLogging(t,e,i)},t.trackEvent=function(t,e,i){var r,n;return null==i&&(i=null),r={event:t,details:e},this.instance.athleteId&&(r.athlete_id=this.instance.athleteId),i&&(r.timestamp=i),n={key:this.instance.key,data:btoa(JSON.stringify(r)).replace(/\+/g,"-").replace(/\//g,"_")},this.stmSource&&(n.stm_source=this.stmSource),jQuery.ajax({url:this.instance.host+"/logging/v1/log",type:"POST",crossDomain:!0,contentType:"application/x-www-form-urlencoded",data:n})},t.log=function(t){return t.key=this.instance.key,jQuery.ajax({url:this.instance.host+"/logging/v2/log",type:"POST",crossDomain:!0,contentType:"application/x-www-form-urlencoded",data:t})},t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pace/header"]=function(t){return function(){var t,e,i,r,n,a,s;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='row'>\n  <ul class='inline-stats spans12'>\n    <li>\n      <strong>"),n=new Strava.I18n.DistanceFormatter,i.push("        "+e(t(n.format(this.activity.distance)))),i.push("        \x91<abbr class='unit' title='"+e(t(n.unitLong()))+"'>"+e(t(n.unitShort()))+"</abbr>\x92\n      </strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.pace.header.distance")))+"</div>\n    </li>\n    <li>\n      <strong>"),s=new Strava.I18n.PaceFormatter,i.push("        "+e(t(s.format(this.activity.average_speed/3600)))),i.push("        \x91<abbr class='unit' title='"+e(t(s.unitLong()))+"'>"+e(t(s.unitShort()))+"</abbr>\x92\n      </strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.pace.header.pace")))+"</div>\n    </li>\n    <li>\n      <strong>"),i.push("        "+e(t((new Strava.I18n.TimespanFormatter).display(this.activity.moving_time)))),i.push("      </strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.pace.header.run_time")))+"</div>\n    </li>"),this.activity.elev_gain&&!this.activity.trainer&&(i.push("    <li>\n      <strong>"),a=new Strava.I18n.ElevationFormatter,i.push("        "+e(t(a.format(this.activity.elev_gain)))),i.push("        \x91<abbr class='unit' title='"+e(t(a.unitLong()))+"'>"+e(t(a.unitShort()))+"</abbr>\x92\n      </strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.pace.header.elevation")))+"</div>\n    </li>")),i.push("    <li>\n      <strong>"),this.activity.calories?(r=new TwitterCldr.DecimalFormatter,i.push("        "+e(t(r.format(this.activity.calories,{precision:0}))))):i.push("        &mdash;"),i.push("      </strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.pace.header.calories")))+"</div>\n    </li>\n  </ul>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_runs"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<section class='pinnable-view with-border' id='similar-activities-section'>\n  <div class='inset main'>\n    <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_runs.heading")))+"</h2>\n    <div class='row'>\n      <div class='spans8'>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_runs.blurb")))+"</div>\n    </div>\n  </div>\n  <div class='pinnable-anchor'>\n    <div class='pinnable' id='similar-activities-pinnable'>\n      <div id='similar-activities-chart-container'>\n        <div class='base-chart' id='similar-activities-chart'>\n          <div class='spinner'>\n            <div class='graphic'></div>\n          </div>\n        </div>\n        <div id='similar-activities-chart-footer'></div>\n      </div>\n      <table class='efforts-table marginless'>\n        <thead>\n          <tr>\n            <th class='date-column'>"+e(t(Strava.I18n.Locale.t("templates.generic.date")))+"</th>\n            <th class='name-column'>"+e(t(Strava.I18n.Locale.t("templates.generic.activity")))+"</th>\n            <th class='pace-column'>"+e(t(Strava.I18n.Locale.t("templates.generic.pace")))+"</th>\n            <th class='difference-column'>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_runs.all_time_average_difference")))+"</th>\n            <th class='time-column'>"+e(t(Strava.I18n.Locale.t("templates.generic.moving_time")))+"</th>\n            <th class='hr-column'>"+e(t(Strava.I18n.Locale.t("templates.generic.heartrate_abbr")))+"</th>\n            <th class='activity-column'></th>\n          </tr>\n        </thead>\n      </table>\n    </div>\n  </div>\n  <div id='similar-activities-efforts-table-container'>\n    <div class='spinner'>\n      <div class='graphic'></div>\n    </div>\n  </div>\n  <footer></footer>\n</section>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SharedRunViewFactoryModule={createPaceZonesView:function(){var t,e,i,r,n,a;return i=this.page(),n=this.create_template_for("#pace-zones-template"),t=this.$$("#view"),t.html(n({})),e={activity:this.page().activity().attributes},this.addHeaderView(t,"activities/pace/header",e),r=i.athleteRacePace(),a=new Strava.Labs.Activities.RunPaceZonesView(t.find(".distribution-chart"),i.paceZones()),r&&i.paceZonesRefreshView(new Strava.Labs.Activities.PaceZonesRefreshView(r,{el:t.find(".js-pace-zones-alert")})),this.addLogging(t)},createSimilarRunsView:function(t,e){var i,r,n;return n="activities/similar_runs",i=this.$$("#view"),i.html(JST[n]()),this.page().handlePageScroll(),new Strava.Labs.Activities.SimilarActivities.Chart(new Strava.Labs.Activities.SimilarActivities.ChartDataContext(t),e),new Strava.Labs.Activities.SimilarActivities.ChartFooterView(t.summary),new Strava.Labs.Activities.SimilarActivities.EffortsTableView(t,e),r={type:"MATCHED_RUNS_DETAIL",matched_runs_detail:{activity_id:this.page().activity().id}},Strava.Util.EventLogging.trackEvent("VIEW",r)},addLogging:function(t){var e;return t.find("#js-snw-adp-pace-zones-upsell").length>0?(Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"screen_enter",element:"join_summit_pace_zones"}),e="#js-snw-adp-pace-zones-upsell-cta",t.off("click",e).on("click",e,function(){return function(){return Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"click",element:"join_summit_pace_zones"})}}(this))):void 0}}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/race_results"]=function(t){return function(){var t,e,i,r,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],n=new Strava.I18n.TimespanFormatter,r=new Strava.I18n.PaceFormatter,i.push("<div class='inset'>\n  <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.race_results.header",{race_name:this.race.name})))+"</h2>\n  <ul class='inline-stats left narrow'>\n    <li>\n      <strong>"+e(t(n.display(this.race.result_time)))+"</strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.race_results.finish_time")))+"</div>\n    </li>"),i.push("    <li>\n      <strong>"+e(t(r.formatShort(this.race.distance/this.race.result_time)))+"</strong>\n      <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.activities.race_results.average_race_pace")))+"</div>\n    </li>"),this.race.goal_time&&this.race.result_time<this.race.goal_time&&(i.push("    <li class='goal-accomplishment'>\n      <strong>\n        <span class='segment-goal-accomplished'></span>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.race_results.race_goal",{time:n.display(this.race.goal_time)})))),i.push("      </strong>\n    </li>")),i.push("  </ul>\n  <div class='clear'></div>\n  <p>"+t(Strava.I18n.Locale.t("templates.activities.race_results.view_results",{path:this.race.path,race_name:this.race.name}))+"</p>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.RaceResultsView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="row",i.prototype.initialize=function(t){return this.data=t,this.template="activities/race_results"},i.prototype.render=function(){return this.renderTemplate({race:this.data}),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.AthleteRunningRace=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.urlRoot="/athlete_running_races",i.RESULT_SOURCE={ACTIVITY_ELAPSED_TIME:0,USER_ENTRY:1,ADMIN_ENTRY:2},i.prototype.toJSON=function(){var t,e,r,n,a;return t=i.__super__.toJSON.call(this),n=(new Strava.I18n.TimespanFormatter).paddedHoursMinutesSeconds(this.get("result_time")),e=n[0],r=n[1],a=n[2],t.hours=e,t.minutes=r,t.seconds=a,t},i}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/verify_race"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],this.race.activity_confirmed?(i.push("<div class='verify-time-question'>\n  <h3 class='bottomless'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.verify_race.official_time")))),i.push("  </h3>\n  <a href='"+e(t(this.race.website))+"' target='_blank'>"+e(t(this.race.name))+"</a>\n</div>\n<div class='inline-inputs time-results'>\n  <span>\n    <input class='lg' type='text' name='hours' value='"+e(t(this.race.hours))+"'>\n    <strong>:</strong>\n  </span>\n  <span>\n    <input class='lg' type='text' name='minutes' value='"+e(t(this.race.minutes))+"'>\n    <strong>:</strong>\n  </span>\n  <span>\n    <input class='lg' type='text' name='seconds' value='"+e(t(this.race.seconds))+"'>\n  </span>\n  <span>\n    <button class='alt' id='confirm-time'>"+e(t(Strava.I18n.Locale.t("templates.activities.verify_race.confirm_time")))+"</button>\n  </span>\n</div>")):(i.push("<h3 class='bottomless'>"),i.push("  "+t(Strava.I18n.Locale.t("templates.activities.verify_race.confirm_run_race",{path:this.race.path,race_name:this.race.name}))),i.push("  <button class='alt' id='confirm-race'>"+e(t(Strava.I18n.Locale.t("templates.generic.yes_uc")))+"</button>\n  <button id='deny-race'>"+e(t(Strava.I18n.Locale.t("templates.generic.no_uc")))+"</button>\n</h3>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.VerifyRaceView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="inset",i.prototype.events={"click #confirm-race":"confirmActivityId","click #deny-race":"removeActivityId","click #confirm-time":"confirmTime"},i.prototype.initialize=function(t){return this.pageView=t,this.template="activities/verify_race",this.model=new Strava.Models.AthleteRunningRace(this.pageView.activity().get("raceData"))},i.prototype.render=function(){var t;return t={race:this.model.toJSON()},this.renderTemplate(t),this},i.prototype.removeActivityId=function(){return this.model.set("remove_activity",!0),this.model.save(),this.remove()},i.prototype.confirmActivityId=function(){return this.model.set("activity_confirmed",!0),this.model.save(),this.renderTemplate({race:this.model.toJSON()}),this},i.prototype.confirmTime=function(){var t,e,i,r;return this.remove(),t=parseInt(this.$('input[name="hours"]').val(),10),e=parseInt(this.$('input[name="minutes"]').val(),10),r=parseInt(this.$('input[name="seconds"]').val(),10),i=r+60*e+60*t*60,this.model.set("result_time",i),this.model.set("result_time_source",Strava.Models.AthleteRunningRace.RESULT_SOURCE.USER_ENTRY),this.model.save(),this.renderResultsView()},i.prototype.renderResultsView=function(){var t,e;return this.remove(),this.$$("footer.achievements").remove(),this.pageView.activity().set("verified_running_race",!0),this.pageView.activity().set("raceData",this.model.toJSON()),e=new Strava.Labs.Activities.RaceResultsView(this.model.toJSON()),t=this.$$("#race-results"),t.html(e.render().el)
},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.BestEffortsTableViewModel=function(e){function i(t){i.__super__.constructor.call(this,t,"best-efforts"),this.context.on("effortsLoaded",function(t){return function(){return t.trigger("ready")}}(this))}return t(i,e),i.prototype.hasFullColumns=function(){return this.hasHeartrate()?!0:!1},i.prototype.getUnit=function(t){return this.context.getUnit(t)},i.prototype.hasHeartrate=function(){return this.context.effortsLoaded()&&this.hasEfforts()&&this.context.getEfforts().at(0).has("avg_hr")},i.prototype.hasEfforts=function(){return this.context.getEfforts().length>0},i.prototype.newEffortsTypes=function(){return this.context.bestEffortsCollection.newEffortTypes},i.prototype.removeBestEfforts=function(t){return jQuery.ajax({type:"POST",url:"/activities/"+this.context.efforts.activityId+"/remove_best_efforts",data:{activity_id:this.context.efforts.activityId},success:t,dataType:"json"})},i.prototype.resetBestEfforts=function(t){return jQuery.ajax({type:"POST",url:"/activities/"+this.context.efforts.activityId+"/reset_best_efforts",data:{activity_id:this.context.efforts.activityId},success:t,dataType:"json"})},i.prototype.addBestEffort=function(t,e){return jQuery.ajax({type:"POST",url:"/activities/"+this.context.efforts.activityId+"/force_create_best_effort",data:{activity_id:this.context.efforts.activityId,distance:t},success:e,dataType:"json"})},i}(Strava.Labs.Activities.EffortsTableViewModel)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/best_efforts/table"]=function(t){return function(){var t,e,i,r,n,a,s;for(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='dense hoverable laps padded-values'>\n  <thead>\n    <tr>\n      <th>Distance</th>\n      <th>Time</th>\n      <th>\n        <span class='glossary-link run-version' data-glossary-term='definition-elapsed-time'>Pace</span>\n      </th>\n      <th>\n        <abbr title='Elevation Gain/Loss'>Elev</abbr>\n      </th>"),this.hasHeartrate&&i.push("      <th>HR</th>"),i.push("      <th>Hidden?</th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.push(this.hasEfforts?"<button id='remove-best-efforts'>Remove Best Efforts</button>":"No Best Efforts"),i.push("<button id='reset-best-efforts'>Reset Best Efforts</button>\n<div class='add-best-effort'>\n  <label for='best-effort-type-drop-down'>Force create best effort using activity time</label>\n  <div class='drop-down-menu enabled' id='best-effort-type-drop-down'>\n    <div class='selection' data-current=''>Select distance</div>\n    <ul class='hidden options'>"),s=this.newEffortTypes,n=0,a=s.length;a>n;n++)r=s[n],i.push("      <li>\n        <a data-value='"+e(t(r.value))+"'>"+e(t(r.label))+"</a>\n      </li>");return i.push("    </ul>\n  </div>\n  <input id='best-effort-type' type='hidden' name='best-effort-type'>\n  <button id='add-best-effort'>Add Best Effort</button>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/best_efforts/row"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>"+e(t(this.label))+"</td>\n<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.time,5))),i.push("</td>\n<td>"),this.pace.value?(i.push("  "+t(Strava.Util.StringUtils.lpad(this.pace.value,5))),i.push("  <abbr class='unit' title='"+e(t(this.pace.abbr.title))+"'>"+e(t(this.pace.abbr.value))+"</abbr>")):i.push("  &mdash;"),i.push("</td>\n<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.elevation.value,6))),i.push("  <abbr class='unit' title='"+e(t(this.elevation.abbr.title))+"'>"+e(t(this.elevation.abbr.value))+"</abbr>\n</td>"),this.heartrate.value&&(i.push("<td>"),i.push("  "+t(Strava.Util.StringUtils.lpad(this.heartrate.value,3))),i.push("  <abbr class='unit' title='"+e(t(this.heartrate.abbr.title))+"'>"+e(t(this.heartrate.abbr.value))+"</abbr>\n</td>")),i.push("<td>"),this.hidden.value&&i.push("  Yes"),i.push("</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.BestEffortsTableView=function(e){function i(t,e){this.template="activities/best_efforts/table",i.__super__.constructor.call(this,t,e)}return t(i,e),i.prototype.events={"click button#remove-best-efforts":"handleRemoveBestEfforts","click button#reset-best-efforts":"handleResetBestEfforts","click button#add-best-effort":"handleAddBestEffort","click #best-effort-type-drop-down a":"selectBestEffortDistance"},i.prototype.render=function(){return this.render_template({elevationUnit:this.tableViewModel.getUnit("altitude"),hasHeartrate:this.tableViewModel.hasHeartrate(),hasEfforts:this.tableViewModel.hasEfforts(),newEffortTypes:this.tableViewModel.newEffortsTypes()}),this.renderEfforts(),this},i.prototype.renderEfforts=function(){var t,e;return e="activities/best_efforts/row",t=this.$("tbody"),this.tableViewModel.each(function(i){var r;return r=new Strava.Labs.Activities.EffortRowView(i,e),t.append(r.render().el)})},i.prototype.handleRemoveBestEfforts=function(){return this.tableViewModel.removeBestEfforts(function(){return location.reload()})},i.prototype.handleResetBestEfforts=function(){return this.tableViewModel.resetBestEfforts(function(){return location.reload()})},i.prototype.handleAddBestEffort=function(){var t;return t=this.$('input[name="best-effort-type"]')[0].value,this.tableViewModel.addBestEffort(t,function(){return location.reload()})},i.prototype.selectBestEffortDistance=function(t){var e,i,r,n;return r=this.$(t.target),n=r.data("value"),e=r.closest(".drop-down-menu"),i=e.find(".selection"),i.data("current",n),i.text(r.text()),this.$('input[name="best-effort-type"]').val(n)},i}(Strava.Labs.Activities.EffortsTableView)}.call(this),function(){Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.PaceAnnotations=function(){function t(t,e,i,r,n){this.parentGroup=t,this.dataContext=e,this.viewModel=i,this.xScale=r,this.yScale=n,this.paceFormatter=new Strava.I18n.ChartLabelPaceFormatter}var e,i,r;return e={circleRadius:3.5,elbow:{width:5,padding:5},terminatorHeight:6,key:{paddingLeft:7,valueYOffset:5,labelYOffset:-8,verticalBuffer:30}},r={pace:"#21B5EA",grade_adjusted_pace:"#8B62D1"},i={fastest:"strava.charts.activities.activity_pace.fastest",average:"strava.charts.activities.activity_pace.average",slowest:"strava.charts.activities.activity_pace.slowest"},t.prototype.create=function(){return this.group=this.parentGroup.append("g").attr("id","g-pace-annotation-group").attr("opacity",0),this.createFastGroup(),this.createAverageGroup(),this.createSlowGroup()},t.prototype.show=function(t){return t.select("#g-pace-annotation-group").attr("opacity",1)},t.prototype.hide=function(t){return t.select("#g-pace-annotation-group").attr("opacity",0)},t.prototype.update=function(t){return this.updateFastGroup(t),this.updateAverageGroup(t),this.updateSlowGroup(t)},t.prototype.createFastGroup=function(){return this.createGroup(this.group,this.fastAttributes(),"g-pace-annotation-fast")},t.prototype.updateFastGroup=function(t){return this.updateGroup("#g-pace-annotation-fast",this.fastAttributes(),t)},t.prototype.createAverageGroup=function(){return this.createGroup(this.group,this.avgAttributes(),"g-pace-annotation-avg","pace-bar-lines-avg")},t.prototype.updateAverageGroup=function(t){return this.updateGroup("#g-pace-annotation-avg",this.avgAttributes(),t)},t.prototype.createSlowGroup=function(){return this.createGroup(this.group,this.slowAttributes(),"g-pace-annotation-slow")},t.prototype.updateSlowGroup=function(t){return this.updateGroup("#g-pace-annotation-slow",this.slowAttributes(),t)},t.prototype.createGroup=function(t,e,i,r){var n,a;return null==r&&(r=null),a=t.append("g").attr("id",i),n=["pace-annotation-primary","pace-bar-lines"],null!=r&&n.push(r),a.append("line").classed(n.join(" "),!0).call(function(t){return function(i){return t.bindLine(i,e.primary,e.color)}}(this)),a.append("line").classed("pace-annotation-terminator pace-bar-lines",!0).call(function(t){return function(i){return t.bindLine(i,e.terminator,e.color)}}(this)),e.circle&&a.append("circle").call(function(t){return function(i){return t.bindCircle(i,e.circle,e.color)}}(this)),e.elbow&&(a.append("line").classed("pace-annotation-elbow-h pace-bar-lines",!0).call(function(t){return function(i){return t.bindLine(i,e.elbow.horizontal,e.color)}}(this)),a.append("line").classed("pace-annotation-elbow-v pace-bar-lines",!0).call(function(t){return function(i){return t.bindLine(i,e.elbow.vertical,e.color)}}(this))),a.append("text").classed("chart-label",!0).attr("dy",".35em").attr("text-anchor","left").call(function(t){return function(i){return t.bindTextLabel(i,e.key.label)}}(this)),a.append("text").classed("chart-value",!0).attr("dy",".35em").attr("text-anchor","left").call(function(t){return function(i){return t.bindTextValue(i,e.key.value)}}(this))},t.prototype.updateGroup=function(t,e,i){var r;return r=i.select(t),r.selectAll(".pace-annotation-primary").call(function(t){return function(i){return t.bindLine(i,e.primary,e.color)}}(this)),r.selectAll(".pace-annotation-terminator").call(function(t){return function(i){return t.bindLine(i,e.terminator,e.color)}}(this)),e.elbow&&(r.selectAll(".pace-annotation-elbow-h").call(function(t){return function(i){return t.bindLine(i,e.elbow.horizontal,e.color)}}(this)),r.selectAll(".pace-annotation-elbow-v").call(function(t){return function(i){return t.bindLine(i,e.elbow.vertical,e.color)}}(this))),e.circle&&r.selectAll("circle").call(function(t){return function(i){return t.bindCircle(i,e.circle,e.color)}}(this)),r.selectAll(".chart-label").call(function(t){return function(i){return t.bindTextLabel(i,e.key.label)}}(this)),r.selectAll(".chart-value").call(function(t){return function(i){return t.bindTextValue(i,e.key.value)}}(this))},t.prototype.bindLine=function(t,e,i){return t.attr("x1",e.x1).attr("x2",e.x2).attr("y1",e.y1).attr("y2",e.y2).attr("stroke",i)},t.prototype.bindCircle=function(t,e,i){return t.attr("cx",e.cx).attr("cy",e.cy).attr("r",e.r).attr("stroke",i).attr("fill",i)},t.prototype.bindTextLabel=function(t,e){return t.attr("x",e.x).attr("y",e.y).text(e.text)},t.prototype.bindTextValue=function(t,e){return t.attr("x",e.x).attr("y",e.y).text(e.text)},t.prototype.fastAttributes=function(){var t,e;return e=this.viewModel.get("stream"),t=this.dataContext.fastestSplit(e),this.elbowedLineAttributes(t,e,{elbow:"up",txKey:"fastest"})},t.prototype.avgAttributes=function(){var t;return t=this.dataContext.averagePace(this.viewModel.get("stream")),this.spanningLineAttributes(t,{txKey:"average"})},t.prototype.slowAttributes=function(){var t,e;return e=this.viewModel.get("stream"),t=this.dataContext.slowestSplit(e),this.elbowedLineAttributes(t,e,{elbow:"down",txKey:"slowest"})},t.prototype.spanningLineAttributes=function(t,i){var r,n,a,s,o;return r=this.xScale.range(),n=r[0],a=r[1],s=a+e.elbow.padding+e.elbow.width,o=this.yScale(t),this.baseAttributes(n,s,s,o,o,t,i.txKey)},t.prototype.elbowedLineAttributes=function(t,i,r){var n,a,s,o,l,c,h,u;return s=this.xScale(t.startDistance+t.distance/2),o=this.xScale.range()[1]+e.elbow.padding,l=o+e.elbow.width,c=this.yScale(t[i]),a=Math.abs(c-this.yScale(this.dataContext.averagePace(this.viewModel.get("stream")))),u=a<e.key.verticalBuffer?e.key.verticalBuffer-a:0,h=function(){switch(r.elbow){case"up":return c-u;case"down":return c+u;default:return c}}(),n=this.baseAttributes(s,o,l,c,h,t[i],r.txKey),n.circle={cx:s,cy:c,r:e.circleRadius},n.elbow={horizontal:{x1:o,x2:l,y1:h,y2:h},vertical:{x1:o,x2:o,y1:c,y2:h}},n},t.prototype.baseAttributes=function(t,n,a,s,o,l,c){return{color:r[this.viewModel.get("stream")],primary:{x1:t,x2:n,y1:s,y2:s},terminator:{x1:a,x2:a,y1:o-e.terminatorHeight,y2:o+e.terminatorHeight},key:{value:{x:a+e.key.paddingLeft,y:o+e.key.valueYOffset,text:this.paceFormatter.formatShort(l)},label:{x:a+e.key.paddingLeft,y:o+e.key.labelYOffset,text:Strava.I18n.Locale.t(i[c])}}}},t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pace_analysis/lap_info_box"]=function(t){return function(){var t,e,i,r;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<strong class='marginless'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.lap_info_box.label",{index:this.effort.label})))),i.push("</strong>\n<p class='marginless'>"),i.push("  "+e(t((new Strava.I18n.ChartLabelDistanceFormatter).formatShort(this.effort.distance,2)))),i.push("  &nbsp; &nbsp;"),"pace"===this.effort.primaryPaceType?i.push("  "+e(t((new Strava.I18n.ChartLabelPaceFormatter).formatShort(this.effort.pace)))):(r=(new Strava.I18n.ChartLabelPaceFormatter).formatShort(this.effort.grade_adjusted_pace),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.shared.gap",{gap:r}))))),i.push("  &nbsp; &nbsp;"),i.push("  "+e(t((new Strava.I18n.TimespanFormatter).display(this.effort.elapsedTime)))),i.push("</p>"),this.effort.zone&&(i.push("<p class='light marginless'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.shared.pace_zone",{zone:this.effort.zone.name,description:this.effort.zone.description})))),i.push("</p>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pace_analysis/split_info_box"]=function(t){return function(){var t,e,i,r,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<strong class='marginless'>"),n="templates.activities.pace_analysis.split_info_box.label."+Strava.I18n.Locale.unitSystem(),i.push("  "+e(t(Strava.I18n.Locale.t(n,{index:this.effort.label})))),i.push("</strong>\n<p class='marginless'>"),i.push("  "+e(t((new Strava.I18n.ChartLabelPaceFormatter).formatShort(this.effort.pace)))),i.push("  &nbsp; &nbsp;"),r=(new Strava.I18n.ChartLabelPaceFormatter).formatShort(this.effort.grade_adjusted_pace),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.shared.gap",{gap:r})))),i.push("</p>"),this.effort.zone&&(i.push("<p class='light marginless'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.shared.pace_zone",{zone:this.effort.zone.name,description:this.effort.zone.description})))),i.push("</p>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.BarInfoBox=function(){function t(t,e,i,r){this.parentGroup=t,this.flexibleInfoBox=e,this.viewModel=i,this.yOffset=r}return t.prototype.create=function(){return this.group=this.parentGroup.append("g").attr("id","g-bar-box").attr("opacity",0),this.group.append("line").classed("pace-info-crossbar",!0)},t.prototype.show=function(t,e,i,r,n){return t.select("#g-bar-box").attr("opacity",1),this.renderHTML(n),this.flexibleInfoBox.move(e,i,r),this.flexibleInfoBox.show(),this.group.select(".pace-info-crossbar").attr("x1",e).attr("x2",e).attr("y1",this.yOffset).attr("y2",i)},t.prototype.hide=function(t){return t.select("#g-bar-box").attr("opacity",0),this.flexibleInfoBox.hide()},t.prototype.update=function(t,e,i,r,n){return this.renderHTML(n),this.flexibleInfoBox.move(e,i,r),t.select("#g-bar-box").selectAll(".pace-info-crossbar").attr("y2",i)},t.prototype.renderHTML=function(t){var e;return e=function(){switch(this.viewModel.get("chart")){case this.viewModel.CHARTS.LAPS:return"activities/pace_analysis/lap_info_box";case this.viewModel.CHARTS.SPLITS:return"activities/pace_analysis/split_info_box";default:throw new Error("PaceAnalysis.BarInfoBox: tried to show unsupported chart")}}.call(this),this.flexibleInfoBox.html(JST[e]({effort:t}))},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.FlexibleInfoBox=function(){function t(t,e){this.offsets=e,this.$textBox=jQuery("<div></div>").attr("class","pace-info-box"),t.append(this.$textBox)}var e;return e=5,t.prototype.html=function(t){return this.$textBox.html(t)},t.prototype.show=function(){return this.$textBox.addClass("point-on-path-box-visible")},t.prototype.hide=function(){return this.$textBox.removeClass("point-on-path-box-visible")},t.prototype.move=function(t,i,r){var n,a,s;return n=this.$textBox.outerWidth(),a=t+n+e>r?t-n+this.offsets.left-e:t+this.offsets.left+e,s=this.offsets.top,this.$textBox.css({left:a+"px",top:s+"px"})},t.prototype.outerHeight=function(){return this.$textBox.outerHeight()},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.SmoothInfoBox=function(){function t(t,e,i,r){this.parentGroup=t,this.flexibleInfoBox=e,this.viewModel=i,this.yOffset=r}var e,i;return i={circleRadius:3.5},e={pace:"#4799b9",grade_adjusted_pace:"#310085"},t.prototype.create=function(){return this.group=this.parentGroup.append("g").attr("id","g-smooth-info-box").attr("opacity",0),this.group.append("line").classed("pace-info-crossbar",!0),this.group.append("circle").classed("smooth-pace-info-point",!0)},t.prototype.show=function(t){return t.select("#g-smooth-info-box").attr("opacity",1),this.flexibleInfoBox.show()},t.prototype.hide=function(t){return t.select("#g-smooth-info-box").attr("opacity",0),this.flexibleInfoBox.hide()},t.prototype.update=function(t,i,r,n){return this.flexibleInfoBox.html(JST["activities/pointInfoBox"]({items:n})),this.flexibleInfoBox.move(t,i,r),this.group.select(".pace-info-crossbar").attr("x1",t).attr("x2",t).attr("y1",this.yOffset).attr("y2",this.yOffset+300),this.group.select(".smooth-pace-info-point").attr("cx",t).attr("cy",i).attr("r",3.5).attr("stroke",e[this.viewModel.get("stream")])},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.Chart=function(e){function i(t,e,r){this.dataContext=e,this.viewModel=r,i.__super__.constructor.call(this,{el:t}),this.paceFormatter=new Strava.I18n.ChartLabelPaceFormatter,this.elevationFormatter=new Strava.I18n.ChartLabelElevationFormatter,this.viewModel.on("change:chart",function(t){return function(e){return t.handleChangeChart(e)}}(this)).on("change:stream",function(t){return function(e){return t.handleChangeStream(e)}}(this)).on("change:zoom",function(t){return function(e){return t.handleChangeZoom(e)}}(this)).on("mouseenter",function(t){return function(){return t.handleMouseenter()}}(this)).on("mouseleave",function(t){return function(){return t.handleMouseleave()}}(this)).on("mousemove",function(t){return function(e){return t.handleMousemove(e)}}(this)).on("effort:highlight",function(t){return function(e){return t.handleHighlightEffort(e)}}(this)).on("effort:unhighlight",function(t){return function(e){return t.handleUnhighlightEffort(e)}}(this)).on("effort:select",function(t){return function(e){return t.handleSelectEffort(e)}}(this)).on("effort:unselect",function(t){return function(e){return t.handleUnselectEffort(e)}}(this))}var r,n,a,s,o,l,c,h,u,p,d,f;return t(i,e),r=300,n={chart:{height:340,width:968,topSection:{height:110},padding:{top:10,bottom:30,right:85,left:60}},key:{width:70,padding:{left:5}},markers:{radius:27,xClipOffset:-10}},a=20,s={blur:1,x:2,y:-1,opacity:.16},d={LEFT:"left",CENTER:"center",RIGHT:"right"},l=30,f={paddingBottom:30,paddingTop:20,innerClamp:.0125,outerClamp:.186,innerRange:25},c={minimumThreshold:.13,count:5},p={pace:"#1193C0",grade_adjusted_pace:"#310085"},o={pace:"#E2F1F8",grade_adjusted_pace:"#EEE5FB"},u={pace:"#A8DDF0",grade_adjusted_pace:"#B89DE8"},h={pace:["#CAEEFB","#79D4F4","#22B9ED","#0095C6","#007198","#034359"],grade_adjusted_pace:["#EEE5FB","#D8C8F5","#B89DE8","#8B62D1","#5929AB","#310085"]},i.prototype.render=function(){return d3.select(".base-chart").empty(),this.createComponents(),this.show(this.viewModel.get("chart")),this},i.prototype.createComponents=function(){var t;return t=n.chart.padding,this.width=n.chart.width-t.left-t.right,this.yOffset=this.dataContext.isRace()?n.chart.topSection.height:0,this.height=n.chart.height-t.top-t.bottom,this.fullHeight=this.height+this.yOffset,this.svg=d3.select(".base-chart").append("svg").attr("width",n.chart.width).attr("height",n.chart.height+this.yOffset),this.mainGroup=this.svg.append("g").attr("transform","translate("+t.left+", "+t.top+")"),this.defs=this.svg.insert("defs",":first-child"),this.createDomains(),this.createScales(),this.dataContext.isRace()&&this.createRaceAnalysis(),this.createBars(),this.createPaceLine(),this.createXAxisIntegrated(),this.createPaceAnnotations(),this.createFlexibleInfoBox(),this.createSmoothInfoBox(),this.createBarInfoBox(),this.createElevationArea(),this.createEventRect(),this.createAxes(),this.createYAxisElevation()},i.prototype.createDomains=function(){var t,e;return this.xDomain=[0,this.dataContext.totalDistance()],t=this.dataContext.chartContext.convert("distance",1),e=_.extend({},f,{innerClamp:f.innerClamp/t,outerClamp:f.outerClamp/t}),this.yDomain=Strava.D3.Charts.Util.autoDomain(this.dataContext.paceExtent(),e),this.xDomainOrdinal=this.getXDomainOrdinal(),this.yDomainElevation=this.dataContext.adjustedElevationExtent()},i.prototype.updateDomains=function(){return this.xDomainOrdinal=this.getXDomainOrdinal()},i.prototype.getXDomainOrdinal=function(){var t;return t=this.dataContext.effortCount(this.viewModel.get("chart")),_.flatten(["l",_.range(1,t+1),"r"])},i.prototype.getXScaleOrdinal=function(){var t,e;return e=this.xScaleLinear,t=this.dataContext.effortData(this.viewModel.get("chart")).map(function(t){return function(i){var r;return r=function(){switch(this.xTickAlignment()){case d.LEFT:return 0;case d.CENTER:return i.distance/2;case d.RIGHT:return i.distance}}.call(t),e(i.startDistance+r)}}(this)),t.unshift(e(this.xDomain[0])),t.push(e(this.xDomain[1])),d3.scale.ordinal().domain(this.xDomainOrdinal).range(t)},i.prototype.getColorScale=function(){var t,e;return e=this.dataContext.paceZonesDomain(),null==e?null:(t=h[this.viewModel.get("stream")],d3.scale.linear().domain(e).range(t).clamp(!0))},i.prototype.createScales=function(){return this.xScaleLinear=d3.scale.linear().domain(this.xDomain).range([0,this.width]),this.xScaleOrdinal=this.getXScaleOrdinal(),this.yScale=d3.scale.linear().domain(this.yDomain).range([this.yOffset,this.fullHeight]).clamp(!0),this.yScaleElevation=d3.scale.linear().domain(this.yDomainElevation).range([this.fullHeight,this.fullHeight-this.height*a/100]),this.colorScale=this.getColorScale()},i.prototype.updateScales=function(){return this.xScaleOrdinal=this.getXScaleOrdinal(),this.colorScale=this.getColorScale()},i.prototype.getCurrentStroke=function(){return p[this.viewModel.get("stream")]},i.prototype.getCurrentFill=function(){return o[this.viewModel.get("stream")]},i.prototype.show=function(t){var e;switch(this.showAxes(this.viewModel.isSmoothChart()),this.showElevationArea(),this.dataContext.isRace()&&this.showRaceAnalysis(e),e=this.svg.transition().delay(0).duration(r),t){case this.viewModel.CHARTS.SMOOTH:return this.showSmoothedChart(e);case this.viewModel.CHARTS.SPLITS:return this.showSplitsChart(e);case this.viewModel.CHARTS.LAPS:return this.showLapsChart(e);default:throw new Error("PaceAnalysis.Chart: tried to show unknown chart")}},i.prototype.showSmoothedChart=function(t){return this.showPaceLine(t),this.showPaceAnnotations(t),this.showXAxisIntegrated(t)},i.prototype.showSplitsChart=function(t){return this.showPaceAnnotations(t),this.showBars(t),this.setPointerOnHover(!0)},i.prototype.showLapsChart=function(t){return this.showBars(t),this.viewModel.highlightEffort(0),this.setPointerOnHover(!0)},i.prototype.handleChangeChart=function(t){var e,i,n,a,s;return n=t.previous("chart"),e=t.get("chart"),s=this.svg.transition().delay(0).duration(r),this.updateDomains(),this.updateScales(),this.updateAxes(s),e===this.viewModel.CHARTS.SMOOTH?(this.hideBars(s),this.showPaceLine(s),this.showPaceAnnotations(s),this.showXAxisIntegrated(s),this.setPointerOnHover(!1)):n===this.viewModel.CHARTS.SMOOTH?(this.updateHiddenBars(),this.showBars(s),this.hidePaceLine(s),e===this.viewModel.CHARTS.LAPS&&this.hidePaceAnnotations(s),this.hideXAxisIntegrated(s),this.setPointerOnHover(!0)):(a=this.dataContext.effortData(n),i=this.dataContext.effortData(e),e===this.viewModel.CHARTS.LAPS&&this.hidePaceAnnotations(s),e===this.viewModel.CHARTS.SPLITS&&this.showPaceAnnotations(s),this.updateVisibleBars(s,a,i)),e===this.viewModel.CHARTS.LAPS?this.viewModel.highlightEffort(0):void 0},i.prototype.handleChangeStream=function(t){var e,i,n;return i=t.previous("stream"),e=t.get("stream"),n=this.svg.transition().delay(0).duration(r),this.updateScales(),this.updateBarStreams(n),this.updatePaceLine(n),this.updatePaceAnnotations(n),this.updateBarInfoBox(n),this.updateXAxisIntegrated(n)},i.prototype.handleChangeZoom=function(){},i.prototype.createAxes=function(){return this.axisGroup=this.mainGroup.append("g").attr("id","g-axis-group").attr("opacity",0),this.xAxis=d3.svg.axis().scale(this.xScaleOrdinal).orient("bottom").tickSize(4,0,0).tickPadding(4,0,0).tickValues(this.getVisibleXTicks()).tickFormat(function(t){return function(e){return t.formatXAxisTick(e)}}(this)),this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").tickSize(5,3,0).tickSubdivide(!0).tickFormat(function(t){return function(e){return t.paceFormatter.formatShort(e)}}(this)).tickValues(this.createYAxisTickValues(this.yDomain)),this.axisGroup.append("g").attr("id","xaxis").classed("axis xaxis paceline",!0).attr("transform","translate(0, "+this.fullHeight+")").call(this.xAxis),this.axisGroup.append("g").attr("id","yaxis").classed("axis yaxis paceline",!0).call(this.yAxis)},i.prototype.showAxes=function(t){return null==t&&(t=!0),this.mainGroup.select("#g-axis-group").attr("opacity",1),t?void 0:this.mainGroup.select("#xaxis-integrated").attr("opacity",0)},i.prototype.updateAxes=function(t){return this.xAxis.scale(this.xScaleOrdinal).tickValues(this.getVisibleXTicks()),t.select("#xaxis").call(this.xAxis)},i.prototype.createXAxisIntegrated=function(){var t,e;return t=this.dataContext.smoothPaceData(this.viewModel.get("stream")),e=n.chart.padding,this.defs.append("clipPath").attr("id","clip-xaxis-integrated").append("path").attr("d",this.paceArea(t)).attr("transform","translate(0, "+-this.fullHeight+")"),this.mainGroup.append("g").attr("id","xaxis-integrated").classed("axis xaxis-integrated",!0).attr("transform","translate(0, "+this.fullHeight+")").attr("clip-path","url(#clip-xaxis-integrated)")},i.prototype.bindXAxisIntegrated=function(){return this.xAxisIntegrated?void 0:(this.xAxisIntegrated=d3.svg.axis().scale(this.xScaleOrdinal).orient("bottom").tickValues(this.getVisibleXTicks()).tickSize(-this.height,0,0).tickFormat(""),this.mainGroup.select("#xaxis-integrated").call(this.xAxisIntegrated))},i.prototype.showXAxisIntegrated=function(t){return this.bindXAxisIntegrated(),t.select("#xaxis-integrated").attr("opacity",1)},i.prototype.hideXAxisIntegrated=function(t){return t.select("#xaxis-integrated").attr("opacity",0)},i.prototype.updateXAxisIntegrated=function(t){var e;return e=this.dataContext.smoothPaceData(this.viewModel.get("stream")),t.select("#clip-xaxis-integrated").selectAll("path").attr("d",this.paceArea(e))},i.prototype.createYAxisElevation=function(){return this.yAxisElevation=d3.svg.axis().scale(this.yScaleElevation).orient("right").ticks(3).tickSize(6,0,0).tickPadding(6).tickFormat(function(t){return function(e){return t.elevationFormatter.formatShort(e)}}(this)),this.axisGroup.append("g").attr("id","yaxis2").classed("axis yaxis2",!0).attr("transform","translate("+this.width+", 0)").call(this.yAxisElevation)},i.prototype.createElevationArea=function(){var t,e,i,r,n,a;return n=this.xScaleLinear,a=this.yScaleElevation,r=this.fullHeight,t=this.dataContext.elevationData(),this.elevationGroup=this.mainGroup.append("g").attr("id","g-elevation-group").attr("opacity",0).attr("clip-path","url(#clip-chart-bounds)"),e=d3.svg.area().x(function(t){return n(t.x)}).y(r).y1(function(t){return a(t.y)}).interpolate("basis"),this.elevationGroup.append("path").classed("elevation-integrated-fill",!0).attr("d",e(t)),i=new Strava.D3.Charts.Filter({root:this.svg},"dropShadow2"),i.basicShadow(".elevation-integrated-fill",s)},i.prototype.showElevationArea=function(){return this.elevationGroup.attr("opacity",1)},i.prototype.createYAxisTickValues=function(t){var e,i,r,n,a,s,o,l;return n=c,a=Strava.D3.Charts.Util.niceTimeTicks(t,n.count),e=this.dataContext.chartContext.convert("distance",1),r=n.minimumThreshold/e,a=a.filter(function(t){return t>=r}),s=this.yDomain,i=s[0],o=s[1],l=(o-i)*(1-f.paddingTop/100)+i,a.filter(function(t){return l>t})},i.prototype.getVisibleXTicks=function(){var t,e,i,r,n,a,s,o,c;if(t=this.xScaleOrdinal.domain(),n=this.xScaleLinear.invert(l),this.viewModel.isLapsChart())return c=t.slice(1,t.length-1),this.dataContext.lapData().reduce(function(){return function(t,e){var i;return i=_.last(t),i&&e.midDistance-i.midDistance<n||t.push(e),t}}(this),[]).map(function(t){return t.label});for(e=t[t.length-2]>this.dataContext.totalDistance()?2:1,c=t.slice(1,t.length-e),o=[],i=r=0,a=c.length,s=Math.ceil(n);s>0?a>r:r>a;i=r+=s)o.push(c[i]);return o},i.prototype.xTickAlignment=function(){return this.viewModel.isSmoothChart()?d.RIGHT:d.CENTER},i.prototype.formatXAxisTick=function(t){return this.viewModel.isLapsChart()?this.formatLapTick(t):this.formatSplitTick(t)},i.prototype.formatLapTick=function(t){return"l"===t||"r"===t?"":1===t?Strava.I18n.Locale.t("strava.labs.activities.pace_analysis.chart.lap",{index:t}):t},i.prototype.formatSplitTick=function(t){return"l"===t||"r"===t?"":1===t?""+t+this.dataContext.chartContext.getUnit("distance"):t},i.prototype.createPaceLine=function(){var t,e,i,r;return i=this.xScaleLinear,r=this.yScale,t=this.fullHeight,e=this.dataContext.smoothPaceData(this.viewModel.get("stream")),this.defs.append("clipPath").attr("id","clip-chart-bounds").append("rect").attr("x",0).attr("y",this.yOffset).attr("width",this.width).attr("height",this.height),this.paceLineGroup=this.mainGroup.append("g").attr("id","g-pace-line-group").attr("opacity",0).attr("clip-path","url(#clip-chart-bounds)"),this.paceLine=d3.svg.line().x(function(t){return i(t.distance)}).y(function(t){return r(t.pace)}).interpolate("basis"),this.paceArea=d3.svg.area().x(function(t){return i(t.distance)}).y0(t).y1(function(t){return r(t.pace)}).interpolate("basis"),this.paceLineGroup.append("path").attr("id","pace-line-smooth").classed("pace-area-line",!0).attr("d",this.paceLine(e)).attr("fill","none").attr("stroke",this.getCurrentStroke()),this.paceLineGroup.append("path").attr("id","pace-area-smooth").attr("d",this.paceArea(e)).attr("fill",this.getCurrentFill()),this.createSplitHighlightFills()},i.prototype.showPaceLine=function(t){return t.select("#g-pace-line-group").attr("opacity",1)},i.prototype.hidePaceLine=function(t){return t.select("#g-pace-line-group").attr("opacity",0)},i.prototype.updatePaceLine=function(t){var e,i;return e=this.dataContext.smoothPaceData(this.viewModel.get("stream")),i=t.select("#g-pace-line-group"),i.selectAll("#pace-line-smooth").attr("d",this.paceLine(e)).attr("stroke",this.getCurrentStroke()),i.selectAll("#pace-area-smooth").attr("d",this.paceArea(e)).attr("fill",this.getCurrentFill()),this.updateSplitHighlightFills(t)},i.prototype.createSplitHighlightFills=function(){var t,e,i,r,n,a;return a=this.xScaleLinear,i=this.dataContext.smoothPaceData(this.viewModel.get("stream")),r=this.dataContext.splitExtent(this.viewModel.get("stream")),e=r[0],n=r[1],this.defs.append("clipPath").attr("id","clip-split-fast").append("rect").attr("id","clip-split-fast-rect").attr("x",a(e.startDistance)).attr("y",this.yOffset).attr("width",a(e.distance)).attr("height",this.height),this.defs.append("clipPath").attr("id","clip-split-slow").append("rect").attr("id","clip-split-slow-rect").attr("x",a(n.startDistance)).attr("y",this.yOffset).attr("width",a(n.distance)).attr("height",this.height),t=this.defs.append("clipPath").attr("id","clip-split-highlights"),t.append("use").attr("xlink:href","#clip-split-fast-rect"),t.append("use").attr("xlink:href","#clip-split-slow-rect"),this.paceLineGroup.append("path").attr("id","split-highlights").attr("d",this.paceArea(i)).attr("fill",u[this.viewModel.get("stream")]).attr("clip-path","url(#clip-split-highlights)")
},i.prototype.updateSplitHighlightFills=function(t){var e,i,r,n,a;return a=this.xScaleLinear,i=this.dataContext.smoothPaceData(this.viewModel.get("stream")),r=this.dataContext.splitExtent(this.viewModel.get("stream")),e=r[0],n=r[1],t.select("#clip-split-fast-rect").attr("x",a(e.startDistance)).attr("width",a(e.distance)),t.select("#clip-split-slow-rect").attr("x",a(n.startDistance)).attr("width",a(n.distance)),t.select("#split-highlights").attr("d",this.paceArea(i)).attr("fill",u[this.viewModel.get("stream")])},i.prototype.appendBars=function(t){var e,i,r;return r=this.xScaleLinear,e=this.colorScale,i=this.viewModel.get("stream"),t.enter().append("rect").classed("simple-bar",!0).classed("default",null==e).classed("gap",this.viewModel.isGapStream()).attr("x",function(t){return r(t.startDistance)}).attr("y",this.fullHeight).attr("width",function(t){return r(t.distance)}).attr("height",0).attr("fill",function(t){return null!=e?e(t[i]):null})},i.prototype.createBars=function(){var t;return this.barGroup=this.mainGroup.append("g").attr("id","g-bar-group"),t=this.barGroup.selectAll("rect").data(this.dataContext.effortData(this.viewModel.get("chart"))),this.appendBars(t)},i.prototype.showBars=function(t){var e,i,r;return i=this.viewModel.get("stream"),r=this.yScale,e=this.fullHeight,t.select("#g-bar-group").selectAll("rect").attr("y",function(t){return r(t[i])}).attr("height",function(t){return e-r(t[i])})},i.prototype.hideBars=function(t){return t.select("#g-bar-group").selectAll("rect").attr("y",this.fullHeight).attr("height",0)},i.prototype.updateHiddenBars=function(){var t,e,i,r,n,a;return n=this.xScaleLinear,a=this.yScale,t=this.colorScale,r=this.viewModel.get("stream"),e=this.fullHeight,i=this.barGroup.selectAll("rect").data(this.dataContext.effortData(this.viewModel.get("chart"))).attr("x",function(t){return n(t.startDistance)}).attr("width",function(t){return n(t.distance)}).attr("fill",function(e){return null!=t?t(e[r]):null}).classed("gap",this.viewModel.isGapStream()),this.appendBars(i),i.exit().remove()},i.prototype.updateBarStreams=function(t){var e,i,r,n,a;return a=this.yScale,i=this.fullHeight,e=this.colorScale,n=this.viewModel.get("stream"),r=this.viewModel.isGapStream(),this.barGroup.selectAll("rect").classed("gap",r),this.viewModel.isSmoothChart()?void 0:t.select("#g-bar-group").selectAll("rect").attr("y",function(t){return a(t[n])}).attr("height",function(t){return i-a(t[n])}).attr("fill",function(t){return null!=e?e(t[n]):null})},i.prototype.updateVisibleBars=function(t,e,i){var r,n,a,s,o,l,c,h,u,p,d;return e=e.slice(0),i=i.slice(0),r=this.colorScale,o=this.viewModel.get("stream"),p=this.xScaleLinear,u=p.domain()[1],d=this.yScale,n=this.fullHeight,h=function(t){return t.attr("x",function(t){return p(t.startDistance)}).attr("y",function(t){return d(t[o])}).attr("width",function(t){return p(t.distance)}).attr("height",function(t){return n-d(t[o])}).attr("fill",function(t){return null!=r?r(t[o]):null})},e.length>i.length?(l=e.length-i.length,s=e.length,c=e.slice(s-l,s),i=i.concat(c.map(function(t){return{startDistance:u,distance:0,pace:t.pace,grade_adjusted_pace:t.grade_adjusted_pace}}))):(l=i.length-e.length,a=i.length,c=i.slice(a-l,a),e=e.concat(c.map(function(t){return{startDistance:u,distance:0,pace:t.pace,grade_adjusted_pace:t.grade_adjusted_pace}})),this.barGroup.selectAll("rect").data(e).enter().append("rect").classed("simple-bar",!0).classed("default",null==r).classed("gap",this.viewModel.isGapStream()).call(h)),this.barGroup.selectAll("rect").data(i),t.select("#g-bar-group").selectAll("rect").call(h)},i.prototype.barForIndex=function(t){return this.barGroup.selectAll("rect").select(function(e,i){return i===t?this:null})},i.prototype.createPaceAnnotations=function(){return this.paceAnnotations=new Strava.Labs.Activities.PaceAnalysis.PaceAnnotations(this.mainGroup,this.dataContext,this.viewModel,this.xScaleLinear,this.yScale),this.paceAnnotations.create()},i.prototype.showPaceAnnotations=function(t){return this.paceAnnotations.show(t)},i.prototype.hidePaceAnnotations=function(t){return this.paceAnnotations.hide(t)},i.prototype.updatePaceAnnotations=function(t){return this.paceAnnotations.update(t)},i.prototype.createRaceAnalysis=function(){var t,e,i,r,a,s;return r=this.dataContext.chartContext.getMeasurementPreference(),a=this.dataContext.chartContext.streamsContext.pointsOfInterest(r),e=this.dataContext.chartContext.convert("distance",1),a.forEach(function(t){return t.x=t.distance*e}),s=function(){return function(t){var e,i;switch(i=(new Strava.I18n.TimespanFormatter).display(t.time),t.race_type){case"5k":case"10k":case"50mi":return e=(new Strava.I18n.DistanceFormatter).formatShort(t.distance,0),{distance:e,time:i};case"halfmarathon":return e=new Strava.I18n.DistanceFormatter("metric").formatShort(t.distance,0),{distance:e,time:i};case"marathon":return e=new Strava.I18n.DistanceFormatter("metric").formatShort(t.distance,0),{distance:e,time:i};default:return{distance:""+t.label,time:i}}}}(this),t={height:function(t){return function(){return t.height}}(this),width:function(t){return function(){return t.width}}(this),topGroup:this.mainGroup,topGroupDimensions:function(t){return function(){return{height:n.chart.topSection.height,width:t.width}}}(this)},i=new Strava.D3.Charts.Marker,i.builder(t).xScale(this.xScaleLinear).yScale(this.yScale).data(a),this.markers=i,this.markers.radius(n.markers.radius).textGenerator(s).xClipOffset(n.markers.xClipOffset),this.markers.render()},i.prototype.showRaceAnalysis=function(t){return this.markers.show(t)},i.prototype.createFlexibleInfoBox=function(){var t;return t=_.clone(n.chart.padding),this.dataContext.isRace()&&(t.top+=n.chart.topSection.height),this.flexibleInfoBox=new Strava.Labs.Activities.PaceAnalysis.FlexibleInfoBox(this.$$(this.svg.node().parentNode),t)},i.prototype.createSmoothInfoBox=function(){return this.smoothInfoBox=new Strava.Labs.Activities.PaceAnalysis.SmoothInfoBox(this.mainGroup,this.flexibleInfoBox,this.viewModel,this.yOffset),this.smoothInfoBox.create()},i.prototype.showSmoothInfoBox=function(t){return this.smoothInfoBox.show(t)},i.prototype.hideSmoothInfoBox=function(t){return this.smoothInfoBox.hide(t)},i.prototype.updateSmoothInfoBox=function(t,e){var i,r;return i=this.dataContext.getSmoothInfoBoxData(this.xScaleLinear.invert(t),this.viewModel.get("stream")),r=this.xScaleLinear.range()[1],this.smoothInfoBox.update(t,e,r,i)},i.prototype.createBarInfoBox=function(){return this.barInfoBox=new Strava.Labs.Activities.PaceAnalysis.BarInfoBox(this.mainGroup,this.flexibleInfoBox,this.viewModel,this.yOffset),this.barInfoBox.create()},i.prototype.showBarInfoBox=function(t,e){return this.renderBarInfoBox(t,e,"show")},i.prototype.hideBarInfoBox=function(t){return this.barInfoBox.hide(t)},i.prototype.updateBarInfoBox=function(t){var e;return e=null!==this.viewModel.selectedEffortIndex?this.viewModel.selectedEffortIndex:null!==this.viewModel.highlightedEffortIndex?this.viewModel.highlightedEffortIndex:null,null!==e?this.renderBarInfoBox(t,e,"update"):void 0},i.prototype.renderBarInfoBox=function(t,e,i){var r,n,a,s,o;return r=this.dataContext.effortForIndex(this.viewModel.get("chart"),e),n=this.viewModel.get("stream"),a=this.xScaleLinear(r.midDistance),o=this.yScale(r[n]),s=this.xScaleLinear.range()[1],r=_.extend({},r,{primaryPaceType:n}),this.barInfoBox[i](t,a,o,s,r)},i.prototype.createEventRect=function(){var t,e;return t=this.mainGroup.append("rect"),e=t.node(),t.classed("event-rect",!0).attr("width",this.width).attr("height",this.fullHeight).on("mouseenter",function(t){return function(){return t.viewModel.mouseenter()}}(this)).on("mouseleave",function(t){return function(){return t.viewModel.mouseleave()}}(this)).on("click",function(t){return function(){var i,r,n,a;return t.viewModel.isSmoothChart()?void 0:(r=d3.mouse(e),n=r[0],a=r[1],i=t.barAtMouseX(n),t.viewModel.toggleSelectEffort(i))}}(this)).on("mousemove",function(t){return function(){var i,r,n,a,s,o;return n=d3.mouse(e),s=n[0],o=n[1],t.viewModel.isSmoothChart()?(i=t.xScaleLinear.invert(s),a=t.dataContext.indexForDistance(i),t.viewModel.mousemove(a)):(r=t.barAtMouseX(s),t.viewModel.highlightEffort(r))}}(this))},i.prototype.setPointerOnHover=function(t){return this.mainGroup.selectAll(".event-rect").classed("pointer",t)},i.prototype.barAtMouseX=function(t){var e;return e=this.xScaleLinear.invert(t),this.dataContext.effortAtDistance(this.viewModel.get("chart"),e).label-1},i.prototype.handleMouseenter=function(){var t;return this.viewModel.isSmoothChart()?(t=this.svg.transition().delay(0).duration(r),this.showSmoothInfoBox(t)):void 0},i.prototype.handleMousemove=function(t){var e,i,r;return this.viewModel.isSmoothChart()?(i=this.paceLineGroup.select("#pace-line-smooth").node(),e=this.dataContext.distanceForIndex(t),r=Strava.D3.Charts.Util.getPathPositionAt(i,this.xScaleLinear(e)),this.updateSmoothInfoBox(r.x,r.y)):void 0},i.prototype.handleMouseleave=function(){var t;return this.viewModel.isSmoothChart()?(t=this.svg.transition().delay(0).duration(r),this.hideSmoothInfoBox(t)):this.viewModel.clearHighlight()},i.prototype.handleHighlightEffort=function(t){var e;return this.viewModel.isSmoothChart()||(this.barForIndex(t).classed("highlighted",!0),e=this.svg.transition().delay(0).duration(r),null!=this.viewModel.selectedEffortIndex)?void 0:this.showBarInfoBox(e,t)},i.prototype.handleUnhighlightEffort=function(t){var e;return this.barForIndex(t).classed("highlighted",!1),e=this.svg.transition().delay(0).duration(r),null==this.viewModel.selectedEffortIndex?this.hideBarInfoBox(e):void 0},i.prototype.handleSelectEffort=function(t){var e;return this.viewModel.isSmoothChart()||(this.barForIndex(t).classed("selected",!0),null==this.viewModel.selectedEffortIndex)?void 0:(e=this.svg.transition().delay(0).duration(r),this.hideBarInfoBox(e),this.showBarInfoBox(e,t))},i.prototype.handleUnselectEffort=function(t){var e;return this.barForIndex(t).classed("selected",!1),e=this.svg.transition().delay(0).duration(r),this.hideBarInfoBox(e)},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pace_analysis/cta"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='info inset mt-sm' id='pace-analysis-cta'>\n  <img src='"+e(t(this.imagePath))+"' alt=''>\n  <p class='marginless'>\n    <strong>"+t(Strava.I18n.Locale.t("templates.activities.pace_analysis.cta.set_zones_v2_html"))+"</strong>\n  </p>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.ChartViewV2=function(e){function i(t,e,r,n){this.el=t,this.dataContext=e,this.viewModel=r,this.isOwner=null!=n?n:!1,i.__super__.constructor.call(this),this.chart=new Strava.Labs.Activities.PaceAnalysis.Chart(this.el,this.dataContext,this.viewModel),this.dataContext.deferred.done(function(t){return function(){return t.handleReady()}}(this))}return t(i,e),i.prototype.handleReady=function(){return this.$$("div.streams-loader").remove()},i.prototype.render=function(){return this.dataContext.deferred.done(function(t){return function(){var e;return t.isOwner&&!t.dataContext.hasPaceZones()&&(e=JST["activities/pace_analysis/cta"]({imagePath:t.viewModel.get("ctaImagePath")}),t.$el.before(e)),t.chart.render()}}(this)),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.EffortsTableView"),Strava.Labs.Activities.PaceAnalysis.EffortsTableView=function(e){function i(t,e,r,n){this.el=t,this.viewModel=e,null==n&&(n=null),i.__super__.constructor.call(this,{el:this.el}),this.viewModel.on("change:chart",function(t){return function(){return t.render()}}(this)),this.splitsTableViewModel=new Strava.Labs.Activities.SplitEffortsTableViewModel(r),n&&(this.lapsTableViewModel=new Strava.Labs.Activities.LapEffortsTableViewModel(n))}return t(i,e),i.prototype.render=function(){var t;return this.$el.empty(),t=this.viewModel.isLapsChart()?new Strava.Labs.Activities.LapEffortsTableView(this.$el,this.lapsTableViewModel,null,"activities/laps/table_run_narrow","activities/laps/row_run_narrow"):new Strava.Labs.Activities.SplitEffortsTableView(this.$el,this.splitsTableViewModel,"activities/splits/table","activities/splits/row"),t.render(),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.ViewModel=function(e){function i(t,e,a){var s;this.dataContext=t,this.dispatcher=e,s=_.defaults(a,{chart:r.SMOOTH,stream:n.PACE,showLaps:!1}),this.dispatcher.addListener(this,this),this.selectedEffortIndex=null,this.highlightedEffortIndex=null,i.__super__.constructor.call(this,s)}var r,n;return t(i,e),r={SMOOTH:"smoothed",SPLITS:"splits",LAPS:"laps"},n={PACE:"pace",GAP:"grade_adjusted_pace"},i.prototype.CHARTS=r,i.prototype.STREAMS=n,i.prototype.changeChart=function(t){return this.clearHighlight(),this.clearSelection(),_.contains(r,t)?this.set({chart:t}):void 0},i.prototype.changeStream=function(t){return _.contains(n,t)?this.set({stream:t}):void 0},i.prototype.isSmoothChart=function(){return this.get("chart")===r.SMOOTH},i.prototype.isLapsChart=function(){return this.get("chart")===r.LAPS},i.prototype.isGapStream=function(){return this.get("stream")===n.GAP},i.prototype.highlightEffort=function(t){var e,i;if(null===this.highlightedEffortIndex||t!==this.highlightedEffortIndex)return null!==this.highlightedEffortIndex&&this.unhighlightEffort(this.highlightedEffortIndex),e=this.get("chart"),i=this.dataContext.effortForIndex(e,t),this.dispatcher.dispatchHover(this,e,i.startIndex,i.endIndex),this.highlightedEffortIndex=t,this.trigger("effort:highlight",t)},i.prototype.unhighlightEffort=function(t){var e,i;return e=this.get("chart"),i=this.dataContext.effortForIndex(e,t),this.dispatcher.dispatchHoverOut(this,e,i.startIndex,i.endIndex),this.highlightedEffortIndex=null,this.trigger("effort:unhighlight",t)},i.prototype.toggleSelectEffort=function(t){var e,i,r;return e=this.get("chart"),i=this.dataContext.effortForIndex(e,t),t!==this.selectedEffortIndex?(null!=this.selectedEffortIndex&&(this.trigger("effort:unselect",this.selectedEffortIndex),this.trigger("effort:unhighlight",this.selectedEffortIndex),r=this.dataContext.effortForIndex(e,this.selectedEffortIndex),this.dispatcher.dispatchUnselect(this,e,r.startIndex,r.endIndex),this.dispatcher.dispatchHoverOut(this,e,r.startIndex,r.endIndex)),this.selectedEffortIndex=t,this.dispatcher.dispatchSelect(this,e,i.startIndex,i.endIndex),this.trigger("effort:select",t)):(this.dispatcher.dispatchUnselect(this,e,i.startIndex,i.endIndex),this.trigger("effort:unselect",t),this.selectedEffortIndex=null,null!==this.highlightedEffortIndex?this.trigger("effort:highlight",this.highlightedEffortIndex):void 0)},i.prototype.clearSelection=function(){return null!==this.selectedEffortIndex?this.toggleSelectEffort(this.selectedEffortIndex):void 0},i.prototype.clearHighlight=function(){return null!==this.highlightedEffortIndex?this.unhighlightEffort(this.highlightedEffortIndex):void 0},i.prototype.mouseenter=function(){return this.trigger("mouseenter")},i.prototype.mousemove=function(t){return this.trigger("mousemove",t),this.isSmoothChart()?this.dispatcher.dispatchMouseOver(this,"latlng",t):void 0},i.prototype.mouseleave=function(){return this.trigger("mouseleave"),this.isSmoothChart()?this.dispatcher.dispatchMouseOut(this,"wtf"):void 0},i.prototype.handleStreamSelect=function(t,e,i){var r;return r=this.dataContext.indexForEffort(this.get("chart"),e,i),null!=r?(null!=this.selectedEffortIndex&&(this.trigger("effort:unselect",this.selectedEffortIndex),this.trigger("effort:unhighlight",this.selectedEffortIndex)),this.selectedEffortIndex=r,this.trigger("effort:select",r)):void 0},i.prototype.handleStreamUnselect=function(t,e,i){var r;return this.selectedEffortIndex=null,r=this.dataContext.indexForEffort(this.get("chart"),e,i),null!=r?(this.trigger("effort:unselect",r),this.trigger("effort:unhighlight",r)):void 0},i.prototype.handleStreamHover=function(t,e,i){var r;return r=this.dataContext.indexForEffort(this.get("chart"),e,i),null!=r?this.trigger("effort:highlight",r):void 0},i.prototype.handleStreamHoverOut=function(t,e,i){var r;return r=this.dataContext.indexForEffort(this.get("chart"),e,i),null!=r?this.trigger("effort:unhighlight",r):void 0},i.prototype.handleStreamMouseOver=function(){},i.prototype.handleStreamMouseOut=function(){},i}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pace_analysis/controls"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='pace-controls row'>\n  <div class='inline-inputs marginless'>\n    <div class='btn-group chart-type pace-control-buttons'>\n      <button class='"+["btn-sm",""+e(t("splits"===this.chart?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-type='splits' title='"+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.splits_title")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.splits")))),i.push("      </button>"),this.showLaps&&(i.push("      <button class='"+["btn-sm",""+e(t("laps"===this.chart?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-type='laps' title='"+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.laps_title")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.laps")))),i.push("      </button>")),i.push("      <button class='"+["btn-sm",""+e(t("smoothed"===this.chart?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-type='smoothed' title='"+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.smoothed_title")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.smoothed")))),i.push("      </button>\n    </div>\n    <div class='btn-group pace-control-buttons stream-type'>\n      <button class='"+["btn-sm",""+e(t("pace"===this.stream?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-type='pace' title='"+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.pace_title")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.pace")))),i.push("      </button>\n      <button class='"+["btn-sm",""+e(t("grade_adjusted_pace"===this.stream?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-type='grade_adjusted_pace' title='"+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.gap_title")))+"'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.activities.pace_analysis.controls.gap")))),i.push("      </button>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.ControlsView=function(e){function i(t){this.viewModel=t,i.__super__.constructor.call(this),this.viewModel.on("change:chart",function(t){return function(){return t.handleChangeChart()}}(this)),this.viewModel.on("change:stream",function(t){return function(){return t.handleChangeStream()}}(this))}return t(i,e),i.prototype.template="activities/pace_analysis/controls",i.prototype.events={"click .chart-type > button":"handleChartTypeClick","click .stream-type > button":"handleStreamTypeClick"},i.prototype.render=function(){return this.render_template(this.viewModel.attributes),this},i.prototype.handleChartTypeClick=function(t){var e;return e=this.$(t.currentTarget),this.viewModel.changeChart(e.data("type"))},i.prototype.handleStreamTypeClick=function(t){var e;return e=this.$(t.currentTarget),this.viewModel.changeStream(e.data("type"))},i.prototype.handleChangeChart=function(){var t,e;return t=this.viewModel.get("chart"),e="[data-type='"+t+"']",this.$(".chart-type "+e).addClass("active"),this.$(".chart-type :not("+e+")").removeClass("active")},i.prototype.handleChangeStream=function(){var t,e;return e=this.viewModel.get("stream"),t="[data-type='"+e+"']",this.$(".stream-type "+t).addClass("active"),this.$(".stream-type :not("+t+")").removeClass("active")},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/best_efforts/view"]=function(t){return function(){var t;return t=[],t.push("<section id='best-efforts'>\n  <section class='capped no-margins row'>\n    <div class='spans8' id='map-canvas'></div>\n    <div class='spans8'>\n      <div id='chart-container'></div>\n      <div class='elev-chart-small spinner streams-loader'>\n        <div class='graphic'></div>\n      </div>\n    </div>\n  </section>\n  <section id='efforts-table'>\n    <div class='segments-loader spinner'>\n      <div class='graphic'></div>\n    </div>\n  </section>\n</section>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.RunViewFactory=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.SharedRunViewFactoryModule),r={effortsTableViewFactory:Strava.Labs.Activities.PaceAnalysis.EffortsTableView,paceAnalysisControlsViewFactory:Strava.Labs.Activities.PaceAnalysis.ControlsView,paceAnalysisChartViewV2Factory:Strava.Labs.Activities.PaceAnalysis.ChartViewV2,splitEffortsTableViewFactory:Strava.Labs.Activities.SplitEffortsTableView,verifyRaceViewFactory:Strava.Labs.Activities.VerifyRaceView},i.prototype.createOverviewView=function(t){var e,r,n,a,s;return i.__super__.createOverviewView.call(this,t),r=this.$$("#view"),this.page().showSplits()&&(e=r.find("#splits-container"),s=new this._splitEffortsTableViewFactory(e,new Strava.Labs.Activities.SplitEffortsTableViewModel(this.page().splitEffortsTableContext()),"activities/splits/table_small","activities/splits/row_small"),a=this.createResizer(r.find(".grabber"),"#splits-container .scrollable-table tbody"),a.min(160).size(360),this.page().pageContext().bind("fullscreenchange",function(){return function(){return setTimeout(function(){var t,i,n,a,s;return n=r.find("#map-canvas").outerHeight(),t=e.find("header").outerHeight(),s=e.find("thead").outerHeight(),a=e.find(".scrollable-table tbody"),i=Math.max(160,n-t-s),a.css("height",i)},0)}}(this))),this.page().activity().get("verified_running_race")?(n=new Strava.Labs.Activities.RaceResultsView(this.page().activity().get("raceData")),r=this.$$("#race-results"),r.html(n.render().el)):void 0},i.prototype.handleChangePaceAnalysisChart=function(t){var e;return e={page:"pace-analysis",action:"change-pace-analysis-chart",event_details:[{key:"new-chart-type",value:t.get("chart")},{key:"activity-id",value:this.page().activityId()},{key:"is-premium",value:this.page().currentAthlete().hasPaceZoneAnalysisAccess()}]},Strava.Util.EventLogging.trackEvent("CLIENT_ACTION",e)},i.prototype.createPaceAnalysisView=function(){var t,e,i,r,n,a,s,o,l,c,h,u,p,d,f,v;return v=this.page().paceAnalysisOptions(),v.showLaps&&(v.chart="laps"),n=this.page().paceAnalysisContext(v.showLaps),f=new Strava.Labs.Activities.PaceAnalysis.ViewModel(n,this.page().chartContext().eventDispatcher(),{showLaps:v.showLaps,chart:v.chart,ctaImagePath:v.ctaImagePath}),f.on("change:chart",function(t){return function(){return t.handleChangePaceAnalysisChart(f)}}(this)),i=new this._paceAnalysisControlsViewFactory(f),d=this.create_template_for("#pace-analysis-template"),e=this.$$("#view"),e.html(d({})),i.setElement(e.find("#chart-container")).render(),o=e.find("#map-canvas"),o.length>0&&(l=new this._mapFactory(this.page().mapContext(),o,this.page().pageContext(),this.page().mbr()).showFullScreenToggle(!1).initializeMap(),c=this.createResizer(e.find(".grabber"),"#map-canvas"),c.onComplete(function(){return function(){return l.getMap().resize()}}(this)).min(200).size(o.height()),this.page().showSplitsTable()&&(t=e.find("#run-efforts-table"),p=this.page().splitEffortsTableContext(),s=v.showLaps?this.page().lapEffortsTableContext():null,a=new this._effortsTableViewFactory(t,f,p,s),a.render()),h=new this._paceAnalysisChartViewV2Factory(e.find("#run-pace-chart"),n,f,this.page().isOwner()),h.render(),this.page().chartContext().isRace()||(r={activity:this.page().activity().attributes},this.addHeaderView(e,"activities/pace/header",r)),this.page().activity().get("verified_running_race")&&(u=new Strava.Labs.Activities.RaceResultsView(this.page().activity().get("raceData")),e=this.$$("#race-results"),e.html(u.render().el))),this.page().collapseHeader(),this.addLogging(e)},i.prototype.createBestEffortsView=function(t){var e,i,r,n,a,s,o,l,c;return i=Strava.Labs.Activities.ContextManager,r=Strava.Labs.Activities.StreamTransformSet,n=this.page().contexts.contextFor(i.TYPES.CHART,r.CONVERTED_ELAPSED_TIME),e=this.$$("#view"),e.html(JST["activities/best_efforts/view"]()),s=this.page().bestEffortsTableContext(),o=new Strava.Labs.Activities.BestEffortsTableView(this.$$("#efforts-table"),new Strava.Labs.Activities.BestEffortsTableViewModel(s)),a=new this._segmentsViewFactory(n,t,!0),a.setElement(e.find("#chart-container")).render(),l=e.find("#map-canvas"),c=this.page().contexts.contextFor(i.TYPES.MAP,r.CONVERTED_ELAPSED_TIME),new this._mapFactory(c,l,null,this.page().mbr()).showFullScreenToggle(!1).showGpxDownload(!1).showPrivacyToggle(!1).initializeMap(),this.page().latlngRequest().request(),this.page().collapseHeader()},i.prototype.addVerifyRaceView=function(){var t,e;return e=new this._verifyRaceViewFactory(this.page()),t=jQuery("#verify-run-race-prompt"),t.html(e.render().el)},i.prototype.addLogging=function(t){var e;return t.find("#js-snw-adp-pace-zones-upsell").length>0?(Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"screen_enter",element:"join_summit_pace_zones"}),e="#js-snw-adp-pace-zones-upsell-cta",t.off("click",e).on("click",e,function(){return function(){return Strava.ExternalAnalytics.trackV2({category:"summit_upsell",page:"activity_detail",action:"click",element:"join_summit_pace_zones"})}}(this))):void 0},i}(Strava.Labs.Activities.OutdoorViewFactory)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Athlete=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="Athlete",i.prototype.tabelized="athletes",i.prototype.urlRoot="/athletes",i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.MenuRouter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t,e,i){return this.id=i,this.baseUrl=t,this.route(this.baseUrl+"/:id",e),this.route(this.baseUrl+"/:id/",e)},i.prototype.addMenuItem=function(t,e){var i;return t?(i=t.replace(/^\s+|\s+$/g,""),0===i.length?this:(this.route(this.baseUrl+"/:id/"+t,e),this.route(this.baseUrl+"/:id/"+t+"/",e),this)):this},i.prototype.addRoute=function(t,e){return this.route(this.baseUrl+"/:id"+t,e),this},i.prototype.changeMenuTo=function(t,e){return null==e&&(e=!0),this.navigate("/"+this.baseUrl+"/"+this.id+"/"+t,{trigger:e,replace:!0})},i.prototype.start=function(){return Backbone.history.start(Modernizr.history?{pushState:!0,silent:!1}:{pushState:!1,silent:!1,hashChange:!1})},i}(Backbone.Router)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.MenuRouter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t,e,r,n){return i.__super__.initialize.call(this,t,e,r),this.context=n},i.prototype.changeMenuTo=function(t,e){return null==e&&(e=!0),this.context.fullscreen()?this.trigger("route:"+t):this.navigate("/"+this.baseUrl+"/"+this.id+"/"+t,{trigger:e,replace:!0})},i}(Strava.Util.MenuRouter)}.call(this),function(){Strava.module("Strava.Logging"),Strava.Logging.AjaxLogging=function(){function t(){}var e;return e="/logging/v1/js_log",t.log=function(t){return jQuery.ajax({type:"POST",url:e,data:{d:t,dataType:"json"}})},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Share.Facebook.Lightbox"),Strava.Share.Facebook.Lightbox.RequestPublishPermissionView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click .fb-request-permission-js":"handleRequestPublishPermission"},i.prototype.render=function(t){return t||(t="default"),this.createTemplate("#facebook-request-publish-template"),this.renderTemplate({type:t}),this},i.prototype.handleRequestPublishPermission=function(){return Strava.Logging.AjaxLogging.log("Strava.Share.Facebook.Lightbox.RequestPublishPermissionView.handleRequestPublisPermission"),null},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Share.Facebook.Lightbox"),Strava.Share.Facebook.Lightbox.RejectedPublishPermissionView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click .fb-request-permission-js":"handleRequestPublishPermission"},i.prototype.render=function(t){return t||(t="default"),this.createTemplate("#facebook-rejected-publish-template"),this.renderTemplate({type:t}),this},i.prototype.handleRequestPublishPermission=function(){return Strava.Logging.AjaxLogging.log("Strava.Share.Facebook.Lightbox.RejectedPublisPermissionView.handleRequestPublisPermission"),null},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Share.Facebook.Lightbox"),Strava.Share.Facebook.Lightbox.View=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}var r;return t(i,e),i.prototype.tagName="div",i.prototype.className="create-facebook-open-graph-action-lightbox",i.show=function(t,e,i,r){return null==r&&(r=new Strava.Share.Facebook.Action),this.getLightboxInstance().renderWithRenderer(this.getInstance().controller(t).objectType(e).objectId(i).action(r))},i.close=function(){return this.getLightboxInstance().closeBox()},i.instance=null,i.lightbox=null,r=null,i.setPageView=function(t){return r=t},i.getInstance=function(){return this.instance||(this.instance=new this),this.instance},i.getLightboxInstance=function(){return this.lightbox||(this.lightbox=new Strava.Ui.LightboxView("create_facebook_open_graph_action")),this.lightbox},i.prototype.controller=function(t){return this.setOrGet("_controller",t)
},i.prototype.action=function(t){return this.setOrGet("_action",t)},i.prototype.objectType=function(t){return this.setOrGet("_objectType",t)},i.prototype.objectId=function(t){return this.setOrGet("_objectId",t)},i.prototype.render=function(){return this.createTemplate("#facebook-open-graph-lightbox-template"),this.renderTemplate({}),this.action().on("strava.sharing.facebook.metaDataLoaded",function(t){return function(e){return t.action(e),t.metaDataLoaded()}}(this)),this.renderView(),this},i.prototype.renderView=function(){return Strava.Logging.AjaxLogging.log("Strava.Share.Facebook.Lightbox.View.renderView"),null},i.prototype.loadMetaData=function(){return this.action().getMetaData(this.objectType(),this.objectId())},i.prototype.renderRejectedPublishPermission=function(){var t;return t=new Strava.Share.Facebook.Lightbox.RejectedPublishPermissionView,t.on("done",function(t){return function(){return t.loadMetaData()}}(this)),t.on("fail",function(t){return function(){return t.renderRejectedPublishPermission()}}(this)),t.setElement(this.$(".content")),t.render("activity")},i.prototype.renderNoPublishPermission=function(){var t;return t=new Strava.Share.Facebook.Lightbox.RequestPublishPermissionView,t.on("done",function(t){return function(){return t.loadMetaData()}}(this)),t.on("fail",function(t){return function(){return t.renderRejectedPublishPermission()}}(this)),t.setElement(this.$(".content")),t.render("activity")},i.prototype.metaDataLoaded=function(){return FB.ui({method:"share",href:this.action().get("actionable_url"),display:"popup"})},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.HeartRateZones=function(e){function i(t){this.activityId=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.getHeartRateZones=function(){return this.heartRateZones},i.prototype.fetchHeartRateZones=function(){var t;return this.heartRateZonesFetched()?this.trigger("heartRateZonesFetched"):(t={url:"/activities/"+this.activityId+"/heartrate_zones",type:"GET",cache:!1,success:function(t){return function(e,i){return t.heartRateZones=t.convertHeartRateZones(i),t.trigger("heartRateZonesFetched")}}(this)},this.fetch(t))},i.prototype.heartRateZonesFetched=function(){return null!=this.heartRateZones},i.prototype.convertHeartRateZones=function(t){var e,i,r,n,a,s,o;if(!t.distribution_buckets)return[];for(i=[],s=t.distribution_buckets,r=n=0,a=s.length;a>n;r=++n){switch(o=s[r],e={},r){case 0:e.range="< "+o.max;break;case 4:e.range="> "+o.min;break;default:e.range=o.min+" - "+o.max}e.time=(new Strava.I18n.TimespanFormatter).display(o.time),e.width=100*o.percent,e.name=o.label_short,e.tag=o.tag,e.description=o.label_long.split(" - ")[1],e.percent=(new Strava.I18n.PercentFormatter).formatShort(100*o.percent,1),i[r]=e}return i},i}(Backbone.Model)}.call(this),function(){Strava.module("Strava.Activities"),Strava.Activities.WorkoutTypeMap={run:{run:{id:0,name:"Run"},race:{id:1,name:"Race"},long_run:{id:2,name:"LongRun"},workout:{id:3,name:"Workout"}},ride:{ride:{id:10,name:"Ride"},race:{id:11,name:"Race"},workout:{id:12,name:"Workout"}}}}.call(this),function(){Strava.module("Strava.Activities"),Strava.Activities.Workouts={TRANSLATION_KEY_PREFIX:"strava.activities.workouts",byKey:function(t){return this._byKey||(this._byKey=Strava.Activities.WorkoutTypeMap),this._byKey[t]},byValue:function(t){return t=t.toLowerCase(),_.object(_.map(this.byKey(t),function(){return function(t,e){return[t.id,e]}}(this)))},keyForValue:function(t,e){return this.byValue(t)[e]},valueForKey:function(t,e){return this.byKey(t)[e].id},asObjects:function(t,e){return null==e&&(e={fullKey:!1}),_.map(this.byKey(t),function(t){return function(i,r){return e.fullKey&&(r=[t.TRANSLATION_KEY_PREFIX,r].join(".")),{key:r,value:i}}}(this))}}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.TrainingActivity=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){return this.state="new",this.on("change:is_changing_type",this.emitTypeChangeEvents,this)},i.prototype.urlRoot="/athlete/training_activities",i.prototype.load=function(){return this.state="loading",this.trigger(this.state),this.fetch({success:function(t){return function(){return t.state="loaded",t.trigger("loaded",t)}}(this),error:function(t){return function(){return t.state="error",t.trigger("error")}}(this)})},i.prototype.update=function(){return this.state="updating",this.trigger(this.state),this.save({},{success:function(t){return function(){return t.state="loaded",t.trigger("updated",t)}}(this),error:function(t){return function(){return t.state="error",t.trigger("error")}}(this)})},i.prototype.ensureLoaded=function(){return"new"===this.state||"error"===this.state?this.load():void 0},i.prototype.emitTypeChangeEvents=function(){var t,e;return t=this.get("is_changing_type"),e=this.previous("is_changing_type"),t===!0&&e===!1&&this.trigger("typeChange:start",this),t===!1&&e===!0?this.trigger("typeChange:end",this):void 0},i.prototype.isRide=function(){return"Ride"===this.get("type")},i.prototype.isRun=function(){return"Run"===this.get("type")},i.prototype.isSwim=function(){return"Swim"===this.get("type")},i.prototype.isRace=function(){return this.get("workout_type")===Strava.Activities.Workouts.valueForKey(this.get("type").toLowerCase(),"race")},i.prototype.supportsGap=function(){return!!this.get("supportsGap")},i.prototype.isTrainer=function(){return this.get("trainer")},i.prototype.useTimerTime=function(){return this.get("use_timer_time")},i.prototype.defaultTransformSetName=function(){return!this.isRun()||this.isRace()||this.get("trainer")?this.isSwim()?Strava.Labs.Activities.StreamTransformSet.CONVERTED_SWIM_MOVING_TIME:Strava.Labs.Activities.StreamTransformSet.CONVERTED_ELAPSED_TIME:this.useTimerTime()?Strava.Labs.Activities.StreamTransformSet.CONVERTED_TIMER_TIME:Strava.Labs.Activities.StreamTransformSet.CONVERTED_MOVING_TIME},i.prototype.pollForTypeChange=function(){var t;return t=setInterval(function(e){return function(){return e.fetch(),e.has("is_changing_type")&&!e.get("is_changing_type")?clearInterval(t):void 0}}(this),1e3)},i.prototype.getAveragePace=function(){return 1/(this.get("average_speed")/3600)},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.ChartLabelDistanceFormatter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.FLOOR_BUFFER=0,i.prototype.format=function(t,e,r){var n;return null==e&&(e=this.precision),null==r&&(r=!0),n="metric"===this.unitSystem?1e3:1609.344,i.__super__.format.call(this,t+1/n,e,r)},i.prototype.convert=function(t){return t},i}(Strava.I18n.DistanceFormatter)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};Strava.module("Strava.Charts.Activities"),Strava.Charts.Activities.ChartContext=function(e){function r(t,e,i){this.streamsContext=t,r.__super__.constructor.call(this),this.initializeAttributes(n),this.streamsContext.on("streamsDataChanged",function(t){return function(){return t.trigger("streamsDataChanged")}}(this)),this.activity(e),this.eventDispatcher(i),this.xTickFormat(function(t){return function(e){return t.getTickFormat(t.xAxisType(),e)}}(this)),this.yTickFormat(function(t){return function(e){return t.getTickFormat(t.yAxisType(),e)}}(this)),this.resetInfobox()}var n,a;return t(r,e),n={activity:null,xAxisType:"distance",yAxisType:"altitude",xTickFormat:function(){},yTickFormat:function(){},Ride:{zoomStreamTypes:["velocity_smooth","watts","heartrate"],defaultInfoboxStreamTypes:["distance","altitude","grade_smooth"],overviewStreamTypes:["time"],criticalPowerStreamTypes:["time"],analysis:{streamTypes:["velocity_smooth","watts","watts_calc","heartrate","cadence","temp","moving","distance","time","altitude","grade_smooth"],stackedStreamTypes:["velocity_smooth","watts","watts_calc","heartrate","cadence","temp"]},altitudeDifference:200,flatBuffer:10,streamTypes:{distance:{formatter:Strava.I18n.ChartLabelDistanceFormatter},velocity_smooth:{formatter:Strava.I18n.ChartLabelDistancePerTimeFormatter},velocity:{formatter:Strava.I18n.ChartLabelDistancePerTimeFormatter},watts:{formatter:Strava.I18n.PowerFormatter},watts_calc:{formatter:Strava.I18n.PowerFormatter},heartrate:{formatter:Strava.I18n.HeartRateFormatter},cadence:{formatter:Strava.I18n.CadenceFormatter},temp:{formatter:Strava.I18n.ChartLabelTemperatureFormatter},altitude:{formatter:Strava.I18n.ChartLabelElevationFormatter},grade_smooth:{formatter:Strava.I18n.PercentFormatter}}},Run:{defaultToggleStreamTypes:["pace"],defaultInfoboxStreamTypes:["distance","altitude","grade_smooth"],overviewStreamTypes:["pace","grade_adjusted_pace"],analysis:{streamTypes:["pace","heartrate","cadence","temp","moving","distance","time","altitude","grade_smooth"],stackedStreamTypes:["pace","heartrate","cadence","temp"]},zoomStreamTypes:["pace","heartrate"],altitudeDifference:200,flatBuffer:10,streamTypes:{cadence:{formatter:Strava.I18n.DoubledStepCadenceFormatter},heartrate:{formatter:Strava.I18n.HeartRateFormatter},pace:{formatter:Strava.I18n.ChartLabelPaceFormatter},distance:{formatter:Strava.I18n.ChartLabelDistanceFormatter},grade_adjusted_pace:{formatter:Strava.I18n.ChartLabelPaceFormatter},grade_smooth:{formatter:Strava.I18n.PercentFormatter},altitude:{formatter:Strava.I18n.ChartLabelElevationFormatter},temp:{formatter:Strava.I18n.ChartLabelTemperatureFormatter}}},Swim:{defaultInfoboxStreamTypes:["distance"],zoomStreamTypes:["pace"],analysis:{streamTypes:["pace","moving","distance","time","timer_time"],stackedStreamTypes:["pace"]},streamTypes:{distance:{formatter:Strava.I18n.ChartLabelSwimDistanceFormatter},pace:{formatter:Strava.I18n.ChartLabelPaceFormatter}}},eventDispatcher:null},a={distance:"long",altitude:"short"},r.prototype.activityType=function(){return this.activity().get("type")},r.prototype.trainer=function(){return this.activity().get("trainer")},r.prototype.data=function(t,e){var i,r,n,a,s,o,l;for(o=this.streamsContext.get(t),l=this.streamsContext.get(e),a=[],i=r=0,n=o.length;n>r;i=++r)s=o[i],a.push({x:s,y:l[i]});return a},r.prototype.getStream=function(t){return this.streamsContext.get(t)},r.prototype.streamValAt=function(t,e){return this.streamsContext.valueAt(t,e)},r.prototype.setStreamVal=function(t,e,i){return this.streamsContext.setValueAt(t,e,i)},r.prototype.findIndex=function(t,e){return d3.bisectLeft(this.streamsContext.get(t),e)},r.prototype.getAdjustedYDomain=function(t){var e,i,r;return i=this.convert("altitude",this.sportObject().altitudeDifference),e=this.convert("altitude",this.sportObject().flatBuffer),r=t[0]+i>t[1]?e:0,[t[0]-r,Math.max(t[1],t[0]+i)]},r.prototype.sportObject=function(){return this.activity().isRun()?this.Run():this.activity().isRide()?this.Ride():this.activity().isSwim()?this.Swim():"mpm"===this.activity().get("speedUnit")?this.Run():this.Ride()},r.prototype.getStreamLabel=function(t){return Strava.I18n.Locale.t("strava.charts.activities.chart_context."+t)},r.prototype.getTickFormat=function(t,e){var i;return"time"===t?(new Strava.I18n.TimespanFormatter).display(e):(i=this.formatter(t),i?i.formatShort(e):"")},r.prototype.formatter=function(t){var e;if(this.sportObject().streamTypes[t])return e=this.sportObject().streamTypes[t].formatter,e?new e:void 0},r.prototype.formatValue=function(t,e){var i,r,n;return n=this.formatter(e),n?n.formatShort(t):(i=Strava.Charts.ChartHelper.getAccuracy(e),r=(new TwitterCldr.DecimalFormatter).format(d3.round(t,i)),0!==i&&(r=parseFloat(r).toFixed(i)),r)},r.prototype.transformStream=function(t,e){return this.transformedStreams[t]=e.map(function(e){return function(i){return e.convert(t,i)}}(this))},r.prototype.convert=function(t,e){var i;return a[t]?(i=a[t]+"Convert",strava.i18n.measurementUnits()[i]*e):"temp"===t?strava.i18n.measurementUnits().tempConvert(e):e},r.prototype.getSplits=function(){return this.streamsContext.splits()},r.prototype.getMeasurementPreference=function(){return strava.i18n.measurementPreference()},r.prototype.getMeasurementUnits=function(){return strava.i18n.measurementUnits()},r.prototype.getUnit=function(t){var e,i;if(this.sportObject().streamTypes[t])return i=this.sportObject().streamTypes[t].formatter,i?(e=new i,e.unitShort()):void 0},r.prototype.getSplitsLabel=function(){return Strava.I18n.Locale.t("meters"===this.getMeasurementPreference()?"strava.charts.activities.chart_context.splits.km":"strava.charts.activities.chart_context.splits.mile")},r.prototype.showPaceLine=function(){return this.trigger("showPaceLine")},r.prototype.hidePaceLine=function(){return this.trigger("hidePaceLine")},r.prototype.showStream=function(t){var e;return e=this.createRequest(),e.require([t],{onReady:function(e){return function(){return e.streamsContext.streamFetched(t)?(e.addInfoboxStreamType(t),e.trigger("showStreamType",t)):void 0}}(this)}),e.request()},r.prototype.hideStream=function(t){return i.call(this.infoboxStreamTypes,t)>=0?(this.removeInfoboxStreamType(t),this.trigger("hideStreamType",t)):void 0},r.prototype.getInfoboxStreamTypes=function(){return this.infoboxStreamTypes.filter(function(t){return function(e){return t.streamsContext.streamFetched(e)}}(this))},r.prototype.addInfoboxStreamType=function(t){return this.infoboxStreamTypes=_.union(this.infoboxStreamTypes,[t])},r.prototype.removeInfoboxStreamType=function(t){return this.infoboxStreamTypes=_.without(this.infoboxStreamTypes,t)},r.prototype.resetInfobox=function(){return this.infoboxStreamTypes=this.sportObject().defaultInfoboxStreamTypes},r.prototype.getAvgPace=function(){var t;return t=this.activity().get("average_speed"),3600/t/this.convert("distance",1)},r.prototype.getAvgGap=function(){return this.streamsContext.get("grade_adjusted_distance")?d3.round(this.streamsContext.data.getAverageGap()):null},r.prototype.isRace=function(){return this.activity().isRace()},r.prototype.isPaceStream=function(t){return"pace"===t||"grade_adjusted_pace"===t},r.prototype.createRequest=function(){return this.streamsContext.createRequest()},r.prototype.defaultInfoboxStreamTypes=function(){return this.sportObject().defaultInfoboxStreamTypes},r.prototype.zoomStreamTypes=function(){return this.sportObject().zoomStreamTypes},r.prototype.defaultToggleStreamTypes=function(){return this.sportObject().defaultToggleStreamTypes||[]},r.prototype.overviewStreamTypes=function(){return this.sportObject().overviewStreamTypes||[]},r.prototype.criticalPowerStreamTypes=function(){return this.sportObject().criticalPowerStreamTypes||[]},r.prototype.analysis=function(){return this.sportObject().analysis||{}},r.prototype.convertStreamIndices=function(t){var e,i;return i=this.activity().get("map_start_index")||0,e=this.streamsContext.length()-1,t.map(function(t){var r;return r=t-i,0>r?0:r>e?e:r})},r}(Strava.Base)}.call(this),function(){Strava.module("Strava.Activities"),Strava.Activities.ActivityTaggingActions=function(){function t(t){this.activity_id=t}return t.prototype.acceptTag=function(t,e){return this.acceptTagDeferred?this.acceptTagDeferred:(this.acceptTagDeferred=jQuery.Deferred(),jQuery.ajax({url:"/activities/"+this.activity_id+"/accept_tag",type:"POST",data:{signature:t,branchData:e}}).done(function(t){return function(e){return t.acceptTagDeferred.resolve(e)}}(this)).fail(function(t){return function(e){return t.acceptTagDeferred.reject(e)}}(this)).always(function(t){return function(){return t.acceptTagDeferred=null}}(this)),this.acceptTagDeferred.promise())},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Uploads"),Strava.Uploads.UploadCollection=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}var r,n;return t(i,e),i.prototype.model=Strava.Uploads.Upload,i.prototype.url=function(){var t,e,i,r,n;for(t=[],n=this.models,e=0,i=n.length;i>e;e++)r=n[e],100!==r.get("progress")&&t.push(r.get("id"));return"/upload/progress.json?ids[]="+t.join("&ids[]=")},i.uploadProgress=function(t){var e;return e=jQuery.Deferred(),r(t,e),e.promise()},r=function(t,e){return setTimeout(function(){return jQuery.ajax({type:"GET",url:"/upload/progress.json",data:{ids:[t]}}).done(function(i){switch(n(i[0].workflow)){case"completed":return e.resolve(i[0]);case"error":return e.reject(i[0].workflow);default:return r(t,e)}}).fail(function(t){return e.reject(t)})},1e3)},n=function(t){switch(t){case"error":case"empty":case"not_available":case"deleted_activity":return"error";case"uploaded":return"completed";default:return"running"}},i}(Backbone.Collection)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Activities"),Strava.Activities.ActivityTaggingView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click #js-btn-ignore":"handleIgnoreBtnClick","click #js-btn-accept":"handleAcceptBtnClick"},i.prototype.attach=function(t,e,i){return this.activityTaggingActions=e,this.signature=i,this.setElement(t)},i.prototype.handleIgnoreBtnClick=function(t){return t.preventDefault(),this.$el.animate({height:0,opacity:0},300,function(t){return function(){return t.$el.hide()}}(this))},i.prototype.handleAcceptBtnClick=function(){return this.branchReferrer().done(function(t){return function(e){return t.doAccept(e)}}(this)).fail(function(t){return function(){return t.doAccept(null)}}(this))},i.prototype.doAccept=function(t){return this.disableIgnoreButton(),this.acceptButtonStateLoading(),this.activityTaggingActions.acceptTag(this.signature,t).done(function(t){return function(e){return t.onAcceptTagComplete(e)}}(this)).fail(function(t){return function(e){return t.onAcceptFail(e)}}(this))},i.prototype.onAcceptFail=function(t){var e,i;return this.enableIgnoreButton(),this.resetAcceptButton(),i=Strava.I18n.Locale.t("strava.activities.activity_tagging_view.error_message"),t&&409===t.status&&(i=Strava.I18n.Locale.t("strava.activities.activity_tagging_view.error_already_accepted_message")),e=new Strava.Ui.AlertView({alertType:"error",messageBody:i,persist:!0}),e.show()},i.prototype.onAcceptTagComplete=function(t){return Strava.Uploads.UploadCollection.uploadProgress(t.id).done(function(t){return function(e){return t.onAcceptComplete(e.activity.id)}}(this)).fail(function(t){return function(){return t.onAcceptFail()}}(this))},i.prototype.onAcceptComplete=function(t){return this.acceptButtonStateSuccess(),(new Strava.Ui.AlertData).data({alertType:"success",messageBody:Strava.I18n.Locale.t("strava.activities.activity_tagging_view.success_message"),persist:!0}),window.location="/activities/"+t},i.prototype.disableIgnoreButton=function(){return this.$("#js-btn-ignore").addClass("disabled").prop("disabled",!0)},i.prototype.enableIgnoreButton=function(){return this.$("#js-btn-ignore").removeClass("disabled").prop("disabled",!1)},i.prototype.acceptButtonStateLoading=function(){return this.$("#js-btn-accept").addClass("status-loading").addClass("disabled").prop("disabled",!0)},i.prototype.acceptButtonStateSuccess=function(){return this.$("#js-btn-accept").addClass("status-success").removeClass("status-loading")},i.prototype.resetAcceptButton=function(){return this.$("#js-btn-accept").removeClass("status-loading").removeClass("status-success").removeClass("disabled").prop("disabled",!1)},i.prototype.branchReferrer=function(){var t;return t=jQuery.Deferred(),Strava.BranchIO.data(!0).done(function(e){return t.resolve(e?e.data:null)}).fail(function(e){return t.reject(e)}),t},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.Pages"),Strava.Labs.Activities.Pages.PageView=function(e){function i(t,e,n){i.__super__.constructor.call(this),this.initializeAttributes(r),this.factory(n),this.activity(new Strava.Labs.Activities.TrainingActivity({id:t,type:e})),this.pageContext(new Strava.Labs.Activities.PageContext)}var r;return t(i,e),r={activity:null,baseUrl:"activities",pageContext:null,isPremium:!1,isOwner:!1,hasGoalsAccess:!1,lapEfforts:null,power:{visible:!1},eventDispatcher:null,streams:null,router:null,factory:null,commentsController:null,kudosController:null,heartRateZones:null,privacyZones:[],currentAthlete:null,activityAthlete:null,activityAthleteWeight:null,editableActivity:null,editObserver:null,lightboxData:null,baseStream:null,showSplitsTable:!1,latlngRequest:null,analysisRequest:null,scrollListener:null,mbr:null,showGroupAthletes:!1,similarActivitiesData:null,similarActivitiesFtueImagePath:null,canSeeTrainingPlans:!1,hasTrainingPlan:!1,supportsGap:!1,taggingSignature:null},i.prototype.activityId=function(){return this.activity().id},i.prototype.activityType=function(){return this.activity().get("type")},i.prototype.addMenuItemRoutes=function(t){return jQuery("#pagenav li a").each(function(e){return function(i,r){var n,a,s,o,l;return n=jQuery(r),o=n.data("menu"),a=n.data("menu-alt"),o?(l=a?a:o,s=Strava.Util.StringUtils.toCamel("handle-"+l+"-clicked"),t.addMenuItem(o,l),t.bind("route:"+l,function(){var t;if(t=e[s],null==t)throw"route handler not found: "+s;return t.apply(e,arguments)})):void 0}}(this))},i.prototype.addCustomRoutes=function(){},i.prototype.setupMenuRouter=function(t){var e;return e=new Strava.Labs.Activities.MenuRouter(this.baseUrl(),this.pageContext().view(),t,this.pageContext()).addRoute("/laps/:lap_effort_id","lap-effort"),e.bind("route:lap-effort",function(t){return function(e,i){return t.pageContext().lapEffortId(parseInt(i)),t.handleLapsClicked(),t.menuView.handleRouteChange("laps")}}(this)),e.addRoute("/analysis/:start_id/:end_id","analysis-range"),e.on("route:analysis-range",function(t){return function(e,i,r){return t.pageContext().analysisRange([i,r]),t.handleAnalysisClicked(),t.menuView.handleRouteChange("analysis")}}(this)),this.addMenuItemRoutes(e),this.addCustomRoutes(e),this.router(e)},i.prototype.assemble=function(t){var e,i,r,n;return e=this.activityId(),i=new Strava.Labs.Activities.EventDispatcher,n=new Strava.Labs.Activities.Streams(e),this.activity().set("supportsGap",this.supportsGap()),this.eventDispatcher(i),this.streams(n),this.buildContexts(),this.streamsRequest=this.chartContext().createRequest(),this.setupMenuRouter(e),this.factory().page(this),this.handleSidenavScroll(),this.menuView=this.factory().createMenuView(),this.setupShowSystemMessageOnSetup(),this.setupActivityTagging(),this.isSwim()||(this.bindSufferScore(),this.heartRateZones(new Strava.Labs.Activities.HeartRateZones(e))),this.lapEfforts(new Strava.Models.Laps(this.activity())),this.bindSocial(),this.setupFlybyLogging(),this.kudosView=this.factory().createKudosView(this.kudosController(),e),this.commentsController().bind("commentCreated",function(t){return function(){return t.updateCommentTabCount()}}(this)).bind("commentDeleted",function(t){return function(){return t.updateCommentTabCount()}}(this)),location.hash&&(r=location.hash.slice(1)),r&&_.isNaN(parseInt(r))===!1&&this.pageContext().segmentEffortId(parseInt(r)),r&&("comments"===r||"kudos"===r)&&Strava.Feed.PopoverBoxActivityView.show("Activity",e,this.lightboxData(),r,!1,this.showGroupAthletes(),this.activityAthlete()),this.pageContext().startMenu(t),Backbone.history.bind("route",function(t){return function(){return t.streamsRequest.request()}}(this)),Strava.Share.Facebook.Lightbox.View.setPageView(this),this},i.prototype.ready=function(){return this.router().start(),this},i.prototype.resetListeners=function(){return this.contexts.reset(),this.eventDispatcher().reset(),this.lapEfforts().off(),this.unbindScrollListener()},i.prototype.handleOverviewClicked=function(){return this.resetListeners(),this.redirectEffort()?void 0:(this.factory().createOverviewView(this.streamsRequest),this.streamsRequest.onReady(function(t){return function(){return null!=t.pageContext().segmentEffortId()?t.showSegmentEffort():void 0}}(this)),this.showHeader())},i.prototype.handleAnalysisClicked=function(){return this.resetListeners(),null==this.analysisRequest()&&this.analysisRequest(this.chartContext().createRequest()),this.factory().createBasicAnalysisView(this.analysisRequest()),this.$$("html, body").scrollTop(0),Backbone.history.on("route",function(t){return function(){return t.analysisRequest().request()}}(this))},i.prototype.handleRelativeEffortClicked=function(){return this.resetListeners(),Strava.ExternalAnalytics.trackV2({category:"activity_detail",page:"activity_detail",action:"click",element:"relative_effort"}),this.factory().createRelativeEffortView(),this.collapseHeader()},i.prototype.handleHeartrateZonesClicked=function(){var t;return this.resetListeners(),Strava.ExternalAnalytics.trackV2({category:"activity_detail",page:"activity_detail",action:"click",element:"heart_rate"}),t={page:"hr-analysis",action:"view-sufferscore"},Strava.Util.EventLogging.trackEvent("CLIENT_ACTION",t),this.factory().createHeartRateZonesView(),this.collapseHeader(),this.pageContext().isUpsell("heart_rate_monitor")||this.pageContext().isUpsell("heart_rate_monitor_buy")?void 0:this.heartRateZones().fetchHeartRateZones()},i.prototype.handleLapsClicked=function(){return this.resetListeners(),this.factory().createLapsView(this.streamsRequest),this.collapseHeader()},i.prototype.showSplits=function(){return!1},i.prototype.showMap=function(){return!1},i.prototype.showSegments=function(){return!1},i.prototype.isRun=function(){return this.activity().isRun()},i.prototype.isRide=function(){return this.activity().isRide()},i.prototype.isSwim=function(){return this.activity().isSwim()},i.prototype.updateCommentTabCount=function(){var t;return t=this.commentsController().getFromHash("Activity-"+this.activityId()).length,jQuery("a.view-comments .count").text(t)},i.prototype.bindSocial=function(){var t,e;return t=this.activityId(),e=jQuery("#heading"),e.find("a.view-comments").on("click",function(e){return function(){return Strava.Feed.PopoverBoxActivityView.show("Activity",t,e.lightboxData(),"comments",!1,e.showGroupAthletes(),e.activityAthlete())}}(this)).end().find(".show-kudos").on("click",function(e){return function(){return Strava.Feed.PopoverBoxActivityView.show("Activity",t,e.lightboxData(),"kudos",!1,e.showGroupAthletes(),e.activityAthlete())}}(this)).end().find(".show-others").on("click",function(e){return function(){return Strava.Feed.PopoverBoxActivityView.show("Activity",t,e.lightboxData(),"groupriders",!1,e.showGroupAthletes(),e.activityAthlete())}}(this))},i.prototype.setupFlybyLogging=function(){var t;return t=jQuery("#heading"),t.find(".flybys-link").on("click",function(t){return function(){return t.logFlybyClick()}}(this))},i.prototype.logFlybyClick=function(){var t;return t={page:"activity",action:"fly-by-link-click",event_details:[{key:"activity_id",value:this.activityId()},{key:"is_premium",value:this.currentAthlete().isPremium()}]},Strava.Util.EventLogging.trackEvent("CLIENT_ACTION",t)},i.prototype.bindResultsBar=function(){var t;return t=jQuery(".achievements"),t.find("a.segment-achievement").on("click",function(t){return function(e){var i;return i=jQuery(e.currentTarget),t.router().changeMenuTo("segments/"+i.data("segment-effort-id"),!0),!1}}(this))},i.prototype.bindSufferScore=function(){return jQuery(".page").on("click",".suffer-score a",function(t){return function(e){var i;return e.preventDefault(),i=jQuery(e.currentTarget).data("menu"),t.router().changeMenuTo(i,!0)}}(this))},i.prototype.allowEdit=function(){var t;return t=this.activity(),this.editableActivity(t)},i.prototype.buildContexts=function(){var t,e;return t=Strava.Labs.Activities.ContextManager,e={},e[t.TYPES.CHART]=function(t){return function(e){var i;return i=new Strava.Charts.Activities.ChartContext(e,t.activity(),t.eventDispatcher()),i.xAxisType(t.baseStream()),i}}(this),this.contexts=new t(this.streams(),this.activity(),e)},i.prototype.chartContext=function(){return this.contexts.contextFor(Strava.Labs.Activities.ContextManager.TYPES.CHART)},i.prototype.lapEffortsTableContext=function(){return this._lapEffortsTableContext||(this._lapEffortsTableContext=new Strava.Labs.Activities.LapEffortsTableContext(this.lapEfforts(),this.contexts.contextFor(Strava.Labs.Activities.ContextManager.TYPES.CHART,Strava.Labs.Activities.StreamTransformSet.CONVERTED_ELAPSED_TIME),this.eventDispatcher(),this.streamsRequest))},i.prototype.redirectEffort=function(){return!1},i.prototype.showHeader=function(){var t;return t=this.$$("#heading"),t.removeClass("collapsed").find(".collapsable").slideDown(300)},i.prototype.collapseHeader=function(t){var e;return e=this.$$("#heading"),e.addClass("collapsed").find(".collapsable").slideUp(300,function(){return function(){return t?t():void 0}}(this))},i.prototype.handleSidenavScroll=function(){var t,e,i;return i=this.$$(".page .sidenav"),t=this.$$(".view > footer"),e=function(){return function(){var e,r,n;return e=t.offset().top-80,n=window.pageYOffset,r=n+i.height(),e>=r&&i.hasClass("unpinned")?i.removeClass("unpinned"):r>=e&&!i.hasClass("unpinned")?i.addClass("unpinned"):void 0}}(this),this.$$(window).on("scroll.sidenav",e)},i.prototype.handlePageScroll=function(){var t,e,i;return i=this.$$(".pinnable-view"),t=this.$$(".pinnable-anchor"),t.length&&i.length?(e=function(e){return function(){var r,n,a,s,o;return a=window.pageYOffset,r=t.offset().top,s=e.$$(".pinnable-view footer"),o=s.offset().top,n=120,a>=r&&!i.hasClass("pinned")&&o>=a?i.addClass("pinned").removeClass("pinned-bottom"):r>=a&&i.hasClass("pinned")?i.removeClass("pinned").removeClass("pinned-bottom"):a>=o+s.outerHeight()-n-e.$$(".pinnable").height()&&i.hasClass("pinned")?i.addClass("pinned-bottom"):i.removeClass("pinned-bottom")}}(this),this.scrollListener(e),this.$$(window).on("scroll.activity",e)):void 0},i.prototype.unbindScrollListener=function(){var t;return this.$$(".pinned").removeClass("pinned"),t=this.scrollListener(),t?(this.$$(window).off("scroll.activity",t),this.scrollListener(null)):void 0},i.prototype.basicAnalysisMapContext=function(){return this.mapContext()},i.prototype.basicAnalysisChartContext=function(){return this.chartContext()},i.prototype.setupActivityTagging=function(){var t,e,i;return t=this.$$(".activity-athlete-tagging-container"),e=new Strava.Activities.ActivityTaggingActions(this.activityId()),i=new Strava.Activities.ActivityTaggingView,i.attach(t,e,this.taggingSignature())},i.prototype.setupShowSystemMessageOnSetup=function(){var t;return t=new Strava.Ui.AlertData,t.data()?(new Strava.Ui.AlertView(t.data()).show(),t.data(null)):void 0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.SegmentEffort=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.indices=function(){return[this.get("start_index"),this.get("end_index")]},i.prototype.summarize=function(){return{effort:this.toJSON(),hidden:this.get("hidden")}},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.SegmentEfforts=function(e){function i(t){i.__super__.constructor.call(this),this.activityId=t,this.fetching=!1,this.hiddenSegmentsVisibleState=!1}return t(i,e),i.prototype.model=Strava.Models.SegmentEffort,i.prototype.url=function(){return"/activities/"+this.activityId+"/segment_efforts"
},i.prototype.hiddenSegmentsVisible=function(t){return null!=t?this.hiddenSegmentsVisibleState=t:this.hiddenSegmentsVisibleState},i.prototype.parse=function(t){var e,i,r,n;for(this.hiddenSegmentEfforts=[],n=t.hidden_efforts,i=0,r=n.length;r>i;i++)e=n[i],e.hidden=!0,this.hiddenSegmentEfforts.push(new Strava.Models.SegmentEffort(e));return t.efforts.map(function(t){return t.hidden=!1,t})},i.prototype.getEffort=function(t){var e;return e=this.get(t),null==e&&(e=_.find(this.hiddenSegmentEfforts,function(){return function(e){return t===e.id}}(this))),e},i}(Backbone.Collection)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.SegmentEffortDetail=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.urlRoot="/segment_efforts",i.prototype.indices=function(){return[this.get("start_index"),this.get("end_index")]},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.SegmentEffortDetails=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=Strava.Models.SegmentEffortDetail,i.prototype.getDeferred=function(t){var e,i;return e=jQuery.Deferred(),i=this.get(t),null!=i?e.resolve(i):(i=new Strava.Models.SegmentEffortDetail({id:t}),i.fetch().done(function(t){return function(){return t.add(i),e.resolve(i)}}(this))),e.done(function(t){return function(e){return t.trigger("segmentEffortDetailReady",e)}}(this)),e},i}(Backbone.Collection)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.SegmentLeaderboard=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.FILTER_KEY="activity-segment-leaderboard-filter",i.prototype.GENDER_KEY="activity-segment-leaderboard-gender",i.prototype.url=function(){return"/segments/"+this.id+"/leaderboard"},i.prototype.sync=function(t,e,r){var n;return null==r&&(r={}),n=_.extend(this.getDefaults(),r.data),_.extend(r,{data:n,cache:!1}),i.__super__.sync.call(this,t,e,r)},i.prototype.fetch=function(t){var e;return e=this.id,this.clear(),this.id=e,i.__super__.fetch.call(this,t)},i.prototype.parse=function(t){return null!=t?(t.viewer_clubs&&(t.viewer_clubs=t.viewer_clubs.map(function(t){return t.club})),t):void 0},i.prototype.fullLeaderboardPath=function(){var t,e,i,r,n;return r=[],e=this.get("filter"),e&&r.push("filter="+e),i=this.get("gender"),i&&r.push("gender="+i),"club"===e&&(t=this.get("club_id"),t&&r.push("club_id="+t)),n="/segments/"+this.id,r.length>0&&(n+="?"+r.join("&")),n},i.prototype.getDefaults=function(){return{raw:!0,page:1,per_page:10,viewer_context:!0}},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.SegmentLeaderboards=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=Strava.Models.SegmentLeaderboard,i.prototype.getDeferred=function(t,e){var i,r;return i=jQuery.Deferred(),r=this.get(t),null!=r?r.fetch(e).done(function(){return i.resolve(r)}):(r=new Strava.Models.SegmentLeaderboard({id:t}),r.fetch(e).done(function(t){return function(){return t.add(r),i.resolve(r)}}(this)).fail(function(){return function(t,e){return i.reject(e)}}(this))),i},i}(Backbone.Collection)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/distance_correction"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<a class='dismiss' href='javascript:;'>"+e(t(Strava.I18n.Locale.t("templates.activities.distance_correction.dismiss")))+"</a>\n<h4 class='h5 title'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.distance_correction.distance_help")))),i.push("</h4>\n<div class='content'>"),"device"===this.data.activeSource?(i.push("  <p>"+t(Strava.I18n.Locale.t("templates.activities.distance_correction.synthetic_html"))+"</p>\n  <a class='button compact' href='/activities/"+e(t(this.data.activityId))+"/swap_distance_stream?to_source=synthetic' data-method='post'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.distance_correction.correct_distance")))),i.push("  </a>")):(i.push("  <p>"+t(Strava.I18n.Locale.t("templates.activities.distance_correction.synthetic_revert_html"))+"</p>\n  <a class='button compact' href='/activities/"+e(t(this.data.activityId))+"/swap_distance_stream?to_source=device' data-method='post'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.distance_correction.correct_distance_revert")))),i.push("  </a>")),i.push("</div>\n<div class='arrow dark top'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.DistanceTooltip=function(e){function i(t){i.__super__.constructor.call(this,t)}return t(i,e),i}(Strava.Ui.TooltipView)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/elevation_correction"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<a class='dismiss' href='javascript:;'>"+e(t(Strava.I18n.Locale.t("templates.activities.elevation_correction.dismiss")))+"</a>\n<h4 class='h5 title'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.elevation_correction.elevation_help")))),i.push("</h4>\n<div class='content'>"),this.data.elevationLookupExists&&this.data.canSwapElevation?(i.push("lookup"===this.data.activeSource?"  <p>"+t(Strava.I18n.Locale.t("templates.activities.elevation_correction.lookup_revert_html"))+"</p>":"  <p>"+t(Strava.I18n.Locale.t("templates.activities.elevation_correction.lookup_html"))+"</p>"),i.push("  <a class='button compact' href='/activities/"+e(t(this.data.activityId))+"/swap_elevation_stream?from_source="+e(t(this.data.activeSource))+"' data-method='put'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.elevation_correction.correct_elevation")))),i.push("  </a>")):this.data.adjusting?i.push("  <p>"+t(Strava.I18n.Locale.t("templates.activities.elevation_correction.adjusting_html"))+"</p>"):(i.push("  <p>"+t(Strava.I18n.Locale.t("templates.activities.elevation_correction.lookup_html"))+"</p>\n  <a class='button compact' href='/activities/"+e(t(this.data.activityId))+"/fetch_elevation' data-method='post'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.elevation_correction.correct_elevation")))),i.push("  </a>")),i.push("</div>\n<div class='arrow dark top'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.ElevationTooltip=function(e){function i(t){i.__super__.constructor.call(this,t)}return t(i,e),i}(Strava.Ui.TooltipView)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/refresh_achievements"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<a class='dismiss' href='javascript:;'>"+e(t(Strava.I18n.Locale.t("templates.activities.refresh_achievements.dismiss")))+"</a>\n<h4 class='h5 title'>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.refresh_achievements.title")))),i.push("</h4>\n<div class='content'>\n  <p>"+t(Strava.I18n.Locale.t("templates.activities.refresh_achievements.body_html"))+"</p>\n  <a class='button compact' href='/activities/"+e(t(this.data.activityId))+"/refresh_achievements' data-method='post'>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.refresh_achievements.proceed")))),i.push("  </a>\n</div>\n<div class='arrow dark top'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.RefreshAchievements=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.show=function(t,e){return new Strava.Ui.TooltipView("activities/refresh_achievements").render(t,e)},i}(Strava.Ui.TooltipView)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.Pages"),Strava.Labs.Activities.Pages.OutdoorPageView=function(e){function i(t,e,n){i.__super__.constructor.call(this,t,e,n),this.initializeAttributes(r),this.segmentEfforts(new Strava.Models.SegmentEfforts(t)),this.segmentEffortDetails(new Strava.Models.SegmentEffortDetails),this.segmentLeaderboards(new Strava.Models.SegmentLeaderboards)}var r;return t(i,e),r={segmentEfforts:null,segmentEffortDetails:null,segmentLeaderboards:null,privacyZones:[],latlngRequest:null},i.prototype.assemble=function(t){return i.__super__.assemble.call(this,t),this.bindResultsBar(),this.initializeMap(),this},i.prototype.initializeMap=function(){return this.mbr()?(this.mapContext(),this.latlngRequest().request()):void 0},i.prototype.resetListeners=function(){return i.__super__.resetListeners.call(this),this.mapContext().off(),this.segmentEfforts().off()},i.prototype.redirectEffort=function(){var t;return t=this.pageContext().segmentEffortId(),t&&!this.segmentEfforts().getEffort(t)?(this.pageContext().segmentEffortId(null),this.router().changeMenuTo("overview",!0),!0):!1},i.prototype.handleSegmentsClicked=function(){return this.resetListeners(),this.redirectEffort()?void 0:(this.factory().createSegmentsView(this.streamsRequest),this.collapseHeader(),this.streamsRequest.onReady(function(t){return function(){return null!=t.pageContext().segmentEffortId()?t.showSegmentEffort():void 0}}(this)))},i.prototype.handleAnalysisClicked=function(){return i.__super__.handleAnalysisClicked.call(this),this.collapseHeader()},i.prototype.showSplits=function(){return!1},i.prototype.showMap=function(){return!0},i.prototype.showSegments=function(){return!0},i.prototype.showSegmentEffort=function(){var t,e,i,r,n;return r=this.pageContext().segmentEffortId(),t=this.segmentEfforts().find(function(){return function(t){return r===t.id}}(this)),null==t&&(t=_.find(this.segmentEfforts().hiddenSegmentEfforts,function(){return function(t){return r===t.id}}(this)),null!=t&&this.segmentEfforts().hiddenSegmentsVisible(!0)),null!=t?(i=this.chartContext().convertStreamIndices(t.indices()),n=i[0],e=i[1],this.eventDispatcher().dispatchSelect(null,"latlng",n,e),this.segmentEffortDetails().getDeferred(t.id),this.segmentEffortDetails().one("segmentEffortRendered",function(t){return function(){var e,i;return t.isRun()?void 0:(i=t.$$("#segments tr[data-segment-effort-id="+r+"]").offset().top,e=t.$$("#elevation-profile .chart").outerHeight(),t.$$("html, body").scrollTop(i-e))}}(this)),this.pageContext().segmentEffortId(null)):void 0},i.prototype.buildContexts=function(){var t,e;return t=Strava.Labs.Activities.ContextManager,e={},e[t.TYPES.CHART]=function(t){return function(e){var i;return i=new Strava.Charts.Activities.ChartContext(e,t.activity(),t.eventDispatcher()),i.xAxisType(t.baseStream()),i}}(this),e[t.TYPES.MAP]=function(t){return function(e){var i;return null==t.latlngRequest()&&t.latlngRequest(e.createRequest()),i=new Strava.Maps.MapContext(e,t.eventDispatcher(),t.latlngRequest()),i.activityId(t.activityId()).isPremium(t.isPremium()).isOwner(t.isOwner()).privacyZones(t.privacyZones()),i}}(this),this.contexts=new t(this.streams(),this.activity(),e)},i.prototype.mapContext=function(){return this.contexts.contextFor(Strava.Labs.Activities.ContextManager.TYPES.MAP)},i.prototype.segmentEffortsTableContext=function(){return this._segmentEffortsTableContext||(this._segmentEffortsTableContext=new Strava.Labs.Activities.SegmentEffortsTableContext(this.segmentEfforts(),this.chartContext(),this.pageContext(),this.eventDispatcher()))},i.prototype.segmentEffortDetailContext=function(){return this._segmentEffortDetailContext||(this._segmentEffortDetailContext=new Strava.Labs.Activities.SegmentEffortDetailContext(this.power(),this.streams(),this.isOwner(),this.chartContext()))},i}(Strava.Labs.Activities.Pages.PageView)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.PaceZones=function(e){function i(t){this.activityId=t,this.paceZones=null,i.__super__.constructor.call(this)}return t(i,e),i.prototype.getPaceZones=function(){return this.paceZones},i.prototype.fetchPaceZones=function(){var t;return this.paceZonesFetched()?this.trigger("paceZonesFetched"):(t={url:"/activities/"+this.activityId+"/pace_zones",type:"GET",cache:!1,success:function(t){return function(e,i){return t.paceZones=t.convertPaceZones(i),t.trigger("paceZonesFetched")}}(this),error:function(t){return function(){return t.handleFetchError()}}(this)},this.deferred=this.fetch(t))},i.prototype.handleFetchError=function(){return this.trigger("pace zones fetch error")},i.prototype.paceZonesFetched=function(){return null!=this.paceZones},i.prototype.convertPaceZones=function(t){var e;return e=d3.max(t,function(t){return t.time}),t.map(function(t){return function(i,r){var n,a,s,o,l;return s=(new Strava.I18n.TimespanFormatter).display(d3.round(t.convertValue(i.max))),a=(new Strava.I18n.TimespanFormatter).display(d3.round(t.convertValue(i.min))),0===i.min?(o="> "+s,n=t.convertValue(i.max),l=1/0):-1===i.max?(o="< "+a,n=0,l=t.convertValue(i.min)):(o=s+" - "+a,n=t.convertValue(i.max),l=t.convertValue(i.min)),{time:(new Strava.I18n.TimespanFormatter).display(i.time),width:d3.round(i.time/e*100),name:"Z"+(r+1),tag:"z"+(r+1),description:i.label,range:o,upperBound:l,lowerBound:n}}}(this))},i.prototype.convertValue=function(t){return 0===t?0:1/t*(1/strava.i18n.measurementUnits().longConvert)},i.prototype.zoneForPace=function(t){return null!=this.paceZones&&this.paceZones.length>0?_.find(this.paceZones,function(e){return t>=e.lowerBound&&t<e.upperBound}):null},i}(Strava.Controller)}.call(this),function(){Strava.module("Strava.Ui"),Strava.Ui.Alert=function(){function t(t){null==t&&(t={}),this.options=jQuery.extend({appendTo:".container header",className:"alert_container",prependTo:null,slideDownDuration:800,slideUpDuration:800,persistenceDuration:5e3,persist:!1,messageSubject:"Alert!",messageBody:"",dismissible:!0,alertType:"info"},t),this.render()}var e;return e=["success","info","warning","error"],t.prototype.render=function(){var t;return t="<div class='alert-message "+this.options.alertType+" hidden "+this.options.className+"'>",this.options.dismissible&&(t+="<a class='dismiss' title='Dismiss this message'>x</a>"),t+="<p><strong>"+this.options.messageSubject+"</strong> "+this.options.messageBody+"</div>",this.obj=jQuery(t),null!=this.options.prependTo?this.obj.prependTo(this.options.prependTo):this.obj.appendTo(this.options.appendTo),this.options.dismissible?this.obj.children(".dismiss").click(function(t){return function(){return t.dismiss()}}(this)):void 0},t.prototype.trigger=function(){return this.options.persist?this.obj.show():this.obj.show().delay(this.options.persistenceDuration).fadeOut()},t.prototype.dismiss=function(){return this.obj.hide("blind",{direction:"vertical"},this.options.slideDownDuration)},t}()}.call(this),function(){var t,e=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),t=".js-pace-zones-alert",Strava.Labs.Activities.PaceZonesRefreshView=function(i){function r(t,e){this.racePace=t,r.__super__.constructor.call(this,e),this.racePace.on("success",this.alertSuccess,this),this.racePace.on("error",this.alertError,this),this.racePace.outdated&&this.alertWarning()}return e(r,i),r.prototype.events={"click .js-refresh-pace-zones":"onRefreshPaceZones"},r.prototype.onRefreshPaceZones=function(){return this.$(".message").hide(),this.racePace.refresh()},r.prototype.alertWarning=function(){var e,i;return i="warning",e=new Strava.Ui.Alert({className:"",messageSubject:"",messageBody:this.renderAlertBody(i),alertType:i,dismissible:!1,persist:!0,appendTo:t}),e.trigger()},r.prototype.alertSuccess=function(){var e,i;return i="success",e=new Strava.Ui.Alert({className:"",messageSubject:"SUCCESS.",messageBody:this.renderAlertBody(i),alertType:i,appendTo:t}),e.trigger()},r.prototype.alertError=function(){var e,i;return i="error",e=new Strava.Ui.Alert({className:"",messageSubject:"Something went wrong.",messageBody:this.renderAlertBody(i),alertType:i,persist:!0,appendTo:t}),e.trigger()},r.prototype.renderAlertBody=function(t){return this.alertTemplate||(this.alertTemplate=this.create_template_for("#pace-zones-alert-body-template")),this.alertTemplate({type:t})},r.prototype.detach=function(){return this.racePace.off("success",this.alertSuccess),this.racePace.off("error",this.alertError),this.remove()},r}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.SplitEffortsTableContext=function(e){function i(t,e,n,a){this.streams=t,this.chartContext=e,i.__super__.constructor.call(this,n),a.require(r,{onReady:function(t){return function(){return t.splits=t.chartContext.getSplits(),t.trigger("splitsLoaded")}}(this)})}var r;return t(i,e),r=["time","distance","altitude","heartrate","cadence","pace","grade_adjusted_pace"],i.prototype.getEfforts=function(){return this.splits},i.prototype.effortsLoaded=function(){return null!=this.splits},i.prototype.getUnit=function(t){return this.chartContext.getUnit(t)},i.prototype.getLabel=function(){return this.chartContext.getSplitsLabel()},i.prototype.hasStream=function(t){return this.streams.streamFetched(t)},i.prototype.isRace=function(){return this.chartContext.isRace()},i}(Strava.Labs.Activities.EffortsTableContext)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.BestEffortsTableContext=function(e){function i(t,e,n,a){i.__super__.constructor.call(this,n),this.chartContext=e,this.eventDispatcher=n,this.bestEffortsCollection=t,a.require(r),this.deferred=this.bestEffortsCollection.fetch({success:function(t){return function(e){return t.efforts=e}}(this)}),jQuery.when(a.deferred,this.deferred).then(function(t){return function(){return t.handleReady()}}(this))}var r;return t(i,e),r=["time","distance","altitude","heartrate","pace"],i.prototype.getEfforts=function(){return this.efforts},i.prototype.effortsLoaded=function(){return null!=this.efforts},i.prototype.getUnit=function(t){return this.chartContext.getUnit(t)},i.prototype.handleReady=function(){return this.efforts.forEach(function(t){return function(e){var i,r;return i=new Strava.Labs.Activities.StreamSplit(t.chartContext.streamsContext.data,e.get("start_index"),e.get("end_index")),r=i.summarize(),e.set("stream_split",r)}}(this)),this.trigger("effortsLoaded")},i}(Strava.Labs.Activities.EffortsTableContext)}.call(this),function(){Strava.module("Strava.Labs.Activities.PaceAnalysis"),Strava.Labs.Activities.PaceAnalysis.DataContext=function(){function t(t,e,i,n){var a;this.streamsRequest=t,this.chartContext=e,this.paceZones=i,this.lapsContext=null!=n?n:null,this.streamsRequest.require(r),this.deferred=new jQuery.Deferred,a=[this.streamsRequest.deferred,this.paceZones.deferred],this.lapsContext&&a.push(this.lapsContext.deferred),jQuery.when.apply(jQuery,a).then(function(t){return function(){return t.handleReady()}}(this))}var e,i,r;return r=["time","distance","pace","altitude","grade_adjusted_pace"],e=50,i=.95,t.prototype.handleReady=function(){return this.deferred.resolve()},t.prototype.hasLaps=function(){return null!=this.lapsContext},t.prototype.smoothPaceData=function(t){var i,r,n,a,s,o,l,c,h;return this.cachedPace||(this.cachedPace={}),null!=this.cachedPace[t]?this.cachedPace[t]:(r=this.chartContext.getStream("distance"),h=r[r.length-1]/e,s=this.chartContext.streamsContext.data.getSmoothPace(h,t),l=s[0],o=s[1],c=s[2],i=function(){var t,e,i;for(i=[],n=t=0,e=l.length;e>t;n=++t)a=l[n],i.push({distance:o[n],pace:a,time:c[n]});return i}(),this.cachedPace[t]=i,i)},t.prototype.effortCount=function(t){switch(t){case"laps":return this.lapData().length;case"smoothed":case"splits":return this.splitData().length;default:throw new Error("PaceAnalysis.DataContext.effortCount: unexpected effortType "+t)}},t.prototype.effortData=function(t){switch(t){case"laps":return this.lapData();case"smoothed":case"splits":return this.splitData();default:throw new Error("PaceAnalysis.DataContext.effortData: unexpected effortType "+t)}},t.prototype.lapData=function(){var t;return t=new Strava.I18n.PaceFormatter,this.lapsContext.laps.reduce(function(e){return function(i,r){var n,a,s,o,l,c,h,u,p,d,f;return p=_.last(i)||{label:0,endDistance:0},h=p.label+1,f=r.get("start_index"),c=r.get("end_index"),s=e.chartContext.convert("distance",r.get("distance")),d=p.endDistance,l=d+s,u=(l-d)/2+d,a=t.convert(r.speed({si:!0})),o=r.time(),n=r.get("raw_stream_split").gap(),i.push({label:h,startIndex:f,endIndex:c,distance:s,startDistance:d,midDistance:u,endDistance:l,elapsedTime:o,pace:a,grade_adjusted_pace:n,zone:e.paceZones.zoneForPace(n)}),i}}(this),[])},t.prototype.splitData=function(){return this.chartContext.getSplits().reduce(function(t){return function(e,i){var r,n,a,s,o,l,c,h,u,p,d,f;return u=_.last(e)||{label:0,endDistance:0},p=i.indices(),f=p[0],l=p[1],c=u.label+1,a=i.distance(),d=u.endDistance,o=d+a,h=(o-d)/2+d,n=i.pace(),s=i.elapsedTime(),r=i.gap(),e.push({label:c,startIndex:f,endIndex:l,distance:a,startDistance:d,midDistance:h,endDistance:o,elapsedTime:s,pace:n,grade_adjusted_pace:r,zone:t.paceZones.zoneForPace(r)}),e}}(this),[])},t.prototype.splitExtent=function(t){return[this.fastestSplit(t),this.slowestSplit(t)]},t.prototype.fastestSplit=function(t){return _.min(this.splitData(),function(e){return e.distance>i?e[t]:1/0})},t.prototype.slowestSplit=function(t){return _.max(this.splitData(),function(e){return e.distance>i?e[t]:-1/0})},t.prototype.averagePace=function(t){return"grade_adjusted_pace"===t?this.chartContext.getAvgGap():this.chartContext.getAvgPace()},t.prototype.paceExtent=function(){var t,e;return t=this.smoothPaceData("pace").concat(this.smoothPaceData("grade_adjusted_pace")),e=function(t){return t.pace},[d3.min(t,e),d3.max(t,e)]},t.prototype.totalDistance=function(){var t;return t=this.chartContext.getStream("distance"),t[t.length-1]},t.prototype.paceZonesDomain=function(){var t,e,i,r,n;return n=this.paceZones.paceZones,null!=n&&n.length>0?(t=n.length,r=n[0].lowerBound,e=n[t-1].upperBound,i=n.slice(1,t-1).map(function(t){return t.upperBound+(t.lowerBound-t.upperBound)/2}),_.flatten([r,i,e])):null},t.prototype.indexForDistance=function(t){return this.chartContext.findIndex("distance",t)},t.prototype.distanceForIndex=function(t){return this.chartContext.streamValAt("distance",t)},t.prototype.getSmoothInfoBoxData=function(t,e){var i,r,n,a,s,o;for(r=this.chartContext.findIndex("distance",t),o=this.chartContext.isRace()?["time","projected",e,"altitude"]:["time",e,"distance","altitude"],i={},n=0,a=o.length;a>n;n++)s=o[n],i[s]=this.createInfoRow(s,r);return i},t.prototype.createInfoRow=function(t,e){var i,r,n,a,s,o,l,c,h,u,p;return u=function(){switch(t){case"watts":case"watts_calc":case"grade_smooth":case"velocity":case"altitude":case"distance":return p=this.chartContext.streamValAt(t,e),s=this.chartContext.formatter(t),s.formatShort(p);case"pace":case"grade_adjusted_pace":return l=this.getPaceForIndex(t,e),s=this.chartContext.formatter(t),s.formatShort(l);case"projected":return l=this.getPaceForIndex("pace",e),a=this.chartContext.getStream("distance"),i=a[e],o=a[a.length-1],n=o-i,r=this.chartContext.streamValAt("time",e),c=l*n+r,(new Strava.I18n.TimespanFormatter).display(c);case"time":return h=this.chartContext.streamValAt("time",e),(new Strava.I18n.TimespanFormatter).display(h);default:return(new TwitterCldr.DecimalFormatter).format(d3.round(this.chartContext.streamValAt(t,e),2))}}.call(this),{val:u,title:this.chartContext.getStreamLabel(t)}},t.prototype.getPaceForIndex=function(t,e){var i,r,n,a,s,o,l;return a=this.chartContext.streamValAt("time",e),r=this.smoothPaceData(t),i=d3.bisector(function(t){return t.time}).left,n=i(r,a),s=r[n].time,o=r[n-1].time,s-a>a-o&&(n-=1),l=r[n].pace},t.prototype.effortAtDistance=function(t,e){return _.find(this.effortData(t),function(t){return t.startDistance<=e&&t.endDistance>=e})},t.prototype.effortForIndex=function(t,e){return this.effortData(t)[e]},t.prototype.indexForEffort=function(t,e,i){var r,n,a;a=this.effortData(t);for(n in a)if(r=a[n],r.startIndex===e&&r.endIndex===i)return parseInt(n);return null},t.prototype.adjustedElevationExtent=function(){var t;return t=d3.extent(this.chartContext.getStream("altitude")),this.chartContext.getAdjustedYDomain(t)},t.prototype.elevationData=function(){return this.chartContext.data("distance","altitude")},t.prototype.hasPaceZones=function(){return this.paceZones.paceZones&&this.paceZones.paceZones.length>0},t.prototype.isRace=function(){return this.chartContext.isRace()},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.BestEffort=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.distanceConversion=function(){return strava.i18n.measurementUnits().longConvert},i.prototype.altitudeConversion=function(){return strava.i18n.measurementUnits().shortConvert},i.prototype.indices=function(){return[this.get("start_index"),this.get("end_index")]},i.prototype.elevationDifference=function(){return this.get("elev_difference")*this.altitudeConversion()},i.prototype.elevationGainLoss=function(){return this.has("stream_split")?this.get("stream_split").elevation:null},i.prototype.distance=function(){return this.get("distance")*this.distanceConversion()},i.prototype.formatNumber=function(t,e){return null==e&&(e=0),null==t?"":(new TwitterCldr.DecimalFormatter).format(t,{precision:e})},i.prototype.formatTime=function(t){return(new Strava.I18n.TimespanFormatter).display(t)},i.prototype.formattedPace=function(){var t;return t=this.get("distance")/this.get("elapsed_time"),0===t?null:(new Strava.I18n.PaceFormatter).format(t)},i.prototype.avgSpeed=function(){return this.get("avg_speed")*this.distanceConversion()},i.prototype.avgGap=function(){return this.has("stream_split")?this.get("stream_split").gap:null},i.prototype.summarize=function(){var t;return t=this.get("abbr"),{label:this.get("label"),distance:{value:this.formatNumber(this.get("distance"),0),abbr:{title:t.distance.long,value:t.distance.short}},time:this.formatTime(this.get("elapsed_time")),elapsed_time:this.get("elapsed_time"),elevation:{value:this.elevationGainLoss(),abbr:{title:t.elevation.long,value:t.elevation.short}},heartrate:{value:this.formatNumber(this.get("avg_hr")),abbr:{title:t.heartrate.long,value:t.heartrate.short}},pace:{value:this.formattedPace(),abbr:{title:t.speed.long,value:t.speed.short}},gap:{value:this.avgGap(),abbr:{title:t.speed.long,value:t.speed.short}},speed:{value:this.formatNumber(this.avgSpeed(),1),abbr:{title:t.speed.long,value:t.speed.short}},power:{value:this.formatNumber(this.get("avg_watts")),abbr:{title:t.power.long,value:t.power.short}},hidden:{value:this.get("hidden")}}},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.BestEfforts=function(e){function i(t){i.__super__.constructor.call(this),this.activityId=t}return t(i,e),i.prototype.model=Strava.Models.BestEffort,i.prototype.url=function(){return"/activities/"+this.activityId+"/best_efforts"},i.prototype.parse=function(t){return this.newEffortTypes=t.new_effort_types,t.efforts},i}(Backbone.Collection)}.call(this),function(){Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.AthleteRacePaceViewModel=function(){function t(t,e,i){this.setting=e,null==i&&(i={}),this.athlete=new Strava.Athletes.Athlete("/athletes/"+t,t),this.athlete.on("sync",function(t){return function(){return t.handleSync()}}(this)),this.athlete.on("error",function(t){return function(e){return t.trigger("error",e)}}(this)),this.outdated=!!i.outdated}return Strava.includeModule(t,Backbone.Events),t.prototype.handleSync=function(){return this.outdated=!1,this.trigger("success",this)},t.prototype.refresh=function(){return this.athlete.set({modified:"sample_race_pace",sample_race_pace:{distance:this.setting.distance,pace:this.setting.time}}),this.athlete.save()},t}()}.call(this),function(){Strava.module("Strava.Labs.Activities.Pages"),Strava.Labs.Activities.Pages.SharedRunPageViewModule={handlePaceZonesClicked:function(){return this.resetListeners(),Strava.ExternalAnalytics.trackV2({category:"activity_detail",page:"activity_detail",action:"click",element:"pace_distribution"}),this.factory().createPaceZonesView(),this.collapseHeader(),this.pageContext().isUpsell("pace_zone_distribution")?void 0:this.paceZones().fetchPaceZones()},handleMatchedRunsClicked:function(){var t;return this.resetListeners(),t=new Backbone.Model,this.factory().createSimilarRunsView(this.similarActivities(),t),this.collapseHeader(function(e){return function(){return t.set("activityId",e.similarActivities().activityId)}}(this))}}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.Pages"),Strava.Labs.Activities.Pages.RunPageView=function(e){function i(t,e){i.__super__.constructor.call(this,t,"Run",e),this.initializeAttributes(r)}var r;return t(i,e),Strava.includeModule(i,Strava.Labs.Activities.Pages.SharedRunPageViewModule),r={athleteRacePace:null,paceAnalysisOptions:null,paceZones:null,paceZonesRefreshView:null,bestEfforts:null,similarActivities:null},i.prototype.addCustomRoutes=function(t){return t.addRoute("/segments/:segment_effort_id/sharing","segment-effort"),t.addRoute("/segments/:segment_effort_id","segment-effort"),t.bind("route:segment-effort",function(t){return function(e,i){return t.pageContext().segmentEffortId(parseInt(i)),t.handleSegmentsClicked(),t.menuView.handleRouteChange("segments")}}(this))},i.prototype.assemble=function(t){return i.__super__.assemble.call(this,t),this.paceZones(new Strava.Labs.Activities.PaceZones(this.activityId())),this.bestEfforts(new Strava.Models.BestEfforts(this.activityId())),this.assembleSimilarActivities()
},i.prototype.assembleSimilarActivities=function(){var t;if(this.similarActivitiesData())return t=Strava.Labs.Activities.SimilarActivities.SimilarActivities,this.similarActivities(new t(parseInt(this.activityId(),10),this.similarActivitiesData())),new Strava.Labs.Activities.SimilarActivities.TeaserView(this)},i.prototype.resetListeners=function(){var t;return i.__super__.resetListeners.call(this),this.paceZones().off(),t=this.paceZonesRefreshView(),t?(t.detach(),this.paceZonesRefreshView(null)):void 0},i.prototype.handleOverviewClicked=function(){return null!=this.pageContext().segmentEffortId()?void this.router().changeMenuTo("segments/"+this.pageContext().segmentEffortId(),!0):(this.resetListeners(),this.factory().createOverviewView(this.streamsRequest),this.showHeader())},i.prototype.handleBestEffortsClicked=function(){return this.factory().createBestEffortsView(this.streamsRequest)},i.prototype.handlePaceAnalysisClicked=function(){var t;return this.resetListeners(),Strava.ExternalAnalytics.trackV2({category:"activity_detail",page:"activity_detail",action:"click",element:"pace_analysis"}),t={page:"pace-analysis",action:"view-pace-analysis",event_details:[{key:"chart-type",value:this.paceAnalysisOptions().chart},{key:"show-laps",value:this.paceAnalysisOptions().showLaps},{key:"activity-id",value:this.activityId()},{key:"is-premium",value:this.currentAthlete().isPremium()}]},Strava.Util.EventLogging.trackEvent("CLIENT_ACTION",t),this.pageContext().isUpsell("workout_analysis")&&this.pageContext().isUpsell("pace_zone_distribution")||this.paceZones().fetchPaceZones(),this.factory().createPaceAnalysisView(this.streamsRequest),this.collapseHeader()},i.prototype.showSplits=function(){return!0},i.prototype.splitEffortsTableContext=function(){return this._splitEffortsTableContext||(this._splitEffortsTableContext=new Strava.Labs.Activities.SplitEffortsTableContext(this.streams(),this.chartContext(),this.eventDispatcher(),this.streamsRequest))},i.prototype.bestEffortsTableContext=function(){return this._bestEffortsTableContext||(this._bestEffortsTableContext=new Strava.Labs.Activities.BestEffortsTableContext(this.bestEfforts(),this.chartContext(),this.eventDispatcher(),this.streamsRequest))},i.prototype.basicAnalysisMapContext=function(){var t,e;return t=Strava.Labs.Activities.StreamTransformSet,e=this.contexts.contextFor(Strava.Labs.Activities.ContextManager.TYPES.MAP,t.CONVERTED_ELAPSED_TIME),this.latlngRequest().request(),e},i.prototype.basicAnalysisChartContext=function(){var t;return t=Strava.Labs.Activities.StreamTransformSet,this.contexts.contextFor(Strava.Labs.Activities.ContextManager.TYPES.CHART,t.CONVERTED_ELAPSED_TIME)},i.prototype.paceAnalysisContext=function(t){var e;return null==t&&(t=!1),this._paceAnalysisContext?this._paceAnalysisContext:(e=t?this.lapEffortsTableContext():null,this._paceAnalysisContext=new Strava.Labs.Activities.PaceAnalysis.DataContext(this.streamsRequest,this.chartContext(),this.paceZones(),e))},i.prototype.lapEffortsTableContext=function(){return this._lapEffortsTableContext||(this._lapEffortsTableContext=new Strava.Labs.Activities.LapEffortsTableContext(this.lapEfforts(),this.chartContext(),this.eventDispatcher(),this.streamsRequest))},i}(Strava.Labs.Activities.Pages.OutdoorPageView)}.call(this),function(){Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.ChartDataContext=function(){function t(e){this.similarActivities=e,this.labels=t.LABELS,this.paceFormatter=new Strava.I18n.PaceFormatter}return t.LABELS={allTimeAverage:Strava.I18n.Locale.t("strava.labs.activities.similar_activities.chart.all_time_average"),fastestEffort:Strava.I18n.Locale.t("strava.labs.activities.similar_activities.chart.fastest_effort"),pace:Strava.I18n.Locale.t("strava.labs.activities.similar_activities.chart.pace"),slowestEffort:Strava.I18n.Locale.t("strava.labs.activities.similar_activities.chart.slowest_effort"),thisEffort:Strava.I18n.Locale.t("strava.labs.activities.similar_activities.chart.this_effort")},t.prototype.originalActivityId=function(){return this.similarActivities.activityId},t.prototype.fastestActivityId=function(){return this.similarActivities.efforts.fastest().get("activity_id")},t.prototype.effortCount=function(){return this.similarActivities.summary.get("effort_count")},t.prototype.averagePace=function(){return this.paceFormatter.convert(this.similarActivities.summary.get("average_speed"))},t.prototype.slowestPace=function(){return this.paceFormatter.convert(this.similarActivities.summary.get("min_average_speed"))},t.prototype.fastestPace=function(){return this.paceFormatter.convert(this.similarActivities.summary.get("max_average_speed"))},t.prototype.invertedIdx=function(t){return this.effortCount()-1-t},t.prototype.effortIdx=function(t){return null==t&&(t=this.similarActivities.activityId),this.invertedIdx(this.similarActivities.efforts.effortIdx(t))},t.prototype.effortAt=function(t){return this.similarActivities.efforts.at(this.invertedIdx(t))},t.prototype.effortDateAt=function(t){return this.effortAt(t).get("start_date_local")},t.prototype.effortPaceAt=function(t){return this.paceFormatter.convert(this.effortAt(t).get("average_speed"))},t.prototype.activityIdAt=function(t){return this.effortAt(t).get("activity_id")},t.prototype.trendPacePoints=function(){return this.similarActivities.efforts.map(function(t){return function(e,i){return{x:t.invertedIdx(i),y:t.paceFormatter.convert(e.get("trend_speed"))}}}(this))},t.prototype.effortPacePoints=function(){return this.similarActivities.efforts.map(function(t){return function(e,i){return{x:t.invertedIdx(i),y:t.paceFormatter.convert(e.get("average_speed")),id:e.get("activity_id")}}}(this))},t.prototype.effortForActivityId=function(t){var e,i,r,n;return i=this.similarActivities.efforts.forActivityId(t),n=i.get("pace_offset"),0>n&&(r=!0,n=-n),e=(r?"-":"+")+this.paceFormatter.formatShort(n),{name:i.get("activity_name"),pace:this.paceFormatter.formatShort(i.get("average_speed")),difference:Strava.Util.StringUtils.lpad(e,8),isFaster:r}},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.Chart=function(e){function i(t,e){this.context=t,this.effortViewModel=e,this.effortViewModel.on("change:activityId",function(t){return function(e,i){return t.setCurrentEffort(i)}}(this)),this.effortViewModel.on("change:highlightActivityId",function(t){return function(e,i){return t.highlightEffort(i)}}(this)),this.dateFormatter=new Strava.I18n.DateTimeFormatter,this.paceFormatter=new Strava.I18n.ChartLabelPaceFormatter,i.__super__.constructor.call(this)}var r,n,a,s,o,l,c,h;return t(i,e),c={WIDTH:960,HEIGHT:240},l={TOP:20,RIGHT:120,BOTTOM:20,LEFT:70},h={TOP:35,BOTTOM:10},a=10,n=30,r=10,o={WIDTH:190,HEIGHT:50,PADDING_LEFT:10,PADDING_TOP:5,LINE_HEIGHT:17},s=30,i.prototype.el="#similar-activities-chart",i.prototype.initialize=function(){return i.__super__.initialize.call(this),this.render()},i.prototype.render=function(){return this.$el.empty(),this.width=c.WIDTH-l.LEFT-l.RIGHT,this.height=c.HEIGHT-l.TOP-l.BOTTOM,this.svg=d3.select(this.el).append("svg").attr({width:c.WIDTH,height:c.HEIGHT}).append("g").attr("transform","translate("+l.LEFT+", "+l.TOP+")"),this.xScale=this.getXScale(),this.yScale=this.getYScale(),this.addXAxis(this.xScale),this.addYAxis(this.yScale),this.addHorizontalLine(this.context.fastestPace(),this.context.labels.fastestEffort,"boundary-line"),this.addHorizontalLine(this.context.slowestPace(),this.context.labels.slowestEffort,"boundary-line"),this.addHorizontalLine(this.context.averagePace(),this.context.labels.allTimeAverage,"",this.context.fastestPace(),this.context.slowestPace()),this.addTrendLine(),this.addCurrentEffort(),this.addEffortsLine(),this.addEffortPoints(),this.addEventRect(),this.addEffortFlag()},i.prototype.getXScale=function(){var t,e;return t=this.context.effortCount()<a?a:this.context.effortCount(),d3.scale.ordinal().rangePoints([0,this.width],.5).domain(function(){e=[];for(var i=0,r=t-1;r>=0?r>=i:i>=r;r>=0?i++:i--)e.push(i);return e}.apply(this))},i.prototype.getYScale=function(){return d3.scale.linear().range([0,this.height]).domain(Strava.D3.Charts.Util.autoDomain([this.context.slowestPace(),this.context.fastestPace()],{paddingBottom:h.TOP,paddingTop:h.BOTTOM}))},i.prototype.addXAxis=function(t){var e;return e=d3.svg.axis().scale(t).orient("bottom").tickValues([]),this.svg.append("g").attr({"class":"axis",transform:"translate(0, "+this.height+")"}).call(e)},i.prototype.addYAxis=function(t){var e,i;return i=d3.svg.axis().scale(t).orient("left").tickFormat(function(t){return function(e,i){return 0===i?t.context.labels.pace:t.paceFormatter.formatShort(e)}}(this)).ticks(5),e=this.svg.append("g").classed("axis",!0).call(i)},i.prototype.addHorizontalLine=function(t,e,i,a,s){var o,l,c,h;return null==i&&(i=""),h=this.yScale(t),l=0,a&&h-this.yScale(a)<n&&(l=n),s&&this.yScale(s)-h<n&&(l=-n),c=this.svg.append("g"),c.append("line").attr({"class":"horiz-line "+i,x1:0,x2:this.width+(l?0:r),y1:h,y2:h}),0!==l&&(c.append("line").attr({"class":"vert-line "+i,x1:this.width,x2:this.width,y1:h,y2:h+l}),c.append("line").attr({"class":"horiz-line "+i,x1:this.width,x2:this.width+r,y1:h+l,y2:h+l})),o=c.append("g").attr("transform","translate("+(this.width+r+2)+", "+(h+l+3)+")"),o.append("text").attr({"class":"annotation"}).text(e),o.append("text").attr({"class":"annotation-pace",y:13}).text(this.paceFormatter.formatShort(t))},i.prototype.addTrendLine=function(){var t;return t=d3.svg.line().x(function(t){return function(e){return t.xScale(e.x)}}(this)).y(function(t){return function(e){return t.yScale(e.y)}}(this)).interpolate("cardinal"),this.svg.append("path").attr({d:function(e){return function(){return t(e.context.trendPacePoints())}}(this),"class":"trend-line"})},i.prototype.addEffortsLine=function(){var t;return t=d3.svg.line().x(function(t){return function(e){return t.xScale(e.x)}}(this)).y(function(t){return function(e){return t.yScale(e.y)}}(this)).interpolate("linear"),this.svg.append("path").attr({d:function(e){return function(){return t(e.context.effortPacePoints())}}(this),"class":"efforts-line"})},i.prototype.addEffortPoints=function(){var t,e,i,r,n;return i=this.context.originalActivityId(),t=this.context.fastestActivityId(),n=i===t,r=this.context.effortIdx(i),this.svg.append("circle").classed("original-effort-outer",!0).attr("cx",this.xScale(r)).attr("cy",this.yScale(this.context.effortPaceAt(r))).attr("r",12).attr("data-activity-id",i),this.svg.append("g").attr("id","effort-points").selectAll("circle").data(this.context.effortPacePoints()).enter().append("circle").classed("effort-point",!0).classed("fastest-effort-point",function(){return function(e){return e.id===t&&!n}}(this)).classed("original-effort-point",function(){return function(t){return t.id===i}}(this)).attr("cx",function(t){return function(e){return t.xScale(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale(e.y)}}(this)).attr("r",function(){return function(e){return e.id!==t||n?4:7}}(this)).attr("data-activity-id",function(){return function(t){return t.id}}(this)),n?void 0:(e=this.context.effortIdx(t),this.svg.append("circle").classed("fastest-effort-inner",!0).attr("cx",this.xScale(e)).attr("cy",this.yScale(this.context.effortPaceAt(e))).attr("r",4).attr("data-activity-id",t))},i.prototype.addCurrentEffort=function(){return this.currentEffortGroup=this.svg.append("g").attr("id","current-effort-group"),this.currentEffortGroup.append("line").attr({"class":"vert-line",y1:0,y2:this.height}),this.currentEffortGroup.append("text").attr({"class":"date-tick",x:-18,y:this.height+18})},i.prototype.addEffortFlag=function(){return this.effortFlagGroup=this.svg.append("g"),this.effortFlagGroup.append("rect").classed("effort-flag",!0).attr({width:o.WIDTH,height:o.HEIGHT}),this.effortFlagGroup.append("a").classed("effort-flag-link",!0).append("text").classed("effort-flag-name",!0).attr({x:o.PADDING_LEFT,y:o.PADDING_TOP+o.LINE_HEIGHT}),this.effortFlagGroup.append("text").classed("effort-flag-pace",!0).attr({x:o.PADDING_LEFT,y:o.PADDING_TOP+2*o.LINE_HEIGHT}),this.effortFlagGroup.append("text").classed("effort-flag-diff",!0).attr({x:.4*o.WIDTH,y:o.PADDING_TOP+2*o.LINE_HEIGHT}),this.effortFlagGroup.append("line").classed("horiz-line",!0).attr({x1:.65*o.WIDTH,x2:.8*o.WIDTH,y1:o.PADDING_TOP+1.8*o.LINE_HEIGHT,y2:o.PADDING_TOP+1.8*o.LINE_HEIGHT})},i.prototype.addEventRect=function(){return this.svg.append("rect").classed("event-rect",!0).classed("clickable",!0).attr("width",this.width).attr("height",this.height).on("mousemove",this.createHandler(function(t){return function(e){return t.handleMouseMove(e)}}(this))).on("mouseleave",function(t){return function(){return t.handleMouseLeave()}}(this)).on("click",this.createHandler(function(t){return function(e){return t.handleClick(e)}}(this)))},i.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},i.prototype.handleMouseMove=function(t){return this.effortViewModel.set("highlightActivityId",this.mouseActivityId(t))},i.prototype.handleMouseLeave=function(){return this.effortViewModel.set("highlightActivityId",null)},i.prototype.handleClick=function(t){return this.effortViewModel.set("activityId",this.mouseActivityId(t))},i.prototype.mouseActivityId=function(t){var e,i;return i=d3.mouse(t)[0],e=Strava.D3.Charts.Util.closestOrdinalValue(i,this.xScale),e>this.context.effortCount()-1&&(e=this.context.effortCount()-1),this.context.activityIdAt(e)},i.prototype.setCurrentEffort=function(t){var e,i,r,n,a;return e=this.context.effortIdx(t),r=this.xScale(e),a=this.yScale(this.context.effortPaceAt(e)),this.setEffortPointClass(null,"selected"),this.currentEffortGroup.transition().duration(300).attr("transform","translate("+r+")").each("end",function(i){return function(){var r,n,a;return r=i.context.effortForActivityId(t),n=i.effortFlagGroup.select(".effort-flag-link"),t===i.context.originalActivityId()?(a=i.context.labels.thisEffort,n.classed("original-effort-link",!0).attr("xlink:href","javascript:;")):(a=r.name.length<=s?r.name:r.name.substring(0,s-3)+"...",n.classed("original-effort-link",!1).attr("xlink:href","/activities/"+t)),i.effortFlagGroup.select(".effort-flag-name").text(a),i.effortFlagGroup.select(".effort-flag-pace").text(r.pace),i.effortFlagGroup.select(".effort-flag-diff").html(r.difference).classed("faster",r.isFaster),i.currentEffortGroup.select(".date-tick").text(i.dateFormatter.format(new Date(1e3*i.context.effortDateAt(e)),{format:"date",type:"short"})),i.setEffortPointClass(t,"selected")}}(this)),i=r+o.WIDTH>this.width&&r>o.WIDTH,n=i?r-o.WIDTH:r,this.effortFlagGroup.transition().duration(300).attr("transform","translate("+n+")")},i.prototype.highlightEffort=function(t){return this.setEffortPointClass(t,"highlighted")},i.prototype.setEffortPointClass=function(t,e){return this.svg.selectAll("circle").classed(e,!1),t?this.svg.selectAll("circle[data-activity-id='"+t+"']").classed(e,!0):void 0},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_activities/chart_footer"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<section class='inset'>\n  <span class='effort-count'>"),i.push("    "+t(Strava.I18n.Locale.t("templates.activities.similar_activities.chart_footer.total_efforts_html",{count:this.effortCount}))),i.push("  </span>\n  <span class='trending-average'>\n    <svg width='"+e(t(55))+"' height='"+e(t(7))+"'>\n      <line class='trend-line' x1='"+e(t(25))+"' x2='"+e(t(50))+"' y1='"+e(t(2))+"' y2='"+e(t(2))+"'></line>\n    </svg>"),i.push("    "+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.chart_footer.trending_average")))),i.push("    <a class='js-trending-average-education' href='javascript:;'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.chart_footer.whats_this")))),i.push("    </a>\n  </span>\n</section>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.ChartFooterView=function(e){function i(t){this.summary=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.el="#similar-activities-chart-footer",i.prototype.template="activities/similar_activities/chart_footer",i.prototype.initialize=function(){return i.__super__.initialize.call(this),this.render()},i.prototype.render=function(){return this.renderTemplate({effortCount:this.summary.get("effort_count")}),this.$(".js-trending-average-education").each(function(){return new Strava.Labs.Activities.SimilarActivities.TrendEducationLightboxView({el:this})})},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.Effort=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.idAttribute="activity_id",i.prototype.setPaceOffset=function(t){return this.set("pace_offset",1/(1/this.get("average_speed")-1/t))},i}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_activities/effort_row"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td class='"+["date-column",""+e(t(this.isOriginalActivity?"original-activity":""))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"+e(t(this.date))+"</td>\n<td class='name-column'>"),this.isFastestActivity&&i.push("  <svg class='right' height='"+e(t(17))+"' width='"+e(t(16))+"'>\n    <circle class='effort-point fastest-effort-point' cx='"+e(t(8))+"' cy='"+e(t(9))+"' r='"+e(t(7))+"'></circle>\n    <circle class='fastest-effort-inner' cx='"+e(t(8))+"' cy='"+e(t(9))+"' r='"+e(t(4))+"'>\n      <title>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.effort_row.fastest_effort")))+"</title>\n    </circle>\n  </svg>"),i.push("  <div class='name'>"+e(t(this.name))+"</div>\n</td>\n<td class='pace-column'>"+e(t(this.pace))+"</td>\n<td class='difference-column'>"+e(t(this.difference))+"</td>\n<td class='time-column'>"+e(t(this.movingTime))+"</td>\n<td class='hr-column'>"+e(t(this.avgHr))+"</td>\n<td class='activity-column'>"),this.isOriginalActivity||i.push("  \x91<a class='view-all-link with-sprite' href='/activities/"+e(t(this.id))+"'>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.effort_row.view_activity")))+"</a>\x92"),i.push("</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.EffortRowView=function(e){function i(t,e,r){this.effort=t,this.originalActivityId=e,this.fastestActivityId=r,this.template="activities/similar_activities/effort_row",this.dateFormatter=new Strava.I18n.DateTimeFormatter,this.paceFormatter=new Strava.I18n.PaceFormatter,this.timeFormatter=new Strava.I18n.TimespanFormatter,this.hrFormatter=new Strava.I18n.HeartRateFormatter,i.__super__.constructor.call(this)}return t(i,e),i.prototype.tagName="tr",i.prototype.attributes=function(){return{"data-activity-id":this.effort.id}},i.prototype.render=function(){var t,e,i,r,n;return r=this.effort.get("pace_offset"),0>r&&(i=!0,r=-r),e=(i?"-":"+")+this.paceFormatter.formatShort(r),n=new Date(1e3*this.effort.get("start_date_local")),t=this.effort.get("avg_hr")?this.hrFormatter.formatShort(this.effort.get("avg_hr")):"\u2014",this.renderTemplate({id:this.effort.id,date:this.dateFormatter.formatUTC(n,{format:"date",type:"short"}),name:this.effort.get("activity_name"),pace:this.paceFormatter.formatShort(this.effort.get("average_speed")),difference:e,movingTime:this.timeFormatter.display(this.effort.get("moving_time")),avgHr:t,isOriginalActivity:this.effort.id===this.originalActivityId,isFastestActivity:this.effort.id===this.fastestActivityId}),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.Efforts=function(e){function i(t,e){i.__super__.constructor.call(this,t),this.byActivityId={},this.each(function(t){return function(i){return t.byActivityId[i.get("activity_id")]=i,i.setPaceOffset(e)}}(this))}return t(i,e),i.prototype.model=Strava.Labs.Activities.SimilarActivities.Effort,i.prototype.effortIdx=function(t){var e;return e=0,this.each(function(){return function(i,r){return i.get("activity_id")===t?e=r:void 0}}(this)),e},i.prototype.forActivityId=function(t){return this.byActivityId[t]},i.prototype.fastest=function(){return this.reduce(function(t,e){return e.get("average_speed")>=t.get("average_speed")?e:t})},i}(Backbone.Collection)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_activities/efforts_table"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<table class='efforts-table hoverable marginless'>\n  <thead class='vh'>\n    <tr>\n      <th class='date-column' scope='col'>"+e(t(Strava.I18n.Locale.t("templates.generic.date")))+"</th>\n      <th class='name-column' scope='col'>"+e(t(Strava.I18n.Locale.t("templates.generic.activity")))+"</th>\n      <th class='pace-column' scope='col'>"+e(t(Strava.I18n.Locale.t("templates.generic.pace")))+"</th>\n      <th class='difference-column' scope='col'>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_runs.all_time_average_difference")))+"</th>\n      <th class='time-column' scope='col'>"+e(t(Strava.I18n.Locale.t("templates.generic.moving_time")))+"</th>\n      <th class='hr-column' scope='col'>"+e(t(Strava.I18n.Locale.t("templates.generic.heartrate_abbr")))+"</th>\n      <th class='activity-column' scope='col'></th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.EffortsTableView=function(e){function i(t,e){this.similarActivities=t,this.effortViewModel=e,this.effortViewModel.on("change:activityId",function(t){return function(e,i){return t.selectCurrentEffort(i)}}(this)),this.effortViewModel.on("change:highlightActivityId",function(t){return function(e,i){return t.highlightEffort(i)}}(this)),i.__super__.constructor.call(this)}return t(i,e),i.prototype.el="#similar-activities-efforts-table-container",i.prototype.template="activities/similar_activities/efforts_table",i.prototype.events={"click tbody tr":"handleRowClick","mouseenter tbody tr":"handleRowMouseEnter","mouseleave tbody":"handleMouseLeave"},i.prototype.initialize=function(){return i.__super__.initialize.call(this),this.render()},i.prototype.render=function(){return this.renderTemplate(),this.renderEfforts()},i.prototype.renderEfforts=function(){var t,e,i;return e=jQuery(document.createDocumentFragment()),i=this.similarActivities.activityId,t=this.similarActivities.efforts.fastest().get("activity_id"),this.similarActivities.efforts.forEach(function(){return function(r){var n;return n=new Strava.Labs.Activities.SimilarActivities.EffortRowView(r,i,t),e.append(n.render().el)}}(this)),this.$("tbody").append(e)},i.prototype.selectCurrentEffort=function(t){var e,i,r,n;return e=this.$("tr[data-activity-id='"+t+"']"),i=function(t){return function(){return t.$(".selected").removeClass("selected"),e.addClass("selected")}}(this),n=e.offset().top,r=this.$$("#similar-activities-pinnable").outerHeight(),n>=window.pageYOffset+jQuery(window).height()||n-window.pageYOffset<r?jQuery("html, body").animate({scrollTop:n-r},100,function(){return function(){return i()}}(this)):i()},i.prototype.highlightEffort=function(t){return this.$("tr").removeClass("highlighted"),t?this.$("tr[data-activity-id='"+t+"']").addClass("highlighted"):void 0},i.prototype.handleRowClick=function(t){var e;return e=jQuery(t.currentTarget),e.hasClass("selected")||"A"===t.target.tagName?void 0:this.effortViewModel.set("activityId",e.data("activity-id"))},i.prototype.handleRowMouseEnter=function(t){return this.effortViewModel.set("highlightActivityId",jQuery(t.currentTarget).data("activity-id"))},i.prototype.handleMouseLeave=function(){return this.effortViewModel.set("highlightActivityId",null)},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_activities/ftue_education"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='inset'>\n  <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.ftue_education.heading")))+"</h2>\n  <div class='row'>\n    <div class='spans8'>\n      <p>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.ftue_education.paragraph1")))+"</p>\n      <p>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.ftue_education.paragraph2")))+"</p>\n      <p>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.ftue_education.paragraph3")))+"</p>\n    </div>\n    <div class='inset spans8'>\n      <img src='"+e(t(this.imagePath))+"' alt=''>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.FtueEducationLightboxView=function(e){function i(t,e){this.pageView=e,i.__super__.constructor.call(this,t),this.lightbox=new Strava.Ui.LightboxView("ftue-education-lightbox")}return t(i,e),i.prototype.template="activities/similar_activities/ftue_education",i.prototype.events={click:"render"},i.prototype.render=function(){return this.lightbox.render(this.getTemplateFor(this.template)({imagePath:this.pageView.similarActivitiesFtueImagePath()})),jQuery.ajax({url:"/athlete/athlete_preferences/set",data:{name:"ftue_seen_froute",value:!0},type:"PUT"}),this},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.SimilarActivities=function(){function t(t,e){this.activityId=t,this.summary=new Backbone.Model(e.summary),this.trend=new Backbone.Model(e.trend),this.efforts=new Strava.Labs.Activities.SimilarActivities.Efforts(e.efforts,this.summary.get("average_speed"))}return t}()}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_activities/teaser"]=function(t){return function(){var t,e,i,r;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='no-margins row'>\n  <div class='inset spans4'>\n    <div class='matched'>"),r=Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.count_matched",{count:this.effortCount}),i.push(1===this.effortCount?"      "+e(t(r)):"      \x91<a class='js-similar-activities view-all-link with-sprite' href='javascript:;'>"+e(t(r))+"</a>\x92"),i.push("    </div>\n    <div class='mb-xs mt-sm pace'>"),i.push("      "+t(Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.this_run_pace_html",{pace:this.pace}))),i.push("    </div>"),this.isTrendingFaster&&(i.push("    <div class='trending'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.trending_up")))),i.push("      <svg width='"+e(t(13))+"' height='"+e(t(7))+"'>\n        <polygon points='5,7 9,0 13,7'></polygon>\n      </svg>\n    </div>")),i.push("  </div>\n  <div class='inset spans4'>\n    <div id='similar-activities-trend-chart'></div>\n  </div>\n  <div class='inset spans4'>"),1===this.effortCount?(i.push("    "+t(Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.achievement.default_html"))),i.push("    <br>\n    <div class='clickable js-ftue-education'>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.learn_more")))+"</div>")):(this.frequencyMilestone&&i.push("    "+t(Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.achievement.frequency_milestone_html",{count:this.frequencyMilestone}))),i.push("    <div class='"+["button","minimal","js-similar-activities","mt-"+e(t(this.frequencyMilestone?"sm":"md"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),i.push("      "+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.teaser.view_matched")))),i.push("    </div>")),i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.TeaserView=function(e){function i(t){this.pageView=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.el="#similar-activities-teaser",i.prototype.template="activities/similar_activities/teaser",i.prototype.events={"click .js-similar-activities":"handleSimilarActivitiesClick"},i.prototype.initialize=function(){return i.__super__.initialize.call(this),this.render()},i.prototype.render=function(){var t,e;return t=this.pageView.activity(),e=this.pageView.similarActivities(),this.renderTemplate({effortCount:e.summary.get("effort_count"),pace:(new Strava.I18n.PaceFormatter).formatShort(t.get("distance")/t.get("moving_time")),isTrendingFaster:1===e.trend.get("direction"),frequencyMilestone:e.summary.get("frequency_milestone")}),new Strava.Labs.Activities.SimilarActivities.TrendChart(new Strava.Labs.Activities.SimilarActivities.TrendChartDataContext(e.trend)),this.$(".js-ftue-education").each(function(t){return function(e,i){return new Strava.Labs.Activities.SimilarActivities.FtueEducationLightboxView({el:i},t.pageView)}}(this)),this.logView(t.id)},i.prototype.handleSimilarActivitiesClick=function(){return this.pageView.router().changeMenuTo("matched-runs")},i.prototype.logView=function(t){var e;return e={type:"MATCHED_RUNS_SUMMARY",matched_runs_summary:{activity_id:t}},jQuery(function(){return Strava.Util.EventLogging.trackEvent("VIEW",e)})},i}(Backbone.View)}.call(this),function(){Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.TrendChartDataContext=function(){function t(t){this.trend=t,this.labels=e,this.paceFormatter=new Strava.I18n.PaceFormatter}var e;return e={thisEffort:Strava.I18n.Locale.t("strava.labs.activities.similar_activities.chart.this_effort")},t.prototype.effortCount=function(){return this.trend.get("speeds").length},t.prototype.originalActivityIdx=function(){return this.trend.get("current_activity_index")},t.prototype.slowestPace=function(){return this.paceFormatter.convert(this.trend.get("min_speed"))
},t.prototype.fastestPace=function(){return this.paceFormatter.convert(this.trend.get("max_speed"))},t.prototype.trendPacePoints=function(){return this.trend.get("speeds").map(function(t){return function(e,i){return{x:i,y:t.paceFormatter.convert(e)}}}(this))},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.TrendChart=function(e){function i(t){this.context=t,i.__super__.constructor.call(this)}var r,n,a;return t(i,e),n={WIDTH:200,HEIGHT:80},r={BOTTOM:16,RIGHT:20},a=10,i.prototype.el="#similar-activities-trend-chart",i.prototype.initialize=function(){return i.__super__.initialize.call(this),this.render()},i.prototype.render=function(){return this.$el.empty(),this.width=n.WIDTH-r.RIGHT,this.height=n.HEIGHT-r.BOTTOM,this.svg=d3.select(this.el).append("svg").attr("width",n.WIDTH).attr("height",n.HEIGHT).append("g"),this.domainCount=this.context.effortCount()>1?this.context.effortCount():2,this.xScale=this.getXScale(),this.yScale=this.getYScale(),this.addXAxis(),this.addEffortLines(),this.addTrendLine(),this.addOriginalEffortLine()},i.prototype.getXScale=function(){var t;return d3.scale.ordinal().rangePoints([0,this.width],.5).domain(function(){t=[];for(var e=0,i=this.domainCount;i>=0?i>e:e>i;i>=0?e++:e--)t.push(e);return t}.apply(this))},i.prototype.getYScale=function(){return d3.scale.linear().range([0,this.height]).domain(Strava.D3.Charts.Util.autoDomain([this.context.slowestPace(),this.context.fastestPace()],{paddingBottom:a,paddingTop:a}))},i.prototype.addXAxis=function(){return this.svg.append("line").classed("horiz-line",!0).attr("x1",0).attr("x2",this.width).attr("y1",this.height).attr("y2",this.height)},i.prototype.addEffortLines=function(){var t;return this.svg.append("g").attr("id","effort-lines").selectAll("line").data(function(){t=[];for(var e=0,i=this.domainCount;i>=0?i>e:e>i;i>=0?e++:e--)t.push(e);return t}.apply(this)).enter().append("line").classed("vert-line",!0).attr("x1",function(t){return function(e){return t.xScale(e)}}(this)).attr("x2",function(t){return function(e){return t.xScale(e)}}(this)).attr("y1",0).attr("y2",this.height)},i.prototype.addOriginalEffortLine=function(){var t,e,i;return i=this.xScale(this.context.originalActivityIdx()),this.svg.append("line").classed("vert-line",!0).classed("original-effort-line",!0).attr("x1",i).attr("x2",i).attr("y1",0).attr("y2",this.height),t=46,e=i-t/2,0>e&&(e=0),e+t>this.width&&(e=this.width-t),this.svg.append("text").attr("x",e).attr("y",this.height+14).text(this.context.labels.thisEffort)},i.prototype.addTrendLine=function(){var t,e;return this.context.effortCount()>1?(t=d3.svg.line().x(function(t){return function(e){return t.xScale(e.x)}}(this)).y(function(t){return function(e){return t.yScale(e.y)}}(this)).interpolate("cardinal"),this.svg.append("path").classed("trend-line",!0).attr("d",function(e){return function(){return t(e.context.trendPacePoints())}}(this))):(e=.3*this.height,this.svg.append("line").classed("horiz-line",!0).classed("future-trend-line",!0).attr("x1",this.xScale(0)).attr("x2",this.xScale(1)).attr("y1",e).attr("y2",e),this.svg.append("circle").classed("future-effort-point",!0).attr("cx",this.xScale(1)).attr("cy",e).attr("r",4))},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/similar_activities/trend_education"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='inset'>\n  <h2>"+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.trend_education.heading")))+"</h2>"),i.push("  "+e(t(Strava.I18n.Locale.t("templates.activities.similar_activities.trend_education.blurb")))),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities.SimilarActivities"),Strava.Labs.Activities.SimilarActivities.TrendEducationLightboxView=function(e){function i(t){i.__super__.constructor.call(this,t),this.lightbox=new Strava.Ui.LightboxView("trend-education-lightbox")}return t(i,e),i.prototype.template="activities/similar_activities/trend_education",i.prototype.events={click:"render"},i.prototype.render=function(){return this.lightbox.render(this.getTemplateFor(this.template)({})),this},i}(Backbone.View)}.call(this);